
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Leveraging BERT and a class-based TF-IDF to create easily interpretable topics.">
      
      
        <meta name="author" content="Maarten P. Grootendorst">
      
      
        <link rel="canonical" href="https://maartengr.github.io/BERTopic/api/bertopic.html">
      
      
        <link rel="prev" href="../usecases.html">
      
      
        <link rel="next" href="backends/base.html">
      
      
      <link rel="icon" href="../icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>BERTopic - BERTopic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="black" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bertopic" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="BERTopic" class="md-header__button md-logo" aria-label="BERTopic" data-md-component="logo">
      
  <img src="../img/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BERTopic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              BERTopic
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="black" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/MaartenGr/BERTopic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../algorithm/algorithm.html" class="md-tabs__link">
        
  
    
  
  The Algorithm

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting_started/quickstart/quickstart.html" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../faq.html" class="md-tabs__link">
        
  
    
  
  FAQ

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../usecases.html" class="md-tabs__link">
        
  
    
  
  Use Cases

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="bertopic.html" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog.html" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="BERTopic" class="md-nav__button md-logo" aria-label="BERTopic" data-md-component="logo">
      
  <img src="../img/icon.png" alt="logo">

    </a>
    BERTopic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MaartenGr/BERTopic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../algorithm/algorithm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Algorithm
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/quickstart/quickstart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/serialization/serialization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/search/search.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search Topics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/best_practices/best_practices.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    In-depth
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            In-depth
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_5_1" id="__nav_3_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Visualizations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            Visualizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/visualization/visualize_topics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/visualization/visualize_documents.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/visualization/visualize_terms.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/visualization/visualize_hierarchy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hierarchy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_5_2" id="__nav_3_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Update Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_2">
            <span class="md-nav__icon md-icon"></span>
            Update Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicreduction/topicreduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic Reduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicrepresentation/topicrepresentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update Topic Representations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/outlier_reduction/outlier_reduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Outlier reduction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/parameter%20tuning/parametertuning.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameter tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/tips_and_tricks/tips_and_tricks.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tips & Tricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Sub-models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Sub-models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/embeddings/embeddings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Embeddings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/dim_reduction/dim_reduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Dimensionality Reduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/clustering/clustering.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/vectorizers/vectorizers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Vectorizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/ctfidf/ctfidf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. c-TF-IDF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6_6" id="__nav_3_6_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    6. Fine-tune Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_6">
            <span class="md-nav__icon md-icon"></span>
            6. Fine-tune Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/representation/representation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6A. Representation Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/representation/llm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6B. LLM & Generative AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/multiaspect/multiaspect.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6C. Multiple Representations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Variations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Variations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicsovertime/topicsovertime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/hierarchicaltopics/hierarchicaltopics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hierarchical Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/multimodal/multimodal.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multimodal Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/online/online.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Online Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/merge/merge.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merge Multiple Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_6" >
        
          
          <label class="md-nav__link" for="__nav_3_7_6" id="__nav_3_7_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    (semi)-supervised
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7_6">
            <span class="md-nav__icon md-icon"></span>
            (semi)-supervised
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/semisupervised/semisupervised.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Semi-supervised Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/supervised/supervised.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supervised Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/manual/manual.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/guided/guided.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guided Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/zeroshot/zeroshot.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zero-shot Topic Modeling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/distribution/distribution.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic Distributions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicsperclass/topicsperclass.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topics per Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/seed_words/seed_words.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seed Words
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../faq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../usecases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    BERTopic
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bertopic.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    BERTopic
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic" class="md-nav__link">
    bertopic._bertopic.BERTopic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topic_labels_" class="md-nav__link">
    topic_labels_
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.approximate_distribution" class="md-nav__link">
    approximate_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.find_topics" class="md-nav__link">
    find_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="md-nav__link">
    generate_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_document_info" class="md-nav__link">
    get_document_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="md-nav__link">
    get_representative_docs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic" class="md-nav__link">
    get_topic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="md-nav__link">
    get_topic_freq()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_info" class="md-nav__link">
    get_topic_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="md-nav__link">
    get_topic_tree()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topics" class="md-nav__link">
    get_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="md-nav__link">
    hierarchical_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_models" class="md-nav__link">
    merge_models()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_topics" class="md-nav__link">
    merge_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.partial_fit" class="md-nav__link">
    partial_fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.push_to_hf_hub" class="md-nav__link">
    push_to_hf_hub()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_outliers" class="md-nav__link">
    reduce_outliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_topics" class="md-nav__link">
    reduce_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.save" class="md-nav__link">
    save()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="md-nav__link">
    set_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_over_time" class="md-nav__link">
    topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_per_class" class="md-nav__link">
    topics_per_class()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.update_topics" class="md-nav__link">
    update_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_approximate_distribution" class="md-nav__link">
    visualize_approximate_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="md-nav__link">
    visualize_barchart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="md-nav__link">
    visualize_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_document_datamap" class="md-nav__link">
    visualize_document_datamap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_documents" class="md-nav__link">
    visualize_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="md-nav__link">
    visualize_heatmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="md-nav__link">
    visualize_hierarchical_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="md-nav__link">
    visualize_hierarchy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="md-nav__link">
    visualize_term_rank()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics" class="md-nav__link">
    visualize_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="md-nav__link">
    visualize_topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="md-nav__link">
    visualize_topics_per_class()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Sub-models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Sub-models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_1" >
        
          
          <label class="md-nav__link" for="__nav_6_2_1" id="__nav_6_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backends
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_1">
            <span class="md-nav__icon md-icon"></span>
            Backends
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="backends/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="backends/word_doc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Word Doc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="backends/openai.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="backends/cohere.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cohere
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2_2" id="__nav_6_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dimensionality Reduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_2">
            <span class="md-nav__icon md-icon"></span>
            Dimensionality Reduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="dimensionality/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_3" >
        
          
          <label class="md-nav__link" for="__nav_6_2_3" id="__nav_6_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clustering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_3">
            <span class="md-nav__icon md-icon"></span>
            Clustering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="cluster/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_4" >
        
          
          <label class="md-nav__link" for="__nav_6_2_4" id="__nav_6_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vectorizers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_4">
            <span class="md-nav__icon md-icon"></span>
            Vectorizers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="ctfidf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cTFIDF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="onlinecv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OnlineCountVectorizer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_5" >
        
          
          <label class="md-nav__link" for="__nav_6_2_5" id="__nav_6_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topic Representation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_5">
            <span class="md-nav__icon md-icon"></span>
            Topic Representation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/mmr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MaximalMarginalRelevance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/keybert.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KeyBERT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/pos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PartOfSpeech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_5_5" >
        
          
          <label class="md-nav__link" for="__nav_6_2_5_5" id="__nav_6_2_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Text Generation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_5_5">
            <span class="md-nav__icon md-icon"></span>
            Text Generation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/generation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ðŸ¤— Transformers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/langchain.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LangChain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/cohere.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cohere
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/openai.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="representation/zeroshot.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zero-shot Classification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Plotting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Plotting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/barchart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Barchart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/documents.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/document_datamap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents with DataMapPlot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/dtm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DTM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/hierarchical_documents.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hierarchical documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/hierarchy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hierarchical topics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/distribution.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distribution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/heatmap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heatmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/term.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Term Scores
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/topics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="plotting/topics_per_class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topics per Class
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../changelog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic" class="md-nav__link">
    bertopic._bertopic.BERTopic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topic_labels_" class="md-nav__link">
    topic_labels_
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.approximate_distribution" class="md-nav__link">
    approximate_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.find_topics" class="md-nav__link">
    find_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="md-nav__link">
    generate_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_document_info" class="md-nav__link">
    get_document_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="md-nav__link">
    get_representative_docs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic" class="md-nav__link">
    get_topic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="md-nav__link">
    get_topic_freq()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_info" class="md-nav__link">
    get_topic_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="md-nav__link">
    get_topic_tree()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topics" class="md-nav__link">
    get_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="md-nav__link">
    hierarchical_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_models" class="md-nav__link">
    merge_models()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_topics" class="md-nav__link">
    merge_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.partial_fit" class="md-nav__link">
    partial_fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.push_to_hf_hub" class="md-nav__link">
    push_to_hf_hub()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_outliers" class="md-nav__link">
    reduce_outliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_topics" class="md-nav__link">
    reduce_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.save" class="md-nav__link">
    save()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="md-nav__link">
    set_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_over_time" class="md-nav__link">
    topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_per_class" class="md-nav__link">
    topics_per_class()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.update_topics" class="md-nav__link">
    update_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_approximate_distribution" class="md-nav__link">
    visualize_approximate_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="md-nav__link">
    visualize_barchart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="md-nav__link">
    visualize_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_document_datamap" class="md-nav__link">
    visualize_document_datamap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_documents" class="md-nav__link">
    visualize_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="md-nav__link">
    visualize_heatmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="md-nav__link">
    visualize_hierarchical_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="md-nav__link">
    visualize_hierarchy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="md-nav__link">
    visualize_term_rank()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics" class="md-nav__link">
    visualize_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="md-nav__link">
    visualize_topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="md-nav__link">
    visualize_topics_per_class()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="bertopic"><code>BERTopic</code><a class="headerlink" href="#bertopic" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-class">

<a id="bertopic._bertopic.BERTopic"></a>
    <div class="doc doc-contents first">

      <p>BERTopic is a topic modeling technique that leverages BERT embeddings and
c-TF-IDF to create dense clusters allowing for easily interpretable topics
whilst keeping important words in the topic descriptions.</p>
<p>The default embedding model is <code>all-MiniLM-L6-v2</code> when selecting <code>language="english"</code>
and <code>paraphrase-multilingual-MiniLM-L12-v2</code> when selecting <code>language="multilingual"</code>.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics_</code></td>
        <td><code>List[int]) </code></td>
        <td><p>The topics that are generated for each document after training or updating
                  the topic model. The most recent topics are tracked.</p></td>
      </tr>
      <tr>
        <td><code>probabilities_</code></td>
        <td><code>List[float]</code></td>
        <td><p>The probability of the assigned topic per document. These are
                          only calculated if a HDBSCAN model is used for the clustering step.
                          When <code>calculate_probabilities=True</code>, then it is the probabilities
                          of all topics per document.</p></td>
      </tr>
      <tr>
        <td><code>topic_sizes_</code></td>
        <td><code>Mapping[int, int]) </code></td>
        <td><p>The size of each topic.</p></td>
      </tr>
      <tr>
        <td><code>topic_mapper_</code></td>
        <td><code>TopicMapper) </code></td>
        <td><p>A class for tracking topics and their mappings anytime they are
                          merged, reduced, added, or removed.</p></td>
      </tr>
      <tr>
        <td><code>topic_representations_</code></td>
        <td><code>Mapping[int, Tuple[int, float]]) </code></td>
        <td><p>The top n terms per topic and their respective
                                                       c-TF-IDF values.</p></td>
      </tr>
      <tr>
        <td><code>c_tf_idf_</code></td>
        <td><code>csr_matrix) </code></td>
        <td><p>The topic-term matrix as calculated through c-TF-IDF. To access its respective
                     words, run <code>.vectorizer_model.get_feature_names()</code>  or
                     <code>.vectorizer_model.get_feature_names_out()</code></p></td>
      </tr>
      <tr>
        <td><code>topic_labels_</code></td>
        <td><code>Mapping[int, str]) </code></td>
        <td><p>The default labels for each topic.</p></td>
      </tr>
      <tr>
        <td><code>custom_labels_</code></td>
        <td><code>List[str]) </code></td>
        <td><p>Custom labels for each topic.</p></td>
      </tr>
      <tr>
        <td><code>topic_embeddings_</code></td>
        <td><code>np.ndarray) </code></td>
        <td><p>The embeddings for each topic. They are calculated by taking the
                             centroid embedding of each cluster.</p></td>
      </tr>
      <tr>
        <td><code>representative_docs_</code></td>
        <td><code>Mapping[int, str]) </code></td>
        <td><p>The representative documents for each topic.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embedding model, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">sentence_model</span><span class="p">)</span>
</code></pre></div>
<p>Due to the stochastic nature of UMAP, the results from BERTopic might differ
and the quality can degrade. Using your own embeddings allows you to
try out BERTopic several times until you find the topics that suit
you best.</p>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BERTopic</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BERTopic is a topic modeling technique that leverages BERT embeddings and</span>
<span class="sd">    c-TF-IDF to create dense clusters allowing for easily interpretable topics</span>
<span class="sd">    whilst keeping important words in the topic descriptions.</span>

<span class="sd">    The default embedding model is `all-MiniLM-L6-v2` when selecting `language=&quot;english&quot;`</span>
<span class="sd">    and `paraphrase-multilingual-MiniLM-L12-v2` when selecting `language=&quot;multilingual&quot;`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        topics_ (List[int]) : The topics that are generated for each document after training or updating</span>
<span class="sd">                              the topic model. The most recent topics are tracked.</span>
<span class="sd">        probabilities_ (List[float]): The probability of the assigned topic per document. These are</span>
<span class="sd">                                      only calculated if a HDBSCAN model is used for the clustering step.</span>
<span class="sd">                                      When `calculate_probabilities=True`, then it is the probabilities</span>
<span class="sd">                                      of all topics per document.</span>
<span class="sd">        topic_sizes_ (Mapping[int, int]) : The size of each topic.</span>
<span class="sd">        topic_mapper_ (TopicMapper) : A class for tracking topics and their mappings anytime they are</span>
<span class="sd">                                      merged, reduced, added, or removed.</span>
<span class="sd">        topic_representations_ (Mapping[int, Tuple[int, float]]) : The top n terms per topic and their respective</span>
<span class="sd">                                                                   c-TF-IDF values.</span>
<span class="sd">        c_tf_idf_ (csr_matrix) : The topic-term matrix as calculated through c-TF-IDF. To access its respective</span>
<span class="sd">                                 words, run `.vectorizer_model.get_feature_names()`  or</span>
<span class="sd">                                 `.vectorizer_model.get_feature_names_out()`</span>
<span class="sd">        topic_labels_ (Mapping[int, str]) : The default labels for each topic.</span>
<span class="sd">        custom_labels_ (List[str]) : Custom labels for each topic.</span>
<span class="sd">        topic_embeddings_ (np.ndarray) : The embeddings for each topic. They are calculated by taking the</span>
<span class="sd">                                         centroid embedding of each cluster.</span>
<span class="sd">        representative_docs_ (Mapping[int, str]) : The representative documents for each topic.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probabilities = topic_model.fit_transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embedding model, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    topic_model = BERTopic(embedding_model=sentence_model)</span>
<span class="sd">    ```</span>

<span class="sd">    Due to the stochastic nature of UMAP, the results from BERTopic might differ</span>
<span class="sd">    and the quality can degrade. Using your own embeddings allows you to</span>
<span class="sd">    try out BERTopic several times until you find the topics that suit</span>
<span class="sd">    you best.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
        <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">min_topic_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">calculate_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">seed_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zeroshot_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zeroshot_min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">umap_model</span><span class="p">:</span> <span class="n">UMAP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hdbscan_model</span><span class="p">:</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">TfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_model</span><span class="p">:</span> <span class="n">BaseRepresentation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;BERTopic initialization.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            language: The main language used in your documents. The default sentence-transformers</span>
<span class="sd">                      model for &quot;english&quot; is `all-MiniLM-L6-v2`. For a full overview of</span>
<span class="sd">                      supported languages see bertopic.backend.languages. Select</span>
<span class="sd">                      &quot;multilingual&quot; to load in the `paraphrase-multilingual-MiniLM-L12-v2`</span>
<span class="sd">                      sentence-transformers model that supports 50+ languages.</span>
<span class="sd">                      NOTE: This is not used if `embedding_model` is used.</span>
<span class="sd">            top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                         too high can negatively impact topic embeddings as topics</span>
<span class="sd">                         are typically best represented by at most 10 words.</span>
<span class="sd">            n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">                          Advised to keep high values between 1 and 3.</span>
<span class="sd">                          More would likely lead to memory issues.</span>
<span class="sd">                          NOTE: This param will not be used if you pass in your own</span>
<span class="sd">                          CountVectorizer.</span>
<span class="sd">            min_topic_size: The minimum size of the topic. Increasing this value will lead</span>
<span class="sd">                            to a lower number of clusters/topics and vice versa.</span>
<span class="sd">                            It is the same parameter as `min_cluster_size` in HDBSCAN.</span>
<span class="sd">                            NOTE: This param will not be used if you are using `hdbscan_model`.</span>
<span class="sd">            nr_topics: Specifying the number of topics will reduce the initial</span>
<span class="sd">                       number of topics to the value specified. This reduction can take</span>
<span class="sd">                       a while as each reduction in topics (-1) activates a c-TF-IDF</span>
<span class="sd">                       calculation. If this is set to None, no reduction is applied. Use</span>
<span class="sd">                       &quot;auto&quot; to automatically reduce topics using HDBSCAN.</span>
<span class="sd">                       NOTE: Controlling the number of topics is best done by adjusting</span>
<span class="sd">                       `min_topic_size` first before adjusting this parameter.</span>
<span class="sd">            low_memory: Sets UMAP low memory to True to make sure less memory is used.</span>
<span class="sd">                        NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP</span>
<span class="sd">                        this parameter will not be used.</span>
<span class="sd">            calculate_probabilities: Calculate the probabilities of all topics</span>
<span class="sd">                                     per document instead of the probability of the assigned</span>
<span class="sd">                                     topic per document. This could slow down the extraction</span>
<span class="sd">                                     of topics if you have many documents (&gt; 100_000).</span>
<span class="sd">                                     NOTE: If false you cannot use the corresponding</span>
<span class="sd">                                     visualization method `visualize_probabilities`.</span>
<span class="sd">                                     NOTE: This is an approximation of topic probabilities</span>
<span class="sd">                                     as used in HDBSCAN and not an exact representation.</span>
<span class="sd">            seed_topic_list: A list of seed words per topic to converge around</span>
<span class="sd">            zeroshot_topic_list: A list of topic names to use for zero-shot classification</span>
<span class="sd">            zeroshot_min_similarity: The minimum similarity between a zero-shot topic and</span>
<span class="sd">                                     a document for assignment. The higher this value, the more</span>
<span class="sd">                                     confident the model needs to be to assign a zero-shot topic to a document.</span>
<span class="sd">            verbose: Changes the verbosity of the model, Set to True if you want</span>
<span class="sd">                     to track the stages of the model.</span>
<span class="sd">            embedding_model: Use a custom embedding model.</span>
<span class="sd">                             The following backends are currently supported</span>
<span class="sd">                               * SentenceTransformers</span>
<span class="sd">                               * Flair</span>
<span class="sd">                               * Spacy</span>
<span class="sd">                               * Gensim</span>
<span class="sd">                               * USE (TF-Hub)</span>
<span class="sd">                             You can also pass in a string that points to one of the following</span>
<span class="sd">                             sentence-transformers models:</span>
<span class="sd">                               * https://www.sbert.net/docs/pretrained_models.html</span>
<span class="sd">            umap_model: Pass in a UMAP model to be used instead of the default.</span>
<span class="sd">                        NOTE: You can also pass in any dimensionality reduction algorithm as long</span>
<span class="sd">                        as it has `.fit` and `.transform` functions.</span>
<span class="sd">            hdbscan_model: Pass in a hdbscan.HDBSCAN model to be used instead of the default</span>
<span class="sd">                           NOTE: You can also pass in any clustering algorithm as long as it has</span>
<span class="sd">                           `.fit` and `.predict` functions along with the `.labels_` variable.</span>
<span class="sd">            vectorizer_model: Pass in a custom `CountVectorizer` instead of the default model.</span>
<span class="sd">            ctfidf_model: Pass in a custom ClassTfidfTransformer instead of the default model.</span>
<span class="sd">            representation_model: Pass in a model that fine-tunes the topic representations</span>
<span class="sd">                                  calculated through c-TF-IDF. Models from `bertopic.representation`</span>
<span class="sd">                                  are supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Topic-based parameters</span>
        <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Note that extracting more than 100 words from a sparse can slow down computation quite a bit.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span> <span class="o">=</span> <span class="n">min_topic_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span> <span class="o">=</span> <span class="n">low_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span> <span class="o">=</span> <span class="n">calculate_probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="o">=</span> <span class="n">seed_topic_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span> <span class="o">=</span> <span class="n">zeroshot_topic_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span> <span class="o">=</span> <span class="n">zeroshot_min_similarity</span>

        <span class="c1"># Embedding model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">embedding_model</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>

        <span class="c1"># Vectorizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span> <span class="o">=</span> <span class="n">n_gram_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

        <span class="c1"># Representation model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span> <span class="o">=</span> <span class="n">representation_model</span>

        <span class="c1"># UMAP or another algorithm that has .fit and .transform functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="n">umap_model</span> <span class="ow">or</span> <span class="n">UMAP</span><span class="p">(</span>
            <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
            <span class="n">low_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># HDBSCAN or another clustering algorithm that has .fit and .predict functions and</span>
        <span class="c1"># the .labels_ variable to extract the labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span> <span class="ow">or</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span>
            <span class="n">min_cluster_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span><span class="p">,</span>
            <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
            <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s2">&quot;eom&quot;</span><span class="p">,</span>
            <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Public attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Private attributes for internal tracking purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;WARNING&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Some algorithms have outlier labels (-1) that can be tricky to work</span>
<span class="sd">        with if you are slicing data based on that labels. Therefore, we</span>
<span class="sd">        track if there are outlier labels and act accordingly when slicing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer indicating whether outliers are present in the topic model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">topic_labels_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map topic IDs to their labels.</span>
<span class="sd">        A label is the topic ID, along with the first four words of the topic representation, joined using &#39;_&#39;.</span>
<span class="sd">        Zeroshot topic labels come from self.zeroshot_topic_list rather than the calculated representation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topic_labels: a dict mapping a topic ID (int) to its label (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topic_labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">():</span>
            <span class="c1"># Need to correct labels from zero-shot topics</span>
            <span class="n">topic_id_to_zeroshot_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">topic_id</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span><span class="p">[</span><span class="n">zeroshot_topic_idx</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">topic_id</span><span class="p">,</span> <span class="n">zeroshot_topic_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">topic_labels</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">topic_id_to_zeroshot_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">topic_labels</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            images: A list of paths to the images to fit on or the images themselves</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic().fit(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings, use it as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the models on a collection of documents, generate topics,</span>
<span class="sd">        and return the probabilities and topic per document.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            images: A list of paths to the images to fit on or the images themselves</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            predictions: Topic predictions for each documents</span>
<span class="sd">            probabilities: The probability of the assigned topic per document.</span>
<span class="sd">                           If `calculate_probabilities` in BERTopic is set to True, then</span>
<span class="sd">                           it calculates the probabilities of all topics across all documents</span>
<span class="sd">                           instead of only the assigned topic. This, however, slows down</span>
<span class="sd">                           computation and may increase memory usage.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings, use it as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">check_documents_type</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
            <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="n">doc_ids</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">))</span> <span class="k">if</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">))</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">})</span>

        <span class="c1"># Extract embeddings</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Embedding - Transforming documents to embeddings.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
                <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Embedding - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
                <span class="p">)</span>

        <span class="c1"># Guided Topic Modeling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Reduce dimensionality and fit UMAP model</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Zero-shot Topic Modeling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">():</span>
            <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">,</span> <span class="n">assigned_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zeroshot_topic_modeling</span><span class="p">(</span>
                <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span>
            <span class="p">)</span>
            <span class="c1"># Filter UMAP embeddings to only non-assigned embeddings to be used for clustering</span>
            <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># No zero-shot topics matched</span>
            <span class="c1"># Cluster reduced embeddings</span>
            <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_combine_zeroshot_topics</span><span class="p">(</span>
                    <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">,</span> <span class="n">assigned_embeddings</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># All documents matches zero-shot topics</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">assigned_documents</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">assigned_embeddings</span>
        <span class="n">topics_before_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>

        <span class="c1"># Sort and Map Topic IDs by their frequency</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Create documents from images if we have images only</span>
        <span class="k">if</span> <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_to_text</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

            <span class="c1"># Extract topics by calculating c-TF-IDF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

            <span class="c1"># Reduce topics</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
                <span class="n">custom_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">)</span>

            <span class="c1"># Save the top 3 most representative documents per topic</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Extract topics by calculating c-TF-IDF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

            <span class="c1"># Reduce topics</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
                <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

            <span class="c1"># Save the top 3 most representative documents per topic</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># In the case of zero-shot topics, probability will come from cosine similarity,</span>
        <span class="c1"># and the HDBSCAN model will be removed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">BaseCluster</span><span class="p">()</span>
            <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Use `topics_before_reduction` because `self.topics_` may have already been updated from</span>
                <span class="c1"># reducing topics, and the original probabilities are needed for `self._map_probabilities()`</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span><span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topics_before_reduction</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">,</span>
                <span class="p">]</span>

        <span class="c1"># Resulting output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;After having fit a model, use transform to predict new instances.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A single document or a list of documents to predict on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model.</span>
<span class="sd">            images: A list of paths to the images to predict on or the images themselves</span>

<span class="sd">        Returns:</span>
<span class="sd">            predictions: Topic predictions for each documents</span>
<span class="sd">            probabilities: The topic probability distribution which is returned by default.</span>
<span class="sd">                           If `calculate_probabilities` in BERTopic is set to False, then the</span>
<span class="sd">                           probabilities are not calculated to speed up computation and</span>
<span class="sd">                           decrease memory usage.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic().fit(docs)</span>
<span class="sd">        topics, probs = topic_model.transform(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        topics, probs = topic_model.transform(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">documents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Check if an embedding model was found</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No embedding model was found to embed the documents.&quot;</span>
                <span class="s2">&quot;Make sure when loading in the model using BERTopic.load()&quot;</span>
                <span class="s2">&quot;to also specify the embedding model.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Transform without hdbscan_model and umap_model using only cosine similarity</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">BaseCluster</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting topic assignments through cosine similarity of topic and document embeddings.&quot;</span><span class="p">)</span>
            <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">))</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Transform with full pipeline</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Reducing dimensionality of input embeddings.&quot;</span><span class="p">)</span>
            <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Extract predictions and probabilities if it is a HDBSCAN-like model</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clustering - Approximating new points with `hdbscan_model`&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_supported_hdbscan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">):</span>
                <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan_delegator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;approximate_predict&quot;</span><span class="p">,</span> <span class="n">umap_embeddings</span>
                <span class="p">)</span>

                <span class="c1"># Calculate probabilities</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Probabilities - Start calculation of probabilities with HDBSCAN&quot;</span><span class="p">)</span>
                    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan_delegator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;membership_vector&quot;</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Probabilities - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cluster - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Map probabilities and predictions</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_predictions</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">partial_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit BERTopic on a subset of the data and perform online learning</span>
<span class="sd">        with batch-like data.</span>

<span class="sd">        Online topic modeling in BERTopic is performed by using dimensionality</span>
<span class="sd">        reduction and cluster algorithms that support a `partial_fit` method</span>
<span class="sd">        in order to incrementally train the topic model.</span>

<span class="sd">        Likewise, the `bertopic.vectorizers.OnlineCountVectorizer` is used</span>
<span class="sd">        to dynamically update its vocabulary when presented with new data.</span>
<span class="sd">        It has several parameters for modeling decay and updating the</span>
<span class="sd">        representations.</span>

<span class="sd">        In other words, although the main algorithm stays the same, the training</span>
<span class="sd">        procedure now works as follows:</span>

<span class="sd">        For each subset of the data:</span>

<span class="sd">        1. Generate embeddings with a pre-trained language model</span>
<span class="sd">        2. Incrementally update the dimensionality reduction algorithm with `partial_fit`</span>
<span class="sd">        3. Incrementally update the cluster algorithm with `partial_fit`</span>
<span class="sd">        4. Incrementally update the OnlineCountVectorizer and apply some form of decay</span>

<span class="sd">        Note that it is advised to use `partial_fit` with batches and</span>
<span class="sd">        not single documents for the best performance.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sklearn.cluster import MiniBatchKMeans</span>
<span class="sd">        from sklearn.decomposition import IncrementalPCA</span>
<span class="sd">        from bertopic.vectorizers import OnlineCountVectorizer</span>
<span class="sd">        from bertopic import BERTopic</span>

<span class="sd">        # Prepare documents</span>
<span class="sd">        docs = fetch_20newsgroups(subset=subset,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&quot;data&quot;]</span>

<span class="sd">        # Prepare sub-models that support online learning</span>
<span class="sd">        umap_model = IncrementalPCA(n_components=5)</span>
<span class="sd">        cluster_model = MiniBatchKMeans(n_clusters=50, random_state=0)</span>
<span class="sd">        vectorizer_model = OnlineCountVectorizer(stop_words=&quot;english&quot;, decay=.01)</span>

<span class="sd">        topic_model = BERTopic(umap_model=umap_model,</span>
<span class="sd">                               hdbscan_model=cluster_model,</span>
<span class="sd">                               vectorizer_model=vectorizer_model)</span>

<span class="sd">        # Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="sd">        for index in range(0, len(docs), 1000):</span>
<span class="sd">            topic_model.partial_fit(docs[index: index+1000])</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checks</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;In order to use `.partial_fit`, the cluster model should have &quot;</span> <span class="s2">&quot;a `.partial_fit` function.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Prepare documents</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="c1"># Extract embeddings</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
                <span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
                <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
                <span class="p">)</span>

        <span class="c1"># Reduce dimensionality</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Cluster reduced embeddings</span>
        <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Map and find new topics</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">new_topic_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_topics</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_new_topics</span><span class="p">(</span><span class="n">new_topic_ids</span><span class="p">)</span>
        <span class="n">updated_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
        <span class="n">updated_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_mappings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_topics</span>

        <span class="c1"># Add missing topics (topics that were originally created but are now missing)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
            <span class="n">missing_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">updated_topics</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">missing_topic</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">missing_topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">missing_topics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Prepare documents</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">updated_topics</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

        <span class="c1"># Update topic representations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">updated_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span>
            <span class="n">updated_words</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>

        <span class="c1"># Update topic sizes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sizes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">topic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">topics_over_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">timestamps</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nr_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">evolution_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create topics over time.</span>

<span class="sd">        To create the topics over time, BERTopic needs to be already fitted once.</span>
<span class="sd">        From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">        each timestamp t. Then, the c-TF-IDF representations at timestamp t are</span>
<span class="sd">        averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">        local representations.</span>

<span class="sd">        Note:</span>
<span class="sd">            Make sure to use a limited number of unique timestamps (&lt;100) as the</span>
<span class="sd">            c-TF-IDF representation will be calculated at each single unique timestamp.</span>
<span class="sd">            Having a large number of unique timestamps can take some time to be calculated.</span>
<span class="sd">            Moreover, there aren&#39;t many use-cases where you would like to see the difference</span>
<span class="sd">            in topic representations over more than 100 different timestamps.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            timestamps: The timestamp of each document. This can be either a list of strings or ints.</span>
<span class="sd">                        If it is a list of strings, then the datetime format will be automatically</span>
<span class="sd">                        inferred. If it is a list of ints, then the documents will be ordered in</span>
<span class="sd">                        ascending order.</span>
<span class="sd">            topics: A list of topics where each topic is related to a document in `docs` and</span>
<span class="sd">                    a timestamp in `timestamps`. You can use this to apply topics_over_time on</span>
<span class="sd">                    a subset of the data. Make sure that `docs`, `timestamps`, and `topics`</span>
<span class="sd">                    all correspond to one another and have the same size.</span>
<span class="sd">            nr_bins: The number of bins you want to create for the timestamps. The left interval will</span>
<span class="sd">                     be chosen as the timestamp. An additional column will be created with the</span>
<span class="sd">                     entire interval.</span>
<span class="sd">            datetime_format: The datetime format of the timestamps if they are strings, eg â€œ%d/%m/%Yâ€.</span>
<span class="sd">                             Set this to None if you want to have it automatically detect the format.</span>
<span class="sd">                             See strftime documentation for more information on choices:</span>
<span class="sd">                             https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</span>
<span class="sd">            evolution_tuning: Fine-tune each topic representation at timestamp *t* by averaging its</span>
<span class="sd">                              c-TF-IDF matrix with the c-TF-IDF matrix at timestamp *t-1*. This creates</span>
<span class="sd">                              evolutionary topic representations.</span>
<span class="sd">            global_tuning: Fine-tune each topic representation at timestamp *t* by averaging its c-TF-IDF matrix</span>
<span class="sd">                       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                       topic representations that could not be found in the documents at timestamp *t*.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics_over_time: A dataframe that contains the topic, words, and frequency of topic</span>
<span class="sd">                              at timestamp *t*.</span>

<span class="sd">        Examples:</span>
<span class="sd">        The timestamps variable represents the timestamp of each document. If you have over</span>
<span class="sd">        100 unique timestamps, it is advised to bin the timestamps as shown below:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        topics_over_time = topic_model.topics_over_time(docs, timestamps, nr_bins=20)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">selected_topics</span> <span class="o">=</span> <span class="n">topics</span> <span class="k">if</span> <span class="n">topics</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">selected_topics</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">})</span>
        <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">all_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
        <span class="n">all_topics_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_topics</span><span class="p">)}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">infer_datetime_format</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">datetime_format</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
                <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">],</span>
                <span class="n">infer_datetime_format</span><span class="o">=</span><span class="n">infer_datetime_format</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">datetime_format</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">nr_bins</span><span class="p">:</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nr_bins</span><span class="p">)</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Bins</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Sort documents in chronological order</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">)</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There are more than 100 unique timestamps (i.e., </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="s2">&quot;which significantly slows down the application. Consider setting `nr_bins` &quot;</span>
                <span class="s2">&quot;to a value lower than 100 to speed up calculation. &quot;</span>
            <span class="p">)</span>

        <span class="c1"># For each unique timestamp, create topic representations</span>
        <span class="n">topics_over_time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span> <span class="o">==</span> <span class="n">timestamp</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">global_tuning</span> <span class="ow">or</span> <span class="n">evolution_tuning</span><span class="p">:</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Fine-tune the c-TF-IDF matrix at timestamp t by averaging it with the c-TF-IDF</span>
            <span class="c1"># matrix at timestamp t-1</span>
            <span class="k">if</span> <span class="n">evolution_tuning</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                <span class="n">overlapping_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">previous_topics</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_topics</span><span class="p">)))</span>  <span class="c1"># noqa: F821</span>
                <span class="p">)</span>

                <span class="n">current_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>
                <span class="n">previous_overlap_idx</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">previous_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>  <span class="c1"># noqa: F821</span>
                    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span>
                <span class="p">]</span>

                <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">tolil</span><span class="p">()[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">c_tf_idf</span><span class="p">[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">previous_c_tf_idf</span><span class="p">[</span><span class="n">previous_overlap_idx</span><span class="p">]</span>  <span class="c1"># noqa: F821</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="mf">2.0</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>

            <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
            <span class="c1"># by simply taking the average of the two</span>
            <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
                <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_topics_indices</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">selected_topics</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="c1"># Extract the words per topic</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Fill dataframe with results</span>
            <span class="n">topics_at_timestamp</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">topic</span><span class="p">,</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                    <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                    <span class="n">timestamp</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="n">topics_over_time</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_timestamp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">evolution_tuning</span><span class="p">:</span>
                <span class="n">previous_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  <span class="c1"># noqa: F841</span>
                <span class="n">previous_c_tf_idf</span> <span class="o">=</span> <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># noqa: F841</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Timestamp&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">topics_per_class</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">classes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create topics per class.</span>

<span class="sd">        To create the topics per class, BERTopic needs to be already fitted once.</span>
<span class="sd">        From the fitted models, the c-TF-IDF representations are calculated at</span>
<span class="sd">        each class c. Then, the c-TF-IDF representations at class c are</span>
<span class="sd">        averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">        local representations. This can be turned off if the pure representation is</span>
<span class="sd">        needed.</span>

<span class="sd">        Note:</span>
<span class="sd">            Make sure to use a limited number of unique classes (&lt;100) as the</span>
<span class="sd">            c-TF-IDF representation will be calculated at each single unique class.</span>
<span class="sd">            Having a large number of unique classes can take some time to be calculated.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            classes: The class of each document. This can be either a list of strings or ints.</span>
<span class="sd">            global_tuning: Fine-tune each topic representation for class c by averaging its c-TF-IDF matrix</span>
<span class="sd">                           with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                           topic representations that could not be found in the documents for class c.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics_per_class: A dataframe that contains the topic, words, and frequency of topics</span>
<span class="sd">                              for each class.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="n">classes</span><span class="p">})</span>
        <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># For each unique timestamp, create topic representations</span>
        <span class="n">topics_per_class</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classes</span><span class="p">)),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Class</span> <span class="o">==</span> <span class="n">class_</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
            <span class="c1"># by simply taking the average of the two</span>
            <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="c1"># Extract the words per topic</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Fill dataframe with results</span>
            <span class="n">topics_at_class</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">topic</span><span class="p">,</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                    <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                    <span class="n">class_</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="n">topics_per_class</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_class</span><span class="p">)</span>

        <span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">topics_per_class</span>

    <span class="k">def</span> <span class="nf">hierarchical_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a hierarchy of topics.</span>

<span class="sd">        To create this hierarchy, BERTopic needs to be already fitted once.</span>
<span class="sd">        Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF or topic embeddings</span>
<span class="sd">        representation using `scipy.cluster.hierarchy.linkage`.</span>

<span class="sd">        Based on that hierarchy, we calculate the topic representation at each</span>
<span class="sd">        merged step. This is a local representation, as we only assume that the</span>
<span class="sd">        chosen step is merged and not all others which typically improves the</span>
<span class="sd">        topic representation.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                        embeddings from the embedding model are used.</span>
<span class="sd">            linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                              `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">            distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                               `lambda x: 1 - cosine_similarity(x)`.</span>
<span class="sd">                               You can pass any function that returns either a square matrix of</span>
<span class="sd">                               shape (n_samples, n_samples) with zeros on the diagonal and</span>
<span class="sd">                               non-negative values or condensed distance matrix of shape</span>
<span class="sd">                               (n_samples * (n_samples - 1) / 2,) containing the upper</span>
<span class="sd">                               triangular of the distance matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                 represented by their parents and their children</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        A custom linkage function can be used as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from scipy.cluster import hierarchy as sch</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">        # Hierarchical topics</span>
<span class="sd">        linkage_function = lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs, linkage_function=linkage_function)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distance_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distance_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">linkage_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;ward&quot;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Calculate distance</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">select_topic_representation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:</span>
        <span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">distance_function</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">validate_distance_matrix</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Use the 1-D condensed distance matrix as an input instead of the raw distance matrix</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># Ensuring that the distances between clusters are unique otherwise the flatting of the hierarchy with</span>
        <span class="c1"># `sch.fcluster(...)` would produce incorrect values for &quot;Topics&quot; for these clusters</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])):</span>
            <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_unique_distances</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Calculate basic bag-of-words to be iteratively merged later</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">clean_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
        <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

        <span class="n">bow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">clean_documents</span><span class="p">)</span>

        <span class="c1"># Extract clusters</span>
        <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Parent_Name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Topics&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Child_Left_Name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Child_Right_Name&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))):</span>
            <span class="c1"># Find clustered documents</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
            <span class="n">nr_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

            <span class="c1"># Extract first topic we find to get the set of topics in a merged topic</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">topic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">clustered_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">clusters</span><span class="p">[</span><span class="n">topic</span><span class="p">]]</span>

            <span class="c1"># Group bow per cluster, calculate c-TF-IDF and extract words</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">bow</span><span class="p">[</span><span class="n">clustered_topics</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clustered_topics</span><span class="p">),</span> <span class="p">:]</span>
            <span class="n">selection</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Extract parent&#39;s name and ID</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
            <span class="n">parent_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="mi">5</span><span class="p">])</span>

            <span class="c1"># Extract child&#39;s name and ID</span>
            <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">child_left_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

            <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">child_left_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child_left_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_left_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

            <span class="c1"># Extract child&#39;s name and ID</span>
            <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">child_right_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

            <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">child_right_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child_right_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_right_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

            <span class="c1"># Save results</span>
            <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">parent_id</span><span class="p">,</span>
                <span class="n">parent_name</span><span class="p">,</span>
                <span class="n">clustered_topics</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">child_left_name</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">child_right_name</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="n">hier_topics</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hier_topics</span>

    <span class="k">def</span> <span class="nf">approximate_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">padding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_embedding_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">calculate_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A post-hoc approximation of topic distributions across documents.</span>

<span class="sd">        In order to perform this approximation, each document is split into tokens</span>
<span class="sd">        according to the provided tokenizer in the `CountVectorizer`. Then, a</span>
<span class="sd">        sliding window is applied on each document creating subsets of the document.</span>
<span class="sd">        For example, with a window size of 3 and stride of 1, the sentence:</span>

<span class="sd">        `Solving the right problem is difficult.`</span>

<span class="sd">        can be split up into `solving the right`, `the right problem`, `right problem is`,</span>
<span class="sd">        and `problem is difficult`. These are called tokensets. For each of these</span>
<span class="sd">        tokensets, we calculate their c-TF-IDF representation and find out</span>
<span class="sd">        how similar they are to the previously generated topics. Then, the</span>
<span class="sd">        similarities to the topics for each tokenset are summed up in order to</span>
<span class="sd">        create a topic distribution for the entire document.</span>

<span class="sd">        We can also dive into this a bit deeper by then splitting these tokensets</span>
<span class="sd">        up into individual tokens and calculate how much a word, in a specific sentence,</span>
<span class="sd">        contributes to the topics found in that document. This can be enabled by</span>
<span class="sd">        setting `calculate_tokens=True` which can be used for visualization purposes</span>
<span class="sd">        in `topic_model.visualize_approximate_distribution`.</span>

<span class="sd">        The main output, `topic_distributions`, can also be used directly in</span>
<span class="sd">        `.visualize_distribution(topic_distributions[index])` by simply selecting</span>
<span class="sd">        a single distribution.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A single document or a list of documents for which we</span>
<span class="sd">                       approximate their topic distributions</span>
<span class="sd">            window: Size of the moving window which indicates the number of</span>
<span class="sd">                    tokens being considered.</span>
<span class="sd">            stride: How far the window should move at each step.</span>
<span class="sd">            min_similarity: The minimum similarity of a document&#39;s tokenset</span>
<span class="sd">                            with respect to the topics.</span>
<span class="sd">            batch_size: The number of documents to process at a time. If None,</span>
<span class="sd">                        then all documents are processed at once.</span>
<span class="sd">                        NOTE: With a large number of documents, it is not</span>
<span class="sd">                        advised to process all documents at once.</span>
<span class="sd">            padding: Whether to pad the beginning and ending of a document with</span>
<span class="sd">                     empty tokens.</span>
<span class="sd">            use_embedding_model: Whether to use the topic model&#39;s embedding</span>
<span class="sd">                                 model to calculate the similarity between</span>
<span class="sd">                                 tokensets and topics instead of using c-TF-IDF.</span>
<span class="sd">            calculate_tokens: Calculate the similarity of tokens with all topics.</span>
<span class="sd">                              NOTE: This is computation-wise more expensive and</span>
<span class="sd">                              can require more memory. Using this over batches of</span>
<span class="sd">                              documents might be preferred.</span>
<span class="sd">            separator: The separator used to merge tokens into tokensets.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topic_distributions: A `n` x `m` matrix containing the topic distributions</span>
<span class="sd">                                 for all input documents with `n` being the documents</span>
<span class="sd">                                 and `m` the topics.</span>
<span class="sd">            topic_token_distributions: A list of `t` x `m` arrays with `t` being the</span>
<span class="sd">                                       number of tokens for the respective document</span>
<span class="sd">                                       and `m` the topics.</span>

<span class="sd">        Examples:</span>
<span class="sd">        After fitting the model, the topic distributions can be calculated regardless</span>
<span class="sd">        of the clustering model and regardless of whether the documents were previously</span>
<span class="sd">        seen or not:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_distr, _ = topic_model.approximate_distribution(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        As a result, the topic distributions are calculated in `topic_distr` for the</span>
<span class="sd">        entire document based on a token set with a specific window size and stride.</span>

<span class="sd">        If you want to calculate the topic distributions on a token-level:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_distr, topic_token_distr = topic_model.approximate_distribution(docs, calculate_tokens=True)</span>
<span class="sd">        ```</span>

<span class="sd">        The `topic_token_distr` then contains, for each token, the best fitting topics.</span>
<span class="sd">        As with `topic_distr`, it can contain multiple topics for a single token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
            <span class="n">batches</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">batches</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">/</span> <span class="n">batch_size</span><span class="p">)</span>

        <span class="n">topic_distributions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">topic_token_distributions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batches</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="n">doc_set</span> <span class="o">=</span> <span class="n">documents</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">]</span>

            <span class="c1"># Extract tokens</span>
            <span class="n">analyzer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">build_tokenizer</span><span class="p">()</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">analyzer</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">doc_set</span><span class="p">]</span>

            <span class="c1"># Extract token sets</span>
            <span class="n">all_sentences</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">all_token_sets_ids</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">tokenset</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">window</span><span class="p">:</span>
                    <span class="n">token_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">tokenset</span><span class="p">]</span>
                    <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Extract tokensets using window and stride parameters</span>
                    <span class="n">stride_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)))[::</span><span class="n">stride</span><span class="p">]</span>
                    <span class="n">token_sets</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">stride_index</span> <span class="ow">in</span> <span class="n">stride_indices</span><span class="p">:</span>
                        <span class="n">selected_tokens</span> <span class="o">=</span> <span class="n">tokenset</span><span class="p">[</span><span class="n">stride_index</span> <span class="p">:</span> <span class="n">stride_index</span> <span class="o">+</span> <span class="n">window</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">padding</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">)</span> <span class="o">==</span> <span class="n">window</span><span class="p">:</span>
                            <span class="n">token_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">)</span>
                            <span class="n">token_sets_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="nb">list</span><span class="p">(</span>
                                    <span class="nb">range</span><span class="p">(</span>
                                        <span class="n">stride_index</span><span class="p">,</span>
                                        <span class="n">stride_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">),</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>

                    <span class="c1"># Add empty tokens at the beginning and end of a document</span>
                    <span class="k">if</span> <span class="n">padding</span><span class="p">:</span>
                        <span class="n">padded</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">padded_ids</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">window</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">window</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">padded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokenset</span><span class="p">[:</span> <span class="n">window</span> <span class="o">-</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">)])</span>
                            <span class="n">padded_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">window</span> <span class="o">-</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">))))</span>

                        <span class="n">token_sets</span> <span class="o">=</span> <span class="n">padded</span> <span class="o">+</span> <span class="n">token_sets</span>
                        <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="n">padded_ids</span> <span class="o">+</span> <span class="n">token_sets_ids</span>

                <span class="c1"># Join the tokens</span>
                <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_sets</span><span class="p">]</span>
                <span class="n">all_sentences</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
                <span class="n">all_token_sets_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">token_sets_ids</span><span class="p">)</span>
                <span class="n">all_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>

            <span class="c1"># Calculate similarity between embeddings of token sets and the topics</span>
            <span class="k">if</span> <span class="n">use_embedding_model</span><span class="p">:</span>
                <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">all_sentences</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

            <span class="c1"># Calculate similarity between c-TF-IDF of token sets and the topics</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bow_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">all_sentences</span><span class="p">)</span>
                <span class="n">c_tf_idf_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bow_doc</span><span class="p">)</span>
                <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">c_tf_idf_doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

            <span class="c1"># Only keep similarities that exceed the minimum</span>
            <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">min_similarity</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Aggregate results on an individual token level</span>
            <span class="k">if</span> <span class="n">calculate_tokens</span><span class="p">:</span>
                <span class="n">topic_distribution</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">topic_token_distribution</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="c1"># Assign topics to individual tokens</span>
                    <span class="n">token_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">))]</span>
                    <span class="n">token_val</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">token_id</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">sim</span><span class="p">,</span> <span class="n">token_set</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">all_token_sets_ids</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_set</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_val</span><span class="p">:</span>
                                <span class="n">token_val</span><span class="p">[</span><span class="n">token</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

                    <span class="n">matrix</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">token_val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                    <span class="c1"># Take empty documents into account</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">))</span>

                    <span class="n">topic_token_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
                    <span class="n">topic_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>

                <span class="n">topic_distribution</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Aggregate on a tokenset level indicated by the window and stride</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_distribution</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">group</span> <span class="o">=</span> <span class="n">similarity</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">topic_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                <span class="n">topic_distribution</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">topic_token_distribution</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Combine results</span>
            <span class="n">topic_distributions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">topic_token_distribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">topic_token_distributions</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_token_distributions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topic_token_distribution</span><span class="p">)</span>

        <span class="n">topic_distributions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">topic_distributions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">topic_distributions</span><span class="p">,</span> <span class="n">topic_token_distributions</span>

    <span class="k">def</span> <span class="nf">find_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find topics most similar to a search_term.</span>

<span class="sd">        Creates an embedding for a search query and compares that with</span>
<span class="sd">        the topic embeddings. The most similar topics are returned</span>
<span class="sd">        along with their similarity values.</span>

<span class="sd">        The query is specified using search_term for text queries or image for image queries.</span>

<span class="sd">        The search_term can be of any size but since it is compared</span>
<span class="sd">        with the topic representation it is advised to keep it</span>
<span class="sd">        below 5 words.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            search_term: the term you want to use to search for topics.</span>
<span class="sd">            image: path to the image you want to use to search for topics.</span>
<span class="sd">            top_n: the number of topics to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            similar_topics: the most similar topics from high to low</span>
<span class="sd">            similarity: the similarity scores from high to low</span>

<span class="sd">        Examples:</span>
<span class="sd">        You can use the underlying embedding model to find topics that</span>
<span class="sd">        best represent the search term:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics, similarity = topic_model.find_topics(&quot;sports&quot;, top_n=5)</span>
<span class="sd">        ```</span>

<span class="sd">        Note that the search query is typically more accurate if the</span>
<span class="sd">        search_term consists of a phrase or multiple words.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This method can only be used if you did not use custom embeddings.&quot;</span><span class="p">)</span>

        <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># Extract search_term embeddings and compare with topic embeddings</span>
        <span class="k">if</span> <span class="n">search_term</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">([</span><span class="n">search_term</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
                <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">image</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">sims</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">search_embedding</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Extract topics most similar to search_term</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sims</span><span class="p">)[</span><span class="o">-</span><span class="n">top_n</span><span class="p">:]</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="p">[</span><span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">similar_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">similar_topics</span><span class="p">,</span> <span class="n">similarity</span>

    <span class="k">def</span> <span class="nf">update_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">ClassTfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_model</span><span class="p">:</span> <span class="n">BaseRepresentation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the topic representation by recalculating c-TF-IDF with the new</span>
<span class="sd">        parameters as defined in this function.</span>

<span class="sd">        When you have trained a model and viewed the topics and the words that represent them,</span>
<span class="sd">        you might not be satisfied with the representation. Perhaps you forgot to remove</span>
<span class="sd">        stop_words or you want to try out a different n_gram_range. This function allows you</span>
<span class="sd">        to update the topic representation after they have been formed.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            images: The images you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics: A list of topics where each topic is related to a document in `docs`.</span>
<span class="sd">                    Use this variable to change or map the topics.</span>
<span class="sd">                    NOTE: Using a custom list of topic assignments may lead to errors if</span>
<span class="sd">                          topic reduction techniques are used afterwards. Make sure that</span>
<span class="sd">                          manually assigning topics is the last step in the pipeline</span>
<span class="sd">            top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                         too high can negatively impact topic embeddings as topics</span>
<span class="sd">                         are typically best represented by at most 10 words.</span>
<span class="sd">            n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">            vectorizer_model: Pass in your own CountVectorizer from scikit-learn</span>
<span class="sd">            ctfidf_model: Pass in your own c-TF-IDF model to update the representations</span>
<span class="sd">            representation_model: Pass in a model that fine-tunes the topic representations</span>
<span class="sd">                                  calculated through c-TF-IDF. Models from `bertopic.representation`</span>
<span class="sd">                                  are supported.</span>

<span class="sd">        Examples:</span>
<span class="sd">        In order to update the topic representation, you will need to first fit the topic</span>
<span class="sd">        model and extract topics from them. Based on these, you can update the representation:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.update_topics(docs, n_gram_range=(2, 3))</span>
<span class="sd">        ```</span>

<span class="sd">        You can also use a custom vectorizer to update the representation:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.feature_extraction.text import CountVectorizer</span>
<span class="sd">        vectorizer_model = CountVectorizer(ngram_range=(1, 2), stop_words=&quot;english&quot;)</span>
<span class="sd">        topic_model.update_topics(docs, vectorizer_model=vectorizer_model)</span>
<span class="sd">        ```</span>

<span class="sd">        You can also use this function to change or map the topics to something else.</span>
<span class="sd">        You can update them as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.update_topics(docs, my_updated_topics)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n_gram_range</span><span class="p">:</span>
            <span class="n">n_gram_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span>

        <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Note that extracting more than 100 words from a sparse &quot;</span> <span class="s2">&quot;can slow down computation quite a bit.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="n">n_gram_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span> <span class="o">=</span> <span class="n">representation_model</span>

        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Using a custom list of topic assignments may lead to errors if &quot;</span>
                <span class="s2">&quot;topic reduction techniques are used afterwards. Make sure that &quot;</span>
                <span class="s2">&quot;manually assigning topics is the last step in the pipeline.&quot;</span>
                <span class="s2">&quot;Note that topic embeddings will also be created through weighted&quot;</span>
                <span class="s2">&quot;c-TF-IDF embeddings instead of centroid embeddings.&quot;</span>
            <span class="p">)</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topics</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

        <span class="c1"># Update topic sizes and assignments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Extract words and update topic labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Update topic vectors</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">:</span>
            <span class="c1"># Remove outlier topic embedding if all that has changed is the outlier class</span>
            <span class="n">same_position</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="kc">True</span> <span class="k">if</span> <span class="n">old_topic</span> <span class="o">==</span> <span class="n">new_topic</span> <span class="k">else</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">old_topic</span><span class="p">,</span> <span class="n">new_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">old_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">same_position</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topics</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return topics with top n words and their c-TF-IDF score.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            full: If True, returns all different forms of topic representations</span>
<span class="sd">                  for each topic, including aspects</span>

<span class="sd">        Returns:</span>
<span class="sd">            self.topic_representations_: The top n words per topic and the corresponding c-TF-IDF score</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        all_topics = topic_model.get_topics()</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">topic_representations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">}</span>
            <span class="n">topic_representations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">topic_representations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span>

    <span class="k">def</span> <span class="nf">get_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return top n words for a specific topic and their c-TF-IDF scores.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want its representation</span>
<span class="sd">            full: If True, returns all different forms of topic representations</span>
<span class="sd">                  for a topic, including aspects</span>

<span class="sd">        Returns:</span>
<span class="sd">            The top n words for a specific word and its respective c-TF-IDF scores</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        topic = topic_model.get_topic(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
                <span class="n">representations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]}</span>
                <span class="n">aspects</span> <span class="o">=</span> <span class="p">{</span><span class="n">aspect</span><span class="p">:</span> <span class="n">representations</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">representations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">representations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">aspects</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">representations</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_topic_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about each topic including its ID, frequency, and name.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want the frequency</span>

<span class="sd">        Returns:</span>
<span class="sd">            info: The information relating to either a single topic or all topics</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        info_df = topic_model.get_topic_info()</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span>

        <span class="c1"># Custom label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="c1"># Main Keywords</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Extract all topic aspects</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span>
                    <span class="p">):</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">info</span><span class="p">[</span><span class="n">aspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Representative Docs / Images</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representative_Docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representative_Images&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span><span class="p">)</span>

        <span class="c1"># Select specific topic to return</span>
        <span class="k">if</span> <span class="n">topic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_topic_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the size of topics (descending order).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want the frequency</span>

<span class="sd">        Returns:</span>
<span class="sd">            Either the frequency of a single topic or dataframe with</span>
<span class="sd">            the frequencies of all topics</span>

<span class="sd">        Examples:</span>
<span class="sd">        To extract the frequency of all topics:</span>

<span class="sd">        ```python</span>
<span class="sd">        frequency = topic_model.get_topic_freq()</span>
<span class="sd">        ```</span>

<span class="sd">        To get the frequency of a single topic:</span>

<span class="sd">        ```python</span>
<span class="sd">        frequency = topic_model.get_topic_freq(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
                <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_document_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about the documents on which the topic was trained</span>
<span class="sd">        including the documents themselves, their respective topics, the name</span>
<span class="sd">        of each topic, the top n words of each topic, whether it is a</span>
<span class="sd">        representative document, and probability of the clustering if the cluster</span>
<span class="sd">        model supports it.</span>

<span class="sd">        There are also options to include other meta data, such as the topic</span>
<span class="sd">        distributions or the x and y coordinates of the reduced embeddings.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents on which the topic model was trained.</span>
<span class="sd">            df: A dataframe containing the metadata and the documents on which</span>
<span class="sd">                the topic model was originally trained on.</span>
<span class="sd">            metadata: A dictionary with meta data for each document in the form</span>
<span class="sd">                      of column name (key) and the respective values (value).</span>

<span class="sd">        Returns:</span>
<span class="sd">            document_info: A dataframe with several statistics regarding</span>
<span class="sd">                           the documents on which the topic model was trained.</span>

<span class="sd">        Usage:</span>

<span class="sd">        To get the document info, you will only need to pass the documents on which</span>
<span class="sd">        the topic model was trained:</span>

<span class="sd">        ```python</span>
<span class="sd">        document_info = topic_model.get_document_info(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        There are additionally options to include meta data, such as the topic</span>
<span class="sd">        distributions. Moreover, we can pass the original dataframe that contains</span>
<span class="sd">        the documents and extend it with the information retrieved from BERTopic:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        # The original data in a dataframe format to include the target variable</span>
<span class="sd">        data = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))</span>
<span class="sd">        df = pd.DataFrame({&quot;Document&quot;: data[&#39;data&#39;], &quot;Class&quot;: data[&#39;target&#39;]})</span>

<span class="sd">        # Add information about the percentage of the document that relates to the topic</span>
<span class="sd">        topic_distr, _ = topic_model.approximate_distribution(docs, batch_size=1000)</span>
<span class="sd">        distributions = [distr[topic] if topic != -1 else 0 for topic, distr in zip(topics, topic_distr)]</span>

<span class="sd">        # Create our documents dataframe using the original dataframe and meta data about</span>
<span class="sd">        # the topic distributions</span>
<span class="sd">        document_info = topic_model.get_document_info(docs, df=df,</span>
<span class="sd">                                                      metadata={&quot;Topic_distribution&quot;: distributions})</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">document_info</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
            <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

        <span class="c1"># Add topic info through `.get_topic_info()`</span>
        <span class="n">topic_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">document_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">document_info</span><span class="p">,</span> <span class="n">topic_info</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

        <span class="c1"># Add top n words</span>
        <span class="n">top_n_words</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="s2">&quot; - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
        <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Top_n_words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">document_info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">top_n_words</span><span class="p">)</span>

        <span class="c1"># Add flat probabilities</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>
                <span class="p">]</span>

        <span class="c1"># Add representative document labels</span>
        <span class="n">repr_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">repr_doc</span> <span class="k">for</span> <span class="n">repr_docs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">repr_doc</span> <span class="ow">in</span> <span class="n">repr_docs</span><span class="p">]</span>
        <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Representative_document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">document_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">document_info</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">repr_docs</span><span class="p">),</span> <span class="s2">&quot;Representative_document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Add custom meta data provided by the user</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">document_info</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">return</span> <span class="n">document_info</span>

    <span class="k">def</span> <span class="nf">get_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the best representing documents per topic.</span>

<span class="sd">        Note:</span>
<span class="sd">            This does not extract all documents per topic as all documents</span>
<span class="sd">            are not saved within BERTopic. To get all documents, please</span>
<span class="sd">            run the following:</span>

<span class="sd">            ```python</span>
<span class="sd">            # When you used `.fit_transform`:</span>
<span class="sd">            df = pd.DataFrame({&quot;Document&quot;: docs, &quot;Topic&quot;: topic})</span>

<span class="sd">            # When you used `.fit`:</span>
<span class="sd">            df = pd.DataFrame({&quot;Document&quot;: docs, &quot;Topic&quot;: topic_model.topics_})</span>
<span class="sd">            ```</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want</span>
<span class="sd">                   the representative documents</span>

<span class="sd">        Returns:</span>
<span class="sd">            Representative documents of the chosen topic</span>

<span class="sd">        Examples:</span>
<span class="sd">        To extract the representative docs of all topics:</span>

<span class="sd">        ```python</span>
<span class="sd">        representative_docs = topic_model.get_representative_docs()</span>
<span class="sd">        ```</span>

<span class="sd">        To get the representative docs of a single topic:</span>

<span class="sd">        ```python</span>
<span class="sd">        representative_docs = topic_model.get_representative_docs(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_topic_tree</span><span class="p">(</span>
        <span class="n">hier_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tight_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the topic tree such that it can be printed.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            hier_topics: A dataframe containing the structure of the topic tree.</span>
<span class="sd">                         This is the output of `topic_model.hierarchical_topics()`</span>
<span class="sd">            max_distance: The maximum distance between two topics. This value is</span>
<span class="sd">                          based on the Distance column in `hier_topics`.</span>
<span class="sd">            tight_layout: Whether to use a tight layout (narrow width) for</span>
<span class="sd">                          easier readability if you have hundreds of topics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tree that has the following structure when printed:</span>
<span class="sd">                .</span>
<span class="sd">                .</span>
<span class="sd">                â””â”€health_medical_disease_patients_hiv</span>
<span class="sd">                    â”œâ”€patients_medical_disease_candida_health</span>
<span class="sd">                    â”‚    â”œâ”€â– â”€â”€candida_yeast_infection_gonorrhea_infections â”€â”€ Topic: 48</span>
<span class="sd">                    â”‚    â””â”€patients_disease_cancer_medical_doctor</span>
<span class="sd">                    â”‚         â”œâ”€â– â”€â”€hiv_medical_cancer_patients_doctor â”€â”€ Topic: 34</span>
<span class="sd">                    â”‚         â””â”€â– â”€â”€pain_drug_patients_disease_diet â”€â”€ Topic: 26</span>
<span class="sd">                    â””â”€â– â”€â”€health_newsgroup_tobacco_vote_votes â”€â”€ Topic: 9</span>

<span class="sd">            The blocks (â– ) indicate that the topic is one you can directly access</span>
<span class="sd">            from `topic_model.get_topic`. In other words, they are the original un-grouped topics.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Train model</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Print topic tree</span>
<span class="sd">        tree = topic_model.get_topic_tree(hierarchical_topics)</span>
<span class="sd">        print(tree)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">tight_layout</span> <span class="k">else</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">max_original_topic</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Extract mapping from ID to name</span>
        <span class="n">topic_to_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_Name</span><span class="p">))</span>
        <span class="n">topic_to_name</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_Name</span><span class="p">)))</span>
        <span class="n">topic_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">name</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Create tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Parent_ID</span><span class="p">):</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Based on: https://stackoverflow.com/a/51920869/10532563.&quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">grandpa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="c1"># Get distance between merged topics</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">),</span>
                    <span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">10</span>

                <span class="k">if</span> <span class="n">parent</span> <span class="o">!=</span> <span class="n">start</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grandpa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_original_topic</span><span class="p">:</span>
                            <span class="c1"># Do not append topic ID if they are not merged</span>
                            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">:</span>
                                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;â– â”€â”€&quot;</span> <span class="o">+</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; â”€â”€ Topic: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;O </span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">to_print</span>

                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â”œ&quot;</span> <span class="o">+</span> <span class="s2">&quot;â”€&quot;</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â”‚&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

                <span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â””&quot;</span> <span class="o">+</span> <span class="s2">&quot;â”€&quot;</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

                <span class="k">return</span> <span class="n">to_print</span>

            <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">to_print</span>

        <span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set custom topic labels in your fitted BERTopic model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_labels: If a list of topic labels, it should contain the same number</span>
<span class="sd">                          of labels as there are topics. This must be ordered</span>
<span class="sd">                          from the topic with the lowest ID to the highest ID,</span>
<span class="sd">                          including topic -1 if it exists.</span>
<span class="sd">                          If a dictionary of `topic ID`: `topic_label`, it can have</span>
<span class="sd">                          any number of topics as it will only map the topics found</span>
<span class="sd">                          in the dictionary.</span>

<span class="sd">        Examples:</span>
<span class="sd">        First, we define our topic labels with `.generate_topic_labels` in which</span>
<span class="sd">        we can customize our topic labels:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_labels = topic_model.generate_topic_labels(nr_words=2,</span>
<span class="sd">                                                    topic_prefix=True,</span>
<span class="sd">                                                    word_length=10,</span>
<span class="sd">                                                    separator=&quot;, &quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Then, we pass these `topic_labels` to our topic model which</span>
<span class="sd">        can be accessed at any time with `.custom_labels_`:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.set_topic_labels(topic_labels)</span>
<span class="sd">        topic_model.custom_labels_</span>
<span class="sd">        ```</span>

<span class="sd">        You might want to change only a few topic labels instead of all of them.</span>
<span class="sd">        To do so, you can pass a dictionary where the keys are the topic IDs and</span>
<span class="sd">        its keys the topic labels:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.set_topic_labels({0: &quot;Space&quot;, 1: &quot;Sports&quot;, 2: &quot;Medicine&quot;})</span>
<span class="sd">        topic_model.custom_labels_</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">original_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
                <span class="n">original_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span>
            <span class="n">custom_labels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">else</span> <span class="n">original_labels</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span>
            <span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">):</span>
                <span class="n">custom_labels</span> <span class="o">=</span> <span class="n">topic_labels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Make sure that `topic_labels` contains the same number &quot;</span> <span class="s2">&quot;of labels as there are topics.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="n">custom_labels</span>

    <span class="k">def</span> <span class="nf">generate_topic_labels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nr_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">topic_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">word_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
        <span class="n">aspect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get labels for each topic in a user-defined format.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            nr_words: Top `n` words per topic to use</span>
<span class="sd">            topic_prefix: Whether to use the topic ID as a prefix.</span>
<span class="sd">                          If set to True, the topic ID will be separated</span>
<span class="sd">                          using the `separator`</span>
<span class="sd">            word_length: The maximum length of each word in the topic label.</span>
<span class="sd">                         Some words might be relatively long and setting this</span>
<span class="sd">                         value helps to make sure that all labels have relatively</span>
<span class="sd">                         similar lengths.</span>
<span class="sd">            separator: The string with which the words and topic prefix will be</span>
<span class="sd">                       separated. Underscores are the default but a nice alternative</span>
<span class="sd">                       is `&quot;, &quot;`.</span>
<span class="sd">            aspect: The aspect from which to generate topic labels</span>

<span class="sd">        Returns:</span>
<span class="sd">            topic_labels: A list of topic labels sorted from the lowest topic ID to the highest.</span>
<span class="sd">                          If the topic model was trained using HDBSCAN, the lowest topic ID is -1,</span>
<span class="sd">                          otherwise it is 0.</span>

<span class="sd">        Examples:</span>
<span class="sd">        To create our custom topic labels, usage is rather straightforward:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_labels = topic_model.generate_topic_labels(nr_words=2, separator=&quot;, &quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

        <span class="n">topic_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aspect</span><span class="p">:</span>
                <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">[</span><span class="n">aspect</span><span class="p">][</span><span class="n">topic</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">word_length</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[:</span><span class="n">word_length</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">][:</span><span class="n">nr_words</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)[:</span><span class="n">nr_words</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">topic_prefix</span><span class="p">:</span>
                <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}{</span><span class="n">separator</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_label</span> <span class="o">=</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

            <span class="n">topic_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">topic_labels</span>

    <span class="k">def</span> <span class="nf">merge_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">topics_to_merge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics_to_merge: Either a list of topics or a list of list of topics</span>
<span class="sd">                             to merge. For example:</span>
<span class="sd">                                [1, 2, 3] will merge topics 1, 2 and 3</span>
<span class="sd">                                [[1, 2], [3, 4]] will merge topics 1 and 2, and</span>
<span class="sd">                                separately merge topics 3 and 4.</span>
<span class="sd">            images: A list of paths to the images used when calling either</span>
<span class="sd">                    `fit` or `fit_transform`.</span>

<span class="sd">        Examples:</span>
<span class="sd">        If you want to merge topics 1, 2, and 3:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_to_merge = [1, 2, 3]</span>
<span class="sd">        topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you want to merge topics 1 and 2, and separately</span>
<span class="sd">        merge topics 3 and 4:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_to_merge = [[1, 2],</span>
<span class="sd">                            [3, 4]]</span>
<span class="sd">        topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
                <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span>
                <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
                <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic_group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_group</span><span class="p">:</span>
                    <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Make sure that `topics_to_merge` is either&quot;</span> <span class="s2">&quot;a list of topics or a list of list of topics.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Track mappings and sizes of topics for merging topic embeddings</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">topic_to</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;topics_from&quot;</span><span class="p">:</span> <span class="n">topics_from</span><span class="p">,</span>
                <span class="s2">&quot;topic_sizes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics_from</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">topic_to</span><span class="p">,</span> <span class="n">topics_from</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Update topics</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reduce_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce the number of topics to a fixed number of topics</span>
<span class="sd">        or automatically.</span>

<span class="sd">        If nr_topics is an integer, then the number of topics is reduced</span>
<span class="sd">        to nr_topics using `AgglomerativeClustering` on the cosine distance matrix</span>
<span class="sd">        of the topic c-TF-IDF or semantic embeddings.</span>

<span class="sd">        If nr_topics is `&quot;auto&quot;`, then HDBSCAN is used to automatically</span>
<span class="sd">        reduce the number of topics by running it on the topic embeddings.</span>

<span class="sd">        The topics, their sizes, and representations are updated.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The docs you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            nr_topics: The number of topics you want reduced to</span>
<span class="sd">            images: A list of paths to the images used when calling either</span>
<span class="sd">                    `fit` or `fit_transform`</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                        embeddings from the embedding model are used.</span>

<span class="sd">        Updates:</span>
<span class="sd">            topics_ : Assigns topics to their merged representations.</span>
<span class="sd">            probabilities_ : Assigns probabilities to their merged representations.</span>

<span class="sd">        Examples:</span>
<span class="sd">        You can further reduce the topics by passing the documents with their</span>
<span class="sd">        topics and probabilities (if they were calculated):</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.reduce_topics(docs, nr_topics=30)</span>
<span class="sd">        ```</span>

<span class="sd">        You can then access the updated topics and probabilities with:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics = topic_model.topics_</span>
<span class="sd">        probabilities = topic_model.probabilities_</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
                <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span>
                <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
                <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Reduce number of topics</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">reduce_outliers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;distributions&quot;</span><span class="p">,</span>
        <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distributions_params</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce outliers by merging them with their nearest topic according</span>
<span class="sd">        to one of several strategies.</span>

<span class="sd">        When using HDBSCAN, DBSCAN, or OPTICS, a number of outlier documents might be created</span>
<span class="sd">        that do not fall within any of the created topics. These are labeled as -1.</span>
<span class="sd">        This function allows the user to match outlier documents with their nearest topic</span>
<span class="sd">        using one of the following strategies using the `strategy` parameter:</span>
<span class="sd">            * &quot;probabilities&quot;</span>
<span class="sd">                This uses the soft-clustering as performed by HDBSCAN to find the</span>
<span class="sd">                best matching topic for each outlier document. To use this, make</span>
<span class="sd">                sure to calculate the `probabilities` beforehand by instantiating</span>
<span class="sd">                BERTopic with `calculate_probabilities=True`.</span>
<span class="sd">            * &quot;distributions&quot;</span>
<span class="sd">                Use the topic distributions, as calculated with `.approximate_distribution`</span>
<span class="sd">                to find the most frequent topic in each outlier document. You can use the</span>
<span class="sd">                `distributions_params` variable to tweak the parameters of</span>
<span class="sd">                `.approximate_distribution`.</span>
<span class="sd">            * &quot;c-tf-idf&quot;</span>
<span class="sd">                Calculate the c-TF-IDF representation for each outlier document and</span>
<span class="sd">                find the best matching c-TF-IDF topic representation using</span>
<span class="sd">                cosine similarity.</span>
<span class="sd">            * &quot;embeddings&quot;</span>
<span class="sd">                Using the embeddings of each outlier documents, find the best</span>
<span class="sd">                matching topic embedding using cosine similarity.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents for which we reduce or remove the outliers.</span>
<span class="sd">            topics: The topics that correspond to the documents</span>
<span class="sd">            images: A list of paths to the images used when calling either</span>
<span class="sd">                    `fit` or `fit_transform`</span>
<span class="sd">            strategy: The strategy used for reducing outliers.</span>
<span class="sd">                    Options:</span>
<span class="sd">                        * &quot;probabilities&quot;</span>
<span class="sd">                            This uses the soft-clustering as performed by HDBSCAN</span>
<span class="sd">                            to find the best matching topic for each outlier document.</span>

<span class="sd">                        * &quot;distributions&quot;</span>
<span class="sd">                            Use the topic distributions, as calculated with `.approximate_distribution`</span>
<span class="sd">                            to find the most frequent topic in each outlier document.</span>

<span class="sd">                        * &quot;c-tf-idf&quot;</span>
<span class="sd">                            Calculate the c-TF-IDF representation for outlier documents and</span>
<span class="sd">                            find the best matching c-TF-IDF topic representation.</span>

<span class="sd">                        * &quot;embeddings&quot;</span>
<span class="sd">                            Calculate the embeddings for outlier documents and</span>
<span class="sd">                            find the best matching topic embedding.</span>
<span class="sd">            probabilities: Probabilities generated by HDBSCAN for each document when using the strategy `&quot;probabilities&quot;`.</span>
<span class="sd">            threshold: The threshold for assigning topics to outlier documents. This value</span>
<span class="sd">                       represents the minimum probability when `strategy=&quot;probabilities&quot;`.</span>
<span class="sd">                       For all other strategies, it represents the minimum similarity.</span>
<span class="sd">            embeddings: The pre-computed embeddings to be used when `strategy=&quot;embeddings&quot;`.</span>
<span class="sd">                        If this is None, then it will compute the embeddings for the outlier documents.</span>
<span class="sd">            distributions_params: The parameters used in `.approximate_distribution` when using</span>
<span class="sd">                                  the strategy `&quot;distributions&quot;`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_topics: The updated topics</span>

<span class="sd">        Usage:</span>

<span class="sd">        The default settings uses the `&quot;distributions&quot;` strategy:</span>

<span class="sd">        ```python</span>
<span class="sd">        new_topics = topic_model.reduce_outliers(docs, topics)</span>
<span class="sd">        ```</span>

<span class="sd">        When you use the `&quot;probabilities&quot;` strategy, make sure to also pass the probabilities</span>
<span class="sd">        as generated through HDBSCAN:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic(calculate_probabilities=True)</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">        new_topics = topic_model.reduce_outliers(docs, topics, probabilities=probs, strategy=&quot;probabilities&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No outliers to reduce.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="s2">&quot;embeddings&quot;</span>

        <span class="c1"># Check correct use of parameters</span>
        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;probabilities&quot;</span> <span class="ow">and</span> <span class="n">probabilities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure to pass in `probabilities` in order to use the probabilities strategy&quot;</span><span class="p">)</span>

        <span class="c1"># Reduce outliers by extracting most likely topics through the topic-term probability matrix</span>
        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;probabilities&quot;</span><span class="p">:</span>
            <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="c1"># Reduce outliers by extracting most frequent topics through calculating of Topic Distributions</span>
        <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;distributions&quot;</span><span class="p">:</span>
            <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
            <span class="n">topic_distr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span>
                <span class="n">outlier_docs</span><span class="p">,</span> <span class="n">min_similarity</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="o">**</span><span class="n">distributions_params</span>
            <span class="p">)</span>
            <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">topic_distr</span><span class="p">])</span>
            <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

        <span class="c1"># Reduce outliers by finding the most similar c-TF-IDF representations</span>
        <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;c-tf-idf&quot;</span><span class="p">:</span>
            <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>

            <span class="c1"># Calculate c-TF-IDF of outlier documents with all topics</span>
            <span class="n">bow_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">outlier_docs</span><span class="p">)</span>
            <span class="n">c_tf_idf_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bow_doc</span><span class="p">)</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">c_tf_idf_doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

            <span class="c1"># Update topics</span>
            <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">similarity</span><span class="p">])</span>
            <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

        <span class="c1"># Reduce outliers by finding the most similar topic embeddings</span>
        <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;To use this strategy, you will need to pass a model to `embedding_model`&quot;</span>
                    <span class="s2">&quot;when instantiating BERTopic.&quot;</span>
                <span class="p">)</span>
            <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>

            <span class="c1"># Extract or calculate embeddings for outlier documents</span>
            <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">embeddings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outlier_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
                <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_images</span><span class="p">(</span><span class="n">outlier_images</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">outlier_docs</span><span class="p">)</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">outlier_embeddings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

            <span class="c1"># Update topics</span>
            <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">similarity</span><span class="p">])</span>
            <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">new_topics</span>

    <span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Intertopic Distance Map&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize topics, their sizes, and their corresponding words.</span>

<span class="sd">        This visualization is highly inspired by LDAvis, a great visualization</span>
<span class="sd">        technique typically reserved for LDA.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize</span>
<span class="sd">                    Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                    For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                    `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">            use_ctfidf: Whether to use c-TF-IDF representations instead of the embeddings from the embedding model.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_topics()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Documents and Topics&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model: A fitted BERTopic instance.</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">                    Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                    For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                    `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">            embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">            reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">            sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                    Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                    0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                    millions of documents as a subset is chosen.</span>
<span class="sd">            hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">            hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                                specific points. Helps to speed up generation of visualization.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_documents(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">        The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from umap import UMAP</span>

<span class="sd">        # Prepare embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">        # Train BERTopic</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>

<span class="sd">        # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">        # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">        # Run the visualization with the original embeddings</span>
<span class="sd">        topic_model.visualize_documents(docs, embeddings=embeddings)</span>

<span class="sd">        # Or, if you have reduced the original embeddings already:</span>
<span class="sd">        topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        &lt;iframe src=&quot;../getting_started/visualization/documents.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 800px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
            <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
            <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
            <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_document_datamap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Documents and Topics&quot;</span><span class="p">,</span>
        <span class="n">sub_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="o">**</span><span class="n">datamap_kwds</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D as a static plot for publication using</span>
<span class="sd">        DataMapPlot. This works best if there are between 5 and 60 topics. It is therefore best</span>
<span class="sd">        to use a sufficiently large `min_topic_size` or set `nr_topics` when building the model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model:  A fitted BERTopic instance.</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">            Not to be confused with the topics that you get from .fit_transform. For example, if you want to visualize only topics 1 through 5: topics = [1, 2, 3, 4, 5]. Documents not in these topics will be shown as noise points.</span>
<span class="sd">            embeddings:  The embeddings of all documents in `docs`.</span>
<span class="sd">            reduced_embeddings:  The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">            custom_labels:  If bool, whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">                           If `str`, it uses labels from other aspects, e.g., &quot;Aspect1&quot;.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            sub_title: Sub-title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>
<span class="sd">            **datamap_kwds:  All further keyword args will be passed on to DataMapPlot&#39;s</span>
<span class="sd">                             `create_plot` function. See the DataMapPlot documentation</span>
<span class="sd">                             for more details.</span>

<span class="sd">        Returns:</span>
<span class="sd">            figure: A Matplotlib Figure object.</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_document_datamap(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">        The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from umap import UMAP</span>

<span class="sd">        # Prepare embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">        # Train BERTopic</span>
<span class="sd">        topic_model = BERTopic(min_topic_size=36).fit(docs, embeddings)</span>

<span class="sd">        # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">        # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">        # Run the visualization with the original embeddings</span>
<span class="sd">        topic_model.visualize_document_datamap(docs, embeddings=embeddings)</span>

<span class="sd">        # Or, if you have reduced the original embeddings already:</span>
<span class="sd">        topic_model.visualize_document_datamap(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_document_datamap(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        fig.savefig(&quot;path/to/file.png&quot;, bbox_inches=&quot;tight&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">docs</span><span class="p">,</span>
            <span class="n">topics</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="p">,</span>
            <span class="n">reduced_embeddings</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">sub_title</span><span class="p">,</span>
            <span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="p">,</span>
            <span class="o">**</span><span class="n">datamap_kwds</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_hierarchical_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">nr_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">level_scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Hierarchical Documents and Topics&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D at different levels of hierarchy.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                represented by their parents and their children</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">                    Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                    For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                    `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">            embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">            reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">            sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                    Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                    0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                    millions of documents as a subset is chosen.</span>
<span class="sd">            hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">            hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                                 specific points. Helps to speed up generation of visualizations.</span>
<span class="sd">            nr_levels: The number of levels to be visualized in the hierarchy. First, the distances</span>
<span class="sd">                       in `hierarchical_topics.Distance` are split in `nr_levels` lists of distances with</span>
<span class="sd">                       equal length. Then, for each list of distances, the merged topics, that have</span>
<span class="sd">                       a distance less or equal to the maximum distance of the selected list of distances, are selected.</span>
<span class="sd">                       NOTE: To get all possible merged steps, make sure that `nr_levels` is equal to</span>
<span class="sd">                       the length of `hierarchical_topics`.</span>
<span class="sd">            level_scale: Whether to apply a linear or logarithmic (&#39;log&#39;) scale levels of the distance</span>
<span class="sd">                         vector. Linear scaling will perform an equal number of merges at each level</span>
<span class="sd">                         while logarithmic scaling will perform more mergers in earlier levels to</span>
<span class="sd">                         provide more resolution at higher levels (this can be used for when the number</span>
<span class="sd">                         of topics is large).</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">                           NOTE: Custom labels are only generated for the original</span>
<span class="sd">                           un-merged topics.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics)</span>
<span class="sd">        ```</span>

<span class="sd">        Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">        The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from umap import UMAP</span>

<span class="sd">        # Prepare embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">        # Train BERTopic and extract hierarchical topics</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">        # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">        # Run the visualization with the original embeddings</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, embeddings=embeddings)</span>

<span class="sd">        # Or, if you have reduced the original embeddings already:</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        &lt;iframe src=&quot;../getting_started/visualization/hierarchical_documents.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 770px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
            <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
            <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
            <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
            <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
            <span class="n">nr_levels</span><span class="o">=</span><span class="n">nr_levels</span><span class="p">,</span>
            <span class="n">level_scale</span><span class="o">=</span><span class="n">level_scale</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_term_rank</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Term score decline per Topic&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the ranks of all terms across all topics.</span>

<span class="sd">        Each topic is represented by a set of words. These words, however,</span>
<span class="sd">        do not all equally represent the topic. This visualization shows</span>
<span class="sd">        how many words are needed to represent a topic and at which point</span>
<span class="sd">        the beneficial effect of adding words starts to decline.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize. These will be colored</span>
<span class="sd">                    red where all others will be colored black.</span>
<span class="sd">            log_scale: Whether to represent the ranking on a log scale</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the ranks of all words across</span>
<span class="sd">        all topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_term_rank()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_term_rank()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Reference:</span>

<span class="sd">        This visualization was heavily inspired by the</span>
<span class="sd">        &quot;Term Probability Decline&quot; visualization found in an</span>
<span class="sd">        analysis by the amazing [tmtoolkit](https://tmtoolkit.readthedocs.io/).</span>
<span class="sd">        Reference to that specific analysis can be found</span>
<span class="sd">        [here](https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">log_scale</span><span class="o">=</span><span class="n">log_scale</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_topics_over_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics_over_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topics over Time&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize topics over time.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics_over_time: The topics you would like to be visualized with the</span>
<span class="sd">                              corresponding topic representation</span>
<span class="sd">            top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">            topics: Select which topics you would like to be visualized</span>
<span class="sd">            normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A plotly.graph_objects.Figure including all traces</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics over time, simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_over_time = topic_model.topics_over_time(docs, timestamps)</span>
<span class="sd">        topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics_over_time</span><span class="o">=</span><span class="n">topics_over_time</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_topics_per_class</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics_per_class</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topics per Class&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize topics per class.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics_per_class: The topics you would like to be visualized with the</span>
<span class="sd">                              corresponding topic representation</span>
<span class="sd">            top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">            topics: Select which topics you would like to be visualized</span>
<span class="sd">            normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A plotly.graph_objects.Figure including all traces</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the topics per class, simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">        topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics_per_class</span><span class="o">=</span><span class="n">topics_per_class</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">min_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topic Probability Distribution&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the distribution of topic probabilities.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            probabilities: An array of probability scores</span>
<span class="sd">            min_probability: The minimum probability score to visualize.</span>
<span class="sd">                             All others are ignored.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>
<span class="sd">        Make sure to fit the model before and only input the</span>
<span class="sd">        probabilities of a single document:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">probabilities</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span>
            <span class="n">min_probability</span><span class="o">=</span><span class="n">min_probability</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_approximate_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">document</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">topic_token_distribution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the topic distribution calculated by `.approximate_topic_distribution`</span>
<span class="sd">        on a token level. Thereby indicating the extent to which a certain word or phrase belongs</span>
<span class="sd">        to a specific topic. The assumption here is that a single word can belong to multiple</span>
<span class="sd">        similar topics and as such can give information about the broader set of topics within</span>
<span class="sd">        a single document.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model: A fitted BERTopic instance.</span>
<span class="sd">            document: The document for which you want to visualize</span>
<span class="sd">                      the approximated topic distribution.</span>
<span class="sd">            topic_token_distribution: The topic-token distribution of the document as</span>
<span class="sd">                                      extracted by `.approximate_topic_distribution`</span>
<span class="sd">            normalize: Whether to normalize, between 0 and 1 (summing up to 1), the</span>
<span class="sd">                       topic distribution values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            df: A stylized dataframe indicating the best fitting topics</span>
<span class="sd">                for each token.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Calculate the topic distributions on a token level</span>
<span class="sd">        # Note that we need to have `calculate_token_level=True`</span>
<span class="sd">        topic_distr, topic_token_distr = topic_model.approximate_distribution(</span>
<span class="sd">                docs, calculate_token_level=True</span>
<span class="sd">        )</span>

<span class="sd">        # Visualize the approximated topic distributions</span>
<span class="sd">        df = topic_model.visualize_approximate_distribution(docs[0], topic_token_distr[0])</span>
<span class="sd">        df</span>
<span class="sd">        ```</span>

<span class="sd">        To revert this stylized dataframe back to a regular dataframe,</span>
<span class="sd">        you can run the following:</span>

<span class="sd">        ```python</span>
<span class="sd">        df.data.columns = [column.strip() for column in df.data.columns]</span>
<span class="sd">        df = df.data</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_approximate_distribution</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">document</span><span class="o">=</span><span class="n">document</span><span class="p">,</span>
            <span class="n">topic_token_distribution</span><span class="o">=</span><span class="n">topic_token_distribution</span><span class="p">,</span>
            <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_hierarchy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Hierarchical Clustering&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
        <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize a hierarchical structure of the topics.</span>

<span class="sd">        A ward linkage function is used to perform the</span>
<span class="sd">        hierarchical clustering based on the cosine distance</span>
<span class="sd">        matrix between c-TF-IDF or semantic embeddings of the topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model: A fitted BERTopic instance.</span>
<span class="sd">            orientation: The orientation of the figure.</span>
<span class="sd">                         Either &#39;left&#39; or &#39;bottom&#39;</span>
<span class="sd">            topics: A selection of topics to visualize</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                        embeddings from the embedding model are used.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">                           NOTE: Custom labels are only generated for the original</span>
<span class="sd">                           un-merged topics.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure. Only works if orientation is set to &#39;left&#39;</span>
<span class="sd">            height: The height of the figure. Only works if orientation is set to &#39;bottom&#39;</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                 represented by their parents and their children.</span>
<span class="sd">                                 NOTE: The hierarchical topic names are only visualized</span>
<span class="sd">                                 if both `topics` and `top_n_topics` are not set.</span>
<span class="sd">            linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                              `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">                              NOTE: Make sure to use the same `linkage_function` as used</span>
<span class="sd">                              in `topic_model.hierarchical_topics`.</span>
<span class="sd">            distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                               `lambda x: 1 - cosine_similarity(x)`</span>
<span class="sd">                               NOTE: Make sure to use the same `distance_function` as used</span>
<span class="sd">                               in `topic_model.hierarchical_topics`.</span>
<span class="sd">            color_threshold: Value at which the separation of clusters will be made which</span>
<span class="sd">                             will result in different colors for different clusters.</span>
<span class="sd">                             A higher value will typically lead to less colored clusters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the hierarchical structure of</span>
<span class="sd">        topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_hierarchy()</span>
<span class="sd">        ```</span>

<span class="sd">        If you also want the labels of hierarchical topics visualized,</span>
<span class="sd">        run the following:</span>

<span class="sd">        ```python</span>
<span class="sd">        # Extract hierarchical topics and their representations</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Visualize these representations</span>
<span class="sd">        topic_model.visualize_hierarchy(hierarchical_topics=hierarchical_topics)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_hierarchy()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &lt;iframe src=&quot;../getting_started/visualization/hierarchy.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 680px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
            <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">,</span>
            <span class="n">distance_function</span><span class="o">=</span><span class="n">distance_function</span><span class="p">,</span>
            <span class="n">color_threshold</span><span class="o">=</span><span class="n">color_threshold</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_heatmap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Similarity Matrix&lt;/b&gt;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize a heatmap of the topic&#39;s similarity matrix.</span>

<span class="sd">        Based on the cosine similarity matrix between c-TF-IDFs or semantic embeddings of the topics,</span>
<span class="sd">        a heatmap is created showing the similarity between topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">            n_clusters: Create n clusters and order the similarity</span>
<span class="sd">                        matrix by those clusters.</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                        embeddings from the embedding model are used.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the similarity matrix of</span>
<span class="sd">        topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_heatmap()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_heatmap()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
            <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_barchart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Topic Word Scores&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
        <span class="n">autoscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize a barchart of selected topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">            n_words: Number of words to show in a topic</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of each figure.</span>
<span class="sd">            height: The height of each figure.</span>
<span class="sd">            autoscale: Whether to automatically calculate the height of the figures to fit the whole bar text</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>
<span class="sd">        To visualize the barchart of selected topics</span>
<span class="sd">        simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_barchart()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_barchart()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
            <span class="n">n_words</span><span class="o">=</span><span class="n">n_words</span><span class="p">,</span>
            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">autoscale</span><span class="o">=</span><span class="n">autoscale</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">,</span>
        <span class="n">serialization</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;safetensors&quot;</span><span class="p">,</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;pytorch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
        <span class="n">save_embedding_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the model to the specified path or folder.</span>

<span class="sd">        When saving the model, make sure to also keep track of the versions</span>
<span class="sd">        of dependencies and Python used. Loading and saving the model should</span>
<span class="sd">        be done using the same dependencies and Python. Moreover, models</span>
<span class="sd">        saved in one version of BERTopic should not be loaded in other versions.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: If `serialization` is &#39;safetensors&#39; or `pytorch`, this is a directory.</span>
<span class="sd">                  If `serialization` is `pickle`, then this is a file.</span>
<span class="sd">            serialization: If `pickle`, the entire model will be pickled. If `safetensors`</span>
<span class="sd">                           or `pytorch` the model will be saved without the embedding,</span>
<span class="sd">                           dimensionality reduction, and clustering algorithms.</span>
<span class="sd">                           This is a very efficient format and typically advised.</span>
<span class="sd">            save_embedding_model: If serialization is `pickle`, then you can choose to skip</span>
<span class="sd">                                  saving the embedding model. If serialization is `safetensors`</span>
<span class="sd">                                  or `pytorch`, this variable can be used as a string pointing</span>
<span class="sd">                                  towards a huggingface model.</span>
<span class="sd">            save_ctfidf: Whether to save c-TF-IDF information if serialization is `safetensors`</span>
<span class="sd">                         or `pytorch`</span>

<span class="sd">        Examples:</span>
<span class="sd">        To save the model in an efficient and safe format (safetensors) with c-TF-IDF information:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.save(&quot;model_dir&quot;, serialization=&quot;safetensors&quot;, save_ctfidf=True)</span>
<span class="sd">        ```</span>

<span class="sd">        If you wish to also add a pointer to the embedding model, which will be downloaded from</span>
<span class="sd">        HuggingFace upon loading:</span>

<span class="sd">        ```python</span>
<span class="sd">        embedding_model = &quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="sd">        topic_model.save(&quot;model_dir&quot;, serialization=&quot;safetensors&quot;, save_embedding_model=embedding_model)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you want save the full model with pickle:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.save(&quot;my_model&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        NOTE: Pickle can run arbitrary code and is generally considered to be less safe than</span>
<span class="sd">        safetensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;When you use `pickle` to save/load a BERTopic model,&quot;</span>
                <span class="s2">&quot;please make sure that the environments in which you save&quot;</span>
                <span class="s2">&quot;and load the model are **exactly** the same. The version of BERTopic,&quot;</span>
                <span class="s2">&quot;its dependencies, and python need to remain the same.&quot;</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="c1"># This prevents the vectorizer from being too large in size if `min_df` was</span>
                <span class="c1"># set to a value higher than 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">stop_words_</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
                    <span class="n">embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;safetensors&quot;</span> <span class="ow">or</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;pytorch&quot;</span><span class="p">:</span>
            <span class="c1"># Directory</span>
            <span class="n">save_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">save_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Check embedding model</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">save_embedding_model</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="s2">&quot;_hf_model&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_embedding_model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">save_embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">_hf_model</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;You are saving a BERTopic model without explicitly defining an embedding model.&quot;</span>
                    <span class="s2">&quot;If you are using a sentence-transformers model or a HuggingFace model supported&quot;</span>
                    <span class="s2">&quot;by sentence-transformers, please save the model by using a pointer towards that model.&quot;</span>
                    <span class="s2">&quot;For example, `save_embedding_model=&#39;sentence-transformers/all-mpnet-base-v2&#39;`&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Minimal</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_hf</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">=</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">)</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_topics</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;topics.json&quot;</span><span class="p">)</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_images</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span><span class="p">)</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span><span class="p">,</span>
                <span class="n">embedding_model</span><span class="o">=</span><span class="n">save_embedding_model</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Additional</span>
            <span class="k">if</span> <span class="n">save_ctfidf</span><span class="p">:</span>
                <span class="n">save_utils</span><span class="o">.</span><span class="n">save_ctfidf</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">save_directory</span><span class="o">=</span><span class="n">save_directory</span><span class="p">,</span>
                    <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">save_utils</span><span class="o">.</span><span class="n">save_ctfidf_config</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;ctfidf_config.json&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the model from the specified path or directory.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: Either load a BERTopic model from a file (`.pickle`) or a folder containing</span>
<span class="sd">                  `.safetensors` or `.bin` files.</span>
<span class="sd">            embedding_model: Additionally load in an embedding model if it was not saved</span>
<span class="sd">                             in the BERTopic model file or directory.</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        BERTopic.load(&quot;model_dir&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you did not save the embedding model:</span>

<span class="sd">        ```python</span>
<span class="sd">        BERTopic.load(&quot;model_dir&quot;, embedding_model=&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_or_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Load from Pickle</span>
        <span class="k">if</span> <span class="n">file_or_dir</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_or_dir</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">embedding_model</span><span class="p">:</span>
                    <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">topic_model</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">topic_model</span>

        <span class="c1"># Load from directory or HF</span>
        <span class="k">if</span> <span class="n">file_or_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">ctfidf_tensors</span><span class="p">,</span> <span class="n">ctfidf_config</span><span class="p">,</span> <span class="n">images</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_local_files</span><span class="p">(</span><span class="n">file_or_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">ctfidf_tensors</span><span class="p">,</span> <span class="n">ctfidf_config</span><span class="p">,</span> <span class="n">images</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_files_from_hf</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure to either pass a valid directory or HF model.&quot;</span><span class="p">)</span>
        <span class="n">topic_model</span> <span class="o">=</span> <span class="n">_create_model_from_files</span><span class="p">(</span>
            <span class="n">topics</span><span class="p">,</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">tensors</span><span class="p">,</span>
            <span class="n">ctfidf_tensors</span><span class="p">,</span>
            <span class="n">ctfidf_config</span><span class="p">,</span>
            <span class="n">images</span><span class="p">,</span>
            <span class="n">warn_no_backend</span><span class="o">=</span><span class="p">(</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Replace embedding model if one is specifically chosen</span>
        <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">topic_model</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">topic_model</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">merge_models</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge multiple pre-trained BERTopic models into a single model.</span>

<span class="sd">        The models are merged as if they were all saved using pytorch or</span>
<span class="sd">        safetensors, so a minimal version without c-TF-IDF.</span>

<span class="sd">        To do this, we choose the first model in the list of</span>
<span class="sd">        models as a baseline. Then, we check each model whether</span>
<span class="sd">        they contain topics that are not in the baseline.</span>
<span class="sd">        This check is based on the cosine similarity between</span>
<span class="sd">        topics embeddings. If topic embeddings between two models</span>
<span class="sd">        are similar, then the topic of the second model is re-assigned</span>
<span class="sd">        to the first. If they are dissimilar, the topic of the second</span>
<span class="sd">        model is assigned to the first.</span>

<span class="sd">        In essence, we simply check whether sufficiently &quot;new&quot;</span>
<span class="sd">        topics emerge and add them.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            models: A list of fitted BERTopic models</span>
<span class="sd">            min_similarity: The minimum similarity for when topics are merged.</span>
<span class="sd">            embedding_model: Additionally load in an embedding model if necessary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new BERTopic model that was created as if you were</span>
<span class="sd">            loading a model from the HuggingFace Hub without c-TF-IDF</span>

<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>

<span class="sd">        # Create three separate models</span>
<span class="sd">        topic_model_1 = BERTopic(min_topic_size=5).fit(docs[:4000])</span>
<span class="sd">        topic_model_2 = BERTopic(min_topic_size=5).fit(docs[4000:8000])</span>
<span class="sd">        topic_model_3 = BERTopic(min_topic_size=5).fit(docs[8000:])</span>

<span class="sd">        # Combine all models into one</span>
<span class="sd">        merged_model = BERTopic.merge_models([topic_model_1, topic_model_2, topic_model_3])</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">torch</span>

        <span class="c1"># Temporarily save model and push to HF</span>
        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
            <span class="c1"># Save model weights and config.</span>
            <span class="n">all_topics</span><span class="p">,</span> <span class="n">all_params</span><span class="p">,</span> <span class="n">all_tensors</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s2">&quot;pytorch&quot;</span><span class="p">)</span>
                <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_local_files</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
                <span class="n">all_topics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
                <span class="n">all_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="n">all_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">]))</span>

                <span class="c1"># Create a base set of parameters</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">merged_topics</span> <span class="o">=</span> <span class="n">topics</span>
                    <span class="n">merged_params</span> <span class="o">=</span> <span class="n">params</span>
                    <span class="n">merged_tensors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">])</span>
                    <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;custom_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">selected_topics</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">all_topics</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="c1"># Calculate similarity matrix</span>
            <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">merged_tensors</span><span class="p">)</span>
            <span class="n">sims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Extract new topics</span>
            <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sims</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim</span> <span class="o">&lt;</span> <span class="n">min_similarity</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">max_topic</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]))</span>

            <span class="c1"># Merge Topic Representations</span>
            <span class="n">new_topics_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">new_topic</span> <span class="ow">in</span> <span class="n">new_topics</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_topic</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">new_topics_dict</span><span class="p">[</span><span class="n">new_topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_topic</span>
                    <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_representations&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_representations&quot;</span><span class="p">][</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_labels&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_labels&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)]</span>

                    <span class="c1"># Add new aspects</span>
                    <span class="k">if</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]:</span>
                        <span class="n">aspects_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="n">aspects_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="n">aspects_diff</span> <span class="o">=</span> <span class="n">aspects_2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">aspects_1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">aspects_diff</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">aspects_diff</span><span class="p">:</span>
                                <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">][</span><span class="n">aspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                        <span class="c1"># If the original model does not have topic aspects but the to be added model does</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">merged_topics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">):</span>
                            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span>

                        <span class="c1"># If they both contain topic aspects, add to the existing set of aspects</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">][</span><span class="n">aspect</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)]</span>

                    <span class="c1"># Add new embeddings</span>
                    <span class="n">new_tensors</span> <span class="o">=</span> <span class="n">tensors</span><span class="p">[</span><span class="n">new_topic</span> <span class="o">+</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]]</span>
                    <span class="n">merged_tensors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">merged_tensors</span><span class="p">,</span> <span class="n">new_tensors</span><span class="p">])</span>

            <span class="c1"># Topic Mapper</span>
            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_mapper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_topic</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">mappings_</span>

            <span class="c1"># Find similar topics and re-assign those from the new models</span>
            <span class="n">sims_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">to_merge</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">a</span> <span class="o">-</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]:</span> <span class="n">b</span> <span class="o">-</span> <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sims_idx</span><span class="p">,</span> <span class="n">sims</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">min_similarity</span>
            <span class="p">}</span>
            <span class="n">to_merge</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_topics_dict</span><span class="p">)</span>
            <span class="n">to_merge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_merge</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]]</span>
            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_sizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]))</span>

        <span class="c1"># Create a new model from the merged parameters</span>
        <span class="n">merged_tensors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">merged_tensors</span><span class="p">)}</span>
        <span class="n">merged_model</span> <span class="o">=</span> <span class="n">_create_model_from_files</span><span class="p">(</span>
            <span class="n">merged_topics</span><span class="p">,</span>
            <span class="n">merged_params</span><span class="p">,</span>
            <span class="n">merged_tensors</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">warn_no_backend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">embedding_model</span>

        <span class="c1"># Replace embedding model if one is specifically chosen</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">verbose</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">BaseEmbedder</span><span class="p">:</span>
            <span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged_model</span>

    <span class="k">def</span> <span class="nf">push_to_hf_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">commit_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Add BERTopic model&quot;</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">create_pr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">model_card</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">serialization</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;safetensors&quot;</span><span class="p">,</span>
        <span class="n">save_embedding_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push your BERTopic model to a HuggingFace Hub.</span>

<span class="sd">        Whenever you want to upload files to the Hub, you need to log in to your HuggingFace account:</span>

<span class="sd">        * Log in to your HuggingFace account with the following command:</span>
<span class="sd">            ```bash</span>
<span class="sd">            huggingface-cli login</span>

<span class="sd">            # or using an environment variable</span>
<span class="sd">            huggingface-cli login --token $HUGGINGFACE_TOKEN</span>
<span class="sd">            ```</span>
<span class="sd">        * Alternatively, you can programmatically login using login() in a notebook or a script:</span>
<span class="sd">            ```python</span>
<span class="sd">            from huggingface_hub import login</span>
<span class="sd">            login()</span>
<span class="sd">            ```</span>
<span class="sd">        * Or you can give a token with the `token` variable</span>

<span class="sd">        Arguments:</span>
<span class="sd">            repo_id: The name of your HuggingFace repository</span>
<span class="sd">            commit_message: A commit message</span>
<span class="sd">            token: Token to add if not already logged in</span>
<span class="sd">            revision: Repository revision</span>
<span class="sd">            private: Whether to create a private repository</span>
<span class="sd">            create_pr: Whether to upload the model as a Pull Request</span>
<span class="sd">            model_card: Whether to automatically create a modelcard</span>
<span class="sd">            serialization: The type of serialization.</span>
<span class="sd">                           Either `safetensors` or `pytorch`</span>
<span class="sd">            save_embedding_model: A pointer towards a HuggingFace model to be loaded in with</span>
<span class="sd">                                  SentenceTransformers. E.g.,</span>
<span class="sd">                                  `sentence-transformers/all-MiniLM-L6-v2`</span>
<span class="sd">            save_ctfidf: Whether to save c-TF-IDF information</span>


<span class="sd">        Examples:</span>
<span class="sd">        ```python</span>
<span class="sd">        topic_model.push_to_hf_hub(</span>
<span class="sd">            repo_id=&quot;ArXiv&quot;,</span>
<span class="sd">            save_ctfidf=True,</span>
<span class="sd">            save_embedding_model=&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">push_to_hf_hub</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_id</span><span class="p">,</span>
            <span class="n">commit_message</span><span class="o">=</span><span class="n">commit_message</span><span class="p">,</span>
            <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span>
            <span class="n">revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
            <span class="n">private</span><span class="o">=</span><span class="n">private</span><span class="p">,</span>
            <span class="n">create_pr</span><span class="o">=</span><span class="n">create_pr</span><span class="p">,</span>
            <span class="n">model_card</span><span class="o">=</span><span class="n">model_card</span><span class="p">,</span>
            <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">,</span>
            <span class="n">save_embedding_model</span><span class="o">=</span><span class="n">save_embedding_model</span><span class="p">,</span>
            <span class="n">save_ctfidf</span><span class="o">=</span><span class="n">save_ctfidf</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameters for this estimator.</span>

<span class="sd">        Adapted from:</span>
<span class="sd">            https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>

<span class="sd">        Arguments:</span>
<span class="sd">            deep: bool, default=True</span>
<span class="sd">                  If True, will return the parameters for this estimator and</span>
<span class="sd">                  contained subobjects that are estimators.</span>

<span class="sd">        Returns:</span>
<span class="sd">            out: Parameter names mapped to their values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_names</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;get_params&quot;</span><span class="p">):</span>
                <span class="n">deep_items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">deep_items</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_extract_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract sentence/document embeddings through pre-trained embeddings</span>
<span class="sd">        For an overview of pre-trained models: https://www.sbert.net/docs/pretrained_models.html.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            images: A list of paths to the images to fit on or the images themselves</span>
<span class="sd">            method: Whether to extract document or word-embeddings, options are &quot;document&quot; and &quot;word&quot;</span>
<span class="sd">            verbose: Whether to show a progressbar demonstrating the time to extract embeddings</span>

<span class="sd">        Returns:</span>
<span class="sd">            embeddings: The extracted embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="s2">&quot;embed_images&quot;</span><span class="p">):</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_words</span><span class="p">(</span><span class="n">words</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">documents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">images</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Make sure to use an embedding model that can either embed documents&quot;</span>
                <span class="s2">&quot;or images depending on which you want to embed.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Wrong method for extracting document/word embeddings. &quot;</span>
                <span class="s2">&quot;Either choose &#39;word&#39; or &#39;document&#39; as the method. &quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_images_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert images to text.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Images - Converting images to text. This might take a while.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tuner</span><span class="p">,</span> <span class="s2">&quot;image_to_text_model&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">documents</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">image_to_text</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tuner</span><span class="p">,</span> <span class="s2">&quot;image_to_text_model&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">documents</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">image_to_text</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="n">BaseRepresentation</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="s2">&quot;image_to_text_model&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="o">.</span><span class="n">image_to_text</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Images - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_map_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map predictions to the correct topics if topics were reduced.&quot;&quot;&quot;</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">(</span><span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mapped_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">mappings</span><span class="p">[</span><span class="n">prediction</span><span class="p">]</span> <span class="k">if</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">mappings</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mapped_predictions</span>

    <span class="k">def</span> <span class="nf">_reduce_dimensionality</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">csr_matrix</span><span class="p">],</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce dimensionality of embeddings using UMAP and train a UMAP model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            embeddings: The extracted embeddings using the sentence transformer module.</span>
<span class="sd">            y: The target class for (semi)-supervised dimensionality reduction</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>

<span class="sd">        Returns:</span>
<span class="sd">            umap_embeddings: The reduced embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Fitting the dimensionality reduction algorithm&quot;</span><span class="p">)</span>
        <span class="c1"># Partial fit</span>
        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Regular fit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># cuml umap needs y to be an numpy array</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cluster_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">umap_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cluster UMAP embeddings with HDBSCAN.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            umap_embeddings: The reduced sentence embeddings with UMAP</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>
<span class="sd">            y: Array of topics to use</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and their corresponding IDs</span>
<span class="sd">                       and newly added Topics</span>
<span class="sd">            probabilities: The distribution of probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cluster - Start clustering the reduced embeddings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">labels_</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">labels_</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Extract probabilities</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;probabilities_&quot;</span><span class="p">):</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">probabilities_</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span> <span class="ow">and</span> <span class="n">is_supported_hdbscan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">):</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan_delegator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;all_points_membership_vectors&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cluster - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">_zeroshot_topic_modeling</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find documents that could be assigned to either one of the topics in self.zeroshot_topic_list.</span>

<span class="sd">        We transform the topics in `self.zeroshot_topic_list` to embeddings and</span>
<span class="sd">        compare them through cosine similarity with the document embeddings.</span>
<span class="sd">        If they pass the `self.zeroshot_min_similarity` threshold, they are assigned.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            embeddings: The document embeddings</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: The leftover documents that were not assigned to any topic</span>
<span class="sd">            embeddings: The leftover embeddings that were not assigned to any topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Zeroshot Step 1 - Finding documents that could be assigned to either one of the zero-shot topics&quot;</span><span class="p">)</span>
        <span class="c1"># Similarity between document and zero-shot topic embeddings</span>
        <span class="n">zeroshot_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span><span class="p">)</span>
        <span class="n">cosine_similarities</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">zeroshot_embeddings</span><span class="p">)</span>
        <span class="n">assignment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cosine_similarities</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">assignment_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cosine_similarities</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">assigned_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">assignment_vals</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span><span class="p">]</span>
        <span class="n">non_assigned_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">assignment_vals</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span>
        <span class="p">]</span>

        <span class="c1"># Assign topics</span>
        <span class="n">assigned_documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">assigned_ids</span><span class="p">]</span>
        <span class="n">assigned_documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">assignment</span><span class="p">[</span><span class="n">assigned_ids</span><span class="p">]]</span>
        <span class="n">assigned_documents</span><span class="p">[</span><span class="s2">&quot;Old_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assigned_documents</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">assigned_documents</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">))</span>
        <span class="n">assigned_embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">[</span><span class="n">assigned_ids</span><span class="p">]</span>

        <span class="c1"># Check that if a number of topics was specified, it exceeds the number of zeroshot topics matched</span>
        <span class="n">num_zeroshot_topics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">&gt;</span> <span class="n">num_zeroshot_topics</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The set nr_topics (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="si">}</span><span class="s2">) must exceed the number of matched zero-shot topics &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">num_zeroshot_topics</span><span class="si">}</span><span class="s2">). Consider raising nr_topics or raising the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;zeroshot_min_similarity (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Select non-assigned topics to be clustered</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">non_assigned_ids</span><span class="p">]</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Old_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">))</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">[</span><span class="n">non_assigned_ids</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Zeroshot Step 1 - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">,</span> <span class="n">assigned_embeddings</span>

    <span class="k">def</span> <span class="nf">_is_zeroshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether zero-shot topic modeling is possible.</span>

<span class="sd">        * Embedding model is necessary to convert zero-shot topics to embeddings</span>
<span class="sd">        * Zero-shot topics should be defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_combine_zeroshot_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">assigned_documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">assigned_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the zero-shot topics with the clustered topics.</span>

<span class="sd">        The zero-shot topics will be inserted between the outlier topic (that may or may not exist) and the rest of the</span>
<span class="sd">        topics from clustering. The rest of the topics from clustering will be given new IDs to correspond to topics</span>
<span class="sd">        after zero-shot topics.</span>

<span class="sd">        Documents and embeddings used in zero-shot topic modeling and clustering and re-merged.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: DataFrame with clustered documents and their corresponding IDs</span>
<span class="sd">            embeddings: The document embeddings for clustered documents</span>
<span class="sd">            assigned_documents: DataFrame with documents and their corresponding IDs</span>
<span class="sd">                                that were assigned to a zero-shot topic</span>
<span class="sd">            assigned_embeddings: The document embeddings for documents that were assigned to a zero-shot topic</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: DataFrame with all the original documents with their topic assignments</span>
<span class="sd">            embeddings: np.ndarray of embeddings aligned with the documents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Zeroshot Step 2 - Combining topics from zero-shot topic modeling with topics from clustering...&quot;</span><span class="p">)</span>
        <span class="c1"># Combine Zero-shot topics with topics from clustering</span>
        <span class="n">zeroshot_topic_idx_to_topic_id</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">zeroshot_topic_id</span><span class="p">:</span> <span class="n">new_topic_id</span>
            <span class="k">for</span> <span class="n">new_topic_id</span><span class="p">,</span> <span class="n">zeroshot_topic_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">assigned_documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">new_topic_id</span><span class="p">:</span> <span class="n">zeroshot_topic_id</span>
            <span class="k">for</span> <span class="n">new_topic_id</span><span class="p">,</span> <span class="n">zeroshot_topic_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">assigned_documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="n">assigned_documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">assigned_documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">zeroshot_topic_idx_to_topic_id</span><span class="p">)</span>
        <span class="n">num_zeroshot_topics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeroshot_topic_idx_to_topic_id</span><span class="p">)</span>

        <span class="c1"># Insert zeroshot topics between outlier cluster and other clusters</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">topic_id</span><span class="p">:</span> <span class="n">topic_id</span> <span class="o">+</span> <span class="n">num_zeroshot_topics</span> <span class="k">if</span> <span class="n">topic_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">topic_id</span>
        <span class="p">)</span>

        <span class="c1"># Combine the clustered documents/embeddings with assigned documents/embeddings in the original order</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">documents</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">])</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_embeddings</span><span class="p">])</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Old_ID</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

        <span class="c1"># Update topic sizes and topic mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Zeroshot Step 2 - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_guided_topic_modeling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply Guided Topic Modeling.</span>

<span class="sd">        We transform the seeded topics to embeddings using the</span>
<span class="sd">        same embedder as used for generating document embeddings.</span>

<span class="sd">        Then, we apply cosine similarity between the embeddings</span>
<span class="sd">        and set labels for documents that are more similar to</span>
<span class="sd">        one of the topics than the average document.</span>

<span class="sd">        If a document is more similar to the average document</span>
<span class="sd">        than any of the topics, it gets the -1 label and is</span>
<span class="sd">        thereby not included in UMAP.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            embeddings: The document embeddings</span>

<span class="sd">        Returns:</span>
<span class="sd">            y: The labels for each seeded topic</span>
<span class="sd">            embeddings: Updated embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Guided - Find embeddings highly related to seeded topics.&quot;</span><span class="p">)</span>
        <span class="c1"># Create embeddings from the seeded topics</span>
        <span class="n">seed_topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seed_topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">seed_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span><span class="p">]</span>
        <span class="n">seed_topic_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">seed_topic_embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">seed_topic_embeddings</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)])</span>

        <span class="c1"># Label documents that are most similar to one of the seeded topics</span>
        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">seed_topic_embeddings</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sim_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>

        <span class="c1"># Average the document embeddings related to the seeded topics with the</span>
        <span class="c1"># embedding of the seeded topic to force the documents in a cluster</span>
        <span class="k">for</span> <span class="n">seed_topic</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">)):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="n">seed_topic</span><span class="p">]</span>
            <span class="n">embeddings</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">embeddings</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">seed_topic_embeddings</span><span class="p">[</span><span class="n">seed_topic</span><span class="p">]],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Guided - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_extract_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mappings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract topics from the clusters using a class-based TF-IDF.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            embeddings: The document embeddings</span>
<span class="sd">            mappings: The mappings from topic to word</span>
<span class="sd">            verbose: Whether to log the process of extracting topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            c_tf_idf: The resulting matrix giving a value (importance score) for each word per topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Representation - Extracting topics from clusters using representation models.&quot;</span><span class="p">)</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Representation - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the 3 most representative docs per topic.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>

<span class="sd">        Updates:</span>
<span class="sd">            self.representative_docs_: Populate each topic with 3 representative docs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">repr_docs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_representative_docs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span>
            <span class="n">documents</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">,</span>
            <span class="n">nr_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">nr_repr_docs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="n">repr_docs</span>

    <span class="k">def</span> <span class="nf">_extract_representative_docs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">c_tf_idf</span><span class="p">:</span> <span class="n">csr_matrix</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">nr_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">nr_repr_docs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">diversity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Approximate most representative documents per topic by sampling</span>
<span class="sd">        a subset of the documents in each topic and calculating which are</span>
<span class="sd">        most representative to their topic based on the cosine similarity between</span>
<span class="sd">        c-TF-IDF representations.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            c_tf_idf: The topic c-TF-IDF representation</span>
<span class="sd">            documents: All input documents</span>
<span class="sd">            topics: The candidate topics as calculated with c-TF-IDF</span>
<span class="sd">            nr_samples: The number of candidate documents to extract per topic</span>
<span class="sd">            nr_repr_docs: The number of representative documents to extract per topic</span>
<span class="sd">            diversity: The diversity between the most representative documents.</span>
<span class="sd">                       If None, no MMR is used. Otherwise, accepts values between 0 and 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            repr_docs_mappings: A dictionary from topic to representative documents</span>
<span class="sd">            representative_docs: A flat list of representative documents</span>
<span class="sd">            repr_doc_indices: Ordered indices of representative documents</span>
<span class="sd">                              that belong to each topic</span>
<span class="sd">            repr_doc_ids: The indices of representative documents</span>
<span class="sd">                          that belong to each topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sample documents per topic</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">nr_samples</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Find and extract documents that are most similar to the topic</span>
        <span class="n">repr_docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">repr_docs_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">repr_docs_mappings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">repr_docs_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">topics</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="c1"># Slice data</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">selected_docs</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;Document&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">selected_docs_ids</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Calculate similarity</span>
            <span class="n">nr_docs</span> <span class="o">=</span> <span class="n">nr_repr_docs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_docs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nr_repr_docs</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_docs</span><span class="p">)</span>
            <span class="n">bow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">selected_docs</span><span class="p">)</span>
            <span class="n">ctfidf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bow</span><span class="p">)</span>
            <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">ctfidf</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

            <span class="c1"># Use MMR to find representative but diverse documents</span>
            <span class="k">if</span> <span class="n">diversity</span><span class="p">:</span>
                <span class="n">docs</span> <span class="o">=</span> <span class="n">mmr</span><span class="p">(</span>
                    <span class="n">c_tf_idf</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">ctfidf</span><span class="p">,</span>
                    <span class="n">selected_docs</span><span class="p">,</span>
                    <span class="n">top_n</span><span class="o">=</span><span class="n">nr_docs</span><span class="p">,</span>
                    <span class="n">diversity</span><span class="o">=</span><span class="n">diversity</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Extract top n most representative documents</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">sim_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">nr_docs</span><span class="p">)[</span><span class="o">-</span><span class="n">nr_docs</span><span class="p">:]</span>
                <span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">selected_docs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

            <span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">selected_docs_ids</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_docs</span><span class="p">)</span> <span class="k">if</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
            <span class="n">repr_docs_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span>
            <span class="n">repr_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
            <span class="n">repr_docs_indices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">repr_docs_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_docs</span><span class="p">)])</span>
        <span class="n">repr_docs_mappings</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">repr_docs</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">repr_docs_indices</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">repr_docs_mappings</span><span class="p">,</span> <span class="n">repr_docs</span><span class="p">,</span> <span class="n">repr_docs_indices</span><span class="p">,</span> <span class="n">repr_docs_ids</span>

    <span class="k">def</span> <span class="nf">_create_topic_vectors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mappings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates embeddings per topics based on their topic representation.</span>

<span class="sd">        As a default, topic vectors (topic embeddings) are created by taking</span>
<span class="sd">        the average of all document embeddings within a topic. If topics are</span>
<span class="sd">        merged, then a weighted average of topic embeddings is taken based on</span>
<span class="sd">        the initial topic sizes.</span>

<span class="sd">        For the `.partial_fit` and `.update_topics` method, the average</span>
<span class="sd">        of all document embeddings is not taken since those are not known.</span>
<span class="sd">        Instead, the weighted average of the embeddings of the top n words</span>
<span class="sd">        is taken for each topic. The weighting is done based on the c-TF-IDF</span>
<span class="sd">        score. This will put more emphasis to words that represent a topic best.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Topic embeddings based on input embeddings</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topic_embeddings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
                <span class="n">topic_embedding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">topic_embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_embedding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topic_embeddings</span><span class="p">)</span>

        <span class="c1"># Topic embeddings when merging topics</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mappings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topic_embeddings_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">topic_to</span><span class="p">,</span> <span class="n">topics_from</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">topic_ids</span> <span class="o">=</span> <span class="n">topics_from</span><span class="p">[</span><span class="s2">&quot;topics_from&quot;</span><span class="p">]</span>
                <span class="n">topic_sizes</span> <span class="o">=</span> <span class="n">topics_from</span><span class="p">[</span><span class="s2">&quot;topic_sizes&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">topic_ids</span><span class="p">:</span>
                    <span class="n">embds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topic_ids</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span>
                    <span class="n">topic_embedding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">embds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">topic_sizes</span><span class="p">)</span>
                    <span class="n">topic_embeddings_dict</span><span class="p">[</span><span class="n">topic_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_embedding</span>

            <span class="c1"># Re-order topic embeddings</span>
            <span class="n">topics_to_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">topic_mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">topic_mapping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic_mapping</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">mappings_</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="p">}</span>
            <span class="n">topic_embeddings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">embds</span> <span class="ow">in</span> <span class="n">topic_embeddings_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">topic_embeddings</span><span class="p">[</span><span class="n">topics_to_map</span><span class="p">[</span><span class="n">topic</span><span class="p">]]</span> <span class="o">=</span> <span class="n">embds</span>
            <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">topic_embeddings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">topic_embeddings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">])</span>

        <span class="c1"># Topic embeddings based on keyword representations</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">BaseEmbedder</span><span class="p">:</span>
            <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="c1"># Only extract top n words</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span>

            <span class="c1"># Extract embeddings for all words in all topics</span>
            <span class="n">topic_words</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_list</span><span class="p">]</span>
            <span class="n">topic_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_words</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">topic</span><span class="p">]</span>
            <span class="n">word_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">topic_words</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Take the weighted average of word embeddings in a topic based on their c-TF-IDF value</span>
            <span class="c1"># The embeddings var is a single numpy matrix and therefore slicing is necessary to</span>
            <span class="c1"># access the words per topic</span>
            <span class="n">topic_embeddings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topic_list</span><span class="p">):</span>
                <span class="n">word_importance</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">word_importance</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)))]</span>
                <span class="n">topic_embedding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span>
                    <span class="n">word_embeddings</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span> <span class="p">:</span> <span class="n">n</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span><span class="p">)],</span>
                    <span class="n">weights</span><span class="o">=</span><span class="n">word_importance</span><span class="p">,</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">topic_embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_embedding</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topic_embeddings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_c_tf_idf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">documents_per_topic</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">csr_matrix</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a class-based TF-IDF where m is the number of total documents.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents_per_topic: The joined documents per topic such that each topic has a single</span>
<span class="sd">                                 string made out of multiple documents</span>
<span class="sd">            m: The total number of documents (unjoined)</span>
<span class="sd">            fit: Whether to fit a new vectorizer or use the fitted self.vectorizer_model</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>

<span class="sd">        Returns:</span>
<span class="sd">            tf_idf: The resulting matrix giving a value (importance score) for each word per topic</span>
<span class="sd">            words: The names of the words to which values were given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="o">.</span><span class="n">update_bow</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fit</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
        <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

        <span class="n">multiplier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_words</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span><span class="p">:</span>
            <span class="n">seed_topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed</span> <span class="k">for</span> <span class="n">seeds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_multiplier</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_words</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">seed_topic_list</span> <span class="k">else</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">words</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_words</span><span class="p">:</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_multiplier</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">seed_words</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span><span class="p">:</span>
            <span class="n">seed_topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed</span> <span class="k">for</span> <span class="n">seeds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">seed_topic_list</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="n">multiplier</span><span class="p">)</span>

        <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span>

    <span class="k">def</span> <span class="nf">_update_topic_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the topic sizes.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Updated dataframe with documents and their corresponding IDs and newly added Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_words_per_topic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">c_tf_idf</span><span class="p">:</span> <span class="n">csr_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">calculate_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Based on tf_idf scores per topic, extract the top n words per topic.</span>

<span class="sd">        If the top words per topic need to be extracted, then only the `words` parameter</span>
<span class="sd">        needs to be passed. If the top words per topic in a specific timestamp, then it</span>
<span class="sd">        is important to pass the timestamp-based c-TF-IDF matrix and its corresponding</span>
<span class="sd">        labels.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            words: List of all words (sorted according to tf_idf matrix position)</span>
<span class="sd">            documents: DataFrame with documents and their topic IDs</span>
<span class="sd">            c_tf_idf: A c-TF-IDF matrix from which to calculate the top words</span>
<span class="sd">            calculate_aspects: Whether to calculate additional topic aspects</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics: The top words per topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">c_tf_idf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>

        <span class="c1"># Get at least the top 30 indices and values per row in a sparse c-TF-IDF matrix</span>
        <span class="n">top_n_words</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_n_idx_sparse</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">top_n_words</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_n_values_sparse</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get top 30 words per topic based on c-TF-IDF score</span>
        <span class="n">base_topics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">label</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">],</span> <span class="n">score</span><span class="p">)</span> <span class="k">if</span> <span class="n">word_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">word_index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scores</span><span class="p">[</span><span class="n">index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Fine-tune the topic representations</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">base_topics</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">:</span>
            <span class="c1"># Default representation: c_tf_idf + top_n_words</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">values</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">:</span>
                <span class="n">topics</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="n">BaseRepresentation</span><span class="p">):</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">):</span>
                <span class="n">main_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">[</span><span class="s2">&quot;Main&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_model</span><span class="p">,</span> <span class="n">BaseRepresentation</span><span class="p">):</span>
                    <span class="n">topics</span> <span class="o">=</span> <span class="n">main_model</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">main_model</span><span class="p">:</span>
                        <span class="n">topics</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">main_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> for representation_model[&#39;Main&#39;]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default representation: c_tf_idf + top_n_words</span>
                <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">values</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> for representation_model&quot;</span><span class="p">)</span>

        <span class="c1"># Extract additional topic aspects</span>
        <span class="k">if</span> <span class="n">calculate_aspects</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">aspect_model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">aspect</span> <span class="o">!=</span> <span class="s2">&quot;Main&quot;</span><span class="p">:</span>
                    <span class="n">aspects</span> <span class="o">=</span> <span class="n">base_topics</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">aspect_model</span><span class="p">:</span>
                        <span class="c1"># Default representation: c_tf_idf + top_n_words</span>
                        <span class="n">aspects</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">values</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">aspects</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aspect_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">tuner</span> <span class="ow">in</span> <span class="n">aspect_model</span><span class="p">:</span>
                            <span class="n">aspects</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">aspects</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aspect_model</span><span class="p">,</span> <span class="n">BaseRepresentation</span><span class="p">):</span>
                        <span class="n">aspects</span> <span class="o">=</span> <span class="n">aspect_model</span><span class="o">.</span><span class="n">extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">aspects</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">aspect_model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> for representation_model[</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">[</span><span class="n">aspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">aspects</span>

        <span class="k">return</span> <span class="n">topics</span>

    <span class="k">def</span> <span class="nf">_reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce topics to self.nr_topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, semantic</span>
<span class="sd">                        embeddings are used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Topic reduction - Reducing number of topics&quot;</span><span class="p">)</span>
        <span class="n">initial_nr_topics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topics</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">&lt;</span> <span class="n">initial_nr_topics</span><span class="p">:</span>
                <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_to_n_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nr_topics needs to be an int or &#39;auto&#39;! &quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Topic reduction - Reduced number of topics from </span><span class="si">{</span><span class="n">initial_nr_topics</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_reduce_to_n_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce topics to self.nr_topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, semantic</span>
<span class="sd">                        embedding are used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Create topic distance matrix</span>
        <span class="n">topic_embeddings</span> <span class="o">=</span> <span class="n">select_topic_representation</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">,</span> <span class="n">output_ndarray</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:]</span>
        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">topic_embeddings</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Cluster the topic embeddings using AgglomerativeClustering</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.4.0&quot;</span><span class="p">):</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;precomputed&quot;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">,</span>
                <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;precomputed&quot;</span><span class="p">,</span>
                <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">labels_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

        <span class="c1"># Track mappings and sizes of topics for merging topic embeddings</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">from_topic</span><span class="p">:</span> <span class="n">to_topic</span> <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">new_topics</span><span class="p">)}</span>
        <span class="n">basic_mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapped_topics</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">basic_mappings</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">topic_to</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;topics_from&quot;</span><span class="p">:</span> <span class="n">topics_from</span><span class="p">,</span>
                <span class="s2">&quot;topic_sizes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics_from</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">topic_to</span><span class="p">,</span> <span class="n">topics_from</span> <span class="ow">in</span> <span class="n">basic_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Map topics</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">new_topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span>

        <span class="c1"># Update representations</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">)</span>

        <span class="c1"># When zero-shot topic(s) are present in the topics to merge,</span>
        <span class="c1"># determine whether to take one of the zero-shot topic labels</span>
        <span class="c1"># or use a calculated representation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">():</span>
            <span class="n">new_topic_id_to_zeroshot_topic_idx</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">topics_to_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">topic_mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">topic_mapping</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic_mapping</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">mappings_</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="n">topic_to</span><span class="p">,</span> <span class="n">topics_from</span> <span class="ow">in</span> <span class="n">basic_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># When extracting topics, the reduced topics were reordered.</span>
                <span class="c1"># Must get the updated topic_to.</span>
                <span class="n">topic_to</span> <span class="o">=</span> <span class="n">topics_to_map</span><span class="p">[</span><span class="n">topic_to</span><span class="p">]</span>

                <span class="c1"># which of the original topics are zero-shot</span>
                <span class="n">zeroshot_topic_ids</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">topic_id</span> <span class="k">for</span> <span class="n">topic_id</span> <span class="ow">in</span> <span class="n">topics_from</span> <span class="k">if</span> <span class="n">topic_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeroshot_topic_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># If any of the original topics are zero-shot, take the best fitting zero-shot label</span>
                <span class="c1"># if the cosine similarity with the new topic exceeds the zero-shot threshold</span>
                <span class="n">zeroshot_labels</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span><span class="p">[</span><span class="n">topic_id</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">topic_id</span> <span class="ow">in</span> <span class="n">zeroshot_topic_ids</span>
                <span class="p">]</span>
                <span class="n">zeroshot_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">zeroshot_labels</span><span class="p">)</span>
                <span class="n">cosine_similarities</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span>
                    <span class="n">zeroshot_embeddings</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="n">topic_to</span><span class="p">]]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">best_zeroshot_topic_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cosine_similarities</span><span class="p">)</span>
                <span class="n">best_cosine_similarity</span> <span class="o">=</span> <span class="n">cosine_similarities</span><span class="p">[</span><span class="n">best_zeroshot_topic_idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">best_cosine_similarity</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span><span class="p">:</span>
                    <span class="n">new_topic_id_to_zeroshot_topic_idx</span><span class="p">[</span><span class="n">topic_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeroshot_topic_ids</span><span class="p">[</span><span class="n">best_zeroshot_topic_idx</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span> <span class="o">=</span> <span class="n">new_topic_id_to_zeroshot_topic_idx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_auto_reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce the number of topics automatically using HDBSCAN.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>
<span class="sd">            use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                        embeddings from the embedding model are used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:]</span>
        <span class="n">max_topic</span> <span class="o">=</span> <span class="n">unique_topics</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Find similar topics</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">select_topic_representation</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">,</span> <span class="n">output_ndarray</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">norm_data</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l2&quot;</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span>
            <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
            <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s2">&quot;eom&quot;</span><span class="p">,</span>
            <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">norm_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

        <span class="c1"># Map similar topics</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">unique_topics</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span> <span class="n">prediction</span> <span class="o">+</span> <span class="n">max_topic</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prediction</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">}</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">from_topic</span><span class="p">:</span> <span class="n">to_topic</span> <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>

        <span class="c1"># Track mappings and sizes of topics for merging topic embeddings</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapped_topics</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">topic_from</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;topics_to&quot;</span><span class="p">:</span> <span class="n">topics_to</span><span class="p">,</span>
                <span class="s2">&quot;topic_sizes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics_to</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">topic_from</span><span class="p">,</span> <span class="n">topics_to</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Update documents and topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_sort_mappings_by_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reorder mappings by their frequency.</span>

<span class="sd">        For example, if topic 88 was mapped to topic</span>
<span class="sd">        5 and topic 5 turns out to be the largest topic,</span>
<span class="sd">        then topic 5 will be topic 0. The second largest</span>
<span class="sd">        will be topic 1, etc.</span>

<span class="sd">        If there are no mappings since no reduction of topics</span>
<span class="sd">        took place, then the topics will simply be ordered</span>
<span class="sd">        by their frequency and will get the topic ids based</span>
<span class="sd">        on that order.</span>

<span class="sd">        This means that -1 will remain the outlier class, and</span>
<span class="sd">        that the rest of the topics will be in descending order</span>
<span class="sd">        of ids and frequency.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the mapped</span>
<span class="sd">                       and re-ordered topic ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Map topics based on frequency</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Old_Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Old_Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sorted_topics</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Old_Topic</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span>

        <span class="c1"># Map documents</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_map_probabilities</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">original_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map the probabilities to the reduced topics.</span>
<span class="sd">        This is achieved by adding together the probabilities</span>
<span class="sd">        of all topics that are mapped to the same topic. Then,</span>
<span class="sd">        the topics that were mapped from are set to 0 as they</span>
<span class="sd">        were reduced.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            probabilities: An array containing probabilities</span>
<span class="sd">            original_topics: Whether we want to map from the</span>
<span class="sd">                             original topics to the most recent topics</span>
<span class="sd">                             or from the second-most recent topics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mapped_probabilities: Updated probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">(</span><span class="n">original_topics</span><span class="p">)</span>

        <span class="c1"># Map array of probabilities (probability for assigned topic per document)</span>
        <span class="k">if</span> <span class="n">probabilities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">mapped_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">probabilities</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">to_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">from_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">mapped_probabilities</span><span class="p">[:,</span> <span class="n">to_topic</span><span class="p">]</span> <span class="o">+=</span> <span class="n">probabilities</span><span class="p">[:,</span> <span class="n">from_topic</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">mapped_probabilities</span>

        <span class="k">return</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">_preprocess_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Basic preprocessing of text.</span>

<span class="sd">        Steps:</span>
<span class="sd">            * Replace \n and \t with whitespace</span>
<span class="sd">            * Only keep alpha-numerical characters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;english&quot;</span><span class="p">:</span>
            <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^A-Za-z0-9 ]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="k">if</span> <span class="n">doc</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;emptydoc&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cleaned_documents</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_top_n_idx_sparse</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return indices of top n values in each row of a sparse matrix.</span>

<span class="sd">        Retrieved from:</span>
<span class="sd">            https://stackoverflow.com/questions/49207275/finding-the-top-n-values-in-a-row-of-a-scipy-sparse-matrix</span>

<span class="sd">        Arguments:</span>
<span class="sd">            matrix: The sparse matrix from which to get the top n indices per row</span>
<span class="sd">            n: The number of highest values to extract from each row</span>

<span class="sd">        Returns:</span>
<span class="sd">            indices: The top n indices per row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">le</span><span class="p">,</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">n_row_pick</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ri</span> <span class="o">-</span> <span class="n">le</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">le</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">le</span><span class="p">:</span><span class="n">ri</span><span class="p">],</span> <span class="o">-</span><span class="n">n_row_pick</span><span class="p">)[</span><span class="o">-</span><span class="n">n_row_pick</span><span class="p">:]]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_top_n_values_sparse</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the top n values for each row in a sparse matrix.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            matrix: The sparse matrix from which to get the top n indices per row</span>
<span class="sd">            indices: The top n indices per row</span>

<span class="sd">        Returns:</span>
<span class="sd">            top_values: The top n scores per row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
            <span class="n">top_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_values</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_param_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameter names for the estimator.</span>

<span class="sd">        Adapted from:</span>
<span class="sd">            https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">init_signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">init_signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;self&quot;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a string representation of the current object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Human readable representation of the most important model parameters.</span>
<span class="sd">                 The parameters that represent models are ignored due to their length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(...)&quot;</span>
            <span class="n">parameters</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, &quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;BERTopic(</span><span class="si">{</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h2 id="bertopic._bertopic.BERTopic.topic_labels_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topic_labels_</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.topic_labels_" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Map topic IDs to their labels.
A label is the topic ID, along with the first four words of the topic representation, joined using '_'.
Zeroshot topic labels come from self.zeroshot_topic_list rather than the calculated representation.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>topic_labels</code></td>
      <td><p>a dict mapping a topic ID (int) to its label (str)</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">top_n_words</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_topic_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calculate_probabilities</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed_topic_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeroshot_topic_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeroshot_min_similarity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">umap_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ctfidf_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">representation_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.__init__" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>BERTopic initialization.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>language</code></td>
        <td><code>str</code></td>
        <td><p>The main language used in your documents. The default sentence-transformers
      model for "english" is <code>all-MiniLM-L6-v2</code>. For a full overview of
      supported languages see bertopic.backend.languages. Select
      "multilingual" to load in the <code>paraphrase-multilingual-MiniLM-L12-v2</code>
      sentence-transformers model that supports 50+ languages.
      NOTE: This is not used if <code>embedding_model</code> is used.</p></td>
        <td><code>&#39;english&#39;</code></td>
      </tr>
      <tr>
        <td><code>top_n_words</code></td>
        <td><code>int</code></td>
        <td><p>The number of words per topic to extract. Setting this
         too high can negatively impact topic embeddings as topics
         are typically best represented by at most 10 words.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>n_gram_range</code></td>
        <td><code>Tuple[int, int]</code></td>
        <td><p>The n-gram range for the CountVectorizer.
          Advised to keep high values between 1 and 3.
          More would likely lead to memory issues.
          NOTE: This param will not be used if you pass in your own
          CountVectorizer.</p></td>
        <td><code>(1, 1)</code></td>
      </tr>
      <tr>
        <td><code>min_topic_size</code></td>
        <td><code>int</code></td>
        <td><p>The minimum size of the topic. Increasing this value will lead
            to a lower number of clusters/topics and vice versa.
            It is the same parameter as <code>min_cluster_size</code> in HDBSCAN.
            NOTE: This param will not be used if you are using <code>hdbscan_model</code>.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>nr_topics</code></td>
        <td><code>Union[int, str]</code></td>
        <td><p>Specifying the number of topics will reduce the initial
       number of topics to the value specified. This reduction can take
       a while as each reduction in topics (-1) activates a c-TF-IDF
       calculation. If this is set to None, no reduction is applied. Use
       "auto" to automatically reduce topics using HDBSCAN.
       NOTE: Controlling the number of topics is best done by adjusting
       <code>min_topic_size</code> first before adjusting this parameter.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>low_memory</code></td>
        <td><code>bool</code></td>
        <td><p>Sets UMAP low memory to True to make sure less memory is used.
        NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP
        this parameter will not be used.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>calculate_probabilities</code></td>
        <td><code>bool</code></td>
        <td><p>Calculate the probabilities of all topics
                     per document instead of the probability of the assigned
                     topic per document. This could slow down the extraction
                     of topics if you have many documents (&gt; 100_000).
                     NOTE: If false you cannot use the corresponding
                     visualization method <code>visualize_probabilities</code>.
                     NOTE: This is an approximation of topic probabilities
                     as used in HDBSCAN and not an exact representation.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>seed_topic_list</code></td>
        <td><code>List[List[str]]</code></td>
        <td><p>A list of seed words per topic to converge around</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>zeroshot_topic_list</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of topic names to use for zero-shot classification</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>zeroshot_min_similarity</code></td>
        <td><code>float</code></td>
        <td><p>The minimum similarity between a zero-shot topic and
                     a document for assignment. The higher this value, the more
                     confident the model needs to be to assign a zero-shot topic to a document.</p></td>
        <td><code>0.7</code></td>
      </tr>
      <tr>
        <td><code>verbose</code></td>
        <td><code>bool</code></td>
        <td><p>Changes the verbosity of the model, Set to True if you want
     to track the stages of the model.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>embedding_model</code></td>
        <td></td>
        <td><p>Use a custom embedding model.
             The following backends are currently supported
               * SentenceTransformers
               * Flair
               * Spacy
               * Gensim
               * USE (TF-Hub)
             You can also pass in a string that points to one of the following
             sentence-transformers models:
               * https://www.sbert.net/docs/pretrained_models.html</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>umap_model</code></td>
        <td><code>UMAP</code></td>
        <td><p>Pass in a UMAP model to be used instead of the default.
        NOTE: You can also pass in any dimensionality reduction algorithm as long
        as it has <code>.fit</code> and <code>.transform</code> functions.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>hdbscan_model</code></td>
        <td><code>HDBSCAN</code></td>
        <td><p>Pass in a hdbscan.HDBSCAN model to be used instead of the default
           NOTE: You can also pass in any clustering algorithm as long as it has
           <code>.fit</code> and <code>.predict</code> functions along with the <code>.labels_</code> variable.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>vectorizer_model</code></td>
        <td><code>CountVectorizer</code></td>
        <td><p>Pass in a custom <code>CountVectorizer</code> instead of the default model.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>ctfidf_model</code></td>
        <td><code>TfidfTransformer</code></td>
        <td><p>Pass in a custom ClassTfidfTransformer instead of the default model.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>representation_model</code></td>
        <td><code>BaseRepresentation</code></td>
        <td><p>Pass in a model that fine-tunes the topic representations
                  calculated through c-TF-IDF. Models from <code>bertopic.representation</code>
                  are supported.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
    <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">min_topic_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">calculate_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">seed_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">zeroshot_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">zeroshot_min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">umap_model</span><span class="p">:</span> <span class="n">UMAP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hdbscan_model</span><span class="p">:</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">TfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">representation_model</span><span class="p">:</span> <span class="n">BaseRepresentation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BERTopic initialization.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        language: The main language used in your documents. The default sentence-transformers</span>
<span class="sd">                  model for &quot;english&quot; is `all-MiniLM-L6-v2`. For a full overview of</span>
<span class="sd">                  supported languages see bertopic.backend.languages. Select</span>
<span class="sd">                  &quot;multilingual&quot; to load in the `paraphrase-multilingual-MiniLM-L12-v2`</span>
<span class="sd">                  sentence-transformers model that supports 50+ languages.</span>
<span class="sd">                  NOTE: This is not used if `embedding_model` is used.</span>
<span class="sd">        top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                     too high can negatively impact topic embeddings as topics</span>
<span class="sd">                     are typically best represented by at most 10 words.</span>
<span class="sd">        n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">                      Advised to keep high values between 1 and 3.</span>
<span class="sd">                      More would likely lead to memory issues.</span>
<span class="sd">                      NOTE: This param will not be used if you pass in your own</span>
<span class="sd">                      CountVectorizer.</span>
<span class="sd">        min_topic_size: The minimum size of the topic. Increasing this value will lead</span>
<span class="sd">                        to a lower number of clusters/topics and vice versa.</span>
<span class="sd">                        It is the same parameter as `min_cluster_size` in HDBSCAN.</span>
<span class="sd">                        NOTE: This param will not be used if you are using `hdbscan_model`.</span>
<span class="sd">        nr_topics: Specifying the number of topics will reduce the initial</span>
<span class="sd">                   number of topics to the value specified. This reduction can take</span>
<span class="sd">                   a while as each reduction in topics (-1) activates a c-TF-IDF</span>
<span class="sd">                   calculation. If this is set to None, no reduction is applied. Use</span>
<span class="sd">                   &quot;auto&quot; to automatically reduce topics using HDBSCAN.</span>
<span class="sd">                   NOTE: Controlling the number of topics is best done by adjusting</span>
<span class="sd">                   `min_topic_size` first before adjusting this parameter.</span>
<span class="sd">        low_memory: Sets UMAP low memory to True to make sure less memory is used.</span>
<span class="sd">                    NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP</span>
<span class="sd">                    this parameter will not be used.</span>
<span class="sd">        calculate_probabilities: Calculate the probabilities of all topics</span>
<span class="sd">                                 per document instead of the probability of the assigned</span>
<span class="sd">                                 topic per document. This could slow down the extraction</span>
<span class="sd">                                 of topics if you have many documents (&gt; 100_000).</span>
<span class="sd">                                 NOTE: If false you cannot use the corresponding</span>
<span class="sd">                                 visualization method `visualize_probabilities`.</span>
<span class="sd">                                 NOTE: This is an approximation of topic probabilities</span>
<span class="sd">                                 as used in HDBSCAN and not an exact representation.</span>
<span class="sd">        seed_topic_list: A list of seed words per topic to converge around</span>
<span class="sd">        zeroshot_topic_list: A list of topic names to use for zero-shot classification</span>
<span class="sd">        zeroshot_min_similarity: The minimum similarity between a zero-shot topic and</span>
<span class="sd">                                 a document for assignment. The higher this value, the more</span>
<span class="sd">                                 confident the model needs to be to assign a zero-shot topic to a document.</span>
<span class="sd">        verbose: Changes the verbosity of the model, Set to True if you want</span>
<span class="sd">                 to track the stages of the model.</span>
<span class="sd">        embedding_model: Use a custom embedding model.</span>
<span class="sd">                         The following backends are currently supported</span>
<span class="sd">                           * SentenceTransformers</span>
<span class="sd">                           * Flair</span>
<span class="sd">                           * Spacy</span>
<span class="sd">                           * Gensim</span>
<span class="sd">                           * USE (TF-Hub)</span>
<span class="sd">                         You can also pass in a string that points to one of the following</span>
<span class="sd">                         sentence-transformers models:</span>
<span class="sd">                           * https://www.sbert.net/docs/pretrained_models.html</span>
<span class="sd">        umap_model: Pass in a UMAP model to be used instead of the default.</span>
<span class="sd">                    NOTE: You can also pass in any dimensionality reduction algorithm as long</span>
<span class="sd">                    as it has `.fit` and `.transform` functions.</span>
<span class="sd">        hdbscan_model: Pass in a hdbscan.HDBSCAN model to be used instead of the default</span>
<span class="sd">                       NOTE: You can also pass in any clustering algorithm as long as it has</span>
<span class="sd">                       `.fit` and `.predict` functions along with the `.labels_` variable.</span>
<span class="sd">        vectorizer_model: Pass in a custom `CountVectorizer` instead of the default model.</span>
<span class="sd">        ctfidf_model: Pass in a custom ClassTfidfTransformer instead of the default model.</span>
<span class="sd">        representation_model: Pass in a model that fine-tunes the topic representations</span>
<span class="sd">                              calculated through c-TF-IDF. Models from `bertopic.representation`</span>
<span class="sd">                              are supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Topic-based parameters</span>
    <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Note that extracting more than 100 words from a sparse can slow down computation quite a bit.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span> <span class="o">=</span> <span class="n">min_topic_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span> <span class="o">=</span> <span class="n">low_memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span> <span class="o">=</span> <span class="n">calculate_probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="o">=</span> <span class="n">seed_topic_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_topic_list</span> <span class="o">=</span> <span class="n">zeroshot_topic_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zeroshot_min_similarity</span> <span class="o">=</span> <span class="n">zeroshot_min_similarity</span>

    <span class="c1"># Embedding model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">embedding_model</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>

    <span class="c1"># Vectorizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span> <span class="o">=</span> <span class="n">n_gram_range</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

    <span class="c1"># Representation model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span> <span class="o">=</span> <span class="n">representation_model</span>

    <span class="c1"># UMAP or another algorithm that has .fit and .transform functions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="n">umap_model</span> <span class="ow">or</span> <span class="n">UMAP</span><span class="p">(</span>
        <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
        <span class="n">low_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># HDBSCAN or another clustering algorithm that has .fit and .predict functions and</span>
    <span class="c1"># the .labels_ variable to extract the labels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span> <span class="ow">or</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span>
        <span class="n">min_cluster_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
        <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s2">&quot;eom&quot;</span><span class="p">,</span>
        <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Public attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_topic_id_to_zeroshot_topic_idx</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Private attributes for internal tracking purposes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;WARNING&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.__str__" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get a string representation of the current object.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Human readable representation of the most important model parameters.
     The parameters that represent models are ignored due to their length.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a string representation of the current object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human readable representation of the most important model parameters.</span>
<span class="sd">             The parameters that represent models are ignored due to their length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(...)&quot;</span>
        <span class="n">parameters</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, &quot;</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;BERTopic(</span><span class="si">{</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.approximate_distribution" class="doc doc-heading">
<code class="highlight language-python"><span class="n">approximate_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_similarity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_embedding_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calculate_tokens</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.approximate_distribution" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A post-hoc approximation of topic distributions across documents.</p>
<p>In order to perform this approximation, each document is split into tokens
according to the provided tokenizer in the <code>CountVectorizer</code>. Then, a
sliding window is applied on each document creating subsets of the document.
For example, with a window size of 3 and stride of 1, the sentence:</p>
<p><code>Solving the right problem is difficult.</code></p>
<p>can be split up into <code>solving the right</code>, <code>the right problem</code>, <code>right problem is</code>,
and <code>problem is difficult</code>. These are called tokensets. For each of these
tokensets, we calculate their c-TF-IDF representation and find out
how similar they are to the previously generated topics. Then, the
similarities to the topics for each tokenset are summed up in order to
create a topic distribution for the entire document.</p>
<p>We can also dive into this a bit deeper by then splitting these tokensets
up into individual tokens and calculate how much a word, in a specific sentence,
contributes to the topics found in that document. This can be enabled by
setting <code>calculate_tokens=True</code> which can be used for visualization purposes
in <code>topic_model.visualize_approximate_distribution</code>.</p>
<p>The main output, <code>topic_distributions</code>, can also be used directly in
<code>.visualize_distribution(topic_distributions[index])</code> by simply selecting
a single distribution.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>Union[str, List[str]]</code></td>
        <td><p>A single document or a list of documents for which we
       approximate their topic distributions</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>window</code></td>
        <td><code>int</code></td>
        <td><p>Size of the moving window which indicates the number of
    tokens being considered.</p></td>
        <td><code>4</code></td>
      </tr>
      <tr>
        <td><code>stride</code></td>
        <td><code>int</code></td>
        <td><p>How far the window should move at each step.</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>min_similarity</code></td>
        <td><code>float</code></td>
        <td><p>The minimum similarity of a document's tokenset
            with respect to the topics.</p></td>
        <td><code>0.1</code></td>
      </tr>
      <tr>
        <td><code>batch_size</code></td>
        <td><code>int</code></td>
        <td><p>The number of documents to process at a time. If None,
        then all documents are processed at once.
        NOTE: With a large number of documents, it is not
        advised to process all documents at once.</p></td>
        <td><code>1000</code></td>
      </tr>
      <tr>
        <td><code>padding</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to pad the beginning and ending of a document with
     empty tokens.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>use_embedding_model</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use the topic model's embedding
                 model to calculate the similarity between
                 tokensets and topics instead of using c-TF-IDF.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>calculate_tokens</code></td>
        <td><code>bool</code></td>
        <td><p>Calculate the similarity of tokens with all topics.
              NOTE: This is computation-wise more expensive and
              can require more memory. Using this over batches of
              documents might be preferred.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>separator</code></td>
        <td><code>str</code></td>
        <td><p>The separator used to merge tokens into tokensets.</p></td>
        <td><code>&#39; &#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>topic_distributions</code></td>
      <td><p>A <code>n</code> x <code>m</code> matrix containing the topic distributions
                     for all input documents with <code>n</code> being the documents
                     and <code>m</code> the topics.
topic_token_distributions: A list of <code>t</code> x <code>m</code> arrays with <code>t</code> being the
                           number of tokens for the respective document
                           and <code>m</code> the topics.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>After fitting the model, the topic distributions can be calculated regardless
of the clustering model and regardless of whether the documents were previously
seen or not:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_distr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>As a result, the topic distributions are calculated in <code>topic_distr</code> for the
entire document based on a token set with a specific window size and stride.</p>
<p>If you want to calculate the topic distributions on a token-level:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_distr</span><span class="p">,</span> <span class="n">topic_token_distr</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">calculate_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The <code>topic_token_distr</code> then contains, for each token, the best fitting topics.
As with <code>topic_distr</code>, it can contain multiple topics for a single token.</p>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">approximate_distribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">padding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_embedding_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">calculate_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A post-hoc approximation of topic distributions across documents.</span>

<span class="sd">    In order to perform this approximation, each document is split into tokens</span>
<span class="sd">    according to the provided tokenizer in the `CountVectorizer`. Then, a</span>
<span class="sd">    sliding window is applied on each document creating subsets of the document.</span>
<span class="sd">    For example, with a window size of 3 and stride of 1, the sentence:</span>

<span class="sd">    `Solving the right problem is difficult.`</span>

<span class="sd">    can be split up into `solving the right`, `the right problem`, `right problem is`,</span>
<span class="sd">    and `problem is difficult`. These are called tokensets. For each of these</span>
<span class="sd">    tokensets, we calculate their c-TF-IDF representation and find out</span>
<span class="sd">    how similar they are to the previously generated topics. Then, the</span>
<span class="sd">    similarities to the topics for each tokenset are summed up in order to</span>
<span class="sd">    create a topic distribution for the entire document.</span>

<span class="sd">    We can also dive into this a bit deeper by then splitting these tokensets</span>
<span class="sd">    up into individual tokens and calculate how much a word, in a specific sentence,</span>
<span class="sd">    contributes to the topics found in that document. This can be enabled by</span>
<span class="sd">    setting `calculate_tokens=True` which can be used for visualization purposes</span>
<span class="sd">    in `topic_model.visualize_approximate_distribution`.</span>

<span class="sd">    The main output, `topic_distributions`, can also be used directly in</span>
<span class="sd">    `.visualize_distribution(topic_distributions[index])` by simply selecting</span>
<span class="sd">    a single distribution.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A single document or a list of documents for which we</span>
<span class="sd">                   approximate their topic distributions</span>
<span class="sd">        window: Size of the moving window which indicates the number of</span>
<span class="sd">                tokens being considered.</span>
<span class="sd">        stride: How far the window should move at each step.</span>
<span class="sd">        min_similarity: The minimum similarity of a document&#39;s tokenset</span>
<span class="sd">                        with respect to the topics.</span>
<span class="sd">        batch_size: The number of documents to process at a time. If None,</span>
<span class="sd">                    then all documents are processed at once.</span>
<span class="sd">                    NOTE: With a large number of documents, it is not</span>
<span class="sd">                    advised to process all documents at once.</span>
<span class="sd">        padding: Whether to pad the beginning and ending of a document with</span>
<span class="sd">                 empty tokens.</span>
<span class="sd">        use_embedding_model: Whether to use the topic model&#39;s embedding</span>
<span class="sd">                             model to calculate the similarity between</span>
<span class="sd">                             tokensets and topics instead of using c-TF-IDF.</span>
<span class="sd">        calculate_tokens: Calculate the similarity of tokens with all topics.</span>
<span class="sd">                          NOTE: This is computation-wise more expensive and</span>
<span class="sd">                          can require more memory. Using this over batches of</span>
<span class="sd">                          documents might be preferred.</span>
<span class="sd">        separator: The separator used to merge tokens into tokensets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topic_distributions: A `n` x `m` matrix containing the topic distributions</span>
<span class="sd">                             for all input documents with `n` being the documents</span>
<span class="sd">                             and `m` the topics.</span>
<span class="sd">        topic_token_distributions: A list of `t` x `m` arrays with `t` being the</span>
<span class="sd">                                   number of tokens for the respective document</span>
<span class="sd">                                   and `m` the topics.</span>

<span class="sd">    Examples:</span>
<span class="sd">    After fitting the model, the topic distributions can be calculated regardless</span>
<span class="sd">    of the clustering model and regardless of whether the documents were previously</span>
<span class="sd">    seen or not:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_distr, _ = topic_model.approximate_distribution(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    As a result, the topic distributions are calculated in `topic_distr` for the</span>
<span class="sd">    entire document based on a token set with a specific window size and stride.</span>

<span class="sd">    If you want to calculate the topic distributions on a token-level:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_distr, topic_token_distr = topic_model.approximate_distribution(docs, calculate_tokens=True)</span>
<span class="sd">    ```</span>

<span class="sd">    The `topic_token_distr` then contains, for each token, the best fitting topics.</span>
<span class="sd">    As with `topic_distr`, it can contain multiple topics for a single token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">/</span> <span class="n">batch_size</span><span class="p">)</span>

    <span class="n">topic_distributions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">topic_token_distributions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batches</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
        <span class="n">doc_set</span> <span class="o">=</span> <span class="n">documents</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="c1"># Extract tokens</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">build_tokenizer</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">analyzer</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">doc_set</span><span class="p">]</span>

        <span class="c1"># Extract token sets</span>
        <span class="n">all_sentences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">all_token_sets_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">tokenset</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">window</span><span class="p">:</span>
                <span class="n">token_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">tokenset</span><span class="p">]</span>
                <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Extract tokensets using window and stride parameters</span>
                <span class="n">stride_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenset</span><span class="p">)))[::</span><span class="n">stride</span><span class="p">]</span>
                <span class="n">token_sets</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">stride_index</span> <span class="ow">in</span> <span class="n">stride_indices</span><span class="p">:</span>
                    <span class="n">selected_tokens</span> <span class="o">=</span> <span class="n">tokenset</span><span class="p">[</span><span class="n">stride_index</span> <span class="p">:</span> <span class="n">stride_index</span> <span class="o">+</span> <span class="n">window</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">padding</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">)</span> <span class="o">==</span> <span class="n">window</span><span class="p">:</span>
                        <span class="n">token_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">)</span>
                        <span class="n">token_sets_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="nb">range</span><span class="p">(</span>
                                    <span class="n">stride_index</span><span class="p">,</span>
                                    <span class="n">stride_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_tokens</span><span class="p">),</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                <span class="c1"># Add empty tokens at the beginning and end of a document</span>
                <span class="k">if</span> <span class="n">padding</span><span class="p">:</span>
                    <span class="n">padded</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">padded_ids</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">window</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">window</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">padded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokenset</span><span class="p">[:</span> <span class="n">window</span> <span class="o">-</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">)])</span>
                        <span class="n">padded_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">window</span> <span class="o">-</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">))))</span>

                    <span class="n">token_sets</span> <span class="o">=</span> <span class="n">padded</span> <span class="o">+</span> <span class="n">token_sets</span>
                    <span class="n">token_sets_ids</span> <span class="o">=</span> <span class="n">padded_ids</span> <span class="o">+</span> <span class="n">token_sets_ids</span>

            <span class="c1"># Join the tokens</span>
            <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_sets</span><span class="p">]</span>
            <span class="n">all_sentences</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
            <span class="n">all_token_sets_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">token_sets_ids</span><span class="p">)</span>
            <span class="n">all_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>

        <span class="c1"># Calculate similarity between embeddings of token sets and the topics</span>
        <span class="k">if</span> <span class="n">use_embedding_model</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">all_sentences</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

        <span class="c1"># Calculate similarity between c-TF-IDF of token sets and the topics</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bow_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">all_sentences</span><span class="p">)</span>
            <span class="n">c_tf_idf_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bow_doc</span><span class="p">)</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">c_tf_idf_doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

        <span class="c1"># Only keep similarities that exceed the minimum</span>
        <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">min_similarity</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Aggregate results on an individual token level</span>
        <span class="k">if</span> <span class="n">calculate_tokens</span><span class="p">:</span>
            <span class="n">topic_distribution</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">topic_token_distribution</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># Assign topics to individual tokens</span>
                <span class="n">token_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">))]</span>
                <span class="n">token_val</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">token_id</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">sim</span><span class="p">,</span> <span class="n">token_set</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">all_token_sets_ids</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_set</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_val</span><span class="p">:</span>
                            <span class="n">token_val</span><span class="p">[</span><span class="n">token</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

                <span class="n">matrix</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">token_val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                <span class="c1"># Take empty documents into account</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">))</span>

                <span class="n">topic_token_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
                <span class="n">topic_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>

            <span class="n">topic_distribution</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Aggregate on a tokenset level indicated by the window and stride</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic_distribution</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">all_indices</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">similarity</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">topic_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">topic_distribution</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">topic_token_distribution</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Combine results</span>
        <span class="n">topic_distributions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_distribution</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">topic_token_distribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topic_token_distributions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic_token_distributions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topic_token_distribution</span><span class="p">)</span>

    <span class="n">topic_distributions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">topic_distributions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">topic_distributions</span><span class="p">,</span> <span class="n">topic_token_distributions</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.find_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.find_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Find topics most similar to a search_term.</p>
<p>Creates an embedding for a search query and compares that with
the topic embeddings. The most similar topics are returned
along with their similarity values.</p>
<p>The query is specified using search_term for text queries or image for image queries.</p>
<p>The search_term can be of any size but since it is compared
with the topic representation it is advised to keep it
below 5 words.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>search_term</code></td>
        <td><code>str</code></td>
        <td><p>the term you want to use to search for topics.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>image</code></td>
        <td><code>str</code></td>
        <td><p>path to the image you want to use to search for topics.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n</code></td>
        <td><code>int</code></td>
        <td><p>the number of topics to return</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>similar_topics</code></td>
      <td><p>the most similar topics from high to low
similarity: the similarity scores from high to low</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>You can use the underlying embedding model to find topics that
best represent the search term:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics</span><span class="p">,</span> <span class="n">similarity</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">find_topics</span><span class="p">(</span><span class="s2">&quot;sports&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>Note that the search query is typically more accurate if the
search_term consists of a phrase or multiple words.</p>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find topics most similar to a search_term.</span>

<span class="sd">    Creates an embedding for a search query and compares that with</span>
<span class="sd">    the topic embeddings. The most similar topics are returned</span>
<span class="sd">    along with their similarity values.</span>

<span class="sd">    The query is specified using search_term for text queries or image for image queries.</span>

<span class="sd">    The search_term can be of any size but since it is compared</span>
<span class="sd">    with the topic representation it is advised to keep it</span>
<span class="sd">    below 5 words.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        search_term: the term you want to use to search for topics.</span>
<span class="sd">        image: path to the image you want to use to search for topics.</span>
<span class="sd">        top_n: the number of topics to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        similar_topics: the most similar topics from high to low</span>
<span class="sd">        similarity: the similarity scores from high to low</span>

<span class="sd">    Examples:</span>
<span class="sd">    You can use the underlying embedding model to find topics that</span>
<span class="sd">    best represent the search term:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics, similarity = topic_model.find_topics(&quot;sports&quot;, top_n=5)</span>
<span class="sd">    ```</span>

<span class="sd">    Note that the search query is typically more accurate if the</span>
<span class="sd">    search_term consists of a phrase or multiple words.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This method can only be used if you did not use custom embeddings.&quot;</span><span class="p">)</span>

    <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Extract search_term embeddings and compare with topic embeddings</span>
    <span class="k">if</span> <span class="n">search_term</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">([</span><span class="n">search_term</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">image</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">search_embedding</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Extract topics most similar to search_term</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sims</span><span class="p">)[</span><span class="o">-</span><span class="n">top_n</span><span class="p">:]</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="p">[</span><span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">similar_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">similar_topics</span><span class="p">,</span> <span class="n">similarity</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.fit" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of documents to fit on</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images to fit on or the images themselves</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>y</code></td>
        <td><code>Union[List[int], numpy.ndarray]</code></td>
        <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        images: A list of paths to the images to fit on or the images themselves</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic().fit(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.fit_transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.fit_transform" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Fit the models on a collection of documents, generate topics,
and return the probabilities and topic per document.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of documents to fit on</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images to fit on or the images themselves</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>y</code></td>
        <td><code>Union[List[int], numpy.ndarray]</code></td>
        <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>predictions</code></td>
      <td><p>Topic predictions for each documents
probabilities: The probability of the assigned topic per document.
               If <code>calculate_probabilities</code> in BERTopic is set to True, then
               it calculates the probabilities of all topics across all documents
               instead of only the assigned topic. This, however, slows down
               computation and may increase memory usage.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the models on a collection of documents, generate topics,</span>
<span class="sd">    and return the probabilities and topic per document.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        images: A list of paths to the images to fit on or the images themselves</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Returns:</span>
<span class="sd">        predictions: Topic predictions for each documents</span>
<span class="sd">        probabilities: The probability of the assigned topic per document.</span>
<span class="sd">                       If `calculate_probabilities` in BERTopic is set to True, then</span>
<span class="sd">                       it calculates the probabilities of all topics across all documents</span>
<span class="sd">                       instead of only the assigned topic. This, however, slows down</span>
<span class="sd">                       computation and may increase memory usage.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="n">doc_ids</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">))</span> <span class="k">if</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">))</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="n">doc_ids</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">})</span>

    <span class="c1"># Extract embeddings</span>
    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Embedding - Transforming documents to embeddings.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Embedding - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
            <span class="p">)</span>

    <span class="c1"># Guided Topic Modeling</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

    <span class="c1"># Reduce dimensionality and fit UMAP model</span>
    <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Zero-shot Topic Modeling</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">():</span>
        <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">,</span> <span class="n">assigned_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zeroshot_topic_modeling</span><span class="p">(</span>
            <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span>
        <span class="p">)</span>
        <span class="c1"># Filter UMAP embeddings to only non-assigned embeddings to be used for clustering</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># No zero-shot topics matched</span>
        <span class="c1"># Cluster reduced embeddings</span>
        <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_combine_zeroshot_topics</span><span class="p">(</span>
                <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">assigned_documents</span><span class="p">,</span> <span class="n">assigned_embeddings</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># All documents matches zero-shot topics</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">assigned_documents</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">assigned_embeddings</span>
    <span class="n">topics_before_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>

    <span class="c1"># Sort and Map Topic IDs by their frequency</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Create documents from images if we have images only</span>
    <span class="k">if</span> <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_to_text</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Extract topics by calculating c-TF-IDF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Reduce topics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
            <span class="n">custom_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">)</span>

        <span class="c1"># Save the top 3 most representative documents per topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">custom_documents</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Extract topics by calculating c-TF-IDF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Reduce topics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Save the top 3 most representative documents per topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># In the case of zero-shot topics, probability will come from cosine similarity,</span>
    <span class="c1"># and the HDBSCAN model will be removed</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_zeroshot</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">assigned_documents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">BaseCluster</span><span class="p">()</span>
        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use `topics_before_reduction` because `self.topics_` may have already been updated from</span>
            <span class="c1"># reducing topics, and the original probabilities are needed for `self._map_probabilities()`</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">topics_before_reduction</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">,</span>
            <span class="p">]</span>

    <span class="c1"># Resulting output</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.generate_topic_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nr_words</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">topic_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">word_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get labels for each topic in a user-defined format.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>nr_words</code></td>
        <td><code>int</code></td>
        <td><p>Top <code>n</code> words per topic to use</p></td>
        <td><code>3</code></td>
      </tr>
      <tr>
        <td><code>topic_prefix</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use the topic ID as a prefix.
          If set to True, the topic ID will be separated
          using the <code>separator</code></p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>word_length</code></td>
        <td><code>int</code></td>
        <td><p>The maximum length of each word in the topic label.
         Some words might be relatively long and setting this
         value helps to make sure that all labels have relatively
         similar lengths.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>separator</code></td>
        <td><code>str</code></td>
        <td><p>The string with which the words and topic prefix will be
       separated. Underscores are the default but a nice alternative
       is <code>", "</code>.</p></td>
        <td><code>&#39;_&#39;</code></td>
      </tr>
      <tr>
        <td><code>aspect</code></td>
        <td><code>str</code></td>
        <td><p>The aspect from which to generate topic labels</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>topic_labels</code></td>
      <td><p>A list of topic labels sorted from the lowest topic ID to the highest.
              If the topic model was trained using HDBSCAN, the lowest topic ID is -1,
              otherwise it is 0.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To create our custom topic labels, usage is rather straightforward:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_labels</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">generate_topic_labels</span><span class="p">(</span><span class="n">nr_words</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_topic_labels</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nr_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">topic_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">word_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
    <span class="n">aspect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get labels for each topic in a user-defined format.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        nr_words: Top `n` words per topic to use</span>
<span class="sd">        topic_prefix: Whether to use the topic ID as a prefix.</span>
<span class="sd">                      If set to True, the topic ID will be separated</span>
<span class="sd">                      using the `separator`</span>
<span class="sd">        word_length: The maximum length of each word in the topic label.</span>
<span class="sd">                     Some words might be relatively long and setting this</span>
<span class="sd">                     value helps to make sure that all labels have relatively</span>
<span class="sd">                     similar lengths.</span>
<span class="sd">        separator: The string with which the words and topic prefix will be</span>
<span class="sd">                   separated. Underscores are the default but a nice alternative</span>
<span class="sd">                   is `&quot;, &quot;`.</span>
<span class="sd">        aspect: The aspect from which to generate topic labels</span>

<span class="sd">    Returns:</span>
<span class="sd">        topic_labels: A list of topic labels sorted from the lowest topic ID to the highest.</span>
<span class="sd">                      If the topic model was trained using HDBSCAN, the lowest topic ID is -1,</span>
<span class="sd">                      otherwise it is 0.</span>

<span class="sd">    Examples:</span>
<span class="sd">    To create our custom topic labels, usage is rather straightforward:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_labels = topic_model.generate_topic_labels(nr_words=2, separator=&quot;, &quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

    <span class="n">topic_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">aspect</span><span class="p">:</span>
            <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">[</span><span class="n">aspect</span><span class="p">][</span><span class="n">topic</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">word_length</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[:</span><span class="n">word_length</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">][:</span><span class="n">nr_words</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)[:</span><span class="n">nr_words</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">topic_prefix</span><span class="p">:</span>
            <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}{</span><span class="n">separator</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic_label</span> <span class="o">=</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

        <span class="n">topic_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">topic_labels</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_document_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_document_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_document_info" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get information about the documents on which the topic was trained
including the documents themselves, their respective topics, the name
of each topic, the top n words of each topic, whether it is a
representative document, and probability of the clustering if the cluster
model supports it.</p>
<p>There are also options to include other meta data, such as the topic
distributions or the x and y coordinates of the reduced embeddings.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents on which the topic model was trained.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>df</code></td>
        <td><code>DataFrame</code></td>
        <td><p>A dataframe containing the metadata and the documents on which
the topic model was originally trained on.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>metadata</code></td>
        <td><code>Mapping[str, Any]</code></td>
        <td><p>A dictionary with meta data for each document in the form
      of column name (key) and the respective values (value).</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>document_info</code></td>
      <td><p>A dataframe with several statistics regarding
               the documents on which the topic model was trained.</p></td>
    </tr>
  </tbody>
</table>      <p>Usage:</p>
<p>To get the document info, you will only need to pass the documents on which
the topic model was trained:</p>
<div class="highlight"><pre><span></span><code><span class="n">document_info</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_document_info</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>There are additionally options to include meta data, such as the topic
distributions. Moreover, we can pass the original dataframe that contains
the documents and extend it with the information retrieved from BERTopic:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="c1"># The original data in a dataframe format to include the target variable</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]})</span>

<span class="c1"># Add information about the percentage of the document that relates to the topic</span>
<span class="n">topic_distr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">distributions</span> <span class="o">=</span> <span class="p">[</span><span class="n">distr</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">distr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">topic_distr</span><span class="p">)]</span>

<span class="c1"># Create our documents dataframe using the original dataframe and meta data about</span>
<span class="c1"># the topic distributions</span>
<span class="n">document_info</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_document_info</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
                                              <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Topic_distribution&quot;</span><span class="p">:</span> <span class="n">distributions</span><span class="p">})</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_document_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get information about the documents on which the topic was trained</span>
<span class="sd">    including the documents themselves, their respective topics, the name</span>
<span class="sd">    of each topic, the top n words of each topic, whether it is a</span>
<span class="sd">    representative document, and probability of the clustering if the cluster</span>
<span class="sd">    model supports it.</span>

<span class="sd">    There are also options to include other meta data, such as the topic</span>
<span class="sd">    distributions or the x and y coordinates of the reduced embeddings.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents on which the topic model was trained.</span>
<span class="sd">        df: A dataframe containing the metadata and the documents on which</span>
<span class="sd">            the topic model was originally trained on.</span>
<span class="sd">        metadata: A dictionary with meta data for each document in the form</span>
<span class="sd">                  of column name (key) and the respective values (value).</span>

<span class="sd">    Returns:</span>
<span class="sd">        document_info: A dataframe with several statistics regarding</span>
<span class="sd">                       the documents on which the topic model was trained.</span>

<span class="sd">    Usage:</span>

<span class="sd">    To get the document info, you will only need to pass the documents on which</span>
<span class="sd">    the topic model was trained:</span>

<span class="sd">    ```python</span>
<span class="sd">    document_info = topic_model.get_document_info(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    There are additionally options to include meta data, such as the topic</span>
<span class="sd">    distributions. Moreover, we can pass the original dataframe that contains</span>
<span class="sd">    the documents and extend it with the information retrieved from BERTopic:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    # The original data in a dataframe format to include the target variable</span>
<span class="sd">    data = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))</span>
<span class="sd">    df = pd.DataFrame({&quot;Document&quot;: data[&#39;data&#39;], &quot;Class&quot;: data[&#39;target&#39;]})</span>

<span class="sd">    # Add information about the percentage of the document that relates to the topic</span>
<span class="sd">    topic_distr, _ = topic_model.approximate_distribution(docs, batch_size=1000)</span>
<span class="sd">    distributions = [distr[topic] if topic != -1 else 0 for topic, distr in zip(topics, topic_distr)]</span>

<span class="sd">    # Create our documents dataframe using the original dataframe and meta data about</span>
<span class="sd">    # the topic distributions</span>
<span class="sd">    document_info = topic_model.get_document_info(docs, df=df,</span>
<span class="sd">                                                  metadata={&quot;Topic_distribution&quot;: distributions})</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">document_info</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
        <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">document_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

    <span class="c1"># Add topic info through `.get_topic_info()`</span>
    <span class="n">topic_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">document_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">document_info</span><span class="p">,</span> <span class="n">topic_info</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="c1"># Add top n words</span>
    <span class="n">top_n_words</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="s2">&quot; - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
    <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Top_n_words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">document_info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">top_n_words</span><span class="p">)</span>

    <span class="c1"># Add flat probabilities</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>
            <span class="p">]</span>

    <span class="c1"># Add representative document labels</span>
    <span class="n">repr_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">repr_doc</span> <span class="k">for</span> <span class="n">repr_docs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">repr_doc</span> <span class="ow">in</span> <span class="n">repr_docs</span><span class="p">]</span>
    <span class="n">document_info</span><span class="p">[</span><span class="s2">&quot;Representative_document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">document_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">document_info</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">repr_docs</span><span class="p">),</span> <span class="s2">&quot;Representative_document&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Add custom meta data provided by the user</span>
    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">document_info</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
    <span class="k">return</span> <span class="n">document_info</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_params" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get parameters for this estimator.</p>
<p>Adapted from:
    https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deep</code></td>
        <td><code>bool</code></td>
        <td><p>bool, default=True
  If True, will return the parameters for this estimator and
  contained subobjects that are estimators.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>out</code></td>
      <td><p>Parameter names mapped to their values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get parameters for this estimator.</span>

<span class="sd">    Adapted from:</span>
<span class="sd">        https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>

<span class="sd">    Arguments:</span>
<span class="sd">        deep: bool, default=True</span>
<span class="sd">              If True, will return the parameters for this estimator and</span>
<span class="sd">              contained subobjects that are estimators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        out: Parameter names mapped to their values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_names</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;get_params&quot;</span><span class="p">):</span>
            <span class="n">deep_items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">deep_items</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_representative_docs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extract the best representing documents per topic.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This does not extract all documents per topic as all documents
are not saved within BERTopic. To get all documents, please
run the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># When you used `.fit_transform`:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">})</span>

<span class="c1"># When you used `.fit`:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>
</code></pre></div>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic</code></td>
        <td><code>int</code></td>
        <td><p>A specific topic for which you want
   the representative documents</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>Representative documents of the chosen topic</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To extract the representative docs of all topics:</p>
<div class="highlight"><pre><span></span><code><span class="n">representative_docs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_representative_docs</span><span class="p">()</span>
</code></pre></div>
<p>To get the representative docs of a single topic:</p>
<div class="highlight"><pre><span></span><code><span class="n">representative_docs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_representative_docs</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the best representing documents per topic.</span>

<span class="sd">    Note:</span>
<span class="sd">        This does not extract all documents per topic as all documents</span>
<span class="sd">        are not saved within BERTopic. To get all documents, please</span>
<span class="sd">        run the following:</span>

<span class="sd">        ```python</span>
<span class="sd">        # When you used `.fit_transform`:</span>
<span class="sd">        df = pd.DataFrame({&quot;Document&quot;: docs, &quot;Topic&quot;: topic})</span>

<span class="sd">        # When you used `.fit`:</span>
<span class="sd">        df = pd.DataFrame({&quot;Document&quot;: docs, &quot;Topic&quot;: topic_model.topics_})</span>
<span class="sd">        ```</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want</span>
<span class="sd">               the representative documents</span>

<span class="sd">    Returns:</span>
<span class="sd">        Representative documents of the chosen topic</span>

<span class="sd">    Examples:</span>
<span class="sd">    To extract the representative docs of all topics:</span>

<span class="sd">    ```python</span>
<span class="sd">    representative_docs = topic_model.get_representative_docs()</span>
<span class="sd">    ```</span>

<span class="sd">    To get the representative docs of a single topic:</span>

<span class="sd">    ```python</span>
<span class="sd">    representative_docs = topic_model.get_representative_docs(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_topic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_topic" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Return top n words for a specific topic and their c-TF-IDF scores.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic</code></td>
        <td><code>int</code></td>
        <td><p>A specific topic for which you want its representation</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>full</code></td>
        <td><code>bool</code></td>
        <td><p>If True, returns all different forms of topic representations
  for a topic, including aspects</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[Mapping[str, Tuple[str, float]], bool]</code></td>
      <td><p>The top n words for a specific word and its respective c-TF-IDF scores</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">topic</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return top n words for a specific topic and their c-TF-IDF scores.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want its representation</span>
<span class="sd">        full: If True, returns all different forms of topic representations</span>
<span class="sd">              for a topic, including aspects</span>

<span class="sd">    Returns:</span>
<span class="sd">        The top n words for a specific word and its respective c-TF-IDF scores</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    topic = topic_model.get_topic(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">representations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]}</span>
            <span class="n">aspects</span> <span class="o">=</span> <span class="p">{</span><span class="n">aspect</span><span class="p">:</span> <span class="n">representations</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">representations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">representations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">aspects</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">representations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_topic_freq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Return the size of topics (descending order).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic</code></td>
        <td><code>int</code></td>
        <td><p>A specific topic for which you want the frequency</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[pandas.core.frame.DataFrame, int]</code></td>
      <td><p>Either the frequency of a single topic or dataframe with
the frequencies of all topics</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To extract the frequency of all topics:</p>
<div class="highlight"><pre><span></span><code><span class="n">frequency</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">()</span>
</code></pre></div>
<p>To get the frequency of a single topic:</p>
<div class="highlight"><pre><span></span><code><span class="n">frequency</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the size of topics (descending order).</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want the frequency</span>

<span class="sd">    Returns:</span>
<span class="sd">        Either the frequency of a single topic or dataframe with</span>
<span class="sd">        the frequencies of all topics</span>

<span class="sd">    Examples:</span>
<span class="sd">    To extract the frequency of all topics:</span>

<span class="sd">    ```python</span>
<span class="sd">    frequency = topic_model.get_topic_freq()</span>
<span class="sd">    ```</span>

<span class="sd">    To get the frequency of a single topic:</span>

<span class="sd">    ```python</span>
<span class="sd">    frequency = topic_model.get_topic_freq(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_topic_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_topic_info" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get information about each topic including its ID, frequency, and name.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic</code></td>
        <td><code>int</code></td>
        <td><p>A specific topic for which you want the frequency</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>info</code></td>
      <td><p>The information relating to either a single topic or all topics</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">info_df</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get information about each topic including its ID, frequency, and name.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want the frequency</span>

<span class="sd">    Returns:</span>
<span class="sd">        info: The information relating to either a single topic or all topics</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    info_df = topic_model.get_topic_info()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span>

    <span class="c1"># Custom label</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Main Keywords</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Extract all topic aspects</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span>
                <span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">info</span><span class="p">[</span><span class="n">aspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Representative Docs / Images</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representative_Docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Representative_Images&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">representative_images_</span><span class="p">)</span>

    <span class="c1"># Select specific topic to return</span>
    <span class="k">if</span> <span class="n">topic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_topic_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_tree</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extract the topic tree such that it can be printed.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>hier_topics</code></td>
        <td><code>DataFrame</code></td>
        <td><p>A dataframe containing the structure of the topic tree.
         This is the output of <code>topic_model.hierarchical_topics()</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>max_distance</code></td>
        <td><code>float</code></td>
        <td><p>The maximum distance between two topics. This value is
          based on the Distance column in <code>hier_topics</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>tight_layout</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use a tight layout (narrow width) for
          easier readability if you have hundreds of topics.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>A tree that has the following structure when printed</code></td>
      <td><p>.
    .
    â””â”€health_medical_disease_patients_hiv
        â”œâ”€patients_medical_disease_candida_health
        â”‚    â”œâ”€â– â”€â”€candida_yeast_infection_gonorrhea_infections â”€â”€ Topic: 48
        â”‚    â””â”€patients_disease_cancer_medical_doctor
        â”‚         â”œâ”€â– â”€â”€hiv_medical_cancer_patients_doctor â”€â”€ Topic: 34
        â”‚         â””â”€â– â”€â”€pain_drug_patients_disease_diet â”€â”€ Topic: 26
        â””â”€â– â”€â”€health_newsgroup_tobacco_vote_votes â”€â”€ Topic: 9</p>
<p>The blocks (â– ) indicate that the topic is one you can directly access
from <code>topic_model.get_topic</code>. In other words, they are the original un-grouped topics.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="c1"># Train model</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Print topic tree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_tree</span><span class="p">(</span><span class="n">hierarchical_topics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_topic_tree</span><span class="p">(</span>
    <span class="n">hier_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tight_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the topic tree such that it can be printed.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        hier_topics: A dataframe containing the structure of the topic tree.</span>
<span class="sd">                     This is the output of `topic_model.hierarchical_topics()`</span>
<span class="sd">        max_distance: The maximum distance between two topics. This value is</span>
<span class="sd">                      based on the Distance column in `hier_topics`.</span>
<span class="sd">        tight_layout: Whether to use a tight layout (narrow width) for</span>
<span class="sd">                      easier readability if you have hundreds of topics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tree that has the following structure when printed:</span>
<span class="sd">            .</span>
<span class="sd">            .</span>
<span class="sd">            â””â”€health_medical_disease_patients_hiv</span>
<span class="sd">                â”œâ”€patients_medical_disease_candida_health</span>
<span class="sd">                â”‚    â”œâ”€â– â”€â”€candida_yeast_infection_gonorrhea_infections â”€â”€ Topic: 48</span>
<span class="sd">                â”‚    â””â”€patients_disease_cancer_medical_doctor</span>
<span class="sd">                â”‚         â”œâ”€â– â”€â”€hiv_medical_cancer_patients_doctor â”€â”€ Topic: 34</span>
<span class="sd">                â”‚         â””â”€â– â”€â”€pain_drug_patients_disease_diet â”€â”€ Topic: 26</span>
<span class="sd">                â””â”€â– â”€â”€health_newsgroup_tobacco_vote_votes â”€â”€ Topic: 9</span>

<span class="sd">        The blocks (â– ) indicate that the topic is one you can directly access</span>
<span class="sd">        from `topic_model.get_topic`. In other words, they are the original un-grouped topics.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    # Train model</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Print topic tree</span>
<span class="sd">    tree = topic_model.get_topic_tree(hierarchical_topics)</span>
<span class="sd">    print(tree)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">tight_layout</span> <span class="k">else</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">max_original_topic</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Extract mapping from ID to name</span>
    <span class="n">topic_to_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_Name</span><span class="p">))</span>
    <span class="n">topic_to_name</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_Name</span><span class="p">)))</span>
    <span class="n">topic_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">name</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Create tree</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Parent_ID</span><span class="p">):</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Based on: https://stackoverflow.com/a/51920869/10532563.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">grandpa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="c1"># Get distance between merged topics</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">),</span>
                <span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">10</span>

            <span class="k">if</span> <span class="n">parent</span> <span class="o">!=</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grandpa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_original_topic</span><span class="p">:</span>
                        <span class="c1"># Do not append topic ID if they are not merged</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;â– â”€â”€&quot;</span> <span class="o">+</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; â”€â”€ Topic: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;O </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">to_print</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â”œ&quot;</span> <span class="o">+</span> <span class="s2">&quot;â”€&quot;</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â”‚&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

            <span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;â””&quot;</span> <span class="o">+</span> <span class="s2">&quot;â”€&quot;</span>
            <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">to_print</span>

        <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">to_print</span>

    <span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.get_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.get_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Return topics with top n words and their c-TF-IDF score.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>full</code></td>
        <td><code>bool</code></td>
        <td><p>If True, returns all different forms of topic representations
  for each topic, including aspects</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>self.topic_representations_</code></td>
      <td><p>The top n words per topic and the corresponding c-TF-IDF score</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">all_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topics</span><span class="p">()</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return topics with top n words and their c-TF-IDF score.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        full: If True, returns all different forms of topic representations</span>
<span class="sd">              for each topic, including aspects</span>

<span class="sd">    Returns:</span>
<span class="sd">        self.topic_representations_: The top n words per topic and the corresponding c-TF-IDF score</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    all_topics = topic_model.get_topics()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">topic_representations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">}</span>
        <span class="n">topic_representations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_aspects_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">topic_representations</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.hierarchical_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hierarchical_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance_function</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Create a hierarchy of topics.</p>
<p>To create this hierarchy, BERTopic needs to be already fitted once.
Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF or topic embeddings
representation using <code>scipy.cluster.hierarchy.linkage</code>.</p>
<p>Based on that hierarchy, we calculate the topic representation at each
merged step. This is a local representation, as we only assume that the
chosen step is merged and not all others which typically improves the
topic representation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>use_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the
        embeddings from the embedding model are used.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>linkage_function</code></td>
        <td><code>Callable[[scipy.sparse._csr.csr_matrix], numpy.ndarray]</code></td>
        <td><p>The linkage function to use. Default is:
              <code>lambda x: sch.linkage(x, 'ward', optimal_ordering=True)</code></p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>distance_function</code></td>
        <td><code>Callable[[scipy.sparse._csr.csr_matrix], scipy.sparse._csr.csr_matrix]</code></td>
        <td><p>The distance function to use on the c-TF-IDF matrix. Default is:
               <code>lambda x: 1 - cosine_similarity(x)</code>.
               You can pass any function that returns either a square matrix of
               shape (n_samples, n_samples) with zeros on the diagonal and
               non-negative values or condensed distance matrix of shape
               (n_samples * (n_samples - 1) / 2,) containing the upper
               triangular of the distance matrix.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>hierarchical_topics</code></td>
      <td><p>A dataframe that contains a hierarchy of topics
                     represented by their parents and their children</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>A custom linkage function can be used as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span> <span class="k">as</span> <span class="n">sch</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Hierarchical topics</span>
<span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">hierarchical_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hierarchy of topics.</span>

<span class="sd">    To create this hierarchy, BERTopic needs to be already fitted once.</span>
<span class="sd">    Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF or topic embeddings</span>
<span class="sd">    representation using `scipy.cluster.hierarchy.linkage`.</span>

<span class="sd">    Based on that hierarchy, we calculate the topic representation at each</span>
<span class="sd">    merged step. This is a local representation, as we only assume that the</span>
<span class="sd">    chosen step is merged and not all others which typically improves the</span>
<span class="sd">    topic representation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                    embeddings from the embedding model are used.</span>
<span class="sd">        linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                          `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">        distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                           `lambda x: 1 - cosine_similarity(x)`.</span>
<span class="sd">                           You can pass any function that returns either a square matrix of</span>
<span class="sd">                           shape (n_samples, n_samples) with zeros on the diagonal and</span>
<span class="sd">                           non-negative values or condensed distance matrix of shape</span>
<span class="sd">                           (n_samples * (n_samples - 1) / 2,) containing the upper</span>
<span class="sd">                           triangular of the distance matrix.</span>

<span class="sd">    Returns:</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                             represented by their parents and their children</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    A custom linkage function can be used as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from scipy.cluster import hierarchy as sch</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">    # Hierarchical topics</span>
<span class="sd">    linkage_function = lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs, linkage_function=linkage_function)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">distance_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">distance_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">linkage_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;ward&quot;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Calculate distance</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">select_topic_representation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:</span>
    <span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">distance_function</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">validate_distance_matrix</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Use the 1-D condensed distance matrix as an input instead of the raw distance matrix</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Ensuring that the distances between clusters are unique otherwise the flatting of the hierarchy with</span>
    <span class="c1"># `sch.fcluster(...)` would produce incorrect values for &quot;Topics&quot; for these clusters</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])):</span>
        <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_unique_distances</span><span class="p">(</span><span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Calculate basic bag-of-words to be iteratively merged later</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">clean_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
    <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

    <span class="n">bow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">clean_documents</span><span class="p">)</span>

    <span class="c1"># Extract clusters</span>
    <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Parent_Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Topics&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Child_Left_Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Child_Right_Name&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))):</span>
        <span class="c1"># Find clustered documents</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
        <span class="n">nr_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

        <span class="c1"># Extract first topic we find to get the set of topics in a merged topic</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">topic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">clustered_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">clusters</span><span class="p">[</span><span class="n">topic</span><span class="p">]]</span>

        <span class="c1"># Group bow per cluster, calculate c-TF-IDF and extract words</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">bow</span><span class="p">[</span><span class="n">clustered_topics</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">clustered_topics</span><span class="p">),</span> <span class="p">:]</span>
        <span class="n">selection</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Extract parent&#39;s name and ID</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="mi">5</span><span class="p">])</span>

        <span class="c1"># Extract child&#39;s name and ID</span>
        <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">child_left_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

        <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">child_left_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_left_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_left_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

        <span class="c1"># Extract child&#39;s name and ID</span>
        <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">child_right_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

        <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">child_right_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_right_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_right_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

        <span class="c1"># Save results</span>
        <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">parent_id</span><span class="p">,</span>
            <span class="n">parent_name</span><span class="p">,</span>
            <span class="n">clustered_topics</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">child_left_name</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">child_right_name</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="n">hier_topics</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hier_topics</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.load" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Loads the model from the specified path or directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>str</code></td>
        <td><p>Either load a BERTopic model from a file (<code>.pickle</code>) or a folder containing
  <code>.safetensors</code> or <code>.bin</code> files.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embedding_model</code></td>
        <td></td>
        <td><p>Additionally load in an embedding model if it was not saved
             in the BERTopic model file or directory.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">BERTopic</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model_dir&quot;</span><span class="p">)</span>
</code></pre></div>
<p>or if you did not save the embedding model:</p>
<div class="highlight"><pre><span></span><code><span class="n">BERTopic</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model_dir&quot;</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the model from the specified path or directory.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        path: Either load a BERTopic model from a file (`.pickle`) or a folder containing</span>
<span class="sd">              `.safetensors` or `.bin` files.</span>
<span class="sd">        embedding_model: Additionally load in an embedding model if it was not saved</span>
<span class="sd">                         in the BERTopic model file or directory.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    BERTopic.load(&quot;model_dir&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you did not save the embedding model:</span>

<span class="sd">    ```python</span>
<span class="sd">    BERTopic.load(&quot;model_dir&quot;, embedding_model=&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_or_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Load from Pickle</span>
    <span class="k">if</span> <span class="n">file_or_dir</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_or_dir</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">embedding_model</span><span class="p">:</span>
                <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">topic_model</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">topic_model</span>

    <span class="c1"># Load from directory or HF</span>
    <span class="k">if</span> <span class="n">file_or_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">ctfidf_tensors</span><span class="p">,</span> <span class="n">ctfidf_config</span><span class="p">,</span> <span class="n">images</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_local_files</span><span class="p">(</span><span class="n">file_or_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">ctfidf_tensors</span><span class="p">,</span> <span class="n">ctfidf_config</span><span class="p">,</span> <span class="n">images</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_files_from_hf</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure to either pass a valid directory or HF model.&quot;</span><span class="p">)</span>
    <span class="n">topic_model</span> <span class="o">=</span> <span class="n">_create_model_from_files</span><span class="p">(</span>
        <span class="n">topics</span><span class="p">,</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">tensors</span><span class="p">,</span>
        <span class="n">ctfidf_tensors</span><span class="p">,</span>
        <span class="n">ctfidf_config</span><span class="p">,</span>
        <span class="n">images</span><span class="p">,</span>
        <span class="n">warn_no_backend</span><span class="o">=</span><span class="p">(</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Replace embedding model if one is specifically chosen</span>
    <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">topic_model</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">topic_model</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.merge_models" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_models</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">min_similarity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.merge_models" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Merge multiple pre-trained BERTopic models into a single model.</p>
<p>The models are merged as if they were all saved using pytorch or
safetensors, so a minimal version without c-TF-IDF.</p>
<p>To do this, we choose the first model in the list of
models as a baseline. Then, we check each model whether
they contain topics that are not in the baseline.
This check is based on the cosine similarity between
topics embeddings. If topic embeddings between two models
are similar, then the topic of the second model is re-assigned
to the first. If they are dissimilar, the topic of the second
model is assigned to the first.</p>
<p>In essence, we simply check whether sufficiently "new"
topics emerge and add them.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>models</code></td>
        <td></td>
        <td><p>A list of fitted BERTopic models</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>min_similarity</code></td>
        <td><code>float</code></td>
        <td><p>The minimum similarity for when topics are merged.</p></td>
        <td><code>0.7</code></td>
      </tr>
      <tr>
        <td><code>embedding_model</code></td>
        <td></td>
        <td><p>Additionally load in an embedding model if necessary.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>A new BERTopic model that was created as if you were
loading a model from the HuggingFace Hub without c-TF-IDF</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

<span class="c1"># Create three separate models</span>
<span class="n">topic_model_1</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">min_topic_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">[:</span><span class="mi">4000</span><span class="p">])</span>
<span class="n">topic_model_2</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">min_topic_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">4000</span><span class="p">:</span><span class="mi">8000</span><span class="p">])</span>
<span class="n">topic_model_3</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">min_topic_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">8000</span><span class="p">:])</span>

<span class="c1"># Combine all models into one</span>
<span class="n">merged_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="o">.</span><span class="n">merge_models</span><span class="p">([</span><span class="n">topic_model_1</span><span class="p">,</span> <span class="n">topic_model_2</span><span class="p">,</span> <span class="n">topic_model_3</span><span class="p">])</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">merge_models</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">min_similarity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge multiple pre-trained BERTopic models into a single model.</span>

<span class="sd">    The models are merged as if they were all saved using pytorch or</span>
<span class="sd">    safetensors, so a minimal version without c-TF-IDF.</span>

<span class="sd">    To do this, we choose the first model in the list of</span>
<span class="sd">    models as a baseline. Then, we check each model whether</span>
<span class="sd">    they contain topics that are not in the baseline.</span>
<span class="sd">    This check is based on the cosine similarity between</span>
<span class="sd">    topics embeddings. If topic embeddings between two models</span>
<span class="sd">    are similar, then the topic of the second model is re-assigned</span>
<span class="sd">    to the first. If they are dissimilar, the topic of the second</span>
<span class="sd">    model is assigned to the first.</span>

<span class="sd">    In essence, we simply check whether sufficiently &quot;new&quot;</span>
<span class="sd">    topics emerge and add them.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        models: A list of fitted BERTopic models</span>
<span class="sd">        min_similarity: The minimum similarity for when topics are merged.</span>
<span class="sd">        embedding_model: Additionally load in an embedding model if necessary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new BERTopic model that was created as if you were</span>
<span class="sd">        loading a model from the HuggingFace Hub without c-TF-IDF</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>

<span class="sd">    # Create three separate models</span>
<span class="sd">    topic_model_1 = BERTopic(min_topic_size=5).fit(docs[:4000])</span>
<span class="sd">    topic_model_2 = BERTopic(min_topic_size=5).fit(docs[4000:8000])</span>
<span class="sd">    topic_model_3 = BERTopic(min_topic_size=5).fit(docs[8000:])</span>

<span class="sd">    # Combine all models into one</span>
<span class="sd">    merged_model = BERTopic.merge_models([topic_model_1, topic_model_2, topic_model_3])</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">torch</span>

    <span class="c1"># Temporarily save model and push to HF</span>
    <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="c1"># Save model weights and config.</span>
        <span class="n">all_topics</span><span class="p">,</span> <span class="n">all_params</span><span class="p">,</span> <span class="n">all_tensors</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
            <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s2">&quot;pytorch&quot;</span><span class="p">)</span>
            <span class="n">topics</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">load_local_files</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
            <span class="n">all_topics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
            <span class="n">all_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">all_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">]))</span>

            <span class="c1"># Create a base set of parameters</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">merged_topics</span> <span class="o">=</span> <span class="n">topics</span>
                <span class="n">merged_params</span> <span class="o">=</span> <span class="n">params</span>
                <span class="n">merged_tensors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tensors</span><span class="p">[</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">])</span>
                <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;custom_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">selected_topics</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">all_topics</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="c1"># Calculate similarity matrix</span>
        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">merged_tensors</span><span class="p">)</span>
        <span class="n">sims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Extract new topics</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sims</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim</span> <span class="o">&lt;</span> <span class="n">min_similarity</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">max_topic</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]))</span>

        <span class="c1"># Merge Topic Representations</span>
        <span class="n">new_topics_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">new_topic</span> <span class="ow">in</span> <span class="n">new_topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">max_topic</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">new_topics_dict</span><span class="p">[</span><span class="n">new_topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_topic</span>
                <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_representations&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_representations&quot;</span><span class="p">][</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_labels&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_labels&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)]</span>

                <span class="c1"># Add new aspects</span>
                <span class="k">if</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]:</span>
                    <span class="n">aspects_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">aspects_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">aspects_diff</span> <span class="o">=</span> <span class="n">aspects_2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">aspects_1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aspects_diff</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">aspects_diff</span><span class="p">:</span>
                            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">][</span><span class="n">aspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="c1"># If the original model does not have topic aspects but the to be added model does</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">merged_topics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">):</span>
                        <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span>

                    <span class="c1"># If they both contain topic aspects, add to the existing set of aspects</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_aspects&quot;</span><span class="p">][</span><span class="n">aspect</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">max_topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">new_topic</span><span class="p">)]</span>

                <span class="c1"># Add new embeddings</span>
                <span class="n">new_tensors</span> <span class="o">=</span> <span class="n">tensors</span><span class="p">[</span><span class="n">new_topic</span> <span class="o">+</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]]</span>
                <span class="n">merged_tensors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">merged_tensors</span><span class="p">,</span> <span class="n">new_tensors</span><span class="p">])</span>

        <span class="c1"># Topic Mapper</span>
        <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_mapper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_topic</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">mappings_</span>

        <span class="c1"># Find similar topics and re-assign those from the new models</span>
        <span class="n">sims_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">to_merge</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">-</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]:</span> <span class="n">b</span> <span class="o">-</span> <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;_outliers&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sims_idx</span><span class="p">,</span> <span class="n">sims</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">min_similarity</span>
        <span class="p">}</span>
        <span class="n">to_merge</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_topics_dict</span><span class="p">)</span>
        <span class="n">to_merge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_merge</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">selected_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]]</span>
        <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
        <span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topic_sizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">merged_topics</span><span class="p">[</span><span class="s2">&quot;topics&quot;</span><span class="p">]))</span>

    <span class="c1"># Create a new model from the merged parameters</span>
    <span class="n">merged_tensors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;topic_embeddings&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">merged_tensors</span><span class="p">)}</span>
    <span class="n">merged_model</span> <span class="o">=</span> <span class="n">_create_model_from_files</span><span class="p">(</span>
        <span class="n">merged_topics</span><span class="p">,</span>
        <span class="n">merged_params</span><span class="p">,</span>
        <span class="n">merged_tensors</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">warn_no_backend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">embedding_model</span>

    <span class="c1"># Replace embedding model if one is specifically chosen</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">verbose</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">BaseEmbedder</span><span class="p">:</span>
        <span class="n">merged_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged_model</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.merge_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.merge_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics_to_merge</code></td>
        <td><code>List[Union[Iterable[int], int]]</code></td>
        <td><p>Either a list of topics or a list of list of topics
             to merge. For example:
                [1, 2, 3] will merge topics 1, 2 and 3
                [[1, 2], [3, 4]] will merge topics 1 and 2, and
                separately merge topics 3 and 4.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images used when calling either
    <code>fit</code> or <code>fit_transform</code>.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>If you want to merge topics 1, 2, and 3:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_to_merge</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">merge_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">)</span>
</code></pre></div>
<p>or if you want to merge topics 1 and 2, and separately
merge topics 3 and 4:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_to_merge</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">merge_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">merge_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">topics_to_merge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics_to_merge: Either a list of topics or a list of list of topics</span>
<span class="sd">                         to merge. For example:</span>
<span class="sd">                            [1, 2, 3] will merge topics 1, 2 and 3</span>
<span class="sd">                            [[1, 2], [3, 4]] will merge topics 1 and 2, and</span>
<span class="sd">                            separately merge topics 3 and 4.</span>
<span class="sd">        images: A list of paths to the images used when calling either</span>
<span class="sd">                `fit` or `fit_transform`.</span>

<span class="sd">    Examples:</span>
<span class="sd">    If you want to merge topics 1, 2, and 3:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_to_merge = [1, 2, 3]</span>
<span class="sd">    topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you want to merge topics 1 and 2, and separately</span>
<span class="sd">    merge topics 3 and 4:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_to_merge = [[1, 2],</span>
<span class="sd">                        [3, 4]]</span>
<span class="sd">    topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
            <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span>
            <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
            <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic_group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_group</span><span class="p">:</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Make sure that `topics_to_merge` is either&quot;</span> <span class="s2">&quot;a list of topics or a list of list of topics.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Track mappings and sizes of topics for merging topic embeddings</span>
    <span class="n">mappings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">mappings</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">topic_to</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;topics_from&quot;</span><span class="p">:</span> <span class="n">topics_from</span><span class="p">,</span>
            <span class="s2">&quot;topic_sizes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics_from</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">topic_to</span><span class="p">,</span> <span class="n">topics_from</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># Update topics</span>
    <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.partial_fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.partial_fit" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Fit BERTopic on a subset of the data and perform online learning
with batch-like data.</p>
<p>Online topic modeling in BERTopic is performed by using dimensionality
reduction and cluster algorithms that support a <code>partial_fit</code> method
in order to incrementally train the topic model.</p>
<p>Likewise, the <code>bertopic.vectorizers.OnlineCountVectorizer</code> is used
to dynamically update its vocabulary when presented with new data.
It has several parameters for modeling decay and updating the
representations.</p>
<p>In other words, although the main algorithm stays the same, the training
procedure now works as follows:</p>
<p>For each subset of the data:</p>
<ol>
<li>Generate embeddings with a pre-trained language model</li>
<li>Incrementally update the dimensionality reduction algorithm with <code>partial_fit</code></li>
<li>Incrementally update the cluster algorithm with <code>partial_fit</code></li>
<li>Incrementally update the OnlineCountVectorizer and apply some form of decay</li>
</ol>
<p>Note that it is advised to use <code>partial_fit</code> with batches and
not single documents for the best performance.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of documents to fit on</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>y</code></td>
        <td><code>Union[List[int], numpy.ndarray]</code></td>
        <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">MiniBatchKMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">IncrementalPCA</span>
<span class="kn">from</span> <span class="nn">bertopic.vectorizers</span> <span class="kn">import</span> <span class="n">OnlineCountVectorizer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>

<span class="c1"># Prepare documents</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

<span class="c1"># Prepare sub-models that support online learning</span>
<span class="n">umap_model</span> <span class="o">=</span> <span class="n">IncrementalPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cluster_model</span> <span class="o">=</span> <span class="n">MiniBatchKMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">OnlineCountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">umap_model</span><span class="p">,</span>
                       <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">cluster_model</span><span class="p">,</span>
                       <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer_model</span><span class="p">)</span>

<span class="c1"># Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">),</span> <span class="mi">1000</span><span class="p">):</span>
    <span class="n">topic_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">:</span> <span class="n">index</span><span class="o">+</span><span class="mi">1000</span><span class="p">])</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">partial_fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit BERTopic on a subset of the data and perform online learning</span>
<span class="sd">    with batch-like data.</span>

<span class="sd">    Online topic modeling in BERTopic is performed by using dimensionality</span>
<span class="sd">    reduction and cluster algorithms that support a `partial_fit` method</span>
<span class="sd">    in order to incrementally train the topic model.</span>

<span class="sd">    Likewise, the `bertopic.vectorizers.OnlineCountVectorizer` is used</span>
<span class="sd">    to dynamically update its vocabulary when presented with new data.</span>
<span class="sd">    It has several parameters for modeling decay and updating the</span>
<span class="sd">    representations.</span>

<span class="sd">    In other words, although the main algorithm stays the same, the training</span>
<span class="sd">    procedure now works as follows:</span>

<span class="sd">    For each subset of the data:</span>

<span class="sd">    1. Generate embeddings with a pre-trained language model</span>
<span class="sd">    2. Incrementally update the dimensionality reduction algorithm with `partial_fit`</span>
<span class="sd">    3. Incrementally update the cluster algorithm with `partial_fit`</span>
<span class="sd">    4. Incrementally update the OnlineCountVectorizer and apply some form of decay</span>

<span class="sd">    Note that it is advised to use `partial_fit` with batches and</span>
<span class="sd">    not single documents for the best performance.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sklearn.cluster import MiniBatchKMeans</span>
<span class="sd">    from sklearn.decomposition import IncrementalPCA</span>
<span class="sd">    from bertopic.vectorizers import OnlineCountVectorizer</span>
<span class="sd">    from bertopic import BERTopic</span>

<span class="sd">    # Prepare documents</span>
<span class="sd">    docs = fetch_20newsgroups(subset=subset,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&quot;data&quot;]</span>

<span class="sd">    # Prepare sub-models that support online learning</span>
<span class="sd">    umap_model = IncrementalPCA(n_components=5)</span>
<span class="sd">    cluster_model = MiniBatchKMeans(n_clusters=50, random_state=0)</span>
<span class="sd">    vectorizer_model = OnlineCountVectorizer(stop_words=&quot;english&quot;, decay=.01)</span>

<span class="sd">    topic_model = BERTopic(umap_model=umap_model,</span>
<span class="sd">                           hdbscan_model=cluster_model,</span>
<span class="sd">                           vectorizer_model=vectorizer_model)</span>

<span class="sd">    # Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="sd">    for index in range(0, len(docs), 1000):</span>
<span class="sd">        topic_model.partial_fit(docs[index: index+1000])</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Checks</span>
    <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;In order to use `.partial_fit`, the cluster model should have &quot;</span> <span class="s2">&quot;a `.partial_fit` function.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Prepare documents</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

    <span class="c1"># Extract embeddings</span>
    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
            <span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
            <span class="p">)</span>

    <span class="c1"># Reduce dimensionality</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Cluster reduced embeddings</span>
    <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Map and find new topics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
    <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
    <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">new_topic_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_topics</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_new_topics</span><span class="p">(</span><span class="n">new_topic_ids</span><span class="p">)</span>
    <span class="n">updated_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
    <span class="n">updated_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_mappings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>
    <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_topics</span>

    <span class="c1"># Add missing topics (topics that were originally created but are now missing)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
        <span class="n">missing_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">updated_topics</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">missing_topic</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">missing_topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">missing_topics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Prepare documents</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">updated_topics</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

    <span class="c1"># Update topic representations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">updated_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span>
        <span class="n">updated_words</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>

    <span class="c1"># Update topic sizes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sizes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">topic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.push_to_hf_hub" class="doc doc-heading">
<code class="highlight language-python"><span class="n">push_to_hf_hub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo_id</span><span class="p">,</span> <span class="n">commit_message</span><span class="o">=</span><span class="s1">&#39;Add BERTopic model&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_card</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s1">&#39;safetensors&#39;</span><span class="p">,</span> <span class="n">save_embedding_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_ctfidf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.push_to_hf_hub" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Push your BERTopic model to a HuggingFace Hub.</p>
<p>Whenever you want to upload files to the Hub, you need to log in to your HuggingFace account:</p>
<ul>
<li>Log in to your HuggingFace account with the following command:
    <div class="highlight"><pre><span></span><code>huggingface-cli<span class="w"> </span>login

<span class="c1"># or using an environment variable</span>
huggingface-cli<span class="w"> </span>login<span class="w"> </span>--token<span class="w"> </span><span class="nv">$HUGGINGFACE_TOKEN</span>
</code></pre></div></li>
<li>Alternatively, you can programmatically login using login() in a notebook or a script:
    <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">huggingface_hub</span> <span class="kn">import</span> <span class="n">login</span>
<span class="n">login</span><span class="p">()</span>
</code></pre></div></li>
<li>Or you can give a token with the <code>token</code> variable</li>
</ul>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>repo_id</code></td>
        <td><code>str</code></td>
        <td><p>The name of your HuggingFace repository</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>commit_message</code></td>
        <td><code>str</code></td>
        <td><p>A commit message</p></td>
        <td><code>&#39;Add BERTopic model&#39;</code></td>
      </tr>
      <tr>
        <td><code>token</code></td>
        <td><code>str</code></td>
        <td><p>Token to add if not already logged in</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>revision</code></td>
        <td><code>str</code></td>
        <td><p>Repository revision</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>private</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to create a private repository</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>create_pr</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to upload the model as a Pull Request</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>model_card</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to automatically create a modelcard</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>serialization</code></td>
        <td><code>str</code></td>
        <td><p>The type of serialization.
           Either <code>safetensors</code> or <code>pytorch</code></p></td>
        <td><code>&#39;safetensors&#39;</code></td>
      </tr>
      <tr>
        <td><code>save_embedding_model</code></td>
        <td><code>Union[str, bool]</code></td>
        <td><p>A pointer towards a HuggingFace model to be loaded in with
                  SentenceTransformers. E.g.,
                  <code>sentence-transformers/all-MiniLM-L6-v2</code></p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>save_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to save c-TF-IDF information</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">push_to_hf_hub</span><span class="p">(</span>
    <span class="n">repo_id</span><span class="o">=</span><span class="s2">&quot;ArXiv&quot;</span><span class="p">,</span>
    <span class="n">save_ctfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save_embedding_model</span><span class="o">=</span><span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">push_to_hf_hub</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">repo_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">commit_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Add BERTopic model&quot;</span><span class="p">,</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">create_pr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">model_card</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">serialization</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;safetensors&quot;</span><span class="p">,</span>
    <span class="n">save_embedding_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push your BERTopic model to a HuggingFace Hub.</span>

<span class="sd">    Whenever you want to upload files to the Hub, you need to log in to your HuggingFace account:</span>

<span class="sd">    * Log in to your HuggingFace account with the following command:</span>
<span class="sd">        ```bash</span>
<span class="sd">        huggingface-cli login</span>

<span class="sd">        # or using an environment variable</span>
<span class="sd">        huggingface-cli login --token $HUGGINGFACE_TOKEN</span>
<span class="sd">        ```</span>
<span class="sd">    * Alternatively, you can programmatically login using login() in a notebook or a script:</span>
<span class="sd">        ```python</span>
<span class="sd">        from huggingface_hub import login</span>
<span class="sd">        login()</span>
<span class="sd">        ```</span>
<span class="sd">    * Or you can give a token with the `token` variable</span>

<span class="sd">    Arguments:</span>
<span class="sd">        repo_id: The name of your HuggingFace repository</span>
<span class="sd">        commit_message: A commit message</span>
<span class="sd">        token: Token to add if not already logged in</span>
<span class="sd">        revision: Repository revision</span>
<span class="sd">        private: Whether to create a private repository</span>
<span class="sd">        create_pr: Whether to upload the model as a Pull Request</span>
<span class="sd">        model_card: Whether to automatically create a modelcard</span>
<span class="sd">        serialization: The type of serialization.</span>
<span class="sd">                       Either `safetensors` or `pytorch`</span>
<span class="sd">        save_embedding_model: A pointer towards a HuggingFace model to be loaded in with</span>
<span class="sd">                              SentenceTransformers. E.g.,</span>
<span class="sd">                              `sentence-transformers/all-MiniLM-L6-v2`</span>
<span class="sd">        save_ctfidf: Whether to save c-TF-IDF information</span>


<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    topic_model.push_to_hf_hub(</span>
<span class="sd">        repo_id=&quot;ArXiv&quot;,</span>
<span class="sd">        save_ctfidf=True,</span>
<span class="sd">        save_embedding_model=&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">save_utils</span><span class="o">.</span><span class="n">push_to_hf_hub</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_id</span><span class="p">,</span>
        <span class="n">commit_message</span><span class="o">=</span><span class="n">commit_message</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
        <span class="n">private</span><span class="o">=</span><span class="n">private</span><span class="p">,</span>
        <span class="n">create_pr</span><span class="o">=</span><span class="n">create_pr</span><span class="p">,</span>
        <span class="n">model_card</span><span class="o">=</span><span class="n">model_card</span><span class="p">,</span>
        <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">,</span>
        <span class="n">save_embedding_model</span><span class="o">=</span><span class="n">save_embedding_model</span><span class="p">,</span>
        <span class="n">save_ctfidf</span><span class="o">=</span><span class="n">save_ctfidf</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.reduce_outliers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;distributions&#39;</span><span class="p">,</span> <span class="n">probabilities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distributions_params</span><span class="o">=</span><span class="p">{})</span></code>


<a href="#bertopic._bertopic.BERTopic.reduce_outliers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Reduce outliers by merging them with their nearest topic according
to one of several strategies.</p>
<p>When using HDBSCAN, DBSCAN, or OPTICS, a number of outlier documents might be created
that do not fall within any of the created topics. These are labeled as -1.
This function allows the user to match outlier documents with their nearest topic
using one of the following strategies using the <code>strategy</code> parameter:
    * "probabilities"
        This uses the soft-clustering as performed by HDBSCAN to find the
        best matching topic for each outlier document. To use this, make
        sure to calculate the <code>probabilities</code> beforehand by instantiating
        BERTopic with <code>calculate_probabilities=True</code>.
    * "distributions"
        Use the topic distributions, as calculated with <code>.approximate_distribution</code>
        to find the most frequent topic in each outlier document. You can use the
        <code>distributions_params</code> variable to tweak the parameters of
        <code>.approximate_distribution</code>.
    * "c-tf-idf"
        Calculate the c-TF-IDF representation for each outlier document and
        find the best matching c-TF-IDF topic representation using
        cosine similarity.
    * "embeddings"
        Using the embeddings of each outlier documents, find the best
        matching topic embedding using cosine similarity.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of documents for which we reduce or remove the outliers.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>The topics that correspond to the documents</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images used when calling either
    <code>fit</code> or <code>fit_transform</code></p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>strategy</code></td>
        <td><code>str</code></td>
        <td><p>The strategy used for reducing outliers.
    Options:
        * "probabilities"
            This uses the soft-clustering as performed by HDBSCAN
            to find the best matching topic for each outlier document.</p>
<div class="highlight"><pre><span></span><code>    * &quot;distributions&quot;
        Use the topic distributions, as calculated with `.approximate_distribution`
        to find the most frequent topic in each outlier document.

    * &quot;c-tf-idf&quot;
        Calculate the c-TF-IDF representation for outlier documents and
        find the best matching c-TF-IDF topic representation.

    * &quot;embeddings&quot;
        Calculate the embeddings for outlier documents and
        find the best matching topic embedding.
</code></pre></div></td>
        <td><code>&#39;distributions&#39;</code></td>
      </tr>
      <tr>
        <td><code>probabilities</code></td>
        <td><code>ndarray</code></td>
        <td><p>Probabilities generated by HDBSCAN for each document when using the strategy <code>"probabilities"</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>threshold</code></td>
        <td><code>float</code></td>
        <td><p>The threshold for assigning topics to outlier documents. This value
       represents the minimum probability when <code>strategy="probabilities"</code>.
       For all other strategies, it represents the minimum similarity.</p></td>
        <td><code>0</code></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The pre-computed embeddings to be used when <code>strategy="embeddings"</code>.
        If this is None, then it will compute the embeddings for the outlier documents.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>distributions_params</code></td>
        <td><code>Mapping[str, Any]</code></td>
        <td><p>The parameters used in <code>.approximate_distribution</code> when using
                  the strategy <code>"distributions"</code>.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>new_topics</code></td>
      <td><p>The updated topics</p></td>
    </tr>
  </tbody>
</table>      <p>Usage:</p>
<p>The default settings uses the <code>"distributions"</code> strategy:</p>
<div class="highlight"><pre><span></span><code><span class="n">new_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">reduce_outliers</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
</code></pre></div>
<p>When you use the <code>"probabilities"</code> strategy, make sure to also pass the probabilities
as generated through HDBSCAN:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">calculate_probabilities</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="n">new_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">reduce_outliers</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="n">probabilities</span><span class="o">=</span><span class="n">probs</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;probabilities&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_outliers</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;distributions&quot;</span><span class="p">,</span>
    <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distributions_params</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce outliers by merging them with their nearest topic according</span>
<span class="sd">    to one of several strategies.</span>

<span class="sd">    When using HDBSCAN, DBSCAN, or OPTICS, a number of outlier documents might be created</span>
<span class="sd">    that do not fall within any of the created topics. These are labeled as -1.</span>
<span class="sd">    This function allows the user to match outlier documents with their nearest topic</span>
<span class="sd">    using one of the following strategies using the `strategy` parameter:</span>
<span class="sd">        * &quot;probabilities&quot;</span>
<span class="sd">            This uses the soft-clustering as performed by HDBSCAN to find the</span>
<span class="sd">            best matching topic for each outlier document. To use this, make</span>
<span class="sd">            sure to calculate the `probabilities` beforehand by instantiating</span>
<span class="sd">            BERTopic with `calculate_probabilities=True`.</span>
<span class="sd">        * &quot;distributions&quot;</span>
<span class="sd">            Use the topic distributions, as calculated with `.approximate_distribution`</span>
<span class="sd">            to find the most frequent topic in each outlier document. You can use the</span>
<span class="sd">            `distributions_params` variable to tweak the parameters of</span>
<span class="sd">            `.approximate_distribution`.</span>
<span class="sd">        * &quot;c-tf-idf&quot;</span>
<span class="sd">            Calculate the c-TF-IDF representation for each outlier document and</span>
<span class="sd">            find the best matching c-TF-IDF topic representation using</span>
<span class="sd">            cosine similarity.</span>
<span class="sd">        * &quot;embeddings&quot;</span>
<span class="sd">            Using the embeddings of each outlier documents, find the best</span>
<span class="sd">            matching topic embedding using cosine similarity.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents for which we reduce or remove the outliers.</span>
<span class="sd">        topics: The topics that correspond to the documents</span>
<span class="sd">        images: A list of paths to the images used when calling either</span>
<span class="sd">                `fit` or `fit_transform`</span>
<span class="sd">        strategy: The strategy used for reducing outliers.</span>
<span class="sd">                Options:</span>
<span class="sd">                    * &quot;probabilities&quot;</span>
<span class="sd">                        This uses the soft-clustering as performed by HDBSCAN</span>
<span class="sd">                        to find the best matching topic for each outlier document.</span>

<span class="sd">                    * &quot;distributions&quot;</span>
<span class="sd">                        Use the topic distributions, as calculated with `.approximate_distribution`</span>
<span class="sd">                        to find the most frequent topic in each outlier document.</span>

<span class="sd">                    * &quot;c-tf-idf&quot;</span>
<span class="sd">                        Calculate the c-TF-IDF representation for outlier documents and</span>
<span class="sd">                        find the best matching c-TF-IDF topic representation.</span>

<span class="sd">                    * &quot;embeddings&quot;</span>
<span class="sd">                        Calculate the embeddings for outlier documents and</span>
<span class="sd">                        find the best matching topic embedding.</span>
<span class="sd">        probabilities: Probabilities generated by HDBSCAN for each document when using the strategy `&quot;probabilities&quot;`.</span>
<span class="sd">        threshold: The threshold for assigning topics to outlier documents. This value</span>
<span class="sd">                   represents the minimum probability when `strategy=&quot;probabilities&quot;`.</span>
<span class="sd">                   For all other strategies, it represents the minimum similarity.</span>
<span class="sd">        embeddings: The pre-computed embeddings to be used when `strategy=&quot;embeddings&quot;`.</span>
<span class="sd">                    If this is None, then it will compute the embeddings for the outlier documents.</span>
<span class="sd">        distributions_params: The parameters used in `.approximate_distribution` when using</span>
<span class="sd">                              the strategy `&quot;distributions&quot;`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        new_topics: The updated topics</span>

<span class="sd">    Usage:</span>

<span class="sd">    The default settings uses the `&quot;distributions&quot;` strategy:</span>

<span class="sd">    ```python</span>
<span class="sd">    new_topics = topic_model.reduce_outliers(docs, topics)</span>
<span class="sd">    ```</span>

<span class="sd">    When you use the `&quot;probabilities&quot;` strategy, make sure to also pass the probabilities</span>
<span class="sd">    as generated through HDBSCAN:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic(calculate_probabilities=True)</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">    new_topics = topic_model.reduce_outliers(docs, topics, probabilities=probs, strategy=&quot;probabilities&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No outliers to reduce.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">strategy</span> <span class="o">=</span> <span class="s2">&quot;embeddings&quot;</span>

    <span class="c1"># Check correct use of parameters</span>
    <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;probabilities&quot;</span> <span class="ow">and</span> <span class="n">probabilities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure to pass in `probabilities` in order to use the probabilities strategy&quot;</span><span class="p">)</span>

    <span class="c1"># Reduce outliers by extracting most likely topics through the topic-term probability matrix</span>
    <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;probabilities&quot;</span><span class="p">:</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">topic</span>
            <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="c1"># Reduce outliers by extracting most frequent topics through calculating of Topic Distributions</span>
    <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;distributions&quot;</span><span class="p">:</span>
        <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
        <span class="n">topic_distr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span>
            <span class="n">outlier_docs</span><span class="p">,</span> <span class="n">min_similarity</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="o">**</span><span class="n">distributions_params</span>
        <span class="p">)</span>
        <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">topic_distr</span><span class="p">])</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

    <span class="c1"># Reduce outliers by finding the most similar c-TF-IDF representations</span>
    <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;c-tf-idf&quot;</span><span class="p">:</span>
        <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>

        <span class="c1"># Calculate c-TF-IDF of outlier documents with all topics</span>
        <span class="n">bow_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">outlier_docs</span><span class="p">)</span>
        <span class="n">c_tf_idf_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bow_doc</span><span class="p">)</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">c_tf_idf_doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

        <span class="c1"># Update topics</span>
        <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">similarity</span><span class="p">])</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

    <span class="c1"># Reduce outliers by finding the most similar topic embeddings</span>
    <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To use this strategy, you will need to pass a model to `embedding_model`&quot;</span>
                <span class="s2">&quot;when instantiating BERTopic.&quot;</span>
            <span class="p">)</span>
        <span class="n">outlier_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outlier_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>

        <span class="c1"># Extract or calculate embeddings for outlier documents</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">embeddings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outlier_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">outlier_ids</span><span class="p">]</span>
            <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_images</span><span class="p">(</span><span class="n">outlier_images</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outlier_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">outlier_docs</span><span class="p">)</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">outlier_embeddings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="p">:])</span>

        <span class="c1"># Update topics</span>
        <span class="n">similarity</span><span class="p">[</span><span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">outlier_topics</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">similarity</span><span class="p">])</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">outlier_topics</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">new_topics</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.reduce_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.reduce_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Reduce the number of topics to a fixed number of topics
or automatically.</p>
<p>If nr_topics is an integer, then the number of topics is reduced
to nr_topics using <code>AgglomerativeClustering</code> on the cosine distance matrix
of the topic c-TF-IDF or semantic embeddings.</p>
<p>If nr_topics is <code>"auto"</code>, then HDBSCAN is used to automatically
reduce the number of topics by running it on the topic embeddings.</p>
<p>The topics, their sizes, and representations are updated.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The docs you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>nr_topics</code></td>
        <td><code>Union[int, str]</code></td>
        <td><p>The number of topics you want reduced to</p></td>
        <td><code>20</code></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images used when calling either
    <code>fit</code> or <code>fit_transform</code></p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the
        embeddings from the embedding model are used.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>      <div class="admonition updates">
<p class="admonition-title">Updates</p>
<p>topics_ : Assigns topics to their merged representations.
probabilities_ : Assigns probabilities to their merged representations.</p>
</div>

<p><strong>Examples:</strong></p>
    
      <p>You can further reduce the topics by passing the documents with their
topics and probabilities (if they were calculated):</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">reduce_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>
<p>You can then access the updated topics and probabilities with:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce the number of topics to a fixed number of topics</span>
<span class="sd">    or automatically.</span>

<span class="sd">    If nr_topics is an integer, then the number of topics is reduced</span>
<span class="sd">    to nr_topics using `AgglomerativeClustering` on the cosine distance matrix</span>
<span class="sd">    of the topic c-TF-IDF or semantic embeddings.</span>

<span class="sd">    If nr_topics is `&quot;auto&quot;`, then HDBSCAN is used to automatically</span>
<span class="sd">    reduce the number of topics by running it on the topic embeddings.</span>

<span class="sd">    The topics, their sizes, and representations are updated.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The docs you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        nr_topics: The number of topics you want reduced to</span>
<span class="sd">        images: A list of paths to the images used when calling either</span>
<span class="sd">                `fit` or `fit_transform`</span>
<span class="sd">        use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                    embeddings from the embedding model are used.</span>

<span class="sd">    Updates:</span>
<span class="sd">        topics_ : Assigns topics to their merged representations.</span>
<span class="sd">        probabilities_ : Assigns probabilities to their merged representations.</span>

<span class="sd">    Examples:</span>
<span class="sd">    You can further reduce the topics by passing the documents with their</span>
<span class="sd">    topics and probabilities (if they were calculated):</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.reduce_topics(docs, nr_topics=30)</span>
<span class="sd">    ```</span>

<span class="sd">    You can then access the updated topics and probabilities with:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics = topic_model.topics_</span>
<span class="sd">    probabilities = topic_model.probabilities_</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
            <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span>
            <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Reduce number of topics</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.save" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> <span class="n">save_embedding_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_ctfidf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.save" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Saves the model to the specified path or folder.</p>
<p>When saving the model, make sure to also keep track of the versions
of dependencies and Python used. Loading and saving the model should
be done using the same dependencies and Python. Moreover, models
saved in one version of BERTopic should not be loaded in other versions.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td></td>
        <td><p>If <code>serialization</code> is 'safetensors' or <code>pytorch</code>, this is a directory.
  If <code>serialization</code> is <code>pickle</code>, then this is a file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>serialization</code></td>
        <td><code>Literal[&#39;safetensors&#39;, &#39;pickle&#39;, &#39;pytorch&#39;]</code></td>
        <td><p>If <code>pickle</code>, the entire model will be pickled. If <code>safetensors</code>
           or <code>pytorch</code> the model will be saved without the embedding,
           dimensionality reduction, and clustering algorithms.
           This is a very efficient format and typically advised.</p></td>
        <td><code>&#39;pickle&#39;</code></td>
      </tr>
      <tr>
        <td><code>save_embedding_model</code></td>
        <td><code>Union[bool, str]</code></td>
        <td><p>If serialization is <code>pickle</code>, then you can choose to skip
                  saving the embedding model. If serialization is <code>safetensors</code>
                  or <code>pytorch</code>, this variable can be used as a string pointing
                  towards a huggingface model.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>save_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to save c-TF-IDF information if serialization is <code>safetensors</code>
         or <code>pytorch</code></p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To save the model in an efficient and safe format (safetensors) with c-TF-IDF information:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model_dir&quot;</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s2">&quot;safetensors&quot;</span><span class="p">,</span> <span class="n">save_ctfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>If you wish to also add a pointer to the embedding model, which will be downloaded from
HuggingFace upon loading:</p>
<div class="highlight"><pre><span></span><code><span class="n">embedding_model</span> <span class="o">=</span> <span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model_dir&quot;</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="s2">&quot;safetensors&quot;</span><span class="p">,</span> <span class="n">save_embedding_model</span><span class="o">=</span><span class="n">embedding_model</span><span class="p">)</span>
</code></pre></div>
<p>or if you want save the full model with pickle:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">)</span>
</code></pre></div>
<p>NOTE: Pickle can run arbitrary code and is generally considered to be less safe than
safetensors.</p>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">,</span>
    <span class="n">serialization</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;safetensors&quot;</span><span class="p">,</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;pytorch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
    <span class="n">save_embedding_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the model to the specified path or folder.</span>

<span class="sd">    When saving the model, make sure to also keep track of the versions</span>
<span class="sd">    of dependencies and Python used. Loading and saving the model should</span>
<span class="sd">    be done using the same dependencies and Python. Moreover, models</span>
<span class="sd">    saved in one version of BERTopic should not be loaded in other versions.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        path: If `serialization` is &#39;safetensors&#39; or `pytorch`, this is a directory.</span>
<span class="sd">              If `serialization` is `pickle`, then this is a file.</span>
<span class="sd">        serialization: If `pickle`, the entire model will be pickled. If `safetensors`</span>
<span class="sd">                       or `pytorch` the model will be saved without the embedding,</span>
<span class="sd">                       dimensionality reduction, and clustering algorithms.</span>
<span class="sd">                       This is a very efficient format and typically advised.</span>
<span class="sd">        save_embedding_model: If serialization is `pickle`, then you can choose to skip</span>
<span class="sd">                              saving the embedding model. If serialization is `safetensors`</span>
<span class="sd">                              or `pytorch`, this variable can be used as a string pointing</span>
<span class="sd">                              towards a huggingface model.</span>
<span class="sd">        save_ctfidf: Whether to save c-TF-IDF information if serialization is `safetensors`</span>
<span class="sd">                     or `pytorch`</span>

<span class="sd">    Examples:</span>
<span class="sd">    To save the model in an efficient and safe format (safetensors) with c-TF-IDF information:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.save(&quot;model_dir&quot;, serialization=&quot;safetensors&quot;, save_ctfidf=True)</span>
<span class="sd">    ```</span>

<span class="sd">    If you wish to also add a pointer to the embedding model, which will be downloaded from</span>
<span class="sd">    HuggingFace upon loading:</span>

<span class="sd">    ```python</span>
<span class="sd">    embedding_model = &quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="sd">    topic_model.save(&quot;model_dir&quot;, serialization=&quot;safetensors&quot;, save_embedding_model=embedding_model)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you want save the full model with pickle:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.save(&quot;my_model&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    NOTE: Pickle can run arbitrary code and is generally considered to be less safe than</span>
<span class="sd">    safetensors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;When you use `pickle` to save/load a BERTopic model,&quot;</span>
            <span class="s2">&quot;please make sure that the environments in which you save&quot;</span>
            <span class="s2">&quot;and load the model are **exactly** the same. The version of BERTopic,&quot;</span>
            <span class="s2">&quot;its dependencies, and python need to remain the same.&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># This prevents the vectorizer from being too large in size if `min_df` was</span>
            <span class="c1"># set to a value higher than 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">stop_words_</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
                <span class="n">embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;safetensors&quot;</span> <span class="ow">or</span> <span class="n">serialization</span> <span class="o">==</span> <span class="s2">&quot;pytorch&quot;</span><span class="p">:</span>
        <span class="c1"># Directory</span>
        <span class="n">save_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">save_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check embedding model</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">save_embedding_model</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="s2">&quot;_hf_model&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_embedding_model</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">save_embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">_hf_model</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;You are saving a BERTopic model without explicitly defining an embedding model.&quot;</span>
                <span class="s2">&quot;If you are using a sentence-transformers model or a HuggingFace model supported&quot;</span>
                <span class="s2">&quot;by sentence-transformers, please save the model by using a pointer towards that model.&quot;</span>
                <span class="s2">&quot;For example, `save_embedding_model=&#39;sentence-transformers/all-mpnet-base-v2&#39;`&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Minimal</span>
        <span class="n">save_utils</span><span class="o">.</span><span class="n">save_hf</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">=</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">)</span>
        <span class="n">save_utils</span><span class="o">.</span><span class="n">save_topics</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;topics.json&quot;</span><span class="p">)</span>
        <span class="n">save_utils</span><span class="o">.</span><span class="n">save_images</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span><span class="p">)</span>
        <span class="n">save_utils</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span><span class="p">,</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="n">save_embedding_model</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Additional</span>
        <span class="k">if</span> <span class="n">save_ctfidf</span><span class="p">:</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_ctfidf</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">save_directory</span><span class="o">=</span><span class="n">save_directory</span><span class="p">,</span>
                <span class="n">serialization</span><span class="o">=</span><span class="n">serialization</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">save_utils</span><span class="o">.</span><span class="n">save_ctfidf_config</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">save_directory</span> <span class="o">/</span> <span class="s2">&quot;ctfidf_config.json&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.set_topic_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_labels</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Set custom topic labels in your fitted BERTopic model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_labels</code></td>
        <td><code>Union[List[str], Mapping[int, str]]</code></td>
        <td><p>If a list of topic labels, it should contain the same number
          of labels as there are topics. This must be ordered
          from the topic with the lowest ID to the highest ID,
          including topic -1 if it exists.
          If a dictionary of <code>topic ID</code>: <code>topic_label</code>, it can have
          any number of topics as it will only map the topics found
          in the dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>First, we define our topic labels with <code>.generate_topic_labels</code> in which
we can customize our topic labels:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_labels</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">generate_topic_labels</span><span class="p">(</span><span class="n">nr_words</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">topic_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">word_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</code></pre></div>
<p>Then, we pass these <code>topic_labels</code> to our topic model which
can be accessed at any time with <code>.custom_labels_</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">set_topic_labels</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">custom_labels_</span>
</code></pre></div>
<p>You might want to change only a few topic labels instead of all of them.
To do so, you can pass a dictionary where the keys are the topic IDs and
its keys the topic labels:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">set_topic_labels</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Sports&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Medicine&quot;</span><span class="p">})</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">custom_labels_</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set custom topic labels in your fitted BERTopic model.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_labels: If a list of topic labels, it should contain the same number</span>
<span class="sd">                      of labels as there are topics. This must be ordered</span>
<span class="sd">                      from the topic with the lowest ID to the highest ID,</span>
<span class="sd">                      including topic -1 if it exists.</span>
<span class="sd">                      If a dictionary of `topic ID`: `topic_label`, it can have</span>
<span class="sd">                      any number of topics as it will only map the topics found</span>
<span class="sd">                      in the dictionary.</span>

<span class="sd">    Examples:</span>
<span class="sd">    First, we define our topic labels with `.generate_topic_labels` in which</span>
<span class="sd">    we can customize our topic labels:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_labels = topic_model.generate_topic_labels(nr_words=2,</span>
<span class="sd">                                                topic_prefix=True,</span>
<span class="sd">                                                word_length=10,</span>
<span class="sd">                                                separator=&quot;, &quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Then, we pass these `topic_labels` to our topic model which</span>
<span class="sd">    can be accessed at any time with `.custom_labels_`:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.set_topic_labels(topic_labels)</span>
<span class="sd">    topic_model.custom_labels_</span>
<span class="sd">    ```</span>

<span class="sd">    You might want to change only a few topic labels instead of all of them.</span>
<span class="sd">    To do so, you can pass a dictionary where the keys are the topic IDs and</span>
<span class="sd">    its keys the topic labels:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.set_topic_labels({0: &quot;Space&quot;, 1: &quot;Sports&quot;, 2: &quot;Medicine&quot;})</span>
<span class="sd">    topic_model.custom_labels_</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
            <span class="n">original_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span>
        <span class="n">custom_labels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">else</span> <span class="n">original_labels</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span>
        <span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">):</span>
            <span class="n">custom_labels</span> <span class="o">=</span> <span class="n">topic_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Make sure that `topic_labels` contains the same number &quot;</span> <span class="s2">&quot;of labels as there are topics.&quot;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="n">custom_labels</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.topics_over_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nr_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datetime_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evolution_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">global_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.topics_over_time" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Create topics over time.</p>
<p>To create the topics over time, BERTopic needs to be already fitted once.
From the fitted models, the c-TF-IDF representations are calculate at
each timestamp t. Then, the c-TF-IDF representations at timestamp t are
averaged with the global c-TF-IDF representations in order to fine-tune the
local representations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to use a limited number of unique timestamps (&lt;100) as the
c-TF-IDF representation will be calculated at each single unique timestamp.
Having a large number of unique timestamps can take some time to be calculated.
Moreover, there aren't many use-cases where you would like to see the difference
in topic representations over more than 100 different timestamps.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>timestamps</code></td>
        <td><code>Union[List[str], List[int]]</code></td>
        <td><p>The timestamp of each document. This can be either a list of strings or ints.
        If it is a list of strings, then the datetime format will be automatically
        inferred. If it is a list of ints, then the documents will be ordered in
        ascending order.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A list of topics where each topic is related to a document in <code>docs</code> and
    a timestamp in <code>timestamps</code>. You can use this to apply topics_over_time on
    a subset of the data. Make sure that <code>docs</code>, <code>timestamps</code>, and <code>topics</code>
    all correspond to one another and have the same size.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>nr_bins</code></td>
        <td><code>int</code></td>
        <td><p>The number of bins you want to create for the timestamps. The left interval will
     be chosen as the timestamp. An additional column will be created with the
     entire interval.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>datetime_format</code></td>
        <td><code>str</code></td>
        <td><p>The datetime format of the timestamps if they are strings, eg â€œ%d/%m/%Yâ€.
             Set this to None if you want to have it automatically detect the format.
             See strftime documentation for more information on choices:
             https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>evolution_tuning</code></td>
        <td><code>bool</code></td>
        <td><p>Fine-tune each topic representation at timestamp <em>t</em> by averaging its
              c-TF-IDF matrix with the c-TF-IDF matrix at timestamp <em>t-1</em>. This creates
              evolutionary topic representations.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>global_tuning</code></td>
        <td><code>bool</code></td>
        <td><p>Fine-tune each topic representation at timestamp <em>t</em> by averaging its c-TF-IDF matrix
       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in
       topic representations that could not be found in the documents at timestamp <em>t</em>.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>topics_over_time</code></td>
      <td><p>A dataframe that contains the topic, words, and frequency of topic
                  at timestamp <em>t</em>.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>The timestamps variable represents the timestamp of each document. If you have over
100 unique timestamps, it is advised to bin the timestamps as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics_over_time</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_over_time</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">nr_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">topics_over_time</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">timestamps</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nr_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">evolution_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create topics over time.</span>

<span class="sd">    To create the topics over time, BERTopic needs to be already fitted once.</span>
<span class="sd">    From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">    each timestamp t. Then, the c-TF-IDF representations at timestamp t are</span>
<span class="sd">    averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">    local representations.</span>

<span class="sd">    Note:</span>
<span class="sd">        Make sure to use a limited number of unique timestamps (&lt;100) as the</span>
<span class="sd">        c-TF-IDF representation will be calculated at each single unique timestamp.</span>
<span class="sd">        Having a large number of unique timestamps can take some time to be calculated.</span>
<span class="sd">        Moreover, there aren&#39;t many use-cases where you would like to see the difference</span>
<span class="sd">        in topic representations over more than 100 different timestamps.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        timestamps: The timestamp of each document. This can be either a list of strings or ints.</span>
<span class="sd">                    If it is a list of strings, then the datetime format will be automatically</span>
<span class="sd">                    inferred. If it is a list of ints, then the documents will be ordered in</span>
<span class="sd">                    ascending order.</span>
<span class="sd">        topics: A list of topics where each topic is related to a document in `docs` and</span>
<span class="sd">                a timestamp in `timestamps`. You can use this to apply topics_over_time on</span>
<span class="sd">                a subset of the data. Make sure that `docs`, `timestamps`, and `topics`</span>
<span class="sd">                all correspond to one another and have the same size.</span>
<span class="sd">        nr_bins: The number of bins you want to create for the timestamps. The left interval will</span>
<span class="sd">                 be chosen as the timestamp. An additional column will be created with the</span>
<span class="sd">                 entire interval.</span>
<span class="sd">        datetime_format: The datetime format of the timestamps if they are strings, eg â€œ%d/%m/%Yâ€.</span>
<span class="sd">                         Set this to None if you want to have it automatically detect the format.</span>
<span class="sd">                         See strftime documentation for more information on choices:</span>
<span class="sd">                         https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</span>
<span class="sd">        evolution_tuning: Fine-tune each topic representation at timestamp *t* by averaging its</span>
<span class="sd">                          c-TF-IDF matrix with the c-TF-IDF matrix at timestamp *t-1*. This creates</span>
<span class="sd">                          evolutionary topic representations.</span>
<span class="sd">        global_tuning: Fine-tune each topic representation at timestamp *t* by averaging its c-TF-IDF matrix</span>
<span class="sd">                   with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                   topic representations that could not be found in the documents at timestamp *t*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topics_over_time: A dataframe that contains the topic, words, and frequency of topic</span>
<span class="sd">                          at timestamp *t*.</span>

<span class="sd">    Examples:</span>
<span class="sd">    The timestamps variable represents the timestamp of each document. If you have over</span>
<span class="sd">    100 unique timestamps, it is advised to bin the timestamps as shown below:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    topics_over_time = topic_model.topics_over_time(docs, timestamps, nr_bins=20)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">selected_topics</span> <span class="o">=</span> <span class="n">topics</span> <span class="k">if</span> <span class="n">topics</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">selected_topics</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">})</span>
    <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">all_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="n">all_topics_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_topics</span><span class="p">)}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">infer_datetime_format</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">datetime_format</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">],</span>
            <span class="n">infer_datetime_format</span><span class="o">=</span><span class="n">infer_datetime_format</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">datetime_format</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">nr_bins</span><span class="p">:</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nr_bins</span><span class="p">)</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Bins</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Sort documents in chronological order</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">)</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;There are more than 100 unique timestamps (i.e., </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
            <span class="s2">&quot;which significantly slows down the application. Consider setting `nr_bins` &quot;</span>
            <span class="s2">&quot;to a value lower than 100 to speed up calculation. &quot;</span>
        <span class="p">)</span>

    <span class="c1"># For each unique timestamp, create topic representations</span>
    <span class="n">topics_over_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
        <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span> <span class="o">==</span> <span class="n">timestamp</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">global_tuning</span> <span class="ow">or</span> <span class="n">evolution_tuning</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Fine-tune the c-TF-IDF matrix at timestamp t by averaging it with the c-TF-IDF</span>
        <span class="c1"># matrix at timestamp t-1</span>
        <span class="k">if</span> <span class="n">evolution_tuning</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">overlapping_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">previous_topics</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_topics</span><span class="p">)))</span>  <span class="c1"># noqa: F821</span>
            <span class="p">)</span>

            <span class="n">current_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>
            <span class="n">previous_overlap_idx</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">previous_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>  <span class="c1"># noqa: F821</span>
                <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span>
            <span class="p">]</span>

            <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">tolil</span><span class="p">()[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">c_tf_idf</span><span class="p">[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">previous_c_tf_idf</span><span class="p">[</span><span class="n">previous_overlap_idx</span><span class="p">]</span>  <span class="c1"># noqa: F821</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mf">2.0</span>
            <span class="p">)</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>

        <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
        <span class="c1"># by simply taking the average of the two</span>
        <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
            <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_topics_indices</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">selected_topics</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Extract the words per topic</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># Fill dataframe with results</span>
        <span class="n">topics_at_timestamp</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">topic</span><span class="p">,</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                <span class="n">timestamp</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">topics_over_time</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_timestamp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">evolution_tuning</span><span class="p">:</span>
            <span class="n">previous_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  <span class="c1"># noqa: F841</span>
            <span class="n">previous_c_tf_idf</span> <span class="o">=</span> <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># noqa: F841</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Timestamp&quot;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.topics_per_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">global_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.topics_per_class" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Create topics per class.</p>
<p>To create the topics per class, BERTopic needs to be already fitted once.
From the fitted models, the c-TF-IDF representations are calculated at
each class c. Then, the c-TF-IDF representations at class c are
averaged with the global c-TF-IDF representations in order to fine-tune the
local representations. This can be turned off if the pure representation is
needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to use a limited number of unique classes (&lt;100) as the
c-TF-IDF representation will be calculated at each single unique class.
Having a large number of unique classes can take some time to be calculated.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>classes</code></td>
        <td><code>Union[List[int], List[str]]</code></td>
        <td><p>The class of each document. This can be either a list of strings or ints.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>global_tuning</code></td>
        <td><code>bool</code></td>
        <td><p>Fine-tune each topic representation for class c by averaging its c-TF-IDF matrix
           with the global c-TF-IDF matrix. Turn this off if you want to prevent words in
           topic representations that could not be found in the documents for class c.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>topics_per_class</code></td>
      <td><p>A dataframe that contains the topic, words, and frequency of topics
                  for each class.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_per_class</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">topics_per_class</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create topics per class.</span>

<span class="sd">    To create the topics per class, BERTopic needs to be already fitted once.</span>
<span class="sd">    From the fitted models, the c-TF-IDF representations are calculated at</span>
<span class="sd">    each class c. Then, the c-TF-IDF representations at class c are</span>
<span class="sd">    averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">    local representations. This can be turned off if the pure representation is</span>
<span class="sd">    needed.</span>

<span class="sd">    Note:</span>
<span class="sd">        Make sure to use a limited number of unique classes (&lt;100) as the</span>
<span class="sd">        c-TF-IDF representation will be calculated at each single unique class.</span>
<span class="sd">        Having a large number of unique classes can take some time to be calculated.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        classes: The class of each document. This can be either a list of strings or ints.</span>
<span class="sd">        global_tuning: Fine-tune each topic representation for class c by averaging its c-TF-IDF matrix</span>
<span class="sd">                       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                       topic representations that could not be found in the documents for class c.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topics_per_class: A dataframe that contains the topic, words, and frequency of topics</span>
<span class="sd">                          for each class.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="n">classes</span><span class="p">})</span>
    <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># For each unique timestamp, create topic representations</span>
    <span class="n">topics_per_class</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classes</span><span class="p">)),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
        <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Class</span> <span class="o">==</span> <span class="n">class_</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
        <span class="c1"># by simply taking the average of the two</span>
        <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Extract the words per topic</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">calculate_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># Fill dataframe with results</span>
        <span class="n">topics_at_class</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">topic</span><span class="p">,</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                <span class="n">class_</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">topics_per_class</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_class</span><span class="p">)</span>

    <span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">topics_per_class</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.transform" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>After having fit a model, use transform to predict new instances.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>documents</code></td>
        <td><code>Union[str, List[str]]</code></td>
        <td><p>A single document or a list of documents to predict on</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>A list of paths to the images to predict on or the images themselves</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>predictions</code></td>
      <td><p>Topic predictions for each documents
probabilities: The topic probability distribution which is returned by default.
               If <code>calculate_probabilities</code> in BERTopic is set to False, then the
               probabilities are not calculated to speed up computation and
               decrease memory usage.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;After having fit a model, use transform to predict new instances.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A single document or a list of documents to predict on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model.</span>
<span class="sd">        images: A list of paths to the images to predict on or the images themselves</span>

<span class="sd">    Returns:</span>
<span class="sd">        predictions: Topic predictions for each documents</span>
<span class="sd">        probabilities: The topic probability distribution which is returned by default.</span>
<span class="sd">                       If `calculate_probabilities` in BERTopic is set to False, then the</span>
<span class="sd">                       probabilities are not calculated to speed up computation and</span>
<span class="sd">                       decrease memory usage.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic().fit(docs)</span>
<span class="sd">    topics, probs = topic_model.transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    topics, probs = topic_model.transform(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">documents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># Check if an embedding model was found</span>
    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;No embedding model was found to embed the documents.&quot;</span>
            <span class="s2">&quot;Make sure when loading in the model using BERTopic.load()&quot;</span>
            <span class="s2">&quot;to also specify the embedding model.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Transform without hdbscan_model and umap_model using only cosine similarity</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span> <span class="o">==</span> <span class="n">BaseCluster</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting topic assignments through cosine similarity of topic and document embeddings.&quot;</span><span class="p">)</span>
        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">))</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">sim_matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Transform with full pipeline</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Reducing dimensionality of input embeddings.&quot;</span><span class="p">)</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dimensionality - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract predictions and probabilities if it is a HDBSCAN-like model</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clustering - Approximating new points with `hdbscan_model`&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_supported_hdbscan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">):</span>
            <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan_delegator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;approximate_predict&quot;</span><span class="p">,</span> <span class="n">umap_embeddings</span>
            <span class="p">)</span>

            <span class="c1"># Calculate probabilities</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Probabilities - Start calculation of probabilities with HDBSCAN&quot;</span><span class="p">)</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan_delegator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;membership_vector&quot;</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Probabilities - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cluster - Completed </span><span class="se">\u2713</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Map probabilities and predictions</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_predictions</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.update_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_words</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ctfidf_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">representation_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.update_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Updates the topic representation by recalculating c-TF-IDF with the new
parameters as defined in this function.</p>
<p>When you have trained a model and viewed the topics and the words that represent them,
you might not be satisfied with the representation. Perhaps you forgot to remove
stop_words or you want to try out a different n_gram_range. This function allows you
to update the topic representation after they have been formed.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>images</code></td>
        <td><code>List[str]</code></td>
        <td><p>The images you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A list of topics where each topic is related to a document in <code>docs</code>.
    Use this variable to change or map the topics.
    NOTE: Using a custom list of topic assignments may lead to errors if
          topic reduction techniques are used afterwards. Make sure that
          manually assigning topics is the last step in the pipeline</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n_words</code></td>
        <td><code>int</code></td>
        <td><p>The number of words per topic to extract. Setting this
         too high can negatively impact topic embeddings as topics
         are typically best represented by at most 10 words.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>n_gram_range</code></td>
        <td><code>Tuple[int, int]</code></td>
        <td><p>The n-gram range for the CountVectorizer.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>vectorizer_model</code></td>
        <td><code>CountVectorizer</code></td>
        <td><p>Pass in your own CountVectorizer from scikit-learn</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>ctfidf_model</code></td>
        <td><code>ClassTfidfTransformer</code></td>
        <td><p>Pass in your own c-TF-IDF model to update the representations</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>representation_model</code></td>
        <td><code>BaseRepresentation</code></td>
        <td><p>Pass in a model that fine-tunes the topic representations
                  calculated through c-TF-IDF. Models from <code>bertopic.representation</code>
                  are supported.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>In order to update the topic representation, you will need to first fit the topic
model and extract topics from them. Based on these, you can update the representation:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<p>You can also use a custom vectorizer to update the representation:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer_model</span><span class="p">)</span>
</code></pre></div>
<p>You can also use this function to change or map the topics to something else.
You can update them as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">my_updated_topics</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">ClassTfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">representation_model</span><span class="p">:</span> <span class="n">BaseRepresentation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the topic representation by recalculating c-TF-IDF with the new</span>
<span class="sd">    parameters as defined in this function.</span>

<span class="sd">    When you have trained a model and viewed the topics and the words that represent them,</span>
<span class="sd">    you might not be satisfied with the representation. Perhaps you forgot to remove</span>
<span class="sd">    stop_words or you want to try out a different n_gram_range. This function allows you</span>
<span class="sd">    to update the topic representation after they have been formed.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        images: The images you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics: A list of topics where each topic is related to a document in `docs`.</span>
<span class="sd">                Use this variable to change or map the topics.</span>
<span class="sd">                NOTE: Using a custom list of topic assignments may lead to errors if</span>
<span class="sd">                      topic reduction techniques are used afterwards. Make sure that</span>
<span class="sd">                      manually assigning topics is the last step in the pipeline</span>
<span class="sd">        top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                     too high can negatively impact topic embeddings as topics</span>
<span class="sd">                     are typically best represented by at most 10 words.</span>
<span class="sd">        n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">        vectorizer_model: Pass in your own CountVectorizer from scikit-learn</span>
<span class="sd">        ctfidf_model: Pass in your own c-TF-IDF model to update the representations</span>
<span class="sd">        representation_model: Pass in a model that fine-tunes the topic representations</span>
<span class="sd">                              calculated through c-TF-IDF. Models from `bertopic.representation`</span>
<span class="sd">                              are supported.</span>

<span class="sd">    Examples:</span>
<span class="sd">    In order to update the topic representation, you will need to first fit the topic</span>
<span class="sd">    model and extract topics from them. Based on these, you can update the representation:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.update_topics(docs, n_gram_range=(2, 3))</span>
<span class="sd">    ```</span>

<span class="sd">    You can also use a custom vectorizer to update the representation:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.feature_extraction.text import CountVectorizer</span>
<span class="sd">    vectorizer_model = CountVectorizer(ngram_range=(1, 2), stop_words=&quot;english&quot;)</span>
<span class="sd">    topic_model.update_topics(docs, vectorizer_model=vectorizer_model)</span>
<span class="sd">    ```</span>

<span class="sd">    You can also use this function to change or map the topics to something else.</span>
<span class="sd">    You can update them as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.update_topics(docs, my_updated_topics)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_gram_range</span><span class="p">:</span>
        <span class="n">n_gram_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span>

    <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Note that extracting more than 100 words from a sparse &quot;</span> <span class="s2">&quot;can slow down computation quite a bit.&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="n">n_gram_range</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representation_model</span> <span class="o">=</span> <span class="n">representation_model</span>

    <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Using a custom list of topic assignments may lead to errors if &quot;</span>
            <span class="s2">&quot;topic reduction techniques are used afterwards. Make sure that &quot;</span>
            <span class="s2">&quot;manually assigning topics is the last step in the pipeline.&quot;</span>
            <span class="s2">&quot;Note that topic embeddings will also be created through weighted&quot;</span>
            <span class="s2">&quot;c-TF-IDF embeddings instead of centroid embeddings.&quot;</span>
        <span class="p">)</span>

    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topics</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">images</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Topic&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

    <span class="c1"># Update topic sizes and assignments</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Extract words and update topic labels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Update topic vectors</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">:</span>
        <span class="c1"># Remove outlier topic embedding if all that has changed is the outlier class</span>
        <span class="n">same_position</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="kc">True</span> <span class="k">if</span> <span class="n">old_topic</span> <span class="o">==</span> <span class="n">new_topic</span> <span class="k">else</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">old_topic</span><span class="p">,</span> <span class="n">new_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="n">topics</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">old_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">same_position</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topics</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_approximate_distribution" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_approximate_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">topic_token_distribution</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_approximate_distribution" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize the topic distribution calculated by <code>.approximate_topic_distribution</code>
on a token level. Thereby indicating the extent to which a certain word or phrase belongs
to a specific topic. The assumption here is that a single word can belong to multiple
similar topics and as such can give information about the broader set of topics within
a single document.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_model</code></td>
        <td></td>
        <td><p>A fitted BERTopic instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>document</code></td>
        <td><code>str</code></td>
        <td><p>The document for which you want to visualize
      the approximated topic distribution.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topic_token_distribution</code></td>
        <td><code>ndarray</code></td>
        <td><p>The topic-token distribution of the document as
                      extracted by <code>.approximate_topic_distribution</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>normalize</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to normalize, between 0 and 1 (summing up to 1), the
       topic distribution values.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>df</code></td>
      <td><p>A stylized dataframe indicating the best fitting topics
    for each token.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="c1"># Calculate the topic distributions on a token level</span>
<span class="c1"># Note that we need to have `calculate_token_level=True`</span>
<span class="n">topic_distr</span><span class="p">,</span> <span class="n">topic_token_distr</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">approximate_distribution</span><span class="p">(</span>
        <span class="n">docs</span><span class="p">,</span> <span class="n">calculate_token_level</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Visualize the approximated topic distributions</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_approximate_distribution</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">topic_token_distr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span>
</code></pre></div>
<p>To revert this stylized dataframe back to a regular dataframe,
you can run the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">data</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_approximate_distribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">document</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">topic_token_distribution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize the topic distribution calculated by `.approximate_topic_distribution`</span>
<span class="sd">    on a token level. Thereby indicating the extent to which a certain word or phrase belongs</span>
<span class="sd">    to a specific topic. The assumption here is that a single word can belong to multiple</span>
<span class="sd">    similar topics and as such can give information about the broader set of topics within</span>
<span class="sd">    a single document.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model: A fitted BERTopic instance.</span>
<span class="sd">        document: The document for which you want to visualize</span>
<span class="sd">                  the approximated topic distribution.</span>
<span class="sd">        topic_token_distribution: The topic-token distribution of the document as</span>
<span class="sd">                                  extracted by `.approximate_topic_distribution`</span>
<span class="sd">        normalize: Whether to normalize, between 0 and 1 (summing up to 1), the</span>
<span class="sd">                   topic distribution values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        df: A stylized dataframe indicating the best fitting topics</span>
<span class="sd">            for each token.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ```python</span>
<span class="sd">    # Calculate the topic distributions on a token level</span>
<span class="sd">    # Note that we need to have `calculate_token_level=True`</span>
<span class="sd">    topic_distr, topic_token_distr = topic_model.approximate_distribution(</span>
<span class="sd">            docs, calculate_token_level=True</span>
<span class="sd">    )</span>

<span class="sd">    # Visualize the approximated topic distributions</span>
<span class="sd">    df = topic_model.visualize_approximate_distribution(docs[0], topic_token_distr[0])</span>
<span class="sd">    df</span>
<span class="sd">    ```</span>

<span class="sd">    To revert this stylized dataframe back to a regular dataframe,</span>
<span class="sd">    you can run the following:</span>

<span class="sd">    ```python</span>
<span class="sd">    df.data.columns = [column.strip() for column in df.data.columns]</span>
<span class="sd">    df = df.data</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_approximate_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">document</span><span class="o">=</span><span class="n">document</span><span class="p">,</span>
        <span class="n">topic_token_distribution</span><span class="o">=</span><span class="n">topic_token_distribution</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_barchart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_barchart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_words</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Topic Word Scores&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">autoscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize a barchart of selected topics.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>Only select the top n most frequent topics.</p></td>
        <td><code>8</code></td>
      </tr>
      <tr>
        <td><code>n_words</code></td>
        <td><code>int</code></td>
        <td><p>Number of words to show in a topic</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;Topic Word Scores&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of each figure.</p></td>
        <td><code>250</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of each figure.</p></td>
        <td><code>250</code></td>
      </tr>
      <tr>
        <td><code>autoscale</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to automatically calculate the height of the figures to fit the whole bar text</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>fig</code></td>
      <td><p>A plotly figure</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the barchart of selected topics
simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_barchart</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Topic Word Scores&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
    <span class="n">autoscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize a barchart of selected topics.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">        n_words: Number of words to show in a topic</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of each figure.</span>
<span class="sd">        height: The height of each figure.</span>
<span class="sd">        autoscale: Whether to automatically calculate the height of the figures to fit the whole bar text</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the barchart of selected topics</span>
<span class="sd">    simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_barchart()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_barchart()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">n_words</span><span class="o">=</span><span class="n">n_words</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">autoscale</span><span class="o">=</span><span class="n">autoscale</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_distribution" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">min_probability</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Topic Probability Distribution&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize the distribution of topic probabilities.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>probabilities</code></td>
        <td><code>ndarray</code></td>
        <td><p>An array of probability scores</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>min_probability</code></td>
        <td><code>float</code></td>
        <td><p>The minimum probability score to visualize.
             All others are ignored.</p></td>
        <td><code>0.015</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Topic Probability Distribution&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>800</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>600</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>Make sure to fit the model before and only input the
probabilities of a single document:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_distribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">min_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topic Probability Distribution&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize the distribution of topic probabilities.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        probabilities: An array of probability scores</span>
<span class="sd">        min_probability: The minimum probability score to visualize.</span>
<span class="sd">                         All others are ignored.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>
<span class="sd">    Make sure to fit the model before and only input the</span>
<span class="sd">    probabilities of a single document:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">probabilities</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span>
        <span class="n">min_probability</span><span class="o">=</span><span class="n">min_probability</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_document_datamap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_document_datamap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Documents and Topics&#39;</span><span class="p">,</span> <span class="n">sub_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="o">**</span><span class="n">datamap_kwds</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_document_datamap" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize documents and their topics in 2D as a static plot for publication using
DataMapPlot. This works best if there are between 5 and 60 topics. It is therefore best
to use a sufficiently large <code>min_topic_size</code> or set <code>nr_topics</code> when building the model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_model</code></td>
        <td></td>
        <td><p>A fitted BERTopic instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>Not</code></td>
        <td><code>to be confused with the topics that you get from .fit_transform. For example, if you want to visualize only topics 1 through 5</code></td>
        <td><p>topics = [1, 2, 3, 4, 5]. Documents not in these topics will be shown as noise points.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>reduced_embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The 2D reduced embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>Union[bool, str]</code></td>
        <td><p>If bool, whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.
           If <code>str</code>, it uses labels from other aspects, e.g., "Aspect1".</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;Documents and Topics&#39;</code></td>
      </tr>
      <tr>
        <td><code>sub_title</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Sub-title of the plot.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>1200</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>1200</code></td>
      </tr>
      <tr>
        <td><code>**datamap_kwds</code></td>
        <td></td>
        <td><p>All further keyword args will be passed on to DataMapPlot's
             <code>create_plot</code> function. See the DataMapPlot documentation
             for more details.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>figure</code></td>
      <td><p>A Matplotlib Figure object.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>Do note that this re-calculates the embeddings and reduces them to 2D.
The advised and preferred pipeline for using this function is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>

<span class="c1"># Prepare embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Train BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">min_topic_size</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Reduce dimensionality of embeddings, this step is optional</span>
<span class="c1"># reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="c1"># Run the visualization with the original embeddings</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Or, if you have reduced the original embeddings already:</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;path/to/file.png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_document_datamap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Documents and Topics&quot;</span><span class="p">,</span>
    <span class="n">sub_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="o">**</span><span class="n">datamap_kwds</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D as a static plot for publication using</span>
<span class="sd">    DataMapPlot. This works best if there are between 5 and 60 topics. It is therefore best</span>
<span class="sd">    to use a sufficiently large `min_topic_size` or set `nr_topics` when building the model.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model:  A fitted BERTopic instance.</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">        Not to be confused with the topics that you get from .fit_transform. For example, if you want to visualize only topics 1 through 5: topics = [1, 2, 3, 4, 5]. Documents not in these topics will be shown as noise points.</span>
<span class="sd">        embeddings:  The embeddings of all documents in `docs`.</span>
<span class="sd">        reduced_embeddings:  The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">        custom_labels:  If bool, whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">                       If `str`, it uses labels from other aspects, e.g., &quot;Aspect1&quot;.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        sub_title: Sub-title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>
<span class="sd">        **datamap_kwds:  All further keyword args will be passed on to DataMapPlot&#39;s</span>
<span class="sd">                         `create_plot` function. See the DataMapPlot documentation</span>
<span class="sd">                         for more details.</span>

<span class="sd">    Returns:</span>
<span class="sd">        figure: A Matplotlib Figure object.</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_document_datamap(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">    The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from umap import UMAP</span>

<span class="sd">    # Prepare embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">    # Train BERTopic</span>
<span class="sd">    topic_model = BERTopic(min_topic_size=36).fit(docs, embeddings)</span>

<span class="sd">    # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">    # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">    # Run the visualization with the original embeddings</span>
<span class="sd">    topic_model.visualize_document_datamap(docs, embeddings=embeddings)</span>

<span class="sd">    # Or, if you have reduced the original embeddings already:</span>
<span class="sd">    topic_model.visualize_document_datamap(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_document_datamap(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    fig.savefig(&quot;path/to/file.png&quot;, bbox_inches=&quot;tight&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_document_datamap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="p">,</span>
        <span class="n">sub_title</span><span class="p">,</span>
        <span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="p">,</span>
        <span class="o">**</span><span class="n">datamap_kwds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_documents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hide_annotations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_document_hover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Documents and Topics&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_documents" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize documents and their topics in 2D.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_model</code></td>
        <td></td>
        <td><p>A fitted BERTopic instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize.
    Not to be confused with the topics that you get from <code>.fit_transform</code>.
    For example, if you want to visualize only topics 1 through 5:
    <code>topics = [1, 2, 3, 4, 5]</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>reduced_embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The 2D reduced embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sample</code></td>
        <td><code>float</code></td>
        <td><p>The percentage of documents in each topic that you would like to keep.
    Value can be between 0 and 1. Setting this value to, for example,
    0.1 (10% of documents in each topic) makes it easier to visualize
    millions of documents as a subset is chosen.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>hide_annotations</code></td>
        <td><code>bool</code></td>
        <td><p>Hide the names of the traces on top of each cluster.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>hide_document_hover</code></td>
        <td><code>bool</code></td>
        <td><p>Hide the content of the documents when hovering over
                specific points. Helps to speed up generation of visualization.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Documents and Topics&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>1200</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>750</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>Do note that this re-calculates the embeddings and reduces them to 2D.
The advised and preferred pipeline for using this function is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>

<span class="c1"># Prepare embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Train BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Reduce dimensionality of embeddings, this step is optional</span>
<span class="c1"># reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="c1"># Run the visualization with the original embeddings</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Or, if you have reduced the original embeddings already:</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../getting_started/visualization/documents.html"
style="width:1000px; height: 800px; border: 0px;""></iframe>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Documents and Topics&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model: A fitted BERTopic instance.</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">                Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">        embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">        reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">        sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                millions of documents as a subset is chosen.</span>
<span class="sd">        hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">        hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                            specific points. Helps to speed up generation of visualization.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_documents(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">    The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from umap import UMAP</span>

<span class="sd">    # Prepare embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">    # Train BERTopic</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>

<span class="sd">    # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">    # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">    # Run the visualization with the original embeddings</span>
<span class="sd">    topic_model.visualize_documents(docs, embeddings=embeddings)</span>

<span class="sd">    # Or, if you have reduced the original embeddings already:</span>
<span class="sd">    topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    &lt;iframe src=&quot;../getting_started/visualization/documents.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 800px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
        <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
        <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
        <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_heatmap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Similarity Matrix&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize a heatmap of the topic's similarity matrix.</p>
<p>Based on the cosine similarity matrix between c-TF-IDFs or semantic embeddings of the topics,
a heatmap is created showing the similarity between topics.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>Only select the top n most frequent topics.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>n_clusters</code></td>
        <td><code>int</code></td>
        <td><p>Create n clusters and order the similarity
        matrix by those clusters.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the
        embeddings from the embedding model are used.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Similarity Matrix&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>800</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>800</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>fig</code></td>
      <td><p>A plotly figure</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the similarity matrix of
topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_heatmap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Similarity Matrix&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize a heatmap of the topic&#39;s similarity matrix.</span>

<span class="sd">    Based on the cosine similarity matrix between c-TF-IDFs or semantic embeddings of the topics,</span>
<span class="sd">    a heatmap is created showing the similarity between topics.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">        n_clusters: Create n clusters and order the similarity</span>
<span class="sd">                    matrix by those clusters.</span>
<span class="sd">        use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                    embeddings from the embedding model are used.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the similarity matrix of</span>
<span class="sd">    topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_heatmap()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_heatmap()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hide_annotations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_document_hover</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nr_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">level_scale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Hierarchical Documents and Topics&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize documents and their topics in 2D at different levels of hierarchy.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>docs</code></td>
        <td><code>List[str]</code></td>
        <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>hierarchical_topics</code></td>
        <td><code>DataFrame</code></td>
        <td><p>A dataframe that contains a hierarchy of topics
                represented by their parents and their children</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize.
    Not to be confused with the topics that you get from <code>.fit_transform</code>.
    For example, if you want to visualize only topics 1 through 5:
    <code>topics = [1, 2, 3, 4, 5]</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>reduced_embeddings</code></td>
        <td><code>ndarray</code></td>
        <td><p>The 2D reduced embeddings of all documents in <code>docs</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sample</code></td>
        <td><code>Union[float, int]</code></td>
        <td><p>The percentage of documents in each topic that you would like to keep.
    Value can be between 0 and 1. Setting this value to, for example,
    0.1 (10% of documents in each topic) makes it easier to visualize
    millions of documents as a subset is chosen.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>hide_annotations</code></td>
        <td><code>bool</code></td>
        <td><p>Hide the names of the traces on top of each cluster.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>hide_document_hover</code></td>
        <td><code>bool</code></td>
        <td><p>Hide the content of the documents when hovering over
                 specific points. Helps to speed up generation of visualizations.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>nr_levels</code></td>
        <td><code>int</code></td>
        <td><p>The number of levels to be visualized in the hierarchy. First, the distances
       in <code>hierarchical_topics.Distance</code> are split in <code>nr_levels</code> lists of distances with
       equal length. Then, for each list of distances, the merged topics, that have
       a distance less or equal to the maximum distance of the selected list of distances, are selected.
       NOTE: To get all possible merged steps, make sure that <code>nr_levels</code> is equal to
       the length of <code>hierarchical_topics</code>.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>level_scale</code></td>
        <td><code>str</code></td>
        <td><p>Whether to apply a linear or logarithmic ('log') scale levels of the distance
         vector. Linear scaling will perform an equal number of merges at each level
         while logarithmic scaling will perform more mergers in earlier levels to
         provide more resolution at higher levels (this can be used for when the number
         of topics is large).</p></td>
        <td><code>&#39;linear&#39;</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.
           NOTE: Custom labels are only generated for the original
           un-merged topics.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Hierarchical Documents and Topics&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>1200</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>750</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">)</span>
</code></pre></div>
<p>Do note that this re-calculates the embeddings and reduces them to 2D.
The advised and preferred pipeline for using this function is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>

<span class="c1"># Prepare embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Train BERTopic and extract hierarchical topics</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Reduce dimensionality of embeddings, this step is optional</span>
<span class="c1"># reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="c1"># Run the visualization with the original embeddings</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Or, if you have reduced the original embeddings already:</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../getting_started/visualization/hierarchical_documents.html"
style="width:1000px; height: 770px; border: 0px;""></iframe>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_hierarchical_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">nr_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">level_scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Hierarchical Documents and Topics&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize documents and their topics in 2D at different levels of hierarchy.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                            represented by their parents and their children</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">                Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">        embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">        reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">        sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                millions of documents as a subset is chosen.</span>
<span class="sd">        hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">        hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                             specific points. Helps to speed up generation of visualizations.</span>
<span class="sd">        nr_levels: The number of levels to be visualized in the hierarchy. First, the distances</span>
<span class="sd">                   in `hierarchical_topics.Distance` are split in `nr_levels` lists of distances with</span>
<span class="sd">                   equal length. Then, for each list of distances, the merged topics, that have</span>
<span class="sd">                   a distance less or equal to the maximum distance of the selected list of distances, are selected.</span>
<span class="sd">                   NOTE: To get all possible merged steps, make sure that `nr_levels` is equal to</span>
<span class="sd">                   the length of `hierarchical_topics`.</span>
<span class="sd">        level_scale: Whether to apply a linear or logarithmic (&#39;log&#39;) scale levels of the distance</span>
<span class="sd">                     vector. Linear scaling will perform an equal number of merges at each level</span>
<span class="sd">                     while logarithmic scaling will perform more mergers in earlier levels to</span>
<span class="sd">                     provide more resolution at higher levels (this can be used for when the number</span>
<span class="sd">                     of topics is large).</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">                       NOTE: Custom labels are only generated for the original</span>
<span class="sd">                       un-merged topics.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics)</span>
<span class="sd">    ```</span>

<span class="sd">    Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">    The advised and preferred pipeline for using this function is as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from umap import UMAP</span>

<span class="sd">    # Prepare embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">    # Train BERTopic and extract hierarchical topics</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">    # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">    # Run the visualization with the original embeddings</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, embeddings=embeddings)</span>

<span class="sd">    # Or, if you have reduced the original embeddings already:</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    &lt;iframe src=&quot;../getting_started/visualization/hierarchical_documents.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 770px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
        <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
        <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
        <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
        <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
        <span class="n">nr_levels</span><span class="o">=</span><span class="n">nr_levels</span><span class="p">,</span>
        <span class="n">level_scale</span><span class="o">=</span><span class="n">level_scale</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_hierarchy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Hierarchical Clustering&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize a hierarchical structure of the topics.</p>
<p>A ward linkage function is used to perform the
hierarchical clustering based on the cosine distance
matrix between c-TF-IDF or semantic embeddings of the topics.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_model</code></td>
        <td></td>
        <td><p>A fitted BERTopic instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>orientation</code></td>
        <td><code>str</code></td>
        <td><p>The orientation of the figure.
         Either 'left' or 'bottom'</p></td>
        <td><code>&#39;left&#39;</code></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>Only select the top n most frequent topics</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the
        embeddings from the embedding model are used.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.
           NOTE: Custom labels are only generated for the original
           un-merged topics.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Hierarchical Clustering&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure. Only works if orientation is set to 'left'</p></td>
        <td><code>1000</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure. Only works if orientation is set to 'bottom'</p></td>
        <td><code>600</code></td>
      </tr>
      <tr>
        <td><code>hierarchical_topics</code></td>
        <td><code>DataFrame</code></td>
        <td><p>A dataframe that contains a hierarchy of topics
                 represented by their parents and their children.
                 NOTE: The hierarchical topic names are only visualized
                 if both <code>topics</code> and <code>top_n_topics</code> are not set.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>linkage_function</code></td>
        <td><code>Callable[[scipy.sparse._csr.csr_matrix], numpy.ndarray]</code></td>
        <td><p>The linkage function to use. Default is:
              <code>lambda x: sch.linkage(x, 'ward', optimal_ordering=True)</code>
              NOTE: Make sure to use the same <code>linkage_function</code> as used
              in <code>topic_model.hierarchical_topics</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>distance_function</code></td>
        <td><code>Callable[[scipy.sparse._csr.csr_matrix], scipy.sparse._csr.csr_matrix]</code></td>
        <td><p>The distance function to use on the c-TF-IDF matrix. Default is:
               <code>lambda x: 1 - cosine_similarity(x)</code>
               NOTE: Make sure to use the same <code>distance_function</code> as used
               in <code>topic_model.hierarchical_topics</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>color_threshold</code></td>
        <td><code>int</code></td>
        <td><p>Value at which the separation of clusters will be made which
             will result in different colors for different clusters.
             A higher value will typically lead to less colored clusters.</p></td>
        <td><code>1</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>fig</code></td>
      <td><p>A plotly figure</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the hierarchical structure of
topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">()</span>
</code></pre></div>
<p>If you also want the labels of hierarchical topics visualized,
run the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Extract hierarchical topics and their representations</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Visualize these representations</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">)</span>
</code></pre></div>
<p>If you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../getting_started/visualization/hierarchy.html"
style="width:1000px; height: 680px; border: 0px;""></iframe>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_hierarchy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Hierarchical Clustering&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize a hierarchical structure of the topics.</span>

<span class="sd">    A ward linkage function is used to perform the</span>
<span class="sd">    hierarchical clustering based on the cosine distance</span>
<span class="sd">    matrix between c-TF-IDF or semantic embeddings of the topics.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model: A fitted BERTopic instance.</span>
<span class="sd">        orientation: The orientation of the figure.</span>
<span class="sd">                     Either &#39;left&#39; or &#39;bottom&#39;</span>
<span class="sd">        topics: A selection of topics to visualize</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">        use_ctfidf: Whether to calculate distances between topics based on c-TF-IDF embeddings. If False, the</span>
<span class="sd">                    embeddings from the embedding model are used.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">                       NOTE: Custom labels are only generated for the original</span>
<span class="sd">                       un-merged topics.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure. Only works if orientation is set to &#39;left&#39;</span>
<span class="sd">        height: The height of the figure. Only works if orientation is set to &#39;bottom&#39;</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                             represented by their parents and their children.</span>
<span class="sd">                             NOTE: The hierarchical topic names are only visualized</span>
<span class="sd">                             if both `topics` and `top_n_topics` are not set.</span>
<span class="sd">        linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                          `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">                          NOTE: Make sure to use the same `linkage_function` as used</span>
<span class="sd">                          in `topic_model.hierarchical_topics`.</span>
<span class="sd">        distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                           `lambda x: 1 - cosine_similarity(x)`</span>
<span class="sd">                           NOTE: Make sure to use the same `distance_function` as used</span>
<span class="sd">                           in `topic_model.hierarchical_topics`.</span>
<span class="sd">        color_threshold: Value at which the separation of clusters will be made which</span>
<span class="sd">                         will result in different colors for different clusters.</span>
<span class="sd">                         A higher value will typically lead to less colored clusters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the hierarchical structure of</span>
<span class="sd">    topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_hierarchy()</span>
<span class="sd">    ```</span>

<span class="sd">    If you also want the labels of hierarchical topics visualized,</span>
<span class="sd">    run the following:</span>

<span class="sd">    ```python</span>
<span class="sd">    # Extract hierarchical topics and their representations</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Visualize these representations</span>
<span class="sd">    topic_model.visualize_hierarchy(hierarchical_topics=hierarchical_topics)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_hierarchy()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &lt;iframe src=&quot;../getting_started/visualization/hierarchy.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 680px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
        <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="o">=</span><span class="n">distance_function</span><span class="p">,</span>
        <span class="n">color_threshold</span><span class="o">=</span><span class="n">color_threshold</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_term_rank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_term_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Term score decline per Topic&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize the ranks of all terms across all topics.</p>
<p>Each topic is represented by a set of words. These words, however,
do not all equally represent the topic. This visualization shows
how many words are needed to represent a topic and at which point
the beneficial effect of adding words starts to decline.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize. These will be colored
    red where all others will be colored black.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>log_scale</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to represent the ranking on a log scale</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Term score decline per Topic&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>800</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>500</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>fig</code></td>
      <td><p>A plotly figure</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the ranks of all words across
all topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Reference:</p>
<p>This visualization was heavily inspired by the
"Term Probability Decline" visualization found in an
analysis by the amazing <a href="https://tmtoolkit.readthedocs.io/">tmtoolkit</a>.
Reference to that specific analysis can be found
<a href="https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html">here</a>.</p>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_term_rank</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Term score decline per Topic&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize the ranks of all terms across all topics.</span>

<span class="sd">    Each topic is represented by a set of words. These words, however,</span>
<span class="sd">    do not all equally represent the topic. This visualization shows</span>
<span class="sd">    how many words are needed to represent a topic and at which point</span>
<span class="sd">    the beneficial effect of adding words starts to decline.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize. These will be colored</span>
<span class="sd">                red where all others will be colored black.</span>
<span class="sd">        log_scale: Whether to represent the ranking on a log scale</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the ranks of all words across</span>
<span class="sd">    all topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_term_rank()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_term_rank()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Reference:</span>

<span class="sd">    This visualization was heavily inspired by the</span>
<span class="sd">    &quot;Term Probability Decline&quot; visualization found in an</span>
<span class="sd">    analysis by the amazing [tmtoolkit](https://tmtoolkit.readthedocs.io/).</span>
<span class="sd">    Reference to that specific analysis can be found</span>
<span class="sd">    [here](https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">log_scale</span><span class="o">=</span><span class="n">log_scale</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_ctfidf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Intertopic Distance Map&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">650</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_topics" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize topics, their sizes, and their corresponding words.</p>
<p>This visualization is highly inspired by LDAvis, a great visualization
technique typically reserved for LDA.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>A selection of topics to visualize
    Not to be confused with the topics that you get from <code>.fit_transform</code>.
    For example, if you want to visualize only topics 1 through 5:
    <code>topics = [1, 2, 3, 4, 5]</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>Only select the top n most frequent topics</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_ctfidf</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use c-TF-IDF representations instead of the embeddings from the embedding model.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Intertopic Distance Map&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>650</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>650</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_ctfidf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Intertopic Distance Map&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize topics, their sizes, and their corresponding words.</span>

<span class="sd">    This visualization is highly inspired by LDAvis, a great visualization</span>
<span class="sd">    technique typically reserved for LDA.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize</span>
<span class="sd">                Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">        use_ctfidf: Whether to use c-TF-IDF representations instead of the embeddings from the embedding model.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_topics()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">use_ctfidf</span><span class="o">=</span><span class="n">use_ctfidf</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics_over_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics_over_time</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_frequency</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Topics over Time&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize topics over time.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics_over_time</code></td>
        <td><code>DataFrame</code></td>
        <td><p>The topics you would like to be visualized with the
              corresponding topic representation</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>To visualize the most frequent topics instead of all</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>Select which topics you would like to be visualized</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>normalize_frequency</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to normalize each topic's frequency individually</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Topics over Time&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>1250</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>450</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Figure</code></td>
      <td><p>A plotly.graph_objects.Figure including all traces</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics over time, simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_over_time</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_over_time</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics_over_time</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics_over_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topics over Time&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize topics over time.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics_over_time: The topics you would like to be visualized with the</span>
<span class="sd">                          corresponding topic representation</span>
<span class="sd">        top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">        topics: Select which topics you would like to be visualized</span>
<span class="sd">        normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A plotly.graph_objects.Figure including all traces</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics over time, simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_over_time = topic_model.topics_over_time(docs, timestamps)</span>
<span class="sd">    topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics_over_time</span><span class="o">=</span><span class="n">topics_over_time</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics_per_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics_per_class</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_frequency</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;Topics per Class&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span></code>


<a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Visualize topics per class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topics_per_class</code></td>
        <td><code>DataFrame</code></td>
        <td><p>The topics you would like to be visualized with the
              corresponding topic representation</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>top_n_topics</code></td>
        <td><code>int</code></td>
        <td><p>To visualize the most frequent topics instead of all</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>List[int]</code></td>
        <td><p>Select which topics you would like to be visualized</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>normalize_frequency</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to normalize each topic's frequency individually</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>custom_labels</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>Title of the plot.</p></td>
        <td><code>&#39;&lt;b&gt;Topics per Class&lt;/b&gt;&#39;</code></td>
      </tr>
      <tr>
        <td><code>width</code></td>
        <td><code>int</code></td>
        <td><p>The width of the figure.</p></td>
        <td><code>1250</code></td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td><code>int</code></td>
        <td><p>The height of the figure.</p></td>
        <td><code>900</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Figure</code></td>
      <td><p>A plotly.graph_objects.Figure including all traces</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics per class, simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_per_class</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics_per_class</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topics_per_class</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Topics per Class&lt;/b&gt;&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize topics per class.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics_per_class: The topics you would like to be visualized with the</span>
<span class="sd">                          corresponding topic representation</span>
<span class="sd">        top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">        topics: Select which topics you would like to be visualized</span>
<span class="sd">        normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A plotly.graph_objects.Figure including all traces</span>

<span class="sd">    Examples:</span>
<span class="sd">    To visualize the topics per class, simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">    topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics_per_class</span><span class="o">=</span><span class="n">topics_per_class</span><span class="p">,</span>
        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
        <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Maintained by <a href="https://github.com/MaartenGr">Maarten Grootendorst</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.top", "navigation.tracking", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>