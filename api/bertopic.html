
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Leveraging BERT and a class-based TF-IDF to create easily interpretable topics.">
      
      
        <meta name="author" content="Maarten P. Grootendorst">
      
      
        <link rel="canonical" href="https://maartengr.github.io/BERTopic/api/bertopic.html">
      
      <link rel="icon" href="../icon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>BERTopic - BERTopic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bertopic" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="BERTopic" class="md-header__button md-logo" aria-label="BERTopic" data-md-component="logo">
      
  <img src="../icon_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BERTopic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              BERTopic
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/MaartenGr/BERTopic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../algorithm/algorithm.html" class="md-tabs__link">
      The Algorithm
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../getting_started/quickstart/quickstart.html" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../faq.html" class="md-tabs__link">
      FAQ
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="bertopic.html" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../changelog.html" class="md-tabs__link">
      Changelog
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="BERTopic" class="md-nav__button md-logo" aria-label="BERTopic" data-md-component="logo">
      
  <img src="../icon_white.png" alt="logo">

    </a>
    BERTopic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MaartenGr/BERTopic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../algorithm/algorithm.html" class="md-nav__link">
        The Algorithm
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/quickstart/quickstart.html" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/embeddings/embeddings.html" class="md-nav__link">
        Embedding Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/visualization/visualization.html" class="md-nav__link">
        Topic Visualization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicreduction/topicreduction.html" class="md-nav__link">
        Topic Reduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicrepresentation/topicrepresentation.html" class="md-nav__link">
        Topic Representation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/search/search.html" class="md-nav__link">
        Search Topics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/parameter%20tuning/parametertuning.html" class="md-nav__link">
        Parameter tuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/tips_and_tricks/tips_and_tricks.html" class="md-nav__link">
        Tips & Tricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9">
          Sub-models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sub-models" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Sub-models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/dim_reduction/dim_reduction.html" class="md-nav__link">
        Dimensionality Reduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/clustering/clustering.html" class="md-nav__link">
        Clustering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/vectorizers/vectorizers.html" class="md-nav__link">
        Vectorizers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/ctfidf/ctfidf.html" class="md-nav__link">
        c-TF-IDF
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_10" type="checkbox" id="__nav_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_10">
          Variations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Variations" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Variations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicsperclass/topicsperclass.html" class="md-nav__link">
        Topics per Class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/supervised/supervised.html" class="md-nav__link">
        (semi)-Supervised Topic Modeling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/topicsovertime/topicsovertime.html" class="md-nav__link">
        Dynamic Topic Modeling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/guided/guided.html" class="md-nav__link">
        Guided Topic Modeling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/hierarchicaltopics/hierarchicaltopics.html" class="md-nav__link">
        Hierarchical Topic Modeling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/online/online.html" class="md-nav__link">
        Online Topic Modeling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../faq.html" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          BERTopic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bertopic.html" class="md-nav__link md-nav__link--active">
        BERTopic
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic" class="md-nav__link">
    bertopic._bertopic.BERTopic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.find_topics" class="md-nav__link">
    find_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="md-nav__link">
    generate_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="md-nav__link">
    get_representative_docs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic" class="md-nav__link">
    get_topic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="md-nav__link">
    get_topic_freq()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_info" class="md-nav__link">
    get_topic_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="md-nav__link">
    get_topic_tree()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topics" class="md-nav__link">
    get_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="md-nav__link">
    hierarchical_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_topics" class="md-nav__link">
    merge_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.partial_fit" class="md-nav__link">
    partial_fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_topics" class="md-nav__link">
    reduce_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.save" class="md-nav__link">
    save()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="md-nav__link">
    set_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_over_time" class="md-nav__link">
    topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_per_class" class="md-nav__link">
    topics_per_class()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.update_topics" class="md-nav__link">
    update_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="md-nav__link">
    visualize_barchart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="md-nav__link">
    visualize_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_documents" class="md-nav__link">
    visualize_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="md-nav__link">
    visualize_heatmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="md-nav__link">
    visualize_hierarchical_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="md-nav__link">
    visualize_hierarchy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="md-nav__link">
    visualize_term_rank()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics" class="md-nav__link">
    visualize_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="md-nav__link">
    visualize_topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="md-nav__link">
    visualize_topics_per_class()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="mmr.html" class="md-nav__link">
        MMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Vectorizers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Vectorizers" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Vectorizers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ctfidf.html" class="md-nav__link">
        cTFIDF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="onlinecv.html" class="md-nav__link">
        OnlineCountVectorizer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Backends" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="backends/base.html" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="backends/word_doc.html" class="md-nav__link">
        Word Doc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_5" type="checkbox" id="__nav_5_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_5">
          Plotting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plotting" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Plotting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/barchart.html" class="md-nav__link">
        Barchart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/documents.html" class="md-nav__link">
        Documents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/dtm.html" class="md-nav__link">
        DTM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/hierarchical_documents.html" class="md-nav__link">
        Hierarchical documents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/hierarchy.html" class="md-nav__link">
        Hierarchical topics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/distribution.html" class="md-nav__link">
        Distribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/heatmap.html" class="md-nav__link">
        Heatmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/term.html" class="md-nav__link">
        Term Scores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/topics.html" class="md-nav__link">
        Topics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="plotting/topics_per_class.html" class="md-nav__link">
        Topics per Class
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog.html" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic" class="md-nav__link">
    bertopic._bertopic.BERTopic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.find_topics" class="md-nav__link">
    find_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.fit_transform" class="md-nav__link">
    fit_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="md-nav__link">
    generate_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="md-nav__link">
    get_representative_docs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic" class="md-nav__link">
    get_topic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="md-nav__link">
    get_topic_freq()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_info" class="md-nav__link">
    get_topic_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="md-nav__link">
    get_topic_tree()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.get_topics" class="md-nav__link">
    get_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="md-nav__link">
    hierarchical_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.merge_topics" class="md-nav__link">
    merge_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.partial_fit" class="md-nav__link">
    partial_fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.reduce_topics" class="md-nav__link">
    reduce_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.save" class="md-nav__link">
    save()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="md-nav__link">
    set_topic_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_over_time" class="md-nav__link">
    topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.topics_per_class" class="md-nav__link">
    topics_per_class()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.update_topics" class="md-nav__link">
    update_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="md-nav__link">
    visualize_barchart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="md-nav__link">
    visualize_distribution()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_documents" class="md-nav__link">
    visualize_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="md-nav__link">
    visualize_heatmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="md-nav__link">
    visualize_hierarchical_documents()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="md-nav__link">
    visualize_hierarchy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="md-nav__link">
    visualize_term_rank()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics" class="md-nav__link">
    visualize_topics()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="md-nav__link">
    visualize_topics_over_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="md-nav__link">
    visualize_topics_per_class()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/MaartenGr/BERTopic/edit/master/docs/api/bertopic.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="bertopic"><code>BERTopic</code><a class="headerlink" href="#bertopic" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">


<a id="bertopic._bertopic.BERTopic"></a>
  <div class="doc doc-contents first">

  
      <p>BERTopic is a topic modeling technique that leverages BERT embeddings and
c-TF-IDF to create dense clusters allowing for easily interpretable topics
whilst keeping important words in the topic descriptions.</p>
<p>The default embedding model is <code>all-MiniLM-L6-v2</code> when selecting <code>language="english"</code>
and <code>paraphrase-multilingual-MiniLM-L12-v2</code> when selecting <code>language="multilingual"</code>.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics_</code></td>
          <td>
                <code>List[int]) </code>
          </td>
          <td><p>The topics that are generated for each document after training or updating
                  the topic model. The most recent topics are tracked.</p></td>
        </tr>
        <tr>
          <td><code>probabilities_</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td><p>The probability of the assigned topic per document. These are
                          only calculated if a HDBSCAN model is used for the clustering step.
                          When <code>calculate_probabilities=True</code>, then it is the probabilities
                          of all topics per document.</p></td>
        </tr>
        <tr>
          <td><code>topic_sizes_</code></td>
          <td>
                <code>Mapping[int, int]) </code>
          </td>
          <td><p>The size of each topic</p></td>
        </tr>
        <tr>
          <td><code>topic_mapper_</code></td>
          <td>
                <code>TopicMapper) </code>
          </td>
          <td><p>A class for tracking topics and their mappings anytime they are
                          merged, reduced, added, or removed.</p></td>
        </tr>
        <tr>
          <td><code>topic_representations_</code></td>
          <td>
                <code>Mapping[int, Tuple[int, float]]) </code>
          </td>
          <td><p>The top n terms per topic and their respective
                                                       c-TF-IDF values.</p></td>
        </tr>
        <tr>
          <td><code>c_tf_idf_</code></td>
          <td>
                <code>csr_matrix) </code>
          </td>
          <td><p>The topic-term matrix as calculated through c-TF-IDF. To access its respective
                     words, run <code>.vectorizer_model.get_feature_names()</code>  or
                     <code>.vectorizer_model.get_feature_names_out()</code></p></td>
        </tr>
        <tr>
          <td><code>topic_labels_</code></td>
          <td>
                <code>Mapping[int, str]) </code>
          </td>
          <td><p>The default labels for each topic.</p></td>
        </tr>
        <tr>
          <td><code>custom_labels_</code></td>
          <td>
                <code>List[str]) </code>
          </td>
          <td><p>Custom labels for each topic.</p></td>
        </tr>
        <tr>
          <td><code>topic_embeddings_</code></td>
          <td>
                <code>np.ndarray) </code>
          </td>
          <td><p>The embeddings for each topic. It is calculated by taking the
                             weighted average of word embeddings in a topic based on their c-TF-IDF values.</p></td>
        </tr>
        <tr>
          <td><code>representative_docs_</code></td>
          <td>
                <code>Mapping[int, str]) </code>
          </td>
          <td><p>The representative documents for each topic.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embedding model, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">sentence_model</span><span class="p">)</span>
</code></pre></div>
<p>Due to the stochastisch nature of UMAP, the results from BERTopic might differ
and the quality can degrade. Using your own embeddings allows you to
try out BERTopic several times until you find the topics that suit
you best.</p>


        <details class="quote">
          <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BERTopic</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;BERTopic is a topic modeling technique that leverages BERT embeddings and</span>
<span class="sd">    c-TF-IDF to create dense clusters allowing for easily interpretable topics</span>
<span class="sd">    whilst keeping important words in the topic descriptions.</span>

<span class="sd">    The default embedding model is `all-MiniLM-L6-v2` when selecting `language=&quot;english&quot;`</span>
<span class="sd">    and `paraphrase-multilingual-MiniLM-L12-v2` when selecting `language=&quot;multilingual&quot;`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        topics_ (List[int]) : The topics that are generated for each document after training or updating</span>
<span class="sd">                              the topic model. The most recent topics are tracked.</span>
<span class="sd">        probabilities_ (List[float]): The probability of the assigned topic per document. These are</span>
<span class="sd">                                      only calculated if a HDBSCAN model is used for the clustering step.</span>
<span class="sd">                                      When `calculate_probabilities=True`, then it is the probabilities</span>
<span class="sd">                                      of all topics per document.</span>
<span class="sd">        topic_sizes_ (Mapping[int, int]) : The size of each topic</span>
<span class="sd">        topic_mapper_ (TopicMapper) : A class for tracking topics and their mappings anytime they are</span>
<span class="sd">                                      merged, reduced, added, or removed.</span>
<span class="sd">        topic_representations_ (Mapping[int, Tuple[int, float]]) : The top n terms per topic and their respective</span>
<span class="sd">                                                                   c-TF-IDF values.</span>
<span class="sd">        c_tf_idf_ (csr_matrix) : The topic-term matrix as calculated through c-TF-IDF. To access its respective</span>
<span class="sd">                                 words, run `.vectorizer_model.get_feature_names()`  or</span>
<span class="sd">                                 `.vectorizer_model.get_feature_names_out()`</span>
<span class="sd">        topic_labels_ (Mapping[int, str]) : The default labels for each topic.</span>
<span class="sd">        custom_labels_ (List[str]) : Custom labels for each topic.</span>
<span class="sd">        topic_embeddings_ (np.ndarray) : The embeddings for each topic. It is calculated by taking the</span>
<span class="sd">                                         weighted average of word embeddings in a topic based on their c-TF-IDF values.</span>
<span class="sd">        representative_docs_ (Mapping[int, str]) : The representative documents for each topic.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probabilities = topic_model.fit_transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embedding model, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    topic_model = BERTopic(embedding_model=sentence_model)</span>
<span class="sd">    ```</span>

<span class="sd">    Due to the stochastisch nature of UMAP, the results from BERTopic might differ</span>
<span class="sd">    and the quality can degrade. Using your own embeddings allows you to</span>
<span class="sd">    try out BERTopic several times until you find the topics that suit</span>
<span class="sd">    you best.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
                 <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">min_topic_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">calculate_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">diversity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">seed_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">umap_model</span><span class="p">:</span> <span class="n">UMAP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">hdbscan_model</span><span class="p">:</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">TfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;BERTopic initialization</span>

<span class="sd">        Arguments:</span>
<span class="sd">            language: The main language used in your documents. The default sentence-transformers</span>
<span class="sd">                      model for &quot;english&quot; is `all-MiniLM-L6-v2`. For a full overview of</span>
<span class="sd">                      supported languages see bertopic.backend.languages. Select</span>
<span class="sd">                      &quot;multilingual&quot; to load in the `paraphrase-multilingual-MiniLM-L12-v2`</span>
<span class="sd">                      sentence-tranformers model that supports 50+ languages.</span>
<span class="sd">            top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                         too high can negatively impact topic embeddings as topics</span>
<span class="sd">                         are typically best represented by at most 10 words.</span>
<span class="sd">            n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">                          Advised to keep high values between 1 and 3.</span>
<span class="sd">                          More would likely lead to memory issues.</span>
<span class="sd">                          NOTE: This param will not be used if you pass in your own</span>
<span class="sd">                          CountVectorizer.</span>
<span class="sd">            min_topic_size: The minimum size of the topic. Increasing this value will lead</span>
<span class="sd">                            to a lower number of clusters/topics.</span>
<span class="sd">            nr_topics: Specifying the number of topics will reduce the initial</span>
<span class="sd">                       number of topics to the value specified. This reduction can take</span>
<span class="sd">                       a while as each reduction in topics (-1) activates a c-TF-IDF</span>
<span class="sd">                       calculation. If this is set to None, no reduction is applied. Use</span>
<span class="sd">                       &quot;auto&quot; to automatically reduce topics using HDBSCAN.</span>
<span class="sd">            low_memory: Sets UMAP low memory to True to make sure less memory is used.</span>
<span class="sd">                        NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP</span>
<span class="sd">                        this parameter will not be used.</span>
<span class="sd">            calculate_probabilities: Whether to calculate the probabilities of all topics</span>
<span class="sd">                                     per document instead of the probability of the assigned</span>
<span class="sd">                                     topic per document. This could slow down the extraction</span>
<span class="sd">                                     of topics if you have many documents (&gt; 100_000). Set this</span>
<span class="sd">                                     only to True if you have a low amount of documents or if</span>
<span class="sd">                                     you do not mind more computation time.</span>
<span class="sd">                                     NOTE: If false you cannot use the corresponding</span>
<span class="sd">                                     visualization method `visualize_probabilities`.</span>
<span class="sd">            diversity: Whether to use MMR to diversify the resulting topic representations.</span>
<span class="sd">                       If set to None, MMR will not be used. Accepted values lie between</span>
<span class="sd">                       0 and 1 with 0 being not at all diverse and 1 being very diverse.</span>
<span class="sd">            seed_topic_list: A list of seed words per topic to converge around</span>
<span class="sd">            verbose: Changes the verbosity of the model, Set to True if you want</span>
<span class="sd">                     to track the stages of the model.</span>
<span class="sd">            embedding_model: Use a custom embedding model.</span>
<span class="sd">                             The following backends are currently supported</span>
<span class="sd">                               * SentenceTransformers</span>
<span class="sd">                               * Flair</span>
<span class="sd">                               * Spacy</span>
<span class="sd">                               * Gensim</span>
<span class="sd">                               * USE (TF-Hub)</span>
<span class="sd">                             You can also pass in a string that points to one of the following</span>
<span class="sd">                             sentence-transformers models:</span>
<span class="sd">                               * https://www.sbert.net/docs/pretrained_models.html</span>
<span class="sd">            umap_model: Pass in a UMAP model to be used instead of the default.</span>
<span class="sd">                        NOTE: You can also pass in any dimensionality reduction algorithm as long</span>
<span class="sd">                        as it has `.fit` and `.transform` functions.</span>
<span class="sd">            hdbscan_model: Pass in a hdbscan.HDBSCAN model to be used instead of the default</span>
<span class="sd">                           NOTE: You can also pass in any clustering algorithm as long as it has</span>
<span class="sd">                           `.fit` and `.predict` functions along with the `.labels_` variable.</span>
<span class="sd">            vectorizer_model: Pass in a custom `CountVectorizer` instead of the default model.</span>
<span class="sd">            ctfidf_model: Pass in a custom ClassTfidfTransformer instead of the default model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Topic-based parameters</span>
        <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;top_n_words should be lower or equal to 30. The preferred value is 10.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span> <span class="o">=</span> <span class="n">min_topic_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span> <span class="o">=</span> <span class="n">low_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span> <span class="o">=</span> <span class="n">calculate_probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diversity</span> <span class="o">=</span> <span class="n">diversity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="o">=</span> <span class="n">seed_topic_list</span>

        <span class="c1"># Embedding model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">embedding_model</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>

        <span class="c1"># Vectorizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span> <span class="o">=</span> <span class="n">n_gram_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

        <span class="c1"># UMAP or another algorithm that has .fit and .transform functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="n">umap_model</span> <span class="ow">or</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                             <span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                                             <span class="n">low_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">)</span>

        <span class="c1"># HDBSCAN or another clustering algorithm that has .fit and .predict functions and</span>
        <span class="c1"># the .labels_ variable to extract the labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span> <span class="ow">or</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span><span class="p">,</span>
                                                              <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                                              <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
                                                              <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Public attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Private attributes for internal tracking purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic().fit(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings, use it as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                                                                       <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot; Fit the models on a collection of documents, generate topics, and return the docs with topics</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            predictions: Topic predictions for each documents</span>
<span class="sd">            probabilities: The probability of the assigned topic per document.</span>
<span class="sd">                           If `calculate_probabilities` in BERTopic is set to True, then</span>
<span class="sd">                           it calculates the probabilities of all topics across all documents</span>
<span class="sd">                           instead of only the assigned topic. This, however, slows down</span>
<span class="sd">                           computation and may increase memory usage.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings, use it as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span>
                                  <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                                  <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="c1"># Extract embeddings</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                  <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="p">,</span>
                                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transformed documents to Embeddings&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                      <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

        <span class="c1"># Reduce dimensionality</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Cluster reduced embeddings</span>
        <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Sort and Map Topic IDs by their frequency</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Extract topics by calculating c-TF-IDF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Reduce topics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">(</span><span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                  <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; After having fit a model, use transform to predict new instances</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A single document or a list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            predictions: Topic predictions for each documents</span>
<span class="sd">            probabilities: The topic probability distribution which is returned by default.</span>
<span class="sd">                           If `calculate_probabilities` in BERTopic is set to False, then the</span>
<span class="sd">                           probabilities are not calculated to speed up computation and</span>
<span class="sd">                           decrease memory usage.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        topic_model = BERTopic().fit(docs)</span>
<span class="sd">        topics, probs = topic_model.transform(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to use your own embeddings:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>

<span class="sd">        # Create embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">        # Create topic model</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        topics, probs = topic_model.transform(docs, embeddings)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span>
                                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reduced dimensionality&quot;</span><span class="p">)</span>

        <span class="c1"># Extract predictions and probabilities if it is a HDBSCAN model</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">):</span>
            <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">approximate_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>

            <span class="c1"># Calculate probabilities</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">membership_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculated probabilities with HDBSCAN&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicted clusters&quot;</span><span class="p">)</span>

        <span class="c1"># Map probabilities and predictions</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_predictions</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                    <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fit BERTopic on a subset of the data and perform online learning</span>
<span class="sd">        with batch-like data.</span>

<span class="sd">        Online topic modeling in BERTopic is performed by using dimensionality</span>
<span class="sd">        reduction and cluster algorithms that support a `partial_fit` method</span>
<span class="sd">        in order to incrementally train the topic model.</span>

<span class="sd">        Likewise, the `bertopic.vectorizers.OnlineCountVectorizer` is used</span>
<span class="sd">        to dynamically update its vocabulary when presented with new data.</span>
<span class="sd">        It has several parameters for modeling decay and updating the</span>
<span class="sd">        representations.</span>

<span class="sd">        In other words, although the main algorithm stays the same, the training</span>
<span class="sd">        procedure now works as follows:</span>

<span class="sd">        For each subset of the data:</span>

<span class="sd">        1. Generate embeddings with a pre-traing language model</span>
<span class="sd">        2. Incrementally update the dimensionality reduction algorithm with `partial_fit`</span>
<span class="sd">        3. Incrementally update the cluster algorithm with `partial_fit`</span>
<span class="sd">        4. Incrementally update the OnlineCountVectorizer and apply some form of decay</span>

<span class="sd">        Note that it is advised to use `partial_fit` with batches and</span>
<span class="sd">        not single documents for the best performance.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: A list of documents to fit on</span>
<span class="sd">            embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                        instead of the sentence-transformer model</span>
<span class="sd">            y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">               specific instance is specified.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sklearn.cluster import MiniBatchKMeans</span>
<span class="sd">        from sklearn.decomposition import IncrementalPCA</span>
<span class="sd">        from bertopic.vectorizers import OnlineCountVectorizer</span>
<span class="sd">        from bertopic import BERTopic</span>

<span class="sd">        # Prepare documents</span>
<span class="sd">        docs = fetch_20newsgroups(subset=subset,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&quot;data&quot;]</span>

<span class="sd">        # Prepare sub-models that support online learning</span>
<span class="sd">        umap_model = IncrementalPCA(n_components=5)</span>
<span class="sd">        cluster_model = MiniBatchKMeans(n_clusters=50, random_state=0)</span>
<span class="sd">        vectorizer_model = OnlineCountVectorizer(stop_words=&quot;english&quot;, decay=.01)</span>

<span class="sd">        topic_model = BERTopic(umap_model=umap_model,</span>
<span class="sd">                               hdbscan_model=cluster_model,</span>
<span class="sd">                               vectorizer_model=vectorizer_model)</span>

<span class="sd">        # Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="sd">        for index in range(0, len(docs), 1000):</span>
<span class="sd">            topic_model.partial_fit(docs[index: index+1000])</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checks</span>
        <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In order to use `.partial_fit`, the cluster model should have &quot;</span>
                             <span class="s2">&quot;a `.partial_fit` function.&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare documents</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span>
                                  <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                                  <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="c1"># Extract embeddings</span>
        <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                      <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="p">,</span>
                                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                      <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

        <span class="c1"># Reduce dimensionality</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Cluster reduced embeddings</span>
        <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Map and find new topics</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
        <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">new_topic_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_topics</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_new_topics</span><span class="p">(</span><span class="n">new_topic_ids</span><span class="p">)</span>
        <span class="n">updated_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
        <span class="n">updated_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_mappings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_topics</span>

        <span class="c1"># Add missing topics (topics that were originally created but are now missing)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
            <span class="n">missing_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">updated_topics</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">missing_topic</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">missing_topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">missing_topics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Prepare documents</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">updated_topics</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

        <span class="c1"># Update topic representations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">updated_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">updated_words</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">updated_topics</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
                              <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Update topic sizes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sizes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">topic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                         <span class="n">timestamps</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                           <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
                         <span class="n">nr_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">evolution_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Create topics over time</span>

<span class="sd">        To create the topics over time, BERTopic needs to be already fitted once.</span>
<span class="sd">        From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">        each timestamp t. Then, the c-TF-IDF representations at timestamp t are</span>
<span class="sd">        averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">        local representations.</span>

<span class="sd">        NOTE:</span>
<span class="sd">            Make sure to use a limited number of unique timestamps (&lt;100) as the</span>
<span class="sd">            c-TF-IDF representation will be calculated at each single unique timestamp.</span>
<span class="sd">            Having a large number of unique timestamps can take some time to be calculated.</span>
<span class="sd">            Moreover, there aren&#39;t many use-cased where you would like to see the difference</span>
<span class="sd">            in topic representations over more than 100 different timestamps.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            timestamps: The timestamp of each document. This can be either a list of strings or ints.</span>
<span class="sd">                        If it is a list of strings, then the datetime format will be automatically</span>
<span class="sd">                        inferred. If it is a list of ints, then the documents will be ordered by</span>
<span class="sd">                        ascending order.</span>
<span class="sd">            nr_bins: The number of bins you want to create for the timestamps. The left interval will</span>
<span class="sd">                     be chosen as the timestamp. An additional column will be created with the</span>
<span class="sd">                     entire interval.</span>
<span class="sd">            datetime_format: The datetime format of the timestamps if they are strings, eg %d/%m/%Y.</span>
<span class="sd">                             Set this to None if you want to have it automatically detect the format.</span>
<span class="sd">                             See strftime documentation for more information on choices:</span>
<span class="sd">                             https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</span>
<span class="sd">            evolution_tuning: Fine-tune each topic representation at timestamp *t* by averaging its</span>
<span class="sd">                              c-TF-IDF matrix with the c-TF-IDF matrix at timestamp *t-1*. This creates</span>
<span class="sd">                              evolutionary topic representations.</span>
<span class="sd">            global_tuning: Fine-tune each topic representation at timestamp *t* by averaging its c-TF-IDF matrix</span>
<span class="sd">                       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                       topic representations that could not be found in the documents at timestamp *t*.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics_over_time: A dataframe that contains the topic, words, and frequency of topic</span>
<span class="sd">                              at timestamp *t*.</span>

<span class="sd">        Examples:</span>

<span class="sd">        The timestamps variable represent the timestamp of each document. If you have over</span>
<span class="sd">        100 unique timestamps, it is advised to bin the timestamps as shown below:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        topics_over_time = topic_model.topics_over_time(docs, timestamps, nr_bins=20)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">})</span>
        <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">all_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
        <span class="n">all_topics_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_topics</span><span class="p">)}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">infer_datetime_format</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">datetime_format</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">],</span>
                                                     <span class="n">infer_datetime_format</span><span class="o">=</span><span class="n">infer_datetime_format</span><span class="p">,</span>
                                                     <span class="nb">format</span><span class="o">=</span><span class="n">datetime_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nr_bins</span><span class="p">:</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nr_bins</span><span class="p">)</span>
            <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Bins</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Sort documents in chronological order</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">)</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are more than 100 unique timestamps (i.e., </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                          <span class="s2">&quot;which significantly slows down the application. Consider setting `nr_bins` &quot;</span>
                          <span class="s2">&quot;to a value lower than 100 to speed up calculation. &quot;</span><span class="p">)</span>

        <span class="c1"># For each unique timestamp, create topic representations</span>
        <span class="n">topics_over_time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>

            <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span> <span class="o">==</span> <span class="n">timestamp</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
                                                                                    <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
            <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">global_tuning</span> <span class="ow">or</span> <span class="n">evolution_tuning</span><span class="p">:</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Fine-tune the c-TF-IDF matrix at timestamp t by averaging it with the c-TF-IDF</span>
            <span class="c1"># matrix at timestamp t-1</span>
            <span class="k">if</span> <span class="n">evolution_tuning</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                <span class="n">overlapping_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">previous_topics</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_topics</span><span class="p">))))</span>

                <span class="n">current_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>
                <span class="n">previous_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>

                <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">tolil</span><span class="p">()[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c_tf_idf</span><span class="p">[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">+</span>
                                                          <span class="n">previous_c_tf_idf</span><span class="p">[</span><span class="n">previous_overlap_idx</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>

            <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
            <span class="c1"># by simply taking the average of the two</span>
            <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
                <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_topics_indices</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">selected_topics</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="c1"># Extract the words per topic</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Fill dataframe with results</span>
            <span class="n">topics_at_timestamp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">topic</span><span class="p">,</span>
                                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                                    <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                                    <span class="n">timestamp</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="n">topics_over_time</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_timestamp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">evolution_tuning</span><span class="p">:</span>
                <span class="n">previous_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                <span class="n">previous_c_tf_idf</span> <span class="o">=</span> <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Timestamp&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                         <span class="n">classes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                         <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Create topics per class</span>

<span class="sd">        To create the topics per class, BERTopic needs to be already fitted once.</span>
<span class="sd">        From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">        each class c. Then, the c-TF-IDF representations at class c are</span>
<span class="sd">        averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">        local representations. This can be turned off if the pure representation is</span>
<span class="sd">        needed.</span>

<span class="sd">        NOTE:</span>
<span class="sd">            Make sure to use a limited number of unique classes (&lt;100) as the</span>
<span class="sd">            c-TF-IDF representation will be calculated at each single unique class.</span>
<span class="sd">            Having a large number of unique classes can take some time to be calculated.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            classes: The class of each document. This can be either a list of strings or ints.</span>
<span class="sd">            global_tuning: Fine-tune each topic representation at timestamp t by averaging its c-TF-IDF matrix</span>
<span class="sd">                       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                       topic representations that could not be found in the documents at timestamp t.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics_per_class: A dataframe that contains the topic, words, and frequency of topics</span>
<span class="sd">                              for each class.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="n">classes</span><span class="p">})</span>
        <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># For each unique timestamp, create topic representations</span>
        <span class="n">topics_per_class</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classes</span><span class="p">)),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>

            <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Class</span> <span class="o">==</span> <span class="n">class_</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
                                                                                    <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
            <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
            <span class="c1"># by simply taking the average of the two</span>
            <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="c1"># Extract the words per topic</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Fill dataframe with results</span>
            <span class="n">topics_at_class</span> <span class="o">=</span> <span class="p">[(</span><span class="n">topic</span><span class="p">,</span>
                                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                                <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                                <span class="n">class_</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="n">topics_per_class</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_class</span><span class="p">)</span>

        <span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">topics_per_class</span>

    <span class="k">def</span> <span class="nf">hierarchical_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                            <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Create a hierarchy of topics</span>

<span class="sd">        To create this hierarchy, BERTopic needs to be already fitted once.</span>
<span class="sd">        Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF</span>
<span class="sd">        representation using `scipy.cluster.hierarchy.linkage`.</span>

<span class="sd">        Based on that hierarchy, we calculate the topic representation at each</span>
<span class="sd">        merged step. This is a local representation, as we only assume that the</span>
<span class="sd">        chosen step is merged and not all others which typically improves the</span>
<span class="sd">        topic representation.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                            `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">            distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                                `lambda x: 1 - cosine_similarity(x)`</span>

<span class="sd">        Returns:</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                represented by their parents and their children</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        A custom linkage function can be used as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from scipy.cluster import hierarchy as sch</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">        # Hierarchical topics</span>
<span class="sd">        linkage_function = lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs, linkage_function=linkage_function)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">distance_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distance_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">linkage_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Calculate linkage</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">distance_function</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># Calculate basic bag-of-words to be iteratively merged later</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
                                  <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
                                  <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
        <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

        <span class="n">bow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Extract clusters</span>
        <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Parent_Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Topics&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_Name&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_Name&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))):</span>

            <span class="c1"># Find clustered documents</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
            <span class="n">cluster_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)),</span> <span class="s2">&quot;Cluster&quot;</span><span class="p">:</span> <span class="n">clusters</span><span class="p">})</span>
            <span class="n">cluster_df</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Topic&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">nr_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

            <span class="c1"># Extract first topic we find to get the set of topics in a merged topic</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">topic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">clustered_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">clusters</span><span class="p">[</span><span class="n">topic</span><span class="p">]]</span>

            <span class="c1"># Group bow per cluster, calculate c-TF-IDF and extract words</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">bow</span><span class="p">[</span><span class="n">clustered_topics</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
            <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Extract parent&#39;s name and ID</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
            <span class="n">parent_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="mi">5</span><span class="p">])</span>

            <span class="c1"># Extract child&#39;s name and ID</span>
            <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">child_left_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

            <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">child_left_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child_left_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_left_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

            <span class="c1"># Extract child&#39;s name and ID</span>
            <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">child_right_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

            <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">child_right_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child_right_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_right_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

            <span class="c1"># Save results</span>
            <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                                                    <span class="n">clustered_topics</span><span class="p">,</span>
                                                    <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">child_left_name</span><span class="p">,</span>
                                                    <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">child_right_name</span><span class="p">]</span>

        <span class="n">hier_topics</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hier_topics</span>

    <span class="k">def</span> <span class="nf">find_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">search_term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot; Find topics most similar to a search_term</span>

<span class="sd">        Creates an embedding for search_term and compares that with</span>
<span class="sd">        the topic embeddings. The most similar topics are returned</span>
<span class="sd">        along with their similarity values.</span>

<span class="sd">        The search_term can be of any size but since it compares</span>
<span class="sd">        with the topic representation it is advised to keep it</span>
<span class="sd">        below 5 words.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            search_term: the term you want to use to search for topics</span>
<span class="sd">            top_n: the number of topics to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            similar_topics: the most similar topics from high to low</span>
<span class="sd">            similarity: the similarity scores from high to low</span>

<span class="sd">        Examples:</span>

<span class="sd">        You can use the underlying embedding model to find topics that</span>
<span class="sd">        best represent the search term:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics, similarity = topic_model.find_topics(&quot;sports&quot;, top_n=5)</span>
<span class="sd">        ```</span>

<span class="sd">        Note that the search query is typically more accurate if the</span>
<span class="sd">        search_term consists of a phrase or multiple words.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This method can only be used if you did not use custom embeddings.&quot;</span><span class="p">)</span>

        <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># Extract search_term embeddings and compare with topic embeddings</span>
        <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">([</span><span class="n">search_term</span><span class="p">],</span>
                                                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
                                                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">sims</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">search_embedding</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Extract topics most similar to search_term</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sims</span><span class="p">)[</span><span class="o">-</span><span class="n">top_n</span><span class="p">:]</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="p">[</span><span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">similar_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">similar_topics</span><span class="p">,</span> <span class="n">similarity</span>

    <span class="k">def</span> <span class="nf">update_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">ClassTfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates the topic representation by recalculating c-TF-IDF with the new</span>
<span class="sd">        parameters as defined in this function.</span>

<span class="sd">        When you have trained a model and viewed the topics and the words that represent them,</span>
<span class="sd">        you might not be satisfied with the representation. Perhaps you forgot to remove</span>
<span class="sd">        stop_words or you want to try out a different n_gram_range. This function allows you</span>
<span class="sd">        to update the topic representation after they have been formed.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics: A list of topics where each topic is related to a document in `docs`.</span>
<span class="sd">                    Use this variable to change or map the topics.</span>
<span class="sd">                    NOTE: Using a custom list of topic assignments may lead to errors if</span>
<span class="sd">                          topic reduction techniques are used afterwards. Make sure that</span>
<span class="sd">                          manually assigning topics is the last step in the pipeline</span>
<span class="sd">            n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">            vectorizer_model: Pass in your own CountVectorizer from scikit-learn</span>
<span class="sd">            ctfidf_model: Pass in your own c-TF-IDF model to update the representations</span>

<span class="sd">        Examples:</span>

<span class="sd">        In order to update the topic representation, you will need to first fit the topic</span>
<span class="sd">        model and extract topics from them. Based on these, you can update the representation:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.update_topics(docs, n_gram_range=(2, 3))</span>
<span class="sd">        ```</span>

<span class="sd">        You can also use a custom vectorizer to update the representation:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.feature_extraction.text import CountVectorizer</span>
<span class="sd">        vectorizer_model = CountVectorizer(ngram_range=(1, 2), stop_words=&quot;english&quot;)</span>
<span class="sd">        topic_model.update_topics(docs, vectorizer_model=vectorizer_model)</span>
<span class="sd">        ```</span>

<span class="sd">        You can also use this function to change or map the topics to something else.</span>
<span class="sd">        You can update them as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.update_topics(docs, my_updated_topics)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n_gram_range</span><span class="p">:</span>
            <span class="n">n_gram_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="n">n_gram_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)))</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Using a custom list of topic assignments may lead to errors if &quot;</span>
                          <span class="s2">&quot;topic reduction techniques are used afterwards. Make sure that &quot;</span>
                          <span class="s2">&quot;manually assigning topics is the last step in the pipeline.&quot;</span><span class="p">)</span>
        <span class="c1"># Extract words</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topics</span><span class="p">})</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
                              <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot; Return topics with top n words and their c-TF-IDF score</span>

<span class="sd">        Returns:</span>
<span class="sd">            self.topic_representations_: The top n words per topic and the corresponding c-TF-IDF score</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        all_topics = topic_model.get_topics()</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span>

    <span class="k">def</span> <span class="nf">get_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Return top n words for a specific topic and their c-TF-IDF scores</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want its representation</span>

<span class="sd">        Returns:</span>
<span class="sd">            The top n words for a specific word and its respective c-TF-IDF scores</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic = topic_model.get_topic(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_topic_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Get information about each topic including its ID, frequency, and name.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want the frequency</span>

<span class="sd">        Returns:</span>
<span class="sd">            info: The information relating to either a single topic or all topics</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        info_df = topic_model.get_topic_info()</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">topic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_topic_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Return the the size of topics (descending order)</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want the frequency</span>

<span class="sd">        Returns:</span>
<span class="sd">            Either the frequency of a single topic or dataframe with</span>
<span class="sd">            the frequencies of all topics</span>

<span class="sd">        Examples:</span>

<span class="sd">        To extract the frequency of all topics:</span>

<span class="sd">        ```python</span>
<span class="sd">        frequency = topic_model.get_topic_freq()</span>
<span class="sd">        ```</span>

<span class="sd">        To get the frequency of a single topic:</span>

<span class="sd">        ```python</span>
<span class="sd">        frequency = topic_model.get_topic_freq(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Topic&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
                                                                                                   <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Extract representative documents per topic</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic: A specific topic for which you want</span>
<span class="sd">                   the representative documents</span>

<span class="sd">        Returns:</span>
<span class="sd">            Representative documents of the chosen topic</span>

<span class="sd">        Examples:</span>

<span class="sd">        To extract the representative docs of all topics:</span>

<span class="sd">        ```python</span>
<span class="sd">        representative_docs = topic_model.get_representative_docs()</span>
<span class="sd">        ```</span>

<span class="sd">        To get the representative docs of a single topic:</span>

<span class="sd">        ```python</span>
<span class="sd">        representative_docs = topic_model.get_representative_docs(12)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_topic_tree</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                       <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">tight_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Extract the topic tree such that it can be printed</span>

<span class="sd">        Arguments:</span>
<span class="sd">            hier_topics: A dataframe containing the structure of the topic tree.</span>
<span class="sd">                        This is the output of `topic_model.hierachical_topics()`</span>
<span class="sd">            max_distance: The maximum distance between two topics. This value is</span>
<span class="sd">                        based on the Distance column in `hier_topics`.</span>
<span class="sd">            tight_layout: Whether to use a tight layout (narrow width) for</span>
<span class="sd">                        easier readability if you have hundreds of topics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tree that has the following structure when printed:</span>
<span class="sd">                .</span>
<span class="sd">                .</span>
<span class="sd">                health_medical_disease_patients_hiv</span>
<span class="sd">                    patients_medical_disease_candida_health</span>
<span class="sd">                        candida_yeast_infection_gonorrhea_infections  Topic: 48</span>
<span class="sd">                        patients_disease_cancer_medical_doctor</span>
<span class="sd">                             hiv_medical_cancer_patients_doctor  Topic: 34</span>
<span class="sd">                             pain_drug_patients_disease_diet  Topic: 26</span>
<span class="sd">                    health_newsgroup_tobacco_vote_votes  Topic: 9</span>

<span class="sd">            The blocks () indicate that the topic is one you can directly access</span>
<span class="sd">            from `topic_model.get_topic`. In other words, they are the original un-grouped topics.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        # Train model</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        topic_model = BERTopic()</span>
<span class="sd">        topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Print topic tree</span>
<span class="sd">        tree = topic_model.get_topic_tree(hierarchical_topics)</span>
<span class="sd">        print(tree)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">tight_layout</span> <span class="k">else</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">max_original_topic</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Extract mapping from ID to name</span>
        <span class="n">topic_to_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_Name</span><span class="p">))</span>
        <span class="n">topic_to_name</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_Name</span><span class="p">)))</span>
        <span class="n">topic_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">name</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Create tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Parent_ID</span><span class="p">):</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()}</span>

        <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Based on: https://stackoverflow.com/a/51920869/10532563 &quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">grandpa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

                <span class="c1"># Get distance between merged topics</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="o">|</span>
                                           <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span><span class="p">]</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">10</span>

                <span class="k">if</span> <span class="n">parent</span> <span class="o">!=</span> <span class="n">start</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grandpa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_original_topic</span><span class="p">:</span>

                            <span class="c1"># Do not append topic ID if they are not merged</span>
                            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">:</span>
                                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  Topic: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;O </span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">to_print</span>

                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

                <span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

                <span class="k">return</span> <span class="n">to_print</span>

            <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">to_print</span>

        <span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Set custom topic labels in your fitted BERTopic model</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_labels: If a list of topic labels, it should contain the same number</span>
<span class="sd">                        of labels as there are topics. This must be ordered</span>
<span class="sd">                        from the topic with the lowest ID to the highest ID,</span>
<span class="sd">                        including topic -1 if it exists.</span>
<span class="sd">                        If a dictionary of `topic ID`: `topic_label`, it can have</span>
<span class="sd">                        any number of topics as it will only map the topics found</span>
<span class="sd">                        in the dictionary.</span>

<span class="sd">        Examples:</span>

<span class="sd">        First, we define our topic labels with `.get_topic_labels` in which</span>
<span class="sd">        we can customize our topic labels:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_labels = topic_model.get_topic_labels(nr_words=2,</span>
<span class="sd">                                                    topic_prefix=True,</span>
<span class="sd">                                                    word_length=10,</span>
<span class="sd">                                                    separator=&quot;, &quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Then, we pass these `topic_labels` to our topic model which</span>
<span class="sd">        can be accessed at any time with `.custom_labels_`:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.set_topic_labels(topic_labels)</span>
<span class="sd">        topic_model.custom_labels_</span>
<span class="sd">        ```</span>

<span class="sd">        You might want to change only a few topic labels instead of all of them.</span>
<span class="sd">        To do so, you can pass a dictionary where the keys are the topic IDs and</span>
<span class="sd">        its keys the topic labels:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.set_topic_labels({0: &quot;Space&quot;, 1: &quot;Sports&quot;, 2: &quot;Medicine&quot;})</span>
<span class="sd">        topic_model.custom_labels_</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">original_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
                <span class="n">original_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span>
            <span class="n">custom_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">else</span> <span class="n">original_labels</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">):</span>
                <span class="n">custom_labels</span> <span class="o">=</span> <span class="n">topic_labels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure that `topic_labels` contains the same number &quot;</span>
                                 <span class="s2">&quot;of labels as that there are topics.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="n">custom_labels</span>

    <span class="k">def</span> <span class="nf">generate_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">nr_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                              <span class="n">topic_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">word_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Get labels for each topic in a user-defined format</span>

<span class="sd">        Arguments:</span>
<span class="sd">            original_labels:</span>
<span class="sd">            nr_words: Top `n` words per topic to use</span>
<span class="sd">            topic_prefix: Whether to use the topic ID as a prefix.</span>
<span class="sd">                        If set to True, the topic ID will be separated</span>
<span class="sd">                        using the `separator`</span>
<span class="sd">            word_length: The maximum length of each word in the topic label.</span>
<span class="sd">                        Some words might be relatively long and setting this</span>
<span class="sd">                        value helps to make sure that all labels have relatively</span>
<span class="sd">                        similar lengths.</span>
<span class="sd">            separator: The string with which the words and topic prefix will be</span>
<span class="sd">                    separated. Underscores are the default but a nice alternative</span>
<span class="sd">                    is `&quot;, &quot;`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            topic_labels: A list of topic labels sorted from the lowest topic ID to the highest.</span>
<span class="sd">                        If the topic model was trained using HDBSCAN, the lowest topic ID is -1,</span>
<span class="sd">                        otherwise it is 0.</span>

<span class="sd">        Examples:</span>

<span class="sd">        To create our custom topic labels, usage is rather straightforward:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_labels = topic_model.get_topic_labels(nr_words=2, separator=&quot;, &quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

        <span class="n">topic_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">:</span>
            <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">word_length</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[:</span><span class="n">word_length</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">][:</span><span class="n">nr_words</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)[:</span><span class="n">nr_words</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">topic_prefix</span><span class="p">:</span>
                <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}{</span><span class="n">separator</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_label</span> <span class="o">=</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

            <span class="n">topic_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">topic_labels</span>

    <span class="k">def</span> <span class="nf">merge_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                     <span class="n">topics_to_merge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics_to_merge: Either a list of topics or a list of list of topics</span>
<span class="sd">                            to merge. For example:</span>
<span class="sd">                                [1, 2, 3] will merge topics 1, 2 and 3</span>
<span class="sd">                                [[1, 2], [3, 4]] will merge topics 1 and 2, and</span>
<span class="sd">                                separately merge topics 3 and 4.</span>

<span class="sd">        Examples:</span>

<span class="sd">        If you want to merge topics 1, 2, and 3:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_to_merge = [1, 2, 3]</span>
<span class="sd">        topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you want to merge topics 1 and 2, and separately</span>
<span class="sd">        merge topics 3 and 4:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_to_merge = [[1, 2]</span>
<span class="sd">                            [3, 4]]</span>
<span class="sd">        topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic_group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_group</span><span class="p">:</span>
                    <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure that `topics_to_merge` is either&quot;</span>
                             <span class="s2">&quot;a list of topics or a list of list of topics.&quot;</span><span class="p">)</span>

        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">nr_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Further reduce the number of topics to nr_topics.</span>

<span class="sd">        The number of topics is further reduced by calculating the c-TF-IDF matrix</span>
<span class="sd">        of the documents and then reducing them by iteratively merging the least</span>
<span class="sd">        frequent topic with the most similar one based on their c-TF-IDF matrices.</span>
<span class="sd">        The topics, their sizes, and representations are updated.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The docs you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            nr_topics: The number of topics you want reduced to</span>

<span class="sd">        Updates:</span>
<span class="sd">            topics_ : Assigns topics to their merged representations.</span>
<span class="sd">            probabilities_ : Assigns probabilities to their merged representations.</span>

<span class="sd">        Examples:</span>

<span class="sd">        You can further reduce the topics by passing the documents with its</span>
<span class="sd">        topics and probabilities (if they were calculated):</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.reduce_topics(docs, nr_topics=30)</span>
<span class="sd">        ```</span>

<span class="sd">        You can then access the updated topics and probabilities with:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics = topic_model.topics_</span>
<span class="sd">        probabilities = topic_model.probabilities_</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

        <span class="c1"># Reduce number of topics</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">()</span>

        <span class="c1"># Map probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
                         <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize topics, their sizes, and their corresponding words</span>

<span class="sd">        This visualization is highly inspired by LDAvis, a great visualization</span>
<span class="sd">        technique typically reserved for LDA.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_topics()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                         <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                            <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">sample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
                            <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize documents and their topics in 2D</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model: A fitted BERTopic instance.</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">                    Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                    For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                    `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">            embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">            reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">            sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                    Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                    0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                    millions of documents as a subset is chosen.</span>
<span class="sd">            hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">            hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                                specific points. Helps to speed up generation of visualization.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_documents(docs)</span>
<span class="sd">        ```</span>

<span class="sd">        Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">        The advised and prefered pipeline for using this function is as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from umap import UMAP</span>

<span class="sd">        # Prepare embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">        # Train BERTopic</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>

<span class="sd">        # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">        # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">        # Run the visualization with the original embeddings</span>
<span class="sd">        topic_model.visualize_documents(docs, embeddings=embeddings)</span>

<span class="sd">        # Or, if you have reduced the original embeddings already:</span>
<span class="sd">        topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        &lt;iframe src=&quot;../../getting_started/visualization/documents.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 800px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
                                            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                                            <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
                                            <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                            <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
                                            <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
                                            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_hierarchical_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                         <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                         <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">sample</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                         <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                         <span class="n">nr_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                         <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                         <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
                                         <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize documents and their topics in 2D at different levels of hierarchy</span>

<span class="sd">        Arguments:</span>
<span class="sd">            docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                represented by their parents and their children</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">                    Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                    For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                    `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">            embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">            reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">            sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                    Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                    0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                    millions of documents as a subset is chosen.</span>
<span class="sd">            hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">            hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                                specific points. Helps to speed up generation of visualizations.</span>
<span class="sd">            nr_levels: The number of levels to be visualized in the hierarchy. First, the distances</span>
<span class="sd">                    in `hierarchical_topics.Distance` are split in `nr_levels` lists of distances with</span>
<span class="sd">                    equal length. Then, for each list of distances, the merged topics are selected that</span>
<span class="sd">                    have a distance less or equal to the maximum distance of the selected list of distances.</span>
<span class="sd">                    NOTE: To get all possible merged steps, make sure that `nr_levels` is equal to</span>
<span class="sd">                    the length of `hierarchical_topics`.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">                           NOTE: Custom labels are only generated for the original</span>
<span class="sd">                           un-merged topics.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics)</span>
<span class="sd">        ```</span>

<span class="sd">        Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">        The advised and prefered pipeline for using this function is as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">        from sentence_transformers import SentenceTransformer</span>
<span class="sd">        from bertopic import BERTopic</span>
<span class="sd">        from umap import UMAP</span>

<span class="sd">        # Prepare embeddings</span>
<span class="sd">        docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">        sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">        # Train BERTopic and extract hierarchical topics</span>
<span class="sd">        topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">        # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">        # Run the visualization with the original embeddings</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, embeddings=embeddings)</span>

<span class="sd">        # Or, if you have reduced the original embeddings already:</span>
<span class="sd">        topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        &lt;iframe src=&quot;../../getting_started/visualization/hierarchical_documents.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 770px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                         <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
                                                         <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
                                                         <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                                         <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                                                         <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
                                                         <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                                         <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
                                                         <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
                                                         <span class="n">nr_levels</span><span class="o">=</span><span class="n">nr_levels</span><span class="p">,</span>
                                                         <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_term_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">log_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                            <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize the ranks of all terms across all topics</span>

<span class="sd">        Each topic is represented by a set of words. These words, however,</span>
<span class="sd">        do not all equally represent the topic. This visualization shows</span>
<span class="sd">        how many words are needed to represent a topic and at which point</span>
<span class="sd">        the beneficial effect of adding words starts to decline.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize. These will be colored</span>
<span class="sd">                    red where all others will be colored black.</span>
<span class="sd">            log_scale: Whether to represent the ranking on a log scale</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the ranks of all words across</span>
<span class="sd">        all topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_term_rank()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_term_rank()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Reference:</span>

<span class="sd">        This visualization was heavily inspired by the</span>
<span class="sd">        &quot;Term Probability Decline&quot; visualization found in an</span>
<span class="sd">        analysis by the amazing [tmtoolkit](https://tmtoolkit.readthedocs.io/).</span>
<span class="sd">        Reference to that specific analysis can be found</span>
<span class="sd">        [here](https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                            <span class="n">log_scale</span><span class="o">=</span><span class="n">log_scale</span><span class="p">,</span>
                                            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">topics_over_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                   <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
                                   <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">450</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize topics over time</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics_over_time: The topics you would like to be visualized with the</span>
<span class="sd">                              corresponding topic representation</span>
<span class="sd">            top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">            topics: Select which topics you would like to be visualized</span>
<span class="sd">            normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A plotly.graph_objects.Figure including all traces</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the topics over time, simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_over_time = topic_model.topics_over_time(docs, timestamps)</span>
<span class="sd">        topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                   <span class="n">topics_over_time</span><span class="o">=</span><span class="n">topics_over_time</span><span class="p">,</span>
                                                   <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                                   <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                                   <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
                                                   <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                                   <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                                   <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">topics_per_class</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                   <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                   <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
                                   <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">900</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize topics per class</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics_per_class: The topics you would like to be visualized with the</span>
<span class="sd">                              corresponding topic representation</span>
<span class="sd">            top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">            topics: Select which topics you would like to be visualized</span>
<span class="sd">            normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A plotly.graph_objects.Figure including all traces</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the topics per class, simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">        topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                   <span class="n">topics_per_class</span><span class="o">=</span><span class="n">topics_per_class</span><span class="p">,</span>
                                                   <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                                   <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                                   <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
                                                   <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                                   <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                                   <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                               <span class="n">min_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">,</span>
                               <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                               <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize the distribution of topic probabilities</span>

<span class="sd">        Arguments:</span>
<span class="sd">            probabilities: An array of probability scores</span>
<span class="sd">            min_probability: The minimum probability score to visualize.</span>
<span class="sd">                             All others are ignored.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                           `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Examples:</span>

<span class="sd">        Make sure to fit the model before and only input the</span>
<span class="sd">        probabilities of a single document:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">probabilities</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span>
                                               <span class="n">min_probability</span><span class="o">=</span><span class="n">min_probability</span><span class="p">,</span>
                                               <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                               <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                               <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                            <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                            <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
                            <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">color_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize a hierarchical structure of the topics</span>

<span class="sd">        A ward linkage function is used to perform the</span>
<span class="sd">        hierarchical clustering based on the cosine distance</span>
<span class="sd">        matrix between topic embeddings.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topic_model: A fitted BERTopic instance.</span>
<span class="sd">            orientation: The orientation of the figure.</span>
<span class="sd">                        Either &#39;left&#39; or &#39;bottom&#39;</span>
<span class="sd">            topics: A selection of topics to visualize</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">                       NOTE: Custom labels are only generated for the original</span>
<span class="sd">                       un-merged topics.</span>
<span class="sd">            width: The width of the figure. Only works if orientation is set to &#39;left&#39;</span>
<span class="sd">            height: The height of the figure. Only works if orientation is set to &#39;bottom&#39;</span>
<span class="sd">            hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                                represented by their parents and their children.</span>
<span class="sd">                                NOTE: The hierarchical topic names are only visualized</span>
<span class="sd">                                if both `topics` and `top_n_topics` are not set.</span>
<span class="sd">            linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                            `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">                            NOTE: Make sure to use the same `linkage_function` as used</span>
<span class="sd">                            in `topic_model.hierarchical_topics`.</span>
<span class="sd">            distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                            `lambda x: 1 - cosine_similarity(x)`</span>
<span class="sd">                            NOTE: Make sure to use the same `distance_function` as used</span>
<span class="sd">                            in `topic_model.hierarchical_topics`.</span>
<span class="sd">            color_threshold: Value at which the separation of clusters will be made which</span>
<span class="sd">                         will result in different colors for different clusters.</span>
<span class="sd">                         A higher value will typically lead in less colored clusters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the hierarchical structure of</span>
<span class="sd">        topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_hierarchy()</span>
<span class="sd">        ```</span>

<span class="sd">        If you also want the labels visualized of hierarchical topics,</span>
<span class="sd">        run the following:</span>

<span class="sd">        ```python</span>
<span class="sd">        # Extract hierarchical topics and their representations</span>
<span class="sd">        hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">        # Visualize these representations</span>
<span class="sd">        topic_model.visualize_hierarchy(hierarchical_topics=hierarchical_topics)</span>
<span class="sd">        ```</span>

<span class="sd">        If you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_hierarchy()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &lt;iframe src=&quot;../../getting_started/visualization/hierarchy.html&quot;</span>
<span class="sd">        style=&quot;width:1000px; height: 680px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                                            <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                            <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                            <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                            <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
                                            <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">,</span>
                                            <span class="n">distance_function</span><span class="o">=</span><span class="n">distance_function</span><span class="p">,</span>
                                            <span class="n">color_threshold</span><span class="o">=</span><span class="n">color_threshold</span>
                                            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                          <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize a heatmap of the topic&#39;s similarity matrix</span>

<span class="sd">        Based on the cosine similarity matrix between topic embeddings,</span>
<span class="sd">        a heatmap is created showing the similarity between topics.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">            n_clusters: Create n clusters and order the similarity</span>
<span class="sd">                        matrix by those clusters.</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            width: The width of the figure.</span>
<span class="sd">            height: The height of the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the similarity matrix of</span>
<span class="sd">        topics simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_heatmap()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_heatmap()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                          <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                          <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                          <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
                                          <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                          <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                          <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_barchart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
                           <span class="n">n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                           <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Topic Word Scores&quot;</span><span class="p">,</span>
                           <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
                           <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Visualize a barchart of selected topics</span>

<span class="sd">        Arguments:</span>
<span class="sd">            topics: A selection of topics to visualize.</span>
<span class="sd">            top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">            n_words: Number of words to show in a topic</span>
<span class="sd">            custom_labels: Whether to use custom topic labels that were defined using </span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">            title: Title of the plot.</span>
<span class="sd">            width: The width of each figure.</span>
<span class="sd">            height: The height of each figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig: A plotly figure</span>

<span class="sd">        Examples:</span>

<span class="sd">        To visualize the barchart of selected topics</span>
<span class="sd">        simply run:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.visualize_barchart()</span>
<span class="sd">        ```</span>

<span class="sd">        Or if you want to save the resulting figure:</span>

<span class="sd">        ```python</span>
<span class="sd">        fig = topic_model.visualize_barchart()</span>
<span class="sd">        fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                           <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                           <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                           <span class="n">n_words</span><span class="o">=</span><span class="n">n_words</span><span class="p">,</span>
                                           <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                           <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                           <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                           <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">save_embedding_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Saves the model to the specified path</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: the location and name of the file you want to save</span>
<span class="sd">            save_embedding_model: Whether to save the embedding model in this class</span>
<span class="sd">                                  as you might have selected a local model or one that</span>
<span class="sd">                                  is downloaded automatically from the cloud.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.save(&quot;my_model&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you do not want the embedding_model to be saved locally:</span>

<span class="sd">        ```python</span>
<span class="sd">        topic_model.save(&quot;my_model&quot;, save_embedding_model=False)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

            <span class="c1"># This prevents the vectorizer from being too large in size if `min_df` was</span>
            <span class="c1"># set to a value higher than 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">stop_words_</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
                <span class="n">embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
             <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads the model from the specified path</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: the location and name of the BERTopic file you want to load</span>
<span class="sd">            embedding_model: If the embedding_model was not saved to save space or to load</span>
<span class="sd">                             it in from the cloud, you can load it in by specifying it here.</span>

<span class="sd">        Examples:</span>

<span class="sd">        ```python</span>
<span class="sd">        BERTopic.load(&quot;my_model&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        or if you did not save the embedding model:</span>

<span class="sd">        ```python</span>
<span class="sd">        BERTopic.load(&quot;my_model&quot;, embedding_model=&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">embedding_model</span><span class="p">:</span>
                <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">topic_model</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Get parameters for this estimator.</span>

<span class="sd">        Adapted from:</span>
<span class="sd">            https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>

<span class="sd">        Arguments:</span>
<span class="sd">            deep: bool, default=True</span>
<span class="sd">                  If True, will return the parameters for this estimator and</span>
<span class="sd">                  contained subobjects that are estimators.</span>

<span class="sd">        Returns:</span>
<span class="sd">            out: Parameter names mapped to their values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_names</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;get_params&#39;</span><span class="p">):</span>
                <span class="n">deep_items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">deep_items</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_extract_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
                            <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Extract sentence/document embeddings through pre-trained embeddings</span>
<span class="sd">        For an overview of pre-trained models: https://www.sbert.net/docs/pretrained_models.html</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            method: Whether to extract document or word-embeddings, options are &quot;document&quot; and &quot;word&quot;</span>
<span class="sd">            verbose: Whether to show a progressbar demonstrating the time to extract embeddings</span>

<span class="sd">        Returns:</span>
<span class="sd">            embeddings: The extracted embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_words</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;document&quot;</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong method for extracting document/word embeddings. &quot;</span>
                             <span class="s2">&quot;Either choose &#39;word&#39; or &#39;document&#39; as the method. &quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_map_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Map predictions to the correct topics if topics were reduced &quot;&quot;&quot;</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">(</span><span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mapped_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">mappings</span><span class="p">[</span><span class="n">prediction</span><span class="p">]</span>
                              <span class="k">if</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">mappings</span>
                              <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
                              <span class="k">for</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mapped_predictions</span>

    <span class="k">def</span> <span class="nf">_reduce_dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">embeddings</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">csr_matrix</span><span class="p">],</span>
                               <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Reduce dimensionality of embeddings using UMAP and train a UMAP model</span>

<span class="sd">        Arguments:</span>
<span class="sd">            embeddings: The extracted embeddings using the sentence transformer module.</span>
<span class="sd">            y: The target class for (semi)-supervised dimensionality reduction</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>

<span class="sd">        Returns:</span>
<span class="sd">            umap_embeddings: The reduced embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Partial fit</span>
        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Regular fit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The dimensionality reduction algorithm did not contain the `y` parameter and&quot;</span>
                            <span class="s2">&quot; therefore the `y` parameter was not used&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reduced dimensionality&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cluster_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">umap_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                            <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Cluster UMAP embeddings with HDBSCAN</span>

<span class="sd">        Arguments:</span>
<span class="sd">            umap_embeddings: The reduced sentence embeddings with UMAP</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and their corresponding IDs</span>
<span class="sd">                       and newly added Topics</span>
<span class="sd">            probabilities: The distribution of probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">labels_</span>
            <span class="n">documents</span><span class="p">[</span><span class="s1">&#39;Topic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">labels_</span>
            <span class="n">documents</span><span class="p">[</span><span class="s1">&#39;Topic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Some algorithms have outlier labels (-1) that can be tricky to work</span>
        <span class="c1"># with if you are slicing data based on that labels. Therefore, we</span>
        <span class="c1"># track if there are outlier labels and act accordingly when slicing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Save representative docs and calculate probabilities if it is a HDBSCAN model</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">):</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">probabilities_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_representative_docs</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">all_points_membership_vectors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clustered reduced embeddings&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">_guided_topic_modeling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Apply Guided Topic Modeling</span>

<span class="sd">        We transform the seeded topics to embeddings using the</span>
<span class="sd">        same embedder as used for generating document embeddings.</span>

<span class="sd">        Then, we apply cosine similarity between the embeddings</span>
<span class="sd">        and set labels for documents that are more similar to</span>
<span class="sd">        one of the topics, then the average document.</span>

<span class="sd">        If a document is more similar to the average document</span>
<span class="sd">        than any of the topics, it gets the -1 label and is</span>
<span class="sd">        thereby not included in UMAP.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            embeddings: The document embeddings</span>

<span class="sd">        Returns</span>
<span class="sd">            y: The labels for each seeded topic</span>
<span class="sd">            embeddings: Updated embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create embeddings from the seeded topics</span>
        <span class="n">seed_topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seed_topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">seed_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span><span class="p">]</span>
        <span class="n">seed_topic_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">seed_topic_embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">seed_topic_embeddings</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)])</span>

        <span class="c1"># Label documents that are most similar to one of the seeded topics</span>
        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">seed_topic_embeddings</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sim_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>

        <span class="c1"># Average the document embeddings related to the seeded topics with the</span>
        <span class="c1"># embedding of the seeded topic to force the documents in a cluster</span>
        <span class="k">for</span> <span class="n">seed_topic</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seed_topic_list</span><span class="p">)):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="n">seed_topic</span><span class="p">]</span>
            <span class="n">embeddings</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">embeddings</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">seed_topic_embeddings</span><span class="p">[</span><span class="n">seed_topic</span><span class="p">]],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_extract_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract topics from the clusters using a class-based TF-IDF</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            c_tf_idf: The resulting matrix giving a value (importance score) for each word per topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
                              <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_save_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Save the most representative docs (3) per topic</span>

<span class="sd">        The most representative docs are extracted by taking</span>
<span class="sd">        the exemplars from the HDBSCAN-generated clusters.</span>

<span class="sd">        Full instructions can be found here:</span>
<span class="sd">            https://hdbscan.readthedocs.io/en/latest/soft_clustering_explanation.html</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare the condensed tree and luf clusters beneath a given cluster</span>
        <span class="n">condensed_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">condensed_tree_</span>
        <span class="n">raw_tree</span> <span class="o">=</span> <span class="n">condensed_tree</span><span class="o">.</span><span class="n">_raw_tree</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">condensed_tree</span><span class="o">.</span><span class="n">_select_clusters</span><span class="p">())</span>
        <span class="n">cluster_tree</span> <span class="o">=</span> <span class="n">raw_tree</span><span class="p">[</span><span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;child_size&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1">#  Find the points with maximum lambda value in each leaf</span>
        <span class="n">representative_docs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">[</span><span class="s1">&#39;Topic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">leaves</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">_recurse_leaf_dfs</span><span class="p">(</span><span class="n">cluster_tree</span><span class="p">,</span> <span class="n">clusters</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
                    <span class="n">max_lambda</span> <span class="o">=</span> <span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;lambda_val&#39;</span><span class="p">][</span><span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">leaf</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">][(</span><span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">leaf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">raw_tree</span><span class="p">[</span><span class="s1">&#39;lambda_val&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_lambda</span><span class="p">)]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">result</span><span class="p">,</span> <span class="n">points</span><span class="p">))</span>

                <span class="n">representative_docs</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

        <span class="c1"># Convert indices to documents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span><span class="o">.</span><span class="n">Document</span> <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">doc_ids</span> <span class="ow">in</span>
                                     <span class="n">representative_docs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_map_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Map the representative docs per topic to the correct topics</span>

<span class="sd">        If topics were reduced, remove documents from topics that were</span>
<span class="sd">        merged into larger topics as we assume that the documents from</span>
<span class="sd">        larger topics are better representative of the entire merged</span>
<span class="sd">        topic.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            original_topics: Whether we want to map from the</span>
<span class="sd">                             original topics to the most recent topics</span>
<span class="sd">                             or from the second-most recent topics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">):</span>
            <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">(</span><span class="n">original_topics</span><span class="p">)</span>
            <span class="n">representative_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Update the representative documents</span>
            <span class="n">updated_representative_docs</span> <span class="o">=</span> <span class="p">{</span><span class="n">mappings</span><span class="p">[</span><span class="n">old_topic</span><span class="p">]:</span> <span class="p">[]</span>
                                           <span class="k">for</span> <span class="n">old_topic</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">representative_docs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">old_topic</span><span class="p">,</span> <span class="n">docs</span> <span class="ow">in</span> <span class="n">representative_docs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">new_topic</span> <span class="o">=</span> <span class="n">mappings</span><span class="p">[</span><span class="n">old_topic</span><span class="p">]</span>
                <span class="n">updated_representative_docs</span><span class="p">[</span><span class="n">new_topic</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="n">updated_representative_docs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_topic_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates embeddings per topics based on their topic representation</span>

<span class="sd">        We start by creating embeddings out of the topic representation. This</span>
<span class="sd">        results in a number of embeddings per topic. Then, we take the weighted</span>
<span class="sd">        average of embeddings in a topic by their c-TF-IDF score. This will put</span>
<span class="sd">        more emphasis to words that represent a topic best.</span>

<span class="sd">        Only allow topic vectors to be created if there are no custom embeddings and therefore</span>
<span class="sd">        a sentence-transformer model to be used or there are custom embeddings but it is allowed</span>
<span class="sd">        to use a different multi-lingual sentence-transformer model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span>

            <span class="c1"># Extract embeddings for all words in all topics</span>
            <span class="n">topic_words</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_list</span><span class="p">]</span>
            <span class="n">topic_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_words</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">topic</span><span class="p">]</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">topic_words</span><span class="p">,</span>
                                                  <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Take the weighted average of word embeddings in a topic based on their c-TF-IDF value</span>
            <span class="c1"># The embeddings var is a single numpy matrix and therefore slicing is necessary to</span>
            <span class="c1"># access the words per topic</span>
            <span class="n">topic_embeddings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">topic_list</span><span class="p">):</span>
                <span class="n">word_importance</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">word_importance</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)))]</span>
                <span class="n">topic_embedding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">n</span><span class="p">)],</span> <span class="n">weights</span><span class="o">=</span><span class="n">word_importance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">topic_embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_embedding</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="n">topic_embeddings</span>

    <span class="k">def</span> <span class="nf">_c_tf_idf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">documents_per_topic</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                  <span class="n">fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">partial_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">csr_matrix</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot; Calculate a class-based TF-IDF where m is the number of total documents.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents_per_topic: The joined documents per topic such that each topic has a single</span>
<span class="sd">                                 string made out of multiple documents</span>
<span class="sd">            m: The total number of documents (unjoined)</span>
<span class="sd">            fit: Whether to fit a new vectorizer or use the fitted self.vectorizer_model</span>
<span class="sd">            partial_fit: Whether to run `partial_fit` for online learning</span>

<span class="sd">        Returns:</span>
<span class="sd">            tf_idf: The resulting matrix giving a value (importance score) for each word per topic</span>
<span class="sd">            words: The names of the words to which values were given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">partial_fit</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="o">.</span><span class="n">update_bow</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
        <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span><span class="p">:</span>
            <span class="n">seed_topic_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed</span> <span class="k">for</span> <span class="n">seeds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">seed_topic_list</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="n">multiplier</span><span class="p">)</span>

        <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span>

    <span class="k">def</span> <span class="nf">_update_topic_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the topic sizes</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Updated dataframe with documents and their corresponding IDs and newly added Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Document&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sizes</span><span class="o">.</span><span class="n">Topic</span><span class="p">,</span> <span class="n">sizes</span><span class="o">.</span><span class="n">Document</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_extract_words_per_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                 <span class="n">c_tf_idf</span><span class="p">:</span> <span class="n">csr_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>
                                                                      <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot; Based on tf_idf scores per topic, extract the top n words per topic</span>

<span class="sd">        If the top words per topic need to be extracted, then only the `words` parameter</span>
<span class="sd">        needs to be passed. If the top words per topic in a specific timestamp, then it</span>
<span class="sd">        is important to pass the timestamp-based c-TF-IDF matrix and its corresponding</span>
<span class="sd">        labels.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            words: List of all words (sorted according to tf_idf matrix position)</span>
<span class="sd">            c_tf_idf: A c-TF-IDF matrix from which to calculate the top words</span>
<span class="sd">            labels: A list of topic labels</span>

<span class="sd">        Returns:</span>
<span class="sd">            topics: The top words per topic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">c_tf_idf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span>

        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="c1"># Get the top 30 indices and values per row in a sparse c-TF-IDF matrix</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_n_idx_sparse</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_n_values_sparse</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get top 30 words per topic based on c-TF-IDF score</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="p">[(</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">],</span> <span class="n">score</span><span class="p">)</span>
                          <span class="k">if</span> <span class="n">word_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span>
                          <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">word_index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scores</span><span class="p">[</span><span class="n">index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                          <span class="p">]</span>
                  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>

        <span class="c1"># Extract word embeddings for the top 30 words per topic and compare it</span>
        <span class="c1"># with the topic embedding to keep only the words most similar to the topic embedding</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diversity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">topic_words</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">topic_words</span><span class="p">]</span>
                    <span class="n">word_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">words</span><span class="p">,</span>
                                                               <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
                                                               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">topic_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">),</span>
                                                               <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
                                                               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">topic_words</span> <span class="o">=</span> <span class="n">mmr</span><span class="p">(</span><span class="n">topic_embedding</span><span class="p">,</span> <span class="n">word_embeddings</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span>
                                      <span class="n">top_n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">,</span> <span class="n">diversity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diversity</span><span class="p">)</span>
                    <span class="n">topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">topic_words</span><span class="p">]</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">values</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">topics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">topics</span>

    <span class="k">def</span> <span class="nf">_reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Reduce topics to self.nr_topics</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">initial_nr_topics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topics</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">&lt;</span> <span class="n">initial_nr_topics</span><span class="p">:</span>
                <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_to_n_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nr_topics needs to be an int or &#39;auto&#39;! &quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced number of topics from </span><span class="si">{</span><span class="n">initial_nr_topics</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_reduce_to_n_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Reduce topics to self.nr_topics</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Track which topics where originally merged</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create topic similarity matrix</span>
        <span class="n">similarities</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">similarities</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Find most similar topic to least common topic</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span>
            <span class="n">topic_to_merge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Topic</span>
            <span class="n">topic_to_merge_into</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">similarities</span><span class="p">[</span><span class="n">topic_to_merge</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
            <span class="n">similarities</span><span class="p">[:,</span> <span class="n">topic_to_merge</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_to_merge</span><span class="p">)</span>

            <span class="c1"># Update Topic labels</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic_to_merge</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_to_merge_into</span>
            <span class="n">mapped_topics</span><span class="p">[</span><span class="n">topic_to_merge</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_to_merge_into</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Map topics</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">from_topic</span><span class="p">:</span> <span class="n">to_topic</span> <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span>

        <span class="c1"># Update representations</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_auto_reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Reduce the number of topics automatically using HDBSCAN</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the reduced number of Topics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:]</span>
        <span class="n">max_topic</span> <span class="o">=</span> <span class="n">unique_topics</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Find similar topics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">norm_data</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">norm_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:])</span>

        <span class="c1"># Map similar topics</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">unique_topics</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span> <span class="n">prediction</span> <span class="o">+</span> <span class="n">max_topic</span>
                         <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">prediction</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">mapped_topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">from_topic</span><span class="p">:</span> <span class="n">to_topic</span> <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>

        <span class="c1"># Update documents and topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapped_topics</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_sort_mappings_by_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Reorder mappings by their frequency.</span>

<span class="sd">        For example, if topic 88 was mapped to topic</span>
<span class="sd">        5 and topic 5 turns out to be the largest topic,</span>
<span class="sd">        then topic 5 will be topic 0. The second largest,</span>
<span class="sd">        will be topic 1, etc.</span>

<span class="sd">        If there are no mappings since no reduction of topics</span>
<span class="sd">        took place, then the topics will simply be ordered</span>
<span class="sd">        by their frequency and will get the topic ids based</span>
<span class="sd">        on that order.</span>

<span class="sd">        This means that -1 will remain the outlier class, and</span>
<span class="sd">        that the rest of the topics will be in descending order</span>
<span class="sd">        of ids and frequency.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            documents: Dataframe with documents and their corresponding IDs and Topics</span>

<span class="sd">        Returns:</span>
<span class="sd">            documents: Updated dataframe with documents and the mapped</span>
<span class="sd">                       and re-ordered topic ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="c1"># Map topics based on frequency</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Old_Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Old_Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sorted_topics</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Old_Topic</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span>

        <span class="c1"># Map documents</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sorted_topics</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span> <span class="nf">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">probabilities</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                           <span class="n">original_topics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Map the probabilities to the reduced topics.</span>
<span class="sd">        This is achieved by adding the probabilities together</span>
<span class="sd">        of all topics that were mapped to the same topic. Then,</span>
<span class="sd">        the topics that were mapped from were set to 0 as they</span>
<span class="sd">        were reduced.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            probabilities: An array containing probabilities</span>
<span class="sd">            original_topics: Whether we want to map from the</span>
<span class="sd">                             original topics to the most recent topics</span>
<span class="sd">                             or from the second-most recent topics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mapped_probabilities: Updated probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">(</span><span class="n">original_topics</span><span class="p">)</span>

        <span class="c1"># Map array of probabilities (probability for assigned topic per document)</span>
        <span class="k">if</span> <span class="n">probabilities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">mapped_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">probabilities</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">from_topic</span><span class="p">,</span> <span class="n">to_topic</span> <span class="ow">in</span> <span class="n">mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">to_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">from_topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">mapped_probabilities</span><span class="p">[:,</span> <span class="n">to_topic</span><span class="p">]</span> <span class="o">+=</span> <span class="n">probabilities</span><span class="p">[:,</span> <span class="n">from_topic</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">mapped_probabilities</span>

        <span class="k">return</span> <span class="n">probabilities</span>

    <span class="k">def</span> <span class="nf">_preprocess_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Basic preprocessing of text</span>

<span class="sd">        Steps:</span>
<span class="sd">            * Replace \n and \t with whitespace</span>
<span class="sd">            * Only keep alpha-numerical characters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;english&quot;</span><span class="p">:</span>
            <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z0-9 ]+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="n">cleaned_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="k">if</span> <span class="n">doc</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;emptydoc&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cleaned_documents</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cleaned_documents</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_top_n_idx_sparse</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Return indices of top n values in each row of a sparse matrix</span>

<span class="sd">        Retrieved from:</span>
<span class="sd">            https://stackoverflow.com/questions/49207275/finding-the-top-n-values-in-a-row-of-a-scipy-sparse-matrix</span>

<span class="sd">        Arguments:</span>
<span class="sd">            matrix: The sparse matrix from which to get the top n indices per row</span>
<span class="sd">            n: The number of highest values to extract from each row</span>

<span class="sd">        Returns:</span>
<span class="sd">            indices: The top n indices per row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">le</span><span class="p">,</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">n_row_pick</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ri</span> <span class="o">-</span> <span class="n">le</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">le</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">le</span><span class="p">:</span><span class="n">ri</span><span class="p">],</span> <span class="o">-</span><span class="n">n_row_pick</span><span class="p">)[</span><span class="o">-</span><span class="n">n_row_pick</span><span class="p">:]]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_top_n_values_sparse</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Return the top n values for each row in a sparse matrix</span>

<span class="sd">        Arguments:</span>
<span class="sd">            matrix: The sparse matrix from which to get the top n indices per row</span>
<span class="sd">            indices: The top n indices per row</span>

<span class="sd">        Returns:</span>
<span class="sd">            top_values: The top n scores per row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
            <span class="n">top_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_values</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_param_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get parameter names for the estimator</span>

<span class="sd">        Adapted from:</span>
<span class="sd">            https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">init_signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">init_signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                             <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a string representation of the current object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Human readable representation of the most important model parameters.</span>
<span class="sd">                 The parameters that represent models are ignored due to their length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(...)&quot;</span>
            <span class="n">parameters</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, &quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;BERTopic(</span><span class="si">{</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div>
</td></tr></table>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">top_n_words</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">min_topic_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calculate_probabilities</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">diversity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed_topic_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">umap_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ctfidf_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.__init__" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>BERTopic initialization</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>language</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The main language used in your documents. The default sentence-transformers
      model for "english" is <code>all-MiniLM-L6-v2</code>. For a full overview of
      supported languages see bertopic.backend.languages. Select
      "multilingual" to load in the <code>paraphrase-multilingual-MiniLM-L12-v2</code>
      sentence-tranformers model that supports 50+ languages.</p></td>
          <td>
                <code>&#39;english&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>top_n_words</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of words per topic to extract. Setting this
         too high can negatively impact topic embeddings as topics
         are typically best represented by at most 10 words.</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>n_gram_range</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
          </td>
          <td><p>The n-gram range for the CountVectorizer.
          Advised to keep high values between 1 and 3.
          More would likely lead to memory issues.
          NOTE: This param will not be used if you pass in your own
          CountVectorizer.</p></td>
          <td>
                <code>(1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>min_topic_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The minimum size of the topic. Increasing this value will lead
            to a lower number of clusters/topics.</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>nr_topics</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td><p>Specifying the number of topics will reduce the initial
       number of topics to the value specified. This reduction can take
       a while as each reduction in topics (-1) activates a c-TF-IDF
       calculation. If this is set to None, no reduction is applied. Use
       "auto" to automatically reduce topics using HDBSCAN.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>low_memory</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Sets UMAP low memory to True to make sure less memory is used.
        NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP
        this parameter will not be used.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>calculate_probabilities</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to calculate the probabilities of all topics
                     per document instead of the probability of the assigned
                     topic per document. This could slow down the extraction
                     of topics if you have many documents (&gt; 100_000). Set this
                     only to True if you have a low amount of documents or if
                     you do not mind more computation time.
                     NOTE: If false you cannot use the corresponding
                     visualization method <code>visualize_probabilities</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>diversity</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Whether to use MMR to diversify the resulting topic representations.
       If set to None, MMR will not be used. Accepted values lie between
       0 and 1 with 0 being not at all diverse and 1 being very diverse.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>seed_topic_list</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[str]]</code>
          </td>
          <td><p>A list of seed words per topic to converge around</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Changes the verbosity of the model, Set to True if you want
     to track the stages of the model.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>embedding_model</code></td>
          <td>
          </td>
          <td><p>Use a custom embedding model.
             The following backends are currently supported
               * SentenceTransformers
               * Flair
               * Spacy
               * Gensim
               * USE (TF-Hub)
             You can also pass in a string that points to one of the following
             sentence-transformers models:
               * https://www.sbert.net/docs/pretrained_models.html</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>umap_model</code></td>
          <td>
                <code><span title="umap.UMAP">UMAP</span></code>
          </td>
          <td><p>Pass in a UMAP model to be used instead of the default.
        NOTE: You can also pass in any dimensionality reduction algorithm as long
        as it has <code>.fit</code> and <code>.transform</code> functions.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hdbscan_model</code></td>
          <td>
                <code>hdbscan.<span title="hdbscan.HDBSCAN">HDBSCAN</span></code>
          </td>
          <td><p>Pass in a hdbscan.HDBSCAN model to be used instead of the default
           NOTE: You can also pass in any clustering algorithm as long as it has
           <code>.fit</code> and <code>.predict</code> functions along with the <code>.labels_</code> variable.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>vectorizer_model</code></td>
          <td>
                <code><span title="sklearn.feature_extraction.text.CountVectorizer">CountVectorizer</span></code>
          </td>
          <td><p>Pass in a custom <code>CountVectorizer</code> instead of the default model.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ctfidf_model</code></td>
          <td>
                <code><span title="sklearn.feature_extraction.text.TfidfTransformer">TfidfTransformer</span></code>
          </td>
          <td><p>Pass in a custom ClassTfidfTransformer instead of the default model.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;english&quot;</span><span class="p">,</span>
             <span class="n">top_n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
             <span class="n">min_topic_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">nr_topics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">calculate_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">diversity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">seed_topic_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">umap_model</span><span class="p">:</span> <span class="n">UMAP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">hdbscan_model</span><span class="p">:</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">TfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BERTopic initialization</span>

<span class="sd">    Arguments:</span>
<span class="sd">        language: The main language used in your documents. The default sentence-transformers</span>
<span class="sd">                  model for &quot;english&quot; is `all-MiniLM-L6-v2`. For a full overview of</span>
<span class="sd">                  supported languages see bertopic.backend.languages. Select</span>
<span class="sd">                  &quot;multilingual&quot; to load in the `paraphrase-multilingual-MiniLM-L12-v2`</span>
<span class="sd">                  sentence-tranformers model that supports 50+ languages.</span>
<span class="sd">        top_n_words: The number of words per topic to extract. Setting this</span>
<span class="sd">                     too high can negatively impact topic embeddings as topics</span>
<span class="sd">                     are typically best represented by at most 10 words.</span>
<span class="sd">        n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">                      Advised to keep high values between 1 and 3.</span>
<span class="sd">                      More would likely lead to memory issues.</span>
<span class="sd">                      NOTE: This param will not be used if you pass in your own</span>
<span class="sd">                      CountVectorizer.</span>
<span class="sd">        min_topic_size: The minimum size of the topic. Increasing this value will lead</span>
<span class="sd">                        to a lower number of clusters/topics.</span>
<span class="sd">        nr_topics: Specifying the number of topics will reduce the initial</span>
<span class="sd">                   number of topics to the value specified. This reduction can take</span>
<span class="sd">                   a while as each reduction in topics (-1) activates a c-TF-IDF</span>
<span class="sd">                   calculation. If this is set to None, no reduction is applied. Use</span>
<span class="sd">                   &quot;auto&quot; to automatically reduce topics using HDBSCAN.</span>
<span class="sd">        low_memory: Sets UMAP low memory to True to make sure less memory is used.</span>
<span class="sd">                    NOTE: This is only used in UMAP. For example, if you use PCA instead of UMAP</span>
<span class="sd">                    this parameter will not be used.</span>
<span class="sd">        calculate_probabilities: Whether to calculate the probabilities of all topics</span>
<span class="sd">                                 per document instead of the probability of the assigned</span>
<span class="sd">                                 topic per document. This could slow down the extraction</span>
<span class="sd">                                 of topics if you have many documents (&gt; 100_000). Set this</span>
<span class="sd">                                 only to True if you have a low amount of documents or if</span>
<span class="sd">                                 you do not mind more computation time.</span>
<span class="sd">                                 NOTE: If false you cannot use the corresponding</span>
<span class="sd">                                 visualization method `visualize_probabilities`.</span>
<span class="sd">        diversity: Whether to use MMR to diversify the resulting topic representations.</span>
<span class="sd">                   If set to None, MMR will not be used. Accepted values lie between</span>
<span class="sd">                   0 and 1 with 0 being not at all diverse and 1 being very diverse.</span>
<span class="sd">        seed_topic_list: A list of seed words per topic to converge around</span>
<span class="sd">        verbose: Changes the verbosity of the model, Set to True if you want</span>
<span class="sd">                 to track the stages of the model.</span>
<span class="sd">        embedding_model: Use a custom embedding model.</span>
<span class="sd">                         The following backends are currently supported</span>
<span class="sd">                           * SentenceTransformers</span>
<span class="sd">                           * Flair</span>
<span class="sd">                           * Spacy</span>
<span class="sd">                           * Gensim</span>
<span class="sd">                           * USE (TF-Hub)</span>
<span class="sd">                         You can also pass in a string that points to one of the following</span>
<span class="sd">                         sentence-transformers models:</span>
<span class="sd">                           * https://www.sbert.net/docs/pretrained_models.html</span>
<span class="sd">        umap_model: Pass in a UMAP model to be used instead of the default.</span>
<span class="sd">                    NOTE: You can also pass in any dimensionality reduction algorithm as long</span>
<span class="sd">                    as it has `.fit` and `.transform` functions.</span>
<span class="sd">        hdbscan_model: Pass in a hdbscan.HDBSCAN model to be used instead of the default</span>
<span class="sd">                       NOTE: You can also pass in any clustering algorithm as long as it has</span>
<span class="sd">                       `.fit` and `.predict` functions along with the `.labels_` variable.</span>
<span class="sd">        vectorizer_model: Pass in a custom `CountVectorizer` instead of the default model.</span>
<span class="sd">        ctfidf_model: Pass in a custom ClassTfidfTransformer instead of the default model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Topic-based parameters</span>
    <span class="k">if</span> <span class="n">top_n_words</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;top_n_words should be lower or equal to 30. The preferred value is 10.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_n_words</span> <span class="o">=</span> <span class="n">top_n_words</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span> <span class="o">=</span> <span class="n">min_topic_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span> <span class="o">=</span> <span class="n">low_memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span> <span class="o">=</span> <span class="n">calculate_probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diversity</span> <span class="o">=</span> <span class="n">diversity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="o">=</span> <span class="n">seed_topic_list</span>

    <span class="c1"># Embedding model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">embedding_model</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>

    <span class="c1"># Vectorizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span> <span class="o">=</span> <span class="n">n_gram_range</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

    <span class="c1"># UMAP or another algorithm that has .fit and .transform functions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span> <span class="o">=</span> <span class="n">umap_model</span> <span class="ow">or</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                         <span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                         <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                         <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                                         <span class="n">low_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">)</span>

    <span class="c1"># HDBSCAN or another clustering algorithm that has .fit and .predict functions and</span>
    <span class="c1"># the .labels_ variable to extract the labels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span> <span class="ow">or</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_topic_size</span><span class="p">,</span>
                                                          <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                                          <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
                                                          <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Public attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Private attributes for internal tracking purposes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#bertopic._bertopic.BERTopic.__str__" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get a string representation of the current object.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
          </td>
          <td><p>Human readable representation of the most important model parameters.
 The parameters that represent models are ignored due to their length.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a string representation of the current object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human readable representation of the most important model parameters.</span>
<span class="sd">             The parameters that represent models are ignored due to their length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(...)&quot;</span>
        <span class="n">parameters</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">, &quot;</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;BERTopic(</span><span class="si">{</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.find_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_topics</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.find_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Find topics most similar to a search_term</p>
<p>Creates an embedding for search_term and compares that with
the topic embeddings. The most similar topics are returned
along with their similarity values.</p>
<p>The search_term can be of any size but since it compares
with the topic representation it is advised to keep it
below 5 words.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>search_term</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the term you want to use to search for topics</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>top_n</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the number of topics to return</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>similar_topics</code></td>          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>the most similar topics from high to low</p></td>
        </tr>
        <tr>
<td><code>similarity</code></td>          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td><p>the similarity scores from high to low</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>You can use the underlying embedding model to find topics that
best represent the search term:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics</span><span class="p">,</span> <span class="n">similarity</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">find_topics</span><span class="p">(</span><span class="s2">&quot;sports&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>Note that the search query is typically more accurate if the
search_term consists of a phrase or multiple words.</p>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">search_term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot; Find topics most similar to a search_term</span>

<span class="sd">    Creates an embedding for search_term and compares that with</span>
<span class="sd">    the topic embeddings. The most similar topics are returned</span>
<span class="sd">    along with their similarity values.</span>

<span class="sd">    The search_term can be of any size but since it compares</span>
<span class="sd">    with the topic representation it is advised to keep it</span>
<span class="sd">    below 5 words.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        search_term: the term you want to use to search for topics</span>
<span class="sd">        top_n: the number of topics to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        similar_topics: the most similar topics from high to low</span>
<span class="sd">        similarity: the similarity scores from high to low</span>

<span class="sd">    Examples:</span>

<span class="sd">    You can use the underlying embedding model to find topics that</span>
<span class="sd">    best represent the search term:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics, similarity = topic_model.find_topics(&quot;sports&quot;, top_n=5)</span>
<span class="sd">    ```</span>

<span class="sd">    Note that the search query is typically more accurate if the</span>
<span class="sd">    search_term consists of a phrase or multiple words.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This method can only be used if you did not use custom embeddings.&quot;</span><span class="p">)</span>

    <span class="n">topic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">topic_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Extract search_term embeddings and compare with topic embeddings</span>
    <span class="n">search_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">([</span><span class="n">search_term</span><span class="p">],</span>
                                                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">,</span>
                                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">sims</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">search_embedding</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_embeddings_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Extract topics most similar to search_term</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sims</span><span class="p">)[</span><span class="o">-</span><span class="n">top_n</span><span class="p">:]</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="p">[</span><span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">similar_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">similar_topics</span><span class="p">,</span> <span class="n">similarity</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.fit" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>documents</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>A list of documents to fit on</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[int], <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fit the models (Bert, UMAP, and, HDBSCAN) on a collection of documents and generate topics</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic().fit(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.fit_transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.fit_transform" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Fit the models on a collection of documents, generate topics, and return the docs with topics</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>documents</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>A list of documents to fit on</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[int], <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>predictions</code></td>          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>Topic predictions for each documents</p></td>
        </tr>
        <tr>
<td><code>probabilities</code></td>          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, None]</code>
          </td>
          <td><p>The probability of the assigned topic per document.
           If <code>calculate_probabilities</code> in BERTopic is set to True, then
           it calculates the probabilities of all topics across all documents
           instead of only the assigned topic. This, however, slows down
           computation and may increase memory usage.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings, use it as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                  <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                                                                   <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot; Fit the models on a collection of documents, generate topics, and return the docs with topics</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Returns:</span>
<span class="sd">        predictions: Topic predictions for each documents</span>
<span class="sd">        probabilities: The probability of the assigned topic per document.</span>
<span class="sd">                       If `calculate_probabilities` in BERTopic is set to True, then</span>
<span class="sd">                       it calculates the probabilities of all topics across all documents</span>
<span class="sd">                       instead of only the assigned topic. This, however, slows down</span>
<span class="sd">                       computation and may increase memory usage.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings, use it as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span>
                              <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                              <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

    <span class="c1"># Extract embeddings</span>
    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                              <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="p">,</span>
                                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transformed documents to Embeddings&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                  <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

    <span class="c1"># Reduce dimensionality</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Cluster reduced embeddings</span>
    <span class="n">documents</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Sort and Map Topic IDs by their frequency</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Extract topics by calculating c-TF-IDF</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Reduce topics</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">(</span><span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.generate_topic_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_topic_labels</span><span class="p">(</span><span class="n">nr_words</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">topic_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">word_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.generate_topic_labels" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get labels for each topic in a user-defined format</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>original_labels</code></td>
          <td>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nr_words</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Top <code>n</code> words per topic to use</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>topic_prefix</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use the topic ID as a prefix.
        If set to True, the topic ID will be separated
        using the <code>separator</code></p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>word_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The maximum length of each word in the topic label.
        Some words might be relatively long and setting this
        value helps to make sure that all labels have relatively
        similar lengths.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>separator</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The string with which the words and topic prefix will be
    separated. Underscores are the default but a nice alternative
    is <code>", "</code>.</p></td>
          <td>
                <code>&#39;_&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>topic_labels</code></td>          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>A list of topic labels sorted from the lowest topic ID to the highest.
        If the topic model was trained using HDBSCAN, the lowest topic ID is -1,
        otherwise it is 0.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To create our custom topic labels, usage is rather straightforward:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_labels</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_labels</span><span class="p">(</span><span class="n">nr_words</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">nr_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                          <span class="n">topic_prefix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">word_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; Get labels for each topic in a user-defined format</span>

<span class="sd">    Arguments:</span>
<span class="sd">        original_labels:</span>
<span class="sd">        nr_words: Top `n` words per topic to use</span>
<span class="sd">        topic_prefix: Whether to use the topic ID as a prefix.</span>
<span class="sd">                    If set to True, the topic ID will be separated</span>
<span class="sd">                    using the `separator`</span>
<span class="sd">        word_length: The maximum length of each word in the topic label.</span>
<span class="sd">                    Some words might be relatively long and setting this</span>
<span class="sd">                    value helps to make sure that all labels have relatively</span>
<span class="sd">                    similar lengths.</span>
<span class="sd">        separator: The string with which the words and topic prefix will be</span>
<span class="sd">                separated. Underscores are the default but a nice alternative</span>
<span class="sd">                is `&quot;, &quot;`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topic_labels: A list of topic labels sorted from the lowest topic ID to the highest.</span>
<span class="sd">                    If the topic model was trained using HDBSCAN, the lowest topic ID is -1,</span>
<span class="sd">                    otherwise it is 0.</span>

<span class="sd">    Examples:</span>

<span class="sd">    To create our custom topic labels, usage is rather straightforward:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_labels = topic_model.get_topic_labels(nr_words=2, separator=&quot;, &quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

    <span class="n">topic_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">:</span>
        <span class="n">words</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">word_length</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">[:</span><span class="n">word_length</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">][:</span><span class="n">nr_words</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)[:</span><span class="n">nr_words</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">topic_prefix</span><span class="p">:</span>
            <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}{</span><span class="n">separator</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic_label</span> <span class="o">=</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

        <span class="n">topic_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">topic_labels</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.get_params" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get parameters for this estimator.</p>

<details class="adapted-from">
  <summary>Adapted from</summary>
  <p>https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>deep</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>bool, default=True
  If True, will return the parameters for this estimator and
  contained subobjects that are estimators.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>out</code></td>          <td>
                <code><span title="typing.Mapping">Mapping</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>Parameter names mapped to their values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; Get parameters for this estimator.</span>

<span class="sd">    Adapted from:</span>
<span class="sd">        https://github.com/scikit-learn/scikit-learn/blob/b3ea3ed6a/sklearn/base.py#L178</span>

<span class="sd">    Arguments:</span>
<span class="sd">        deep: bool, default=True</span>
<span class="sd">              If True, will return the parameters for this estimator and</span>
<span class="sd">              contained subobjects that are estimators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        out: Parameter names mapped to their values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_names</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;get_params&#39;</span><span class="p">):</span>
            <span class="n">deep_items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">deep_items</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_representative_docs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_representative_docs</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.get_representative_docs" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Extract representative documents per topic</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>A specific topic for which you want
   the representative documents</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>Representative documents of the chosen topic</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To extract the representative docs of all topics:</p>
<div class="highlight"><pre><span></span><code><span class="n">representative_docs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_representative_docs</span><span class="p">()</span>
</code></pre></div>
<p>To get the representative docs of a single topic:</p>
<div class="highlight"><pre><span></span><code><span class="n">representative_docs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_representative_docs</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_representative_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; Extract representative documents per topic</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want</span>
<span class="sd">               the representative documents</span>

<span class="sd">    Returns:</span>
<span class="sd">        Representative documents of the chosen topic</span>

<span class="sd">    Examples:</span>

<span class="sd">    To extract the representative docs of all topics:</span>

<span class="sd">    ```python</span>
<span class="sd">    representative_docs = topic_model.get_representative_docs()</span>
<span class="sd">    ```</span>

<span class="sd">    To get the representative docs of a single topic:</span>

<span class="sd">    ```python</span>
<span class="sd">    representative_docs = topic_model.get_representative_docs(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">representative_docs_</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_topic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.get_topic" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Return top n words for a specific topic and their c-TF-IDF scores</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>A specific topic for which you want its representation</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Mapping">Mapping</span>[str, <span title="typing.Tuple">Tuple</span>[str, float]], bool]</code>
          </td>
          <td><p>The top n words for a specific word and its respective c-TF-IDF scores</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">topic</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; Return top n words for a specific topic and their c-TF-IDF scores</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want its representation</span>

<span class="sd">    Returns:</span>
<span class="sd">        The top n words for a specific word and its respective c-TF-IDF scores</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic = topic_model.get_topic(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_topic_freq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_freq</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.get_topic_freq" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Return the the size of topics (descending order)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>A specific topic for which you want the frequency</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>, int]</code>
          </td>
          <td><p>Either the frequency of a single topic or dataframe with</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>, int]</code>
          </td>
          <td><p>the frequencies of all topics</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To extract the frequency of all topics:</p>
<div class="highlight"><pre><span></span><code><span class="n">frequency</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">()</span>
</code></pre></div>
<p>To get the frequency of a single topic:</p>
<div class="highlight"><pre><span></span><code><span class="n">frequency</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_freq</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; Return the the size of topics (descending order)</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want the frequency</span>

<span class="sd">    Returns:</span>
<span class="sd">        Either the frequency of a single topic or dataframe with</span>
<span class="sd">        the frequencies of all topics</span>

<span class="sd">    Examples:</span>

<span class="sd">    To extract the frequency of all topics:</span>

<span class="sd">    ```python</span>
<span class="sd">    frequency = topic_model.get_topic_freq()</span>
<span class="sd">    ```</span>

<span class="sd">    To get the frequency of a single topic:</span>

<span class="sd">    ```python</span>
<span class="sd">    frequency = topic_model.get_topic_freq(12)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Topic&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
                                                                                               <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_topic_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_info</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.get_topic_info" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get information about each topic including its ID, frequency, and name.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>A specific topic for which you want the frequency</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>info</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The information relating to either a single topic or all topics</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">info_df</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topic_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Get information about each topic including its ID, frequency, and name.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic: A specific topic for which you want the frequency</span>

<span class="sd">    Returns:</span>
<span class="sd">        info: The information relating to either a single topic or all topics</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    info_df = topic_model.get_topic_info()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">topic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span> <span class="o">==</span> <span class="n">topic</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_topic_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topic_tree</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.get_topic_tree" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Extract the topic tree such that it can be printed</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hier_topics</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe containing the structure of the topic tree.
        This is the output of <code>topic_model.hierachical_topics()</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The maximum distance between two topics. This value is
        based on the Distance column in <code>hier_topics</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>tight_layout</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use a tight layout (narrow width) for
        easier readability if you have hundreds of topics.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>A tree that has the following structure when printed:
.
.
health_medical_disease_patients_hiv
    patients_medical_disease_candida_health
        candida_yeast_infection_gonorrhea_infections  Topic: 48
        patients_disease_cancer_medical_doctor
             hiv_medical_cancer_patients_doctor  Topic: 34
             pain_drug_patients_disease_diet  Topic: 26
    health_newsgroup_tobacco_vote_votes  Topic: 9</p></td>
        </tr>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>The blocks () indicate that the topic is one you can directly access</p></td>
        </tr>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>from <code>topic_model.get_topic</code>. In other words, they are the original un-grouped topics.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="c1"># Train model</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Print topic tree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_tree</span><span class="p">(</span><span class="n">hierarchical_topics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_topic_tree</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                   <span class="n">max_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">tight_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Extract the topic tree such that it can be printed</span>

<span class="sd">    Arguments:</span>
<span class="sd">        hier_topics: A dataframe containing the structure of the topic tree.</span>
<span class="sd">                    This is the output of `topic_model.hierachical_topics()`</span>
<span class="sd">        max_distance: The maximum distance between two topics. This value is</span>
<span class="sd">                    based on the Distance column in `hier_topics`.</span>
<span class="sd">        tight_layout: Whether to use a tight layout (narrow width) for</span>
<span class="sd">                    easier readability if you have hundreds of topics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tree that has the following structure when printed:</span>
<span class="sd">            .</span>
<span class="sd">            .</span>
<span class="sd">            health_medical_disease_patients_hiv</span>
<span class="sd">                patients_medical_disease_candida_health</span>
<span class="sd">                    candida_yeast_infection_gonorrhea_infections  Topic: 48</span>
<span class="sd">                    patients_disease_cancer_medical_doctor</span>
<span class="sd">                         hiv_medical_cancer_patients_doctor  Topic: 34</span>
<span class="sd">                         pain_drug_patients_disease_diet  Topic: 26</span>
<span class="sd">                health_newsgroup_tobacco_vote_votes  Topic: 9</span>

<span class="sd">        The blocks () indicate that the topic is one you can directly access</span>
<span class="sd">        from `topic_model.get_topic`. In other words, they are the original un-grouped topics.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    # Train model</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Print topic tree</span>
<span class="sd">    tree = topic_model.get_topic_tree(hierarchical_topics)</span>
<span class="sd">    print(tree)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">tight_layout</span> <span class="k">else</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">max_original_topic</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Extract mapping from ID to name</span>
    <span class="n">topic_to_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_Name</span><span class="p">))</span>
    <span class="n">topic_to_name</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">,</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_Name</span><span class="p">)))</span>
    <span class="n">topic_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">name</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">topic_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Create tree</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Parent_ID</span><span class="p">):</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Left_ID</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Child_Right_ID</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Based on: https://stackoverflow.com/a/51920869/10532563 &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">grandpa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

            <span class="c1"># Get distance between merged topics</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Left_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="o">|</span>
                                       <span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Child_Right_ID</span> <span class="o">==</span> <span class="n">parent</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span><span class="p">]</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">10</span>

            <span class="k">if</span> <span class="n">parent</span> <span class="o">!=</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grandpa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_original_topic</span><span class="p">:</span>

                        <span class="c1"># Do not append topic ID if they are not merged</span>
                        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  Topic: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;O </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">+=</span> <span class="n">topic_to_name</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">to_print</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

            <span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>
            <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">to_print</span>

        <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">to_print</span> <span class="o">=</span> <span class="n">_tree</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">to_print</span>

    <span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hier_topics</span><span class="o">.</span><span class="n">Parent_ID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">get_tree</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.get_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topics</span><span class="p">()</span></code>

<a href="#bertopic._bertopic.BERTopic.get_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Return topics with top n words and their c-TF-IDF score</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Mapping">Mapping</span>[str, <span title="typing.Tuple">Tuple</span>[str, float]]</code>
          </td>
          <td><p>self.topic_representations_: The top n words per topic and the corresponding c-TF-IDF score</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">all_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topics</span><span class="p">()</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot; Return topics with top n words and their c-TF-IDF score</span>

<span class="sd">    Returns:</span>
<span class="sd">        self.topic_representations_: The top n words per topic and the corresponding c-TF-IDF score</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    all_topics = topic_model.get_topics()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.hierarchical_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance_function</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.hierarchical_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Create a hierarchy of topics</p>
<p>To create this hierarchy, BERTopic needs to be already fitted once.
Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF
representation using <code>scipy.cluster.hierarchy.linkage</code>.</p>
<p>Based on that hierarchy, we calculate the topic representation at each
merged step. This is a local representation, as we only assume that the
chosen step is merged and not all others which typically improves the
topic representation.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>linkage_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<span title="scipy.sparse.csr_matrix">csr_matrix</span>], <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td><p>The linkage function to use. Default is:
            <code>lambda x: sch.linkage(x, 'ward', optimal_ordering=True)</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>distance_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<span title="scipy.sparse.csr_matrix">csr_matrix</span>], <span title="scipy.sparse.csr_matrix">csr_matrix</span>]</code>
          </td>
          <td><p>The distance function to use on the c-TF-IDF matrix. Default is:
                <code>lambda x: 1 - cosine_similarity(x)</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>hierarchical_topics</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe that contains a hierarchy of topics
                represented by their parents and their children</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>A custom linkage function can be used as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span> <span class="k">as</span> <span class="n">sch</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Hierarchical topics</span>
<span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">hierarchical_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                        <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Create a hierarchy of topics</span>

<span class="sd">    To create this hierarchy, BERTopic needs to be already fitted once.</span>
<span class="sd">    Then, a hierarchy is calculated on the distance matrix of the c-TF-IDF</span>
<span class="sd">    representation using `scipy.cluster.hierarchy.linkage`.</span>

<span class="sd">    Based on that hierarchy, we calculate the topic representation at each</span>
<span class="sd">    merged step. This is a local representation, as we only assume that the</span>
<span class="sd">    chosen step is merged and not all others which typically improves the</span>
<span class="sd">    topic representation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                        `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">        distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                            `lambda x: 1 - cosine_similarity(x)`</span>

<span class="sd">    Returns:</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                            represented by their parents and their children</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    A custom linkage function can be used as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from scipy.cluster import hierarchy as sch</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>

<span class="sd">    # Hierarchical topics</span>
<span class="sd">    linkage_function = lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs, linkage_function=linkage_function)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">distance_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">distance_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">linkage_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linkage_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sch</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Calculate linkage</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">:]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">distance_function</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Calculate basic bag-of-words to be iteratively merged later</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span>
                              <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)),</span>
                              <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_text</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Scikit-Learn Deprecation: get_feature_names is deprecated in 1.0</span>
    <span class="c1"># and will be removed in 1.2. Please use get_feature_names_out instead.</span>
    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>

    <span class="n">bow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Extract clusters</span>
    <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Parent_Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Topics&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_Name&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_Name&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))):</span>

        <span class="c1"># Find clustered documents</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span>
        <span class="n">cluster_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)),</span> <span class="s2">&quot;Cluster&quot;</span><span class="p">:</span> <span class="n">clusters</span><span class="p">})</span>
        <span class="n">cluster_df</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Topic&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">nr_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>

        <span class="c1"># Extract first topic we find to get the set of topics in a merged topic</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">topic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">clustered_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">clusters</span><span class="p">[</span><span class="n">topic</span><span class="p">]]</span>

        <span class="c1"># Group bow per cluster, calculate c-TF-IDF and extract words</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">bow</span><span class="p">[</span><span class="n">clustered_topics</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Extract parent&#39;s name and ID</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="mi">5</span><span class="p">])</span>

        <span class="c1"># Extract child&#39;s name and ID</span>
        <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">child_left_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

        <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">child_left_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_left_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_left_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

        <span class="c1"># Extract child&#39;s name and ID</span>
        <span class="n">Z_id</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">child_right_id</span> <span class="o">=</span> <span class="n">Z_id</span> <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span>

        <span class="k">if</span> <span class="n">Z_id</span> <span class="o">-</span> <span class="n">nr_clusters</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">child_right_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic</span><span class="p">(</span><span class="n">Z_id</span><span class="p">)][:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_right_name</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">child_right_id</span><span class="p">)]</span><span class="o">.</span><span class="n">Parent_Name</span>

        <span class="c1"># Save results</span>
        <span class="n">hier_topics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hier_topics</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                                                <span class="n">clustered_topics</span><span class="p">,</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">child_left_name</span><span class="p">,</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">child_right_name</span><span class="p">]</span>

    <span class="n">hier_topics</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">hier_topics</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hier_topics</span><span class="p">[[</span><span class="s2">&quot;Parent_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Left_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Child_Right_ID&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hier_topics</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#bertopic._bertopic.BERTopic.load" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Loads the model from the specified path</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the location and name of the BERTopic file you want to load</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>embedding_model</code></td>
          <td>
          </td>
          <td><p>If the embedding_model was not saved to save space or to load
             it in from the cloud, you can load it in by specifying it here.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">BERTopic</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">)</span>
</code></pre></div>
<p>or if you did not save the embedding model:</p>
<div class="highlight"><pre><span></span><code><span class="n">BERTopic</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">,</span> <span class="n">embedding_model</span><span class="o">=</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
         <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
         <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Loads the model from the specified path</span>

<span class="sd">    Arguments:</span>
<span class="sd">        path: the location and name of the BERTopic file you want to load</span>
<span class="sd">        embedding_model: If the embedding_model was not saved to save space or to load</span>
<span class="sd">                         it in from the cloud, you can load it in by specifying it here.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    BERTopic.load(&quot;my_model&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you did not save the embedding model:</span>

<span class="sd">    ```python</span>
<span class="sd">    BERTopic.load(&quot;my_model&quot;, embedding_model=&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">embedding_model</span><span class="p">:</span>
            <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">topic_model</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="n">embedding_model</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">topic_model</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.merge_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.merge_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>topics_to_merge</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="typing.Iterable">Iterable</span>[int], int]]</code>
          </td>
          <td><p>Either a list of topics or a list of list of topics
            to merge. For example:
                [1, 2, 3] will merge topics 1, 2 and 3
                [[1, 2], [3, 4]] will merge topics 1 and 2, and
                separately merge topics 3 and 4.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>If you want to merge topics 1, 2, and 3:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_to_merge</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">merge_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">)</span>
</code></pre></div>
<p>or if you want to merge topics 1 and 2, and separately
merge topics 3 and 4:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_to_merge</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">merge_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics_to_merge</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">merge_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">topics_to_merge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics_to_merge: Either a list of topics or a list of list of topics</span>
<span class="sd">                        to merge. For example:</span>
<span class="sd">                            [1, 2, 3] will merge topics 1, 2 and 3</span>
<span class="sd">                            [[1, 2], [3, 4]] will merge topics 1 and 2, and</span>
<span class="sd">                            separately merge topics 3 and 4.</span>

<span class="sd">    Examples:</span>

<span class="sd">    If you want to merge topics 1, 2, and 3:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_to_merge = [1, 2, 3]</span>
<span class="sd">    topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you want to merge topics 1 and 2, and separately</span>
<span class="sd">    merge topics 3 and 4:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_to_merge = [[1, 2]</span>
<span class="sd">                        [3, 4]]</span>
<span class="sd">    topic_model.merge_topics(docs, topics_to_merge)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">)}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
            <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic_group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">topics_to_merge</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_group</span><span class="p">:</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure that `topics_to_merge` is either&quot;</span>
                         <span class="s2">&quot;a list of topics or a list of list of topics.&quot;</span><span class="p">)</span>

    <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_mappings</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_mappings_by_frequency</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.partial_fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">partial_fit</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.partial_fit" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Fit BERTopic on a subset of the data and perform online learning
with batch-like data.</p>
<p>Online topic modeling in BERTopic is performed by using dimensionality
reduction and cluster algorithms that support a <code>partial_fit</code> method
in order to incrementally train the topic model.</p>
<p>Likewise, the <code>bertopic.vectorizers.OnlineCountVectorizer</code> is used
to dynamically update its vocabulary when presented with new data.
It has several parameters for modeling decay and updating the
representations.</p>
<p>In other words, although the main algorithm stays the same, the training
procedure now works as follows:</p>
<p>For each subset of the data:</p>
<ol>
<li>Generate embeddings with a pre-traing language model</li>
<li>Incrementally update the dimensionality reduction algorithm with <code>partial_fit</code></li>
<li>Incrementally update the cluster algorithm with <code>partial_fit</code></li>
<li>Incrementally update the OnlineCountVectorizer and apply some form of decay</li>
</ol>
<p>Note that it is advised to use <code>partial_fit</code> with batches and
not single documents for the best performance.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>documents</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>A list of documents to fit on</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[int], <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td><p>The target class for (semi)-supervised modeling. Use -1 if no class for a
specific instance is specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">MiniBatchKMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">IncrementalPCA</span>
<span class="kn">from</span> <span class="nn">bertopic.vectorizers</span> <span class="kn">import</span> <span class="n">OnlineCountVectorizer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>

<span class="c1"># Prepare documents</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

<span class="c1"># Prepare sub-models that support online learning</span>
<span class="n">umap_model</span> <span class="o">=</span> <span class="n">IncrementalPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cluster_model</span> <span class="o">=</span> <span class="n">MiniBatchKMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">OnlineCountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">umap_model</span><span class="p">,</span>
                       <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">cluster_model</span><span class="p">,</span>
                       <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer_model</span><span class="p">)</span>

<span class="c1"># Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">),</span> <span class="mi">1000</span><span class="p">):</span>
    <span class="n">topic_model</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">:</span> <span class="n">index</span><span class="o">+</span><span class="mi">1000</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fit BERTopic on a subset of the data and perform online learning</span>
<span class="sd">    with batch-like data.</span>

<span class="sd">    Online topic modeling in BERTopic is performed by using dimensionality</span>
<span class="sd">    reduction and cluster algorithms that support a `partial_fit` method</span>
<span class="sd">    in order to incrementally train the topic model.</span>

<span class="sd">    Likewise, the `bertopic.vectorizers.OnlineCountVectorizer` is used</span>
<span class="sd">    to dynamically update its vocabulary when presented with new data.</span>
<span class="sd">    It has several parameters for modeling decay and updating the</span>
<span class="sd">    representations.</span>

<span class="sd">    In other words, although the main algorithm stays the same, the training</span>
<span class="sd">    procedure now works as follows:</span>

<span class="sd">    For each subset of the data:</span>

<span class="sd">    1. Generate embeddings with a pre-traing language model</span>
<span class="sd">    2. Incrementally update the dimensionality reduction algorithm with `partial_fit`</span>
<span class="sd">    3. Incrementally update the cluster algorithm with `partial_fit`</span>
<span class="sd">    4. Incrementally update the OnlineCountVectorizer and apply some form of decay</span>

<span class="sd">    Note that it is advised to use `partial_fit` with batches and</span>
<span class="sd">    not single documents for the best performance.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model</span>
<span class="sd">        y: The target class for (semi)-supervised modeling. Use -1 if no class for a</span>
<span class="sd">           specific instance is specified.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sklearn.cluster import MiniBatchKMeans</span>
<span class="sd">    from sklearn.decomposition import IncrementalPCA</span>
<span class="sd">    from bertopic.vectorizers import OnlineCountVectorizer</span>
<span class="sd">    from bertopic import BERTopic</span>

<span class="sd">    # Prepare documents</span>
<span class="sd">    docs = fetch_20newsgroups(subset=subset,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&quot;data&quot;]</span>

<span class="sd">    # Prepare sub-models that support online learning</span>
<span class="sd">    umap_model = IncrementalPCA(n_components=5)</span>
<span class="sd">    cluster_model = MiniBatchKMeans(n_clusters=50, random_state=0)</span>
<span class="sd">    vectorizer_model = OnlineCountVectorizer(stop_words=&quot;english&quot;, decay=.01)</span>

<span class="sd">    topic_model = BERTopic(umap_model=umap_model,</span>
<span class="sd">                           hdbscan_model=cluster_model,</span>
<span class="sd">                           vectorizer_model=vectorizer_model)</span>

<span class="sd">    # Incrementally fit the topic model by training on 1000 documents at a time</span>
<span class="sd">    for index in range(0, len(docs), 1000):</span>
<span class="sd">        topic_model.partial_fit(docs[index: index+1000])</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Checks</span>
    <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="s2">&quot;partial_fit&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In order to use `.partial_fit`, the cluster model should have &quot;</span>
                         <span class="s2">&quot;a `.partial_fit` function.&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare documents</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span>
                              <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)),</span>
                              <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

    <span class="c1"># Extract embeddings</span>
    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                  <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Document</span><span class="p">,</span>
                                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">select_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
                                                  <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

    <span class="c1"># Reduce dimensionality</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_topic_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guided_topic_modeling</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_dimensionality</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Cluster reduced embeddings</span>
    <span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_embeddings</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

    <span class="c1"># Map and find new topics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span> <span class="o">=</span> <span class="n">TopicMapper</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
    <span class="n">mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
    <span class="n">new_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">new_topic_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">mappings</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_topics</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">add_new_topics</span><span class="p">(</span><span class="n">new_topic_ids</span><span class="p">)</span>
    <span class="n">updated_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_mapper_</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>
    <span class="n">updated_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_mappings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">]</span>
    <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_topics</span>

    <span class="c1"># Add missing topics (topics that were originally created but are now missing)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="p">:</span>
        <span class="n">missing_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">updated_topics</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">missing_topic</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">missing_topic</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">missing_topics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Prepare documents</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">updated_topics</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>

    <span class="c1"># Update topic representations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">updated_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">partial_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">updated_words</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">updated_topics</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
                          <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Update topic sizes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_topics</span><span class="p">)]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sizes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">topic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_topics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topic_sizes_</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Document</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.reduce_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.reduce_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Further reduce the number of topics to nr_topics.</p>
<p>The number of topics is further reduced by calculating the c-TF-IDF matrix
of the documents and then reducing them by iteratively merging the least
frequent topic with the most similar one based on their c-TF-IDF matrices.
The topics, their sizes, and representations are updated.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The docs you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nr_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of topics you want reduced to</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="updates">
  <summary>Updates</summary>
  <p>topics_ : Assigns topics to their merged representations.
probabilities_ : Assigns probabilities to their merged representations.</p>
</details>
<p><strong>Examples:</strong></p>
    
      <p>You can further reduce the topics by passing the documents with its
topics and probabilities (if they were calculated):</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">reduce_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">nr_topics</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>
<p>You can then access the updated topics and probabilities with:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                  <span class="n">nr_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Further reduce the number of topics to nr_topics.</span>

<span class="sd">    The number of topics is further reduced by calculating the c-TF-IDF matrix</span>
<span class="sd">    of the documents and then reducing them by iteratively merging the least</span>
<span class="sd">    frequent topic with the most similar one based on their c-TF-IDF matrices.</span>
<span class="sd">    The topics, their sizes, and representations are updated.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The docs you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        nr_topics: The number of topics you want reduced to</span>

<span class="sd">    Updates:</span>
<span class="sd">        topics_ : Assigns topics to their merged representations.</span>
<span class="sd">        probabilities_ : Assigns probabilities to their merged representations.</span>

<span class="sd">    Examples:</span>

<span class="sd">    You can further reduce the topics by passing the documents with its</span>
<span class="sd">    topics and probabilities (if they were calculated):</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.reduce_topics(docs, nr_topics=30)</span>
<span class="sd">    ```</span>

<span class="sd">    You can then access the updated topics and probabilities with:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics = topic_model.topics_</span>
<span class="sd">    probabilities = topic_model.probabilities_</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nr_topics</span> <span class="o">=</span> <span class="n">nr_topics</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">})</span>

    <span class="c1"># Reduce number of topics</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_topics</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_merged_topics</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_map_representative_docs</span><span class="p">()</span>

    <span class="c1"># Map probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.save" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_embedding_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.save" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Saves the model to the specified path</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the location and name of the file you want to save</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_embedding_model</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the embedding model in this class
                  as you might have selected a local model or one that
                  is downloaded automatically from the cloud.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">)</span>
</code></pre></div>
<p>or if you do not want the embedding_model to be saved locally:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;my_model&quot;</span><span class="p">,</span> <span class="n">save_embedding_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
         <span class="n">save_embedding_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Saves the model to the specified path</span>

<span class="sd">    Arguments:</span>
<span class="sd">        path: the location and name of the file you want to save</span>
<span class="sd">        save_embedding_model: Whether to save the embedding model in this class</span>
<span class="sd">                              as you might have selected a local model or one that</span>
<span class="sd">                              is downloaded automatically from the cloud.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.save(&quot;my_model&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    or if you do not want the embedding_model to be saved locally:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.save(&quot;my_model&quot;, save_embedding_model=False)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

        <span class="c1"># This prevents the vectorizer from being too large in size if `min_df` was</span>
        <span class="c1"># set to a value higher than 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span><span class="o">.</span><span class="n">stop_words_</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embedding_model</span><span class="p">:</span>
            <span class="n">embedding_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">embedding_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.set_topic_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_topic_labels</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.set_topic_labels" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Set custom topic labels in your fitted BERTopic model</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic_labels</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], <span title="typing.Mapping">Mapping</span>[int, str]]</code>
          </td>
          <td><p>If a list of topic labels, it should contain the same number
        of labels as there are topics. This must be ordered
        from the topic with the lowest ID to the highest ID,
        including topic -1 if it exists.
        If a dictionary of <code>topic ID</code>: <code>topic_label</code>, it can have
        any number of topics as it will only map the topics found
        in the dictionary.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>First, we define our topic labels with <code>.get_topic_labels</code> in which
we can customize our topic labels:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_labels</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">get_topic_labels</span><span class="p">(</span><span class="n">nr_words</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">topic_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">word_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</code></pre></div>
<p>Then, we pass these <code>topic_labels</code> to our topic model which
can be accessed at any time with <code>.custom_labels_</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">set_topic_labels</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">custom_labels_</span>
</code></pre></div>
<p>You might want to change only a few topic labels instead of all of them.
To do so, you can pass a dictionary where the keys are the topic IDs and
its keys the topic labels:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">set_topic_labels</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Space&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Sports&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Medicine&quot;</span><span class="p">})</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">custom_labels_</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_topic_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Set custom topic labels in your fitted BERTopic model</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_labels: If a list of topic labels, it should contain the same number</span>
<span class="sd">                    of labels as there are topics. This must be ordered</span>
<span class="sd">                    from the topic with the lowest ID to the highest ID,</span>
<span class="sd">                    including topic -1 if it exists.</span>
<span class="sd">                    If a dictionary of `topic ID`: `topic_label`, it can have</span>
<span class="sd">                    any number of topics as it will only map the topics found</span>
<span class="sd">                    in the dictionary.</span>

<span class="sd">    Examples:</span>

<span class="sd">    First, we define our topic labels with `.get_topic_labels` in which</span>
<span class="sd">    we can customize our topic labels:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_labels = topic_model.get_topic_labels(nr_words=2,</span>
<span class="sd">                                                topic_prefix=True,</span>
<span class="sd">                                                word_length=10,</span>
<span class="sd">                                                separator=&quot;, &quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Then, we pass these `topic_labels` to our topic model which</span>
<span class="sd">    can be accessed at any time with `.custom_labels_`:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.set_topic_labels(topic_labels)</span>
<span class="sd">    topic_model.custom_labels_</span>
<span class="sd">    ```</span>

<span class="sd">    You might want to change only a few topic labels instead of all of them.</span>
<span class="sd">    To do so, you can pass a dictionary where the keys are the topic IDs and</span>
<span class="sd">    its keys the topic labels:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.set_topic_labels({0: &quot;Space&quot;, 1: &quot;Sports&quot;, 2: &quot;Medicine&quot;})</span>
<span class="sd">    topic_model.custom_labels_</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_topic_info</span><span class="p">()</span>
            <span class="n">original_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">Topic</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">Name</span><span class="p">))</span>
        <span class="n">custom_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">if</span> <span class="n">topic_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">else</span> <span class="n">original_labels</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">unique_topics</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topic_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_topics</span><span class="p">):</span>
            <span class="n">custom_labels</span> <span class="o">=</span> <span class="n">topic_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Make sure that `topic_labels` contains the same number &quot;</span>
                             <span class="s2">&quot;of labels as that there are topics.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">custom_labels_</span> <span class="o">=</span> <span class="n">custom_labels</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.topics_over_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topics_over_time</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">nr_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datetime_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evolution_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">global_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.topics_over_time" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Create topics over time</p>
<p>To create the topics over time, BERTopic needs to be already fitted once.
From the fitted models, the c-TF-IDF representations are calculate at
each timestamp t. Then, the c-TF-IDF representations at timestamp t are
averaged with the global c-TF-IDF representations in order to fine-tune the
local representations.</p>

<details class="note">
  <summary>NOTE</summary>
  <p>Make sure to use a limited number of unique timestamps (&lt;100) as the
c-TF-IDF representation will be calculated at each single unique timestamp.
Having a large number of unique timestamps can take some time to be calculated.
Moreover, there aren't many use-cased where you would like to see the difference
in topic representations over more than 100 different timestamps.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamps</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], <span title="typing.List">List</span>[int]]</code>
          </td>
          <td><p>The timestamp of each document. This can be either a list of strings or ints.
        If it is a list of strings, then the datetime format will be automatically
        inferred. If it is a list of ints, then the documents will be ordered by
        ascending order.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nr_bins</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of bins you want to create for the timestamps. The left interval will
     be chosen as the timestamp. An additional column will be created with the
     entire interval.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>datetime_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The datetime format of the timestamps if they are strings, eg %d/%m/%Y.
             Set this to None if you want to have it automatically detect the format.
             See strftime documentation for more information on choices:
             https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>evolution_tuning</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Fine-tune each topic representation at timestamp <em>t</em> by averaging its
              c-TF-IDF matrix with the c-TF-IDF matrix at timestamp <em>t-1</em>. This creates
              evolutionary topic representations.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>global_tuning</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Fine-tune each topic representation at timestamp <em>t</em> by averaging its c-TF-IDF matrix
       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in
       topic representations that could not be found in the documents at timestamp <em>t</em>.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>topics_over_time</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe that contains the topic, words, and frequency of topic
              at timestamp <em>t</em>.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>The timestamps variable represent the timestamp of each document. If you have over
100 unique timestamps, it is advised to bin the timestamps as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics_over_time</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_over_time</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">nr_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                     <span class="n">timestamps</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                       <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
                     <span class="n">nr_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">datetime_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">evolution_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Create topics over time</span>

<span class="sd">    To create the topics over time, BERTopic needs to be already fitted once.</span>
<span class="sd">    From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">    each timestamp t. Then, the c-TF-IDF representations at timestamp t are</span>
<span class="sd">    averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">    local representations.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        Make sure to use a limited number of unique timestamps (&lt;100) as the</span>
<span class="sd">        c-TF-IDF representation will be calculated at each single unique timestamp.</span>
<span class="sd">        Having a large number of unique timestamps can take some time to be calculated.</span>
<span class="sd">        Moreover, there aren&#39;t many use-cased where you would like to see the difference</span>
<span class="sd">        in topic representations over more than 100 different timestamps.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        timestamps: The timestamp of each document. This can be either a list of strings or ints.</span>
<span class="sd">                    If it is a list of strings, then the datetime format will be automatically</span>
<span class="sd">                    inferred. If it is a list of ints, then the documents will be ordered by</span>
<span class="sd">                    ascending order.</span>
<span class="sd">        nr_bins: The number of bins you want to create for the timestamps. The left interval will</span>
<span class="sd">                 be chosen as the timestamp. An additional column will be created with the</span>
<span class="sd">                 entire interval.</span>
<span class="sd">        datetime_format: The datetime format of the timestamps if they are strings, eg %d/%m/%Y.</span>
<span class="sd">                         Set this to None if you want to have it automatically detect the format.</span>
<span class="sd">                         See strftime documentation for more information on choices:</span>
<span class="sd">                         https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior.</span>
<span class="sd">        evolution_tuning: Fine-tune each topic representation at timestamp *t* by averaging its</span>
<span class="sd">                          c-TF-IDF matrix with the c-TF-IDF matrix at timestamp *t-1*. This creates</span>
<span class="sd">                          evolutionary topic representations.</span>
<span class="sd">        global_tuning: Fine-tune each topic representation at timestamp *t* by averaging its c-TF-IDF matrix</span>
<span class="sd">                   with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                   topic representations that could not be found in the documents at timestamp *t*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topics_over_time: A dataframe that contains the topic, words, and frequency of topic</span>
<span class="sd">                          at timestamp *t*.</span>

<span class="sd">    Examples:</span>

<span class="sd">    The timestamps variable represent the timestamp of each document. If you have over</span>
<span class="sd">    100 unique timestamps, it is advised to bin the timestamps as shown below:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    topics_over_time = topic_model.topics_over_time(docs, timestamps, nr_bins=20)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_documents_type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">})</span>
    <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">all_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="n">all_topics_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">topic</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_topics</span><span class="p">)}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">infer_datetime_format</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">datetime_format</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">],</span>
                                                 <span class="n">infer_datetime_format</span><span class="o">=</span><span class="n">infer_datetime_format</span><span class="p">,</span>
                                                 <span class="nb">format</span><span class="o">=</span><span class="n">datetime_format</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nr_bins</span><span class="p">:</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nr_bins</span><span class="p">)</span>
        <span class="n">documents</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Bins</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Sort documents in chronological order</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">)</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are more than 100 unique timestamps (i.e., </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                      <span class="s2">&quot;which significantly slows down the application. Consider setting `nr_bins` &quot;</span>
                      <span class="s2">&quot;to a value lower than 100 to speed up calculation. &quot;</span><span class="p">)</span>

    <span class="c1"># For each unique timestamp, create topic representations</span>
    <span class="n">topics_over_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>

        <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Timestamps</span> <span class="o">==</span> <span class="n">timestamp</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
                                                                                <span class="s2">&quot;Timestamps&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
        <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">global_tuning</span> <span class="ow">or</span> <span class="n">evolution_tuning</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Fine-tune the c-TF-IDF matrix at timestamp t by averaging it with the c-TF-IDF</span>
        <span class="c1"># matrix at timestamp t-1</span>
        <span class="k">if</span> <span class="n">evolution_tuning</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">overlapping_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">previous_topics</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_topics</span><span class="p">))))</span>

            <span class="n">current_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>
            <span class="n">previous_overlap_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_topics</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">overlapping_topics</span><span class="p">]</span>

            <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">tolil</span><span class="p">()[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c_tf_idf</span><span class="p">[</span><span class="n">current_overlap_idx</span><span class="p">]</span> <span class="o">+</span>
                                                      <span class="n">previous_c_tf_idf</span><span class="p">[</span><span class="n">previous_overlap_idx</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>

        <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
        <span class="c1"># by simply taking the average of the two</span>
        <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
            <span class="n">selected_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_topics_indices</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">selected_topics</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Extract the words per topic</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                    <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># Fill dataframe with results</span>
        <span class="n">topics_at_timestamp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">topic</span><span class="p">,</span>
                                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                                <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                                <span class="n">timestamp</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">topics_over_time</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_timestamp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">evolution_tuning</span><span class="p">:</span>
            <span class="n">previous_topics</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">previous_c_tf_idf</span> <span class="o">=</span> <span class="n">c_tf_idf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Timestamp&quot;</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.topics_per_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topics_per_class</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">global_tuning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.topics_per_class" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Create topics per class</p>
<p>To create the topics per class, BERTopic needs to be already fitted once.
From the fitted models, the c-TF-IDF representations are calculate at
each class c. Then, the c-TF-IDF representations at class c are
averaged with the global c-TF-IDF representations in order to fine-tune the
local representations. This can be turned off if the pure representation is
needed.</p>

<details class="note">
  <summary>NOTE</summary>
  <p>Make sure to use a limited number of unique classes (&lt;100) as the
c-TF-IDF representation will be calculated at each single unique class.
Having a large number of unique classes can take some time to be calculated.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>classes</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[int], <span title="typing.List">List</span>[str]]</code>
          </td>
          <td><p>The class of each document. This can be either a list of strings or ints.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>global_tuning</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Fine-tune each topic representation at timestamp t by averaging its c-TF-IDF matrix
       with the global c-TF-IDF matrix. Turn this off if you want to prevent words in
       topic representations that could not be found in the documents at timestamp t.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>topics_per_class</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe that contains the topic, words, and frequency of topics
              for each class.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_per_class</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                     <span class="n">classes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                     <span class="n">global_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Create topics per class</span>

<span class="sd">    To create the topics per class, BERTopic needs to be already fitted once.</span>
<span class="sd">    From the fitted models, the c-TF-IDF representations are calculate at</span>
<span class="sd">    each class c. Then, the c-TF-IDF representations at class c are</span>
<span class="sd">    averaged with the global c-TF-IDF representations in order to fine-tune the</span>
<span class="sd">    local representations. This can be turned off if the pure representation is</span>
<span class="sd">    needed.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        Make sure to use a limited number of unique classes (&lt;100) as the</span>
<span class="sd">        c-TF-IDF representation will be calculated at each single unique class.</span>
<span class="sd">        Having a large number of unique classes can take some time to be calculated.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        classes: The class of each document. This can be either a list of strings or ints.</span>
<span class="sd">        global_tuning: Fine-tune each topic representation at timestamp t by averaging its c-TF-IDF matrix</span>
<span class="sd">                   with the global c-TF-IDF matrix. Turn this off if you want to prevent words in</span>
<span class="sd">                   topic representations that could not be found in the documents at timestamp t.</span>

<span class="sd">    Returns:</span>
<span class="sd">        topics_per_class: A dataframe that contains the topic, words, and frequency of topics</span>
<span class="sd">                          for each class.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    topic_model = BERTopic()</span>
<span class="sd">    topics, probs = topic_model.fit_transform(docs)</span>
<span class="sd">    topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="n">classes</span><span class="p">})</span>
    <span class="n">global_c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># For each unique timestamp, create topic representations</span>
    <span class="n">topics_per_class</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classes</span><span class="p">)),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>

        <span class="c1"># Calculate c-TF-IDF representation for a specific timestamp</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">documents</span><span class="o">.</span><span class="n">Class</span> <span class="o">==</span> <span class="n">class_</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
                                                                                <span class="s2">&quot;Class&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
        <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Fine-tune the timestamp c-TF-IDF representation based on the global c-TF-IDF representation</span>
        <span class="c1"># by simply taking the average of the two</span>
        <span class="k">if</span> <span class="n">global_tuning</span><span class="p">:</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">c_tf_idf</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_c_tf_idf</span><span class="p">[</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliers</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_tf_idf</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Extract the words per topic</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
        <span class="n">words_per_topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">c_tf_idf</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">topic_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                    <span class="n">index</span><span class="o">=</span><span class="n">documents_per_topic</span><span class="o">.</span><span class="n">Topic</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># Fill dataframe with results</span>
        <span class="n">topics_at_class</span> <span class="o">=</span> <span class="p">[(</span><span class="n">topic</span><span class="p">,</span>
                            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">values</span><span class="p">][:</span><span class="mi">5</span><span class="p">]),</span>
                            <span class="n">topic_frequency</span><span class="p">[</span><span class="n">topic</span><span class="p">],</span>
                            <span class="n">class_</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">words_per_topic</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">topics_per_class</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">topics_at_class</span><span class="p">)</span>

    <span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="p">,</span> <span class="s2">&quot;Words&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;Class&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">topics_per_class</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.transform" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>After having fit a model, use transform to predict new instances</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>documents</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[str]]</code>
          </td>
          <td><p>A single document or a list of documents to fit on</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Pre-trained document embeddings. These can be used
        instead of the sentence-transformer model.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>predictions</code></td>          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>Topic predictions for each documents</p></td>
        </tr>
        <tr>
<td><code>probabilities</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The topic probability distribution which is returned by default.
           If <code>calculate_probabilities</code> in BERTopic is set to False, then the
           probabilities are not calculated to speed up computation and
           decrease memory usage.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>If you want to use your own embeddings:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Create embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create topic model</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="n">topics</span><span class="p">,</span> <span class="n">probs</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">documents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
              <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; After having fit a model, use transform to predict new instances</span>

<span class="sd">    Arguments:</span>
<span class="sd">        documents: A single document or a list of documents to fit on</span>
<span class="sd">        embeddings: Pre-trained document embeddings. These can be used</span>
<span class="sd">                    instead of the sentence-transformer model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        predictions: Topic predictions for each documents</span>
<span class="sd">        probabilities: The topic probability distribution which is returned by default.</span>
<span class="sd">                       If `calculate_probabilities` in BERTopic is set to False, then the</span>
<span class="sd">                       probabilities are not calculated to speed up computation and</span>
<span class="sd">                       decrease memory usage.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>

<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    topic_model = BERTopic().fit(docs)</span>
<span class="sd">    topics, probs = topic_model.transform(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to use your own embeddings:</span>

<span class="sd">    ```python</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>

<span class="sd">    # Create embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;)[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=True)</span>

<span class="sd">    # Create topic model</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    topics, probs = topic_model.transform(docs, embeddings)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">check_embeddings_shape</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">documents</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_embeddings</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span>
                                              <span class="n">method</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">umap_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umap_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reduced dimensionality&quot;</span><span class="p">)</span>

    <span class="c1"># Extract predictions and probabilities if it is a HDBSCAN model</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">):</span>
        <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">approximate_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>

        <span class="c1"># Calculate probabilities</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_probabilities</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">membership_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculated probabilities with HDBSCAN&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">umap_embeddings</span><span class="p">)</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicted clusters&quot;</span><span class="p">)</span>

    <span class="c1"># Map probabilities and predictions</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_probabilities</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">original_topics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_predictions</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.update_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ctfidf_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.update_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Updates the topic representation by recalculating c-TF-IDF with the new
parameters as defined in this function.</p>
<p>When you have trained a model and viewed the topics and the words that represent them,
you might not be satisfied with the representation. Perhaps you forgot to remove
stop_words or you want to try out a different n_gram_range. This function allows you
to update the topic representation after they have been formed.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A list of topics where each topic is related to a document in <code>docs</code>.
    Use this variable to change or map the topics.
    NOTE: Using a custom list of topic assignments may lead to errors if
          topic reduction techniques are used afterwards. Make sure that
          manually assigning topics is the last step in the pipeline</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_gram_range</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
          </td>
          <td><p>The n-gram range for the CountVectorizer.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>vectorizer_model</code></td>
          <td>
                <code><span title="sklearn.feature_extraction.text.CountVectorizer">CountVectorizer</span></code>
          </td>
          <td><p>Pass in your own CountVectorizer from scikit-learn</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ctfidf_model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="bertopic.vectorizers.ClassTfidfTransformer" href="ctfidf.html#bertopic.vectorizers.ClassTfidfTransformer">ClassTfidfTransformer</a></code>
          </td>
          <td><p>Pass in your own c-TF-IDF model to update the representations</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>In order to update the topic representation, you will need to first fit the topic
model and extract topics from them. Based on these, you can update the representation:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">n_gram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<p>You can also use a custom vectorizer to update the representation:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer_model</span><span class="p">)</span>
</code></pre></div>
<p>You can also use this function to change or map the topics to something else.
You can update them as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">update_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">my_updated_topics</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                  <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">n_gram_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">CountVectorizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">ctfidf_model</span><span class="p">:</span> <span class="n">ClassTfidfTransformer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Updates the topic representation by recalculating c-TF-IDF with the new</span>
<span class="sd">    parameters as defined in this function.</span>

<span class="sd">    When you have trained a model and viewed the topics and the words that represent them,</span>
<span class="sd">    you might not be satisfied with the representation. Perhaps you forgot to remove</span>
<span class="sd">    stop_words or you want to try out a different n_gram_range. This function allows you</span>
<span class="sd">    to update the topic representation after they have been formed.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics: A list of topics where each topic is related to a document in `docs`.</span>
<span class="sd">                Use this variable to change or map the topics.</span>
<span class="sd">                NOTE: Using a custom list of topic assignments may lead to errors if</span>
<span class="sd">                      topic reduction techniques are used afterwards. Make sure that</span>
<span class="sd">                      manually assigning topics is the last step in the pipeline</span>
<span class="sd">        n_gram_range: The n-gram range for the CountVectorizer.</span>
<span class="sd">        vectorizer_model: Pass in your own CountVectorizer from scikit-learn</span>
<span class="sd">        ctfidf_model: Pass in your own c-TF-IDF model to update the representations</span>

<span class="sd">    Examples:</span>

<span class="sd">    In order to update the topic representation, you will need to first fit the topic</span>
<span class="sd">    model and extract topics from them. Based on these, you can update the representation:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.update_topics(docs, n_gram_range=(2, 3))</span>
<span class="sd">    ```</span>

<span class="sd">    You can also use a custom vectorizer to update the representation:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.feature_extraction.text import CountVectorizer</span>
<span class="sd">    vectorizer_model = CountVectorizer(ngram_range=(1, 2), stop_words=&quot;english&quot;)</span>
<span class="sd">    topic_model.update_topics(docs, vectorizer_model=vectorizer_model)</span>
<span class="sd">    ```</span>

<span class="sd">    You can also use this function to change or map the topics to something else.</span>
<span class="sd">    You can update them as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.update_topics(docs, my_updated_topics)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_gram_range</span><span class="p">:</span>
        <span class="n">n_gram_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_range</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer_model</span> <span class="o">=</span> <span class="n">vectorizer_model</span> <span class="ow">or</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="n">n_gram_range</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctfidf_model</span> <span class="o">=</span> <span class="n">ctfidf_model</span> <span class="ow">or</span> <span class="n">ClassTfidfTransformer</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topics_</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)))</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Using a custom list of topic assignments may lead to errors if &quot;</span>
                      <span class="s2">&quot;topic reduction techniques are used afterwards. Make sure that &quot;</span>
                      <span class="s2">&quot;manually assigning topics is the last step in the pipeline.&quot;</span><span class="p">)</span>
    <span class="c1"># Extract words</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Document&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">,</span> <span class="s2">&quot;Topic&quot;</span><span class="p">:</span> <span class="n">topics</span><span class="p">})</span>
    <span class="n">documents_per_topic</span> <span class="o">=</span> <span class="n">documents</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Topic&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Document&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">c_tf_idf_</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c_tf_idf</span><span class="p">(</span><span class="n">documents_per_topic</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_words_per_topic</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_topic_vectors</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">topic_labels_</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">4</span><span class="p">]])</span>
                          <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">topic_representations_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_topic_size</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_barchart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_barchart</span><span class="p">(</span><span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_words</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Topic Word Scores&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_barchart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize a barchart of selected topics</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Only select the top n most frequent topics.</p></td>
          <td>
                <code>8</code>
          </td>
        </tr>
        <tr>
          <td><code>n_words</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of words to show in a topic</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using 
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Title of the plot.</p></td>
          <td>
                <code>&#39;Topic Word Scores&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of each figure.</p></td>
          <td>
                <code>250</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of each figure.</p></td>
          <td>
                <code>250</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fig</code></td>          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly figure</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the barchart of selected topics
simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_barchart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
                       <span class="n">n_words</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                       <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Topic Word Scores&quot;</span><span class="p">,</span>
                       <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
                       <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize a barchart of selected topics</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">        n_words: Number of words to show in a topic</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using </span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        width: The width of each figure.</span>
<span class="sd">        height: The height of each figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the barchart of selected topics</span>
<span class="sd">    simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_barchart()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_barchart()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_barchart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                       <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                       <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                       <span class="n">n_words</span><span class="o">=</span><span class="n">n_words</span><span class="p">,</span>
                                       <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                       <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                       <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                       <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_distribution" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_distribution</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">min_probability</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_distribution" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize the distribution of topic probabilities</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>probabilities</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>An array of probability scores</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_probability</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The minimum probability score to visualize.
             All others are ignored.</p></td>
          <td>
                <code>0.015</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>800</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>600</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>Make sure to fit the model before and only input the
probabilities of a single document:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="n">topic_model</span><span class="o">.</span><span class="n">probabilities_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">probabilities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                           <span class="n">min_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">,</span>
                           <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                           <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize the distribution of topic probabilities</span>

<span class="sd">    Arguments:</span>
<span class="sd">        probabilities: An array of probability scores</span>
<span class="sd">        min_probability: The minimum probability score to visualize.</span>
<span class="sd">                         All others are ignored.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>

<span class="sd">    Make sure to fit the model before and only input the</span>
<span class="sd">    probabilities of a single document:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_distribution(topic_model.probabilities_[0])</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                           <span class="n">probabilities</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span>
                                           <span class="n">min_probability</span><span class="o">=</span><span class="n">min_probability</span><span class="p">,</span>
                                           <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                           <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                           <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_documents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hide_annotations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_document_hover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_documents" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize documents and their topics in 2D</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic_model</code></td>
          <td>
          </td>
          <td><p>A fitted BERTopic instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize.
    Not to be confused with the topics that you get from <code>.fit_transform</code>.
    For example, if you want to visualize only topics 1 through 5:
    <code>topics = [1, 2, 3, 4, 5]</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The embeddings of all documents in <code>docs</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reduced_embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The 2D reduced embeddings of all documents in <code>docs</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>sample</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The percentage of documents in each topic that you would like to keep.
    Value can be between 0 and 1. Setting this value to, for example,
    0.1 (10% of documents in each topic) makes it easier to visualize
    millions of documents as a subset is chosen.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hide_annotations</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Hide the names of the traces on top of each cluster.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>hide_document_hover</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Hide the content of the documents when hovering over
                specific points. Helps to speed up generation of visualization.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>1200</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>750</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div>
<p>Do note that this re-calculates the embeddings and reduces them to 2D.
The advised and prefered pipeline for using this function is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>

<span class="c1"># Prepare embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Train BERTopic</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Reduce dimensionality of embeddings, this step is optional</span>
<span class="c1"># reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="c1"># Run the visualization with the original embeddings</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Or, if you have reduced the original embeddings already:</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../../getting_started/visualization/documents.html"
style="width:1000px; height: 800px; border: 0px;""></iframe>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">sample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
                        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize documents and their topics in 2D</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model: A fitted BERTopic instance.</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">                Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">        embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">        reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">        sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                millions of documents as a subset is chosen.</span>
<span class="sd">        hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">        hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                            specific points. Helps to speed up generation of visualization.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_documents(docs)</span>
<span class="sd">    ```</span>

<span class="sd">    Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">    The advised and prefered pipeline for using this function is as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from umap import UMAP</span>

<span class="sd">    # Prepare embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">    # Train BERTopic</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>

<span class="sd">    # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">    # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">    # Run the visualization with the original embeddings</span>
<span class="sd">    topic_model.visualize_documents(docs, embeddings=embeddings)</span>

<span class="sd">    # Or, if you have reduced the original embeddings already:</span>
<span class="sd">    topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_documents(docs, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    &lt;iframe src=&quot;../../getting_started/visualization/documents.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 800px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
                                        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                                        <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
                                        <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                        <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
                                        <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
                                        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_heatmap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_heatmap</span><span class="p">(</span><span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_heatmap" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize a heatmap of the topic's similarity matrix</p>
<p>Based on the cosine similarity matrix between topic embeddings,
a heatmap is created showing the similarity between topics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Only select the top n most frequent topics.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_clusters</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Create n clusters and order the similarity
        matrix by those clusters.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>800</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>800</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fig</code></td>          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly figure</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the similarity matrix of
topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                      <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize a heatmap of the topic&#39;s similarity matrix</span>

<span class="sd">    Based on the cosine similarity matrix between topic embeddings,</span>
<span class="sd">    a heatmap is created showing the similarity between topics.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics.</span>
<span class="sd">        n_clusters: Create n clusters and order the similarity</span>
<span class="sd">                    matrix by those clusters.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the similarity matrix of</span>
<span class="sd">    topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_heatmap()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_heatmap()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                      <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                      <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span>
                                      <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                      <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                      <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hide_annotations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_document_hover</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nr_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_hierarchical_documents" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize documents and their topics in 2D at different levels of hierarchy</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>docs</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>The documents you used when calling either <code>fit</code> or <code>fit_transform</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hierarchical_topics</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe that contains a hierarchy of topics
                represented by their parents and their children</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize.
    Not to be confused with the topics that you get from <code>.fit_transform</code>.
    For example, if you want to visualize only topics 1 through 5:
    <code>topics = [1, 2, 3, 4, 5]</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The embeddings of all documents in <code>docs</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reduced_embeddings</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The 2D reduced embeddings of all documents in <code>docs</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>sample</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, int]</code>
          </td>
          <td><p>The percentage of documents in each topic that you would like to keep.
    Value can be between 0 and 1. Setting this value to, for example,
    0.1 (10% of documents in each topic) makes it easier to visualize
    millions of documents as a subset is chosen.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hide_annotations</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Hide the names of the traces on top of each cluster.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>hide_document_hover</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Hide the content of the documents when hovering over
                specific points. Helps to speed up generation of visualizations.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>nr_levels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of levels to be visualized in the hierarchy. First, the distances
    in <code>hierarchical_topics.Distance</code> are split in <code>nr_levels</code> lists of distances with
    equal length. Then, for each list of distances, the merged topics are selected that
    have a distance less or equal to the maximum distance of the selected list of distances.
    NOTE: To get all possible merged steps, make sure that <code>nr_levels</code> is equal to
    the length of <code>hierarchical_topics</code>.</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
           <code>topic_model.set_topic_labels</code>.
           NOTE: Custom labels are only generated for the original
           un-merged topics.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>1200</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>750</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">)</span>
</code></pre></div>
<p>Do note that this re-calculates the embeddings and reduces them to 2D.
The advised and prefered pipeline for using this function is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_20newsgroups</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
<span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>

<span class="c1"># Prepare embeddings</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">fetch_20newsgroups</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  <span class="n">remove</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;footers&#39;</span><span class="p">,</span> <span class="s1">&#39;quotes&#39;</span><span class="p">))[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">sentence_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">sentence_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Train BERTopic and extract hierarchical topics</span>
<span class="n">topic_model</span> <span class="o">=</span> <span class="n">BERTopic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Reduce dimensionality of embeddings, this step is optional</span>
<span class="c1"># reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="c1"># Run the visualization with the original embeddings</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Or, if you have reduced the original embeddings already:</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="p">,</span> <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../../getting_started/visualization/hierarchical_documents.html"
style="width:1000px; height: 770px; border: 0px;""></iframe>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_hierarchical_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                     <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                     <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">reduced_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">sample</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">hide_annotations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="n">hide_document_hover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">nr_levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                     <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
                                     <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize documents and their topics in 2D at different levels of hierarchy</span>

<span class="sd">    Arguments:</span>
<span class="sd">        docs: The documents you used when calling either `fit` or `fit_transform`</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                            represented by their parents and their children</span>
<span class="sd">        topics: A selection of topics to visualize.</span>
<span class="sd">                Not to be confused with the topics that you get from `.fit_transform`.</span>
<span class="sd">                For example, if you want to visualize only topics 1 through 5:</span>
<span class="sd">                `topics = [1, 2, 3, 4, 5]`.</span>
<span class="sd">        embeddings: The embeddings of all documents in `docs`.</span>
<span class="sd">        reduced_embeddings: The 2D reduced embeddings of all documents in `docs`.</span>
<span class="sd">        sample: The percentage of documents in each topic that you would like to keep.</span>
<span class="sd">                Value can be between 0 and 1. Setting this value to, for example,</span>
<span class="sd">                0.1 (10% of documents in each topic) makes it easier to visualize</span>
<span class="sd">                millions of documents as a subset is chosen.</span>
<span class="sd">        hide_annotations: Hide the names of the traces on top of each cluster.</span>
<span class="sd">        hide_document_hover: Hide the content of the documents when hovering over</span>
<span class="sd">                            specific points. Helps to speed up generation of visualizations.</span>
<span class="sd">        nr_levels: The number of levels to be visualized in the hierarchy. First, the distances</span>
<span class="sd">                in `hierarchical_topics.Distance` are split in `nr_levels` lists of distances with</span>
<span class="sd">                equal length. Then, for each list of distances, the merged topics are selected that</span>
<span class="sd">                have a distance less or equal to the maximum distance of the selected list of distances.</span>
<span class="sd">                NOTE: To get all possible merged steps, make sure that `nr_levels` is equal to</span>
<span class="sd">                the length of `hierarchical_topics`.</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                       `topic_model.set_topic_labels`.</span>
<span class="sd">                       NOTE: Custom labels are only generated for the original</span>
<span class="sd">                       un-merged topics.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics)</span>
<span class="sd">    ```</span>

<span class="sd">    Do note that this re-calculates the embeddings and reduces them to 2D.</span>
<span class="sd">    The advised and prefered pipeline for using this function is as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    from sklearn.datasets import fetch_20newsgroups</span>
<span class="sd">    from sentence_transformers import SentenceTransformer</span>
<span class="sd">    from bertopic import BERTopic</span>
<span class="sd">    from umap import UMAP</span>

<span class="sd">    # Prepare embeddings</span>
<span class="sd">    docs = fetch_20newsgroups(subset=&#39;all&#39;,  remove=(&#39;headers&#39;, &#39;footers&#39;, &#39;quotes&#39;))[&#39;data&#39;]</span>
<span class="sd">    sentence_model = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)</span>
<span class="sd">    embeddings = sentence_model.encode(docs, show_progress_bar=False)</span>

<span class="sd">    # Train BERTopic and extract hierarchical topics</span>
<span class="sd">    topic_model = BERTopic().fit(docs, embeddings)</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Reduce dimensionality of embeddings, this step is optional</span>
<span class="sd">    # reduced_embeddings = UMAP(n_neighbors=10, n_components=2, min_dist=0.0, metric=&#39;cosine&#39;).fit_transform(embeddings)</span>

<span class="sd">    # Run the visualization with the original embeddings</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, embeddings=embeddings)</span>

<span class="sd">    # Or, if you have reduced the original embeddings already:</span>
<span class="sd">    topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_hierarchical_documents(docs, hierarchical_topics, reduced_embeddings=reduced_embeddings)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    &lt;iframe src=&quot;../../getting_started/visualization/hierarchical_documents.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 770px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchical_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                     <span class="n">docs</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span>
                                                     <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
                                                     <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                                     <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                                                     <span class="n">reduced_embeddings</span><span class="o">=</span><span class="n">reduced_embeddings</span><span class="p">,</span>
                                                     <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                                     <span class="n">hide_annotations</span><span class="o">=</span><span class="n">hide_annotations</span><span class="p">,</span>
                                                     <span class="n">hide_document_hover</span><span class="o">=</span><span class="n">hide_document_hover</span><span class="p">,</span>
                                                     <span class="n">nr_levels</span><span class="o">=</span><span class="n">nr_levels</span><span class="p">,</span>
                                                     <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                                     <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                                     <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_hierarchy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">hierarchical_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linkage_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_hierarchy" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize a hierarchical structure of the topics</p>
<p>A ward linkage function is used to perform the
hierarchical clustering based on the cosine distance
matrix between topic embeddings.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topic_model</code></td>
          <td>
          </td>
          <td><p>A fitted BERTopic instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>orientation</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The orientation of the figure.
        Either 'left' or 'bottom'</p></td>
          <td>
                <code>&#39;left&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Only select the top n most frequent topics</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.
       NOTE: Custom labels are only generated for the original
       un-merged topics.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure. Only works if orientation is set to 'left'</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure. Only works if orientation is set to 'bottom'</p></td>
          <td>
                <code>600</code>
          </td>
        </tr>
        <tr>
          <td><code>hierarchical_topics</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A dataframe that contains a hierarchy of topics
                represented by their parents and their children.
                NOTE: The hierarchical topic names are only visualized
                if both <code>topics</code> and <code>top_n_topics</code> are not set.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>linkage_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<span title="scipy.sparse.csr_matrix">csr_matrix</span>], <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td><p>The linkage function to use. Default is:
            <code>lambda x: sch.linkage(x, 'ward', optimal_ordering=True)</code>
            NOTE: Make sure to use the same <code>linkage_function</code> as used
            in <code>topic_model.hierarchical_topics</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>distance_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[<span title="scipy.sparse.csr_matrix">csr_matrix</span>], <span title="scipy.sparse.csr_matrix">csr_matrix</span>]</code>
          </td>
          <td><p>The distance function to use on the c-TF-IDF matrix. Default is:
            <code>lambda x: 1 - cosine_similarity(x)</code>
            NOTE: Make sure to use the same <code>distance_function</code> as used
            in <code>topic_model.hierarchical_topics</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>color_threshold</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Value at which the separation of clusters will be made which
         will result in different colors for different clusters.
         A higher value will typically lead in less colored clusters.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fig</code></td>          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly figure</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the hierarchical structure of
topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">()</span>
</code></pre></div>
<p>If you also want the labels visualized of hierarchical topics,
run the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Extract hierarchical topics and their representations</span>
<span class="n">hierarchical_topics</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">hierarchical_topics</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Visualize these representations</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">)</span>
</code></pre></div>
<p>If you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe src="../../getting_started/visualization/hierarchy.html"
style="width:1000px; height: 680px; border: 0px;""></iframe>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">orientation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
                        <span class="n">hierarchical_topics</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">linkage_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">distance_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">csr_matrix</span><span class="p">],</span> <span class="n">csr_matrix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">color_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize a hierarchical structure of the topics</span>

<span class="sd">    A ward linkage function is used to perform the</span>
<span class="sd">    hierarchical clustering based on the cosine distance</span>
<span class="sd">    matrix between topic embeddings.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topic_model: A fitted BERTopic instance.</span>
<span class="sd">        orientation: The orientation of the figure.</span>
<span class="sd">                    Either &#39;left&#39; or &#39;bottom&#39;</span>
<span class="sd">        topics: A selection of topics to visualize</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">                   NOTE: Custom labels are only generated for the original</span>
<span class="sd">                   un-merged topics.</span>
<span class="sd">        width: The width of the figure. Only works if orientation is set to &#39;left&#39;</span>
<span class="sd">        height: The height of the figure. Only works if orientation is set to &#39;bottom&#39;</span>
<span class="sd">        hierarchical_topics: A dataframe that contains a hierarchy of topics</span>
<span class="sd">                            represented by their parents and their children.</span>
<span class="sd">                            NOTE: The hierarchical topic names are only visualized</span>
<span class="sd">                            if both `topics` and `top_n_topics` are not set.</span>
<span class="sd">        linkage_function: The linkage function to use. Default is:</span>
<span class="sd">                        `lambda x: sch.linkage(x, &#39;ward&#39;, optimal_ordering=True)`</span>
<span class="sd">                        NOTE: Make sure to use the same `linkage_function` as used</span>
<span class="sd">                        in `topic_model.hierarchical_topics`.</span>
<span class="sd">        distance_function: The distance function to use on the c-TF-IDF matrix. Default is:</span>
<span class="sd">                        `lambda x: 1 - cosine_similarity(x)`</span>
<span class="sd">                        NOTE: Make sure to use the same `distance_function` as used</span>
<span class="sd">                        in `topic_model.hierarchical_topics`.</span>
<span class="sd">        color_threshold: Value at which the separation of clusters will be made which</span>
<span class="sd">                     will result in different colors for different clusters.</span>
<span class="sd">                     A higher value will typically lead in less colored clusters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the hierarchical structure of</span>
<span class="sd">    topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_hierarchy()</span>
<span class="sd">    ```</span>

<span class="sd">    If you also want the labels visualized of hierarchical topics,</span>
<span class="sd">    run the following:</span>

<span class="sd">    ```python</span>
<span class="sd">    # Extract hierarchical topics and their representations</span>
<span class="sd">    hierarchical_topics = topic_model.hierarchical_topics(docs)</span>

<span class="sd">    # Visualize these representations</span>
<span class="sd">    topic_model.visualize_hierarchy(hierarchical_topics=hierarchical_topics)</span>
<span class="sd">    ```</span>

<span class="sd">    If you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_hierarchy()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &lt;iframe src=&quot;../../getting_started/visualization/hierarchy.html&quot;</span>
<span class="sd">    style=&quot;width:1000px; height: 680px; border: 0px;&quot;&quot;&gt;&lt;/iframe&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                                        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                        <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                        <span class="n">hierarchical_topics</span><span class="o">=</span><span class="n">hierarchical_topics</span><span class="p">,</span>
                                        <span class="n">linkage_function</span><span class="o">=</span><span class="n">linkage_function</span><span class="p">,</span>
                                        <span class="n">distance_function</span><span class="o">=</span><span class="n">distance_function</span><span class="p">,</span>
                                        <span class="n">color_threshold</span><span class="o">=</span><span class="n">color_threshold</span>
                                        <span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_term_rank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_term_rank</span><span class="p">(</span><span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_term_rank" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize the ranks of all terms across all topics</p>
<p>Each topic is represented by a set of words. These words, however,
do not all equally represent the topic. This visualization shows
how many words are needed to represent a topic and at which point
the beneficial effect of adding words starts to decline.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize. These will be colored
    red where all others will be colored black.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>log_scale</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to represent the ranking on a log scale</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>800</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>500</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fig</code></td>          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly figure</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the ranks of all words across
all topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Reference:</p>
<p>This visualization was heavily inspired by the
"Term Probability Decline" visualization found in an
analysis by the amazing <a href="https://tmtoolkit.readthedocs.io/">tmtoolkit</a>.
Reference to that specific analysis can be found
<a href="https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html">here</a>.</p>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_term_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">log_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
                        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize the ranks of all terms across all topics</span>

<span class="sd">    Each topic is represented by a set of words. These words, however,</span>
<span class="sd">    do not all equally represent the topic. This visualization shows</span>
<span class="sd">    how many words are needed to represent a topic and at which point</span>
<span class="sd">    the beneficial effect of adding words starts to decline.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize. These will be colored</span>
<span class="sd">                red where all others will be colored black.</span>
<span class="sd">        log_scale: Whether to represent the ranking on a log scale</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: A plotly figure</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the ranks of all words across</span>
<span class="sd">    all topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_term_rank()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_term_rank()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Reference:</span>

<span class="sd">    This visualization was heavily inspired by the</span>
<span class="sd">    &quot;Term Probability Decline&quot; visualization found in an</span>
<span class="sd">    analysis by the amazing [tmtoolkit](https://tmtoolkit.readthedocs.io/).</span>
<span class="sd">    Reference to that specific analysis can be found</span>
<span class="sd">    [here](https://wzbsocialsciencecenter.github.io/tm_corona/tm_analysis.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_term_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                        <span class="n">log_scale</span><span class="o">=</span><span class="n">log_scale</span><span class="p">,</span>
                                        <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics</span><span class="p">(</span><span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">650</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_topics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize topics, their sizes, and their corresponding words</p>
<p>This visualization is highly inspired by LDAvis, a great visualization
technique typically reserved for LDA.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>A selection of topics to visualize</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Only select the top n most frequent topics</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>650</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>650</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">()</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
                     <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize topics, their sizes, and their corresponding words</span>

<span class="sd">    This visualization is highly inspired by LDAvis, a great visualization</span>
<span class="sd">    technique typically reserved for LDA.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics: A selection of topics to visualize</span>
<span class="sd">        top_n_topics: Only select the top n most frequent topics</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the topics simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topic_model.visualize_topics()</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics()</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                     <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                     <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                     <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics_over_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_frequency</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_topics_over_time" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize topics over time</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics_over_time</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The topics you would like to be visualized with the
              corresponding topic representation</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>To visualize the most frequent topics instead of all</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>Select which topics you would like to be visualized</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>normalize_frequency</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to normalize each topic's frequency individually</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>1250</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>450</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly.graph_objects.Figure including all traces</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics over time, simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_over_time</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_over_time</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="n">topics_over_time</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">topics_over_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                               <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
                               <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">450</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize topics over time</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics_over_time: The topics you would like to be visualized with the</span>
<span class="sd">                          corresponding topic representation</span>
<span class="sd">        top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">        topics: Select which topics you would like to be visualized</span>
<span class="sd">        normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A plotly.graph_objects.Figure including all traces</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the topics over time, simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_over_time = topic_model.topics_over_time(docs, timestamps)</span>
<span class="sd">    topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics_over_time(topics_over_time)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">topics_over_time</span><span class="o">=</span><span class="n">topics_over_time</span><span class="p">,</span>
                                               <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                               <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                               <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
                                               <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                               <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                               <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="bertopic._bertopic.BERTopic.visualize_topics_per_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">,</span> <span class="n">top_n_topics</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_frequency</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span></code>

<a href="#bertopic._bertopic.BERTopic.visualize_topics_per_class" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualize topics per class</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>topics_per_class</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The topics you would like to be visualized with the
              corresponding topic representation</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>top_n_topics</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>To visualize the most frequent topics instead of all</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td><p>Select which topics you would like to be visualized</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>normalize_frequency</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to normalize each topic's frequency individually</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>custom_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to use custom topic labels that were defined using
       <code>topic_model.set_topic_labels</code>.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The width of the figure.</p></td>
          <td>
                <code>1250</code>
          </td>
        </tr>
        <tr>
          <td><code>height</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The height of the figure.</p></td>
          <td>
                <code>900</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.graph_objects">go</span>.<span title="plotly.graph_objects.Figure">Figure</span></code>
          </td>
          <td><p>A plotly.graph_objects.Figure including all traces</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    
      <p>To visualize the topics per class, simply run:</p>
<div class="highlight"><pre><span></span><code><span class="n">topics_per_class</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">topics_per_class</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
<span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">)</span>
</code></pre></div>
<p>Or if you want to save the resulting figure:</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="n">topics_per_class</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="s2">&quot;path/to/file.html&quot;</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>bertopic\_bertopic.py</code></summary>
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">topics_per_class</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                               <span class="n">top_n_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                               <span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">normalize_frequency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">custom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
                               <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">900</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Visualize topics per class</span>

<span class="sd">    Arguments:</span>
<span class="sd">        topics_per_class: The topics you would like to be visualized with the</span>
<span class="sd">                          corresponding topic representation</span>
<span class="sd">        top_n_topics: To visualize the most frequent topics instead of all</span>
<span class="sd">        topics: Select which topics you would like to be visualized</span>
<span class="sd">        normalize_frequency: Whether to normalize each topic&#39;s frequency individually</span>
<span class="sd">        custom_labels: Whether to use custom topic labels that were defined using</span>
<span class="sd">                   `topic_model.set_topic_labels`.</span>
<span class="sd">        width: The width of the figure.</span>
<span class="sd">        height: The height of the figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A plotly.graph_objects.Figure including all traces</span>

<span class="sd">    Examples:</span>

<span class="sd">    To visualize the topics per class, simply run:</span>

<span class="sd">    ```python</span>
<span class="sd">    topics_per_class = topic_model.topics_per_class(docs, classes)</span>
<span class="sd">    topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">    ```</span>

<span class="sd">    Or if you want to save the resulting figure:</span>

<span class="sd">    ```python</span>
<span class="sd">    fig = topic_model.visualize_topics_per_class(topics_per_class)</span>
<span class="sd">    fig.write_html(&quot;path/to/file.html&quot;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plotting</span><span class="o">.</span><span class="n">visualize_topics_per_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">topics_per_class</span><span class="o">=</span><span class="n">topics_per_class</span><span class="p">,</span>
                                               <span class="n">top_n_topics</span><span class="o">=</span><span class="n">top_n_topics</span><span class="p">,</span>
                                               <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">,</span>
                                               <span class="n">normalize_frequency</span><span class="o">=</span><span class="n">normalize_frequency</span><span class="p">,</span>
                                               <span class="n">custom_labels</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">,</span>
                                               <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                               <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../faq.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: FAQ" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              FAQ
            </div>
          </div>
        </a>
      
      
        
        <a href="mmr.html" class="md-footer__link md-footer__link--next" aria-label="Next: MMR" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              MMR
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 Maintained by <a href="https://github.com/MaartenGr">Maarten</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>